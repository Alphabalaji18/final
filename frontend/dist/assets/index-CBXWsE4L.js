function ate(s,i){for(var a=0;a<i.length;a++){const c=i[a];if(typeof c!="string"&&!Array.isArray(c)){for(const p in c)if(p!=="default"&&!(p in s)){const _=Object.getOwnPropertyDescriptor(c,p);_&&Object.defineProperty(s,p,_.get?_:{enumerable:!0,get:()=>c[p]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))c(p);new MutationObserver(p=>{for(const _ of p)if(_.type==="childList")for(const y of _.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&c(y)}).observe(document,{childList:!0,subtree:!0});function a(p){const _={};return p.integrity&&(_.integrity=p.integrity),p.referrerPolicy&&(_.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?_.credentials="include":p.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function c(p){if(p.ep)return;p.ep=!0;const _=a(p);fetch(p.href,_)}})();var AN=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function BG(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var IN={exports:{}},Jy={},ON={exports:{}},rn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var y4;function cte(){if(y4)return rn;y4=1;var s=Symbol.for("react.element"),i=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),c=Symbol.for("react.strict_mode"),p=Symbol.for("react.profiler"),_=Symbol.for("react.provider"),y=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),I=Symbol.for("react.memo"),D=Symbol.for("react.lazy"),L=Symbol.iterator;function j(de){return de===null||typeof de!="object"?null:(de=L&&de[L]||de["@@iterator"],typeof de=="function"?de:null)}var Y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},X=Object.assign,ee={};function Q(de,Ue,zt){this.props=de,this.context=Ue,this.refs=ee,this.updater=zt||Y}Q.prototype.isReactComponent={},Q.prototype.setState=function(de,Ue){if(typeof de!="object"&&typeof de!="function"&&de!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,de,Ue,"setState")},Q.prototype.forceUpdate=function(de){this.updater.enqueueForceUpdate(this,de,"forceUpdate")};function se(){}se.prototype=Q.prototype;function fe(de,Ue,zt){this.props=de,this.context=Ue,this.refs=ee,this.updater=zt||Y}var me=fe.prototype=new se;me.constructor=fe,X(me,Q.prototype),me.isPureReactComponent=!0;var Oe=Array.isArray,Ve=Object.prototype.hasOwnProperty,Ze={current:null},ut={key:!0,ref:!0,__self:!0,__source:!0};function rt(de,Ue,zt){var Dt,sn={},Ht=null,Gn=null;if(Ue!=null)for(Dt in Ue.ref!==void 0&&(Gn=Ue.ref),Ue.key!==void 0&&(Ht=""+Ue.key),Ue)Ve.call(Ue,Dt)&&!ut.hasOwnProperty(Dt)&&(sn[Dt]=Ue[Dt]);var On=arguments.length-2;if(On===1)sn.children=zt;else if(1<On){for(var Wn=Array(On),ps=0;ps<On;ps++)Wn[ps]=arguments[ps+2];sn.children=Wn}if(de&&de.defaultProps)for(Dt in On=de.defaultProps,On)sn[Dt]===void 0&&(sn[Dt]=On[Dt]);return{$$typeof:s,type:de,key:Ht,ref:Gn,props:sn,_owner:Ze.current}}function dn(de,Ue){return{$$typeof:s,type:de.type,key:Ue,ref:de.ref,props:de.props,_owner:de._owner}}function tn(de){return typeof de=="object"&&de!==null&&de.$$typeof===s}function bi(de){var Ue={"=":"=0",":":"=2"};return"$"+de.replace(/[=:]/g,function(zt){return Ue[zt]})}var Ai=/\/+/g;function Qi(de,Ue){return typeof de=="object"&&de!==null&&de.key!=null?bi(""+de.key):Ue.toString(36)}function qt(de,Ue,zt,Dt,sn){var Ht=typeof de;(Ht==="undefined"||Ht==="boolean")&&(de=null);var Gn=!1;if(de===null)Gn=!0;else switch(Ht){case"string":case"number":Gn=!0;break;case"object":switch(de.$$typeof){case s:case i:Gn=!0}}if(Gn)return Gn=de,sn=sn(Gn),de=Dt===""?"."+Qi(Gn,0):Dt,Oe(sn)?(zt="",de!=null&&(zt=de.replace(Ai,"$&/")+"/"),qt(sn,Ue,zt,"",function(ps){return ps})):sn!=null&&(tn(sn)&&(sn=dn(sn,zt+(!sn.key||Gn&&Gn.key===sn.key?"":(""+sn.key).replace(Ai,"$&/")+"/")+de)),Ue.push(sn)),1;if(Gn=0,Dt=Dt===""?".":Dt+":",Oe(de))for(var On=0;On<de.length;On++){Ht=de[On];var Wn=Dt+Qi(Ht,On);Gn+=qt(Ht,Ue,zt,Wn,sn)}else if(Wn=j(de),typeof Wn=="function")for(de=Wn.call(de),On=0;!(Ht=de.next()).done;)Ht=Ht.value,Wn=Dt+Qi(Ht,On++),Gn+=qt(Ht,Ue,zt,Wn,sn);else if(Ht==="object")throw Ue=String(de),Error("Objects are not valid as a React child (found: "+(Ue==="[object Object]"?"object with keys {"+Object.keys(de).join(", ")+"}":Ue)+"). If you meant to render a collection of children, use an array instead.");return Gn}function Tr(de,Ue,zt){if(de==null)return de;var Dt=[],sn=0;return qt(de,Dt,"","",function(Ht){return Ue.call(zt,Ht,sn++)}),Dt}function xn(de){if(de._status===-1){var Ue=de._result;Ue=Ue(),Ue.then(function(zt){(de._status===0||de._status===-1)&&(de._status=1,de._result=zt)},function(zt){(de._status===0||de._status===-1)&&(de._status=2,de._result=zt)}),de._status===-1&&(de._status=0,de._result=Ue)}if(de._status===1)return de._result.default;throw de._result}var Yt={current:null},ze={transition:null},Xe={ReactCurrentDispatcher:Yt,ReactCurrentBatchConfig:ze,ReactCurrentOwner:Ze};function $e(){throw Error("act(...) is not supported in production builds of React.")}return rn.Children={map:Tr,forEach:function(de,Ue,zt){Tr(de,function(){Ue.apply(this,arguments)},zt)},count:function(de){var Ue=0;return Tr(de,function(){Ue++}),Ue},toArray:function(de){return Tr(de,function(Ue){return Ue})||[]},only:function(de){if(!tn(de))throw Error("React.Children.only expected to receive a single React element child.");return de}},rn.Component=Q,rn.Fragment=a,rn.Profiler=p,rn.PureComponent=fe,rn.StrictMode=c,rn.Suspense=C,rn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Xe,rn.act=$e,rn.cloneElement=function(de,Ue,zt){if(de==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+de+".");var Dt=X({},de.props),sn=de.key,Ht=de.ref,Gn=de._owner;if(Ue!=null){if(Ue.ref!==void 0&&(Ht=Ue.ref,Gn=Ze.current),Ue.key!==void 0&&(sn=""+Ue.key),de.type&&de.type.defaultProps)var On=de.type.defaultProps;for(Wn in Ue)Ve.call(Ue,Wn)&&!ut.hasOwnProperty(Wn)&&(Dt[Wn]=Ue[Wn]===void 0&&On!==void 0?On[Wn]:Ue[Wn])}var Wn=arguments.length-2;if(Wn===1)Dt.children=zt;else if(1<Wn){On=Array(Wn);for(var ps=0;ps<Wn;ps++)On[ps]=arguments[ps+2];Dt.children=On}return{$$typeof:s,type:de.type,key:sn,ref:Ht,props:Dt,_owner:Gn}},rn.createContext=function(de){return de={$$typeof:y,_currentValue:de,_currentValue2:de,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},de.Provider={$$typeof:_,_context:de},de.Consumer=de},rn.createElement=rt,rn.createFactory=function(de){var Ue=rt.bind(null,de);return Ue.type=de,Ue},rn.createRef=function(){return{current:null}},rn.forwardRef=function(de){return{$$typeof:T,render:de}},rn.isValidElement=tn,rn.lazy=function(de){return{$$typeof:D,_payload:{_status:-1,_result:de},_init:xn}},rn.memo=function(de,Ue){return{$$typeof:I,type:de,compare:Ue===void 0?null:Ue}},rn.startTransition=function(de){var Ue=ze.transition;ze.transition={};try{de()}finally{ze.transition=Ue}},rn.unstable_act=$e,rn.useCallback=function(de,Ue){return Yt.current.useCallback(de,Ue)},rn.useContext=function(de){return Yt.current.useContext(de)},rn.useDebugValue=function(){},rn.useDeferredValue=function(de){return Yt.current.useDeferredValue(de)},rn.useEffect=function(de,Ue){return Yt.current.useEffect(de,Ue)},rn.useId=function(){return Yt.current.useId()},rn.useImperativeHandle=function(de,Ue,zt){return Yt.current.useImperativeHandle(de,Ue,zt)},rn.useInsertionEffect=function(de,Ue){return Yt.current.useInsertionEffect(de,Ue)},rn.useLayoutEffect=function(de,Ue){return Yt.current.useLayoutEffect(de,Ue)},rn.useMemo=function(de,Ue){return Yt.current.useMemo(de,Ue)},rn.useReducer=function(de,Ue,zt){return Yt.current.useReducer(de,Ue,zt)},rn.useRef=function(de){return Yt.current.useRef(de)},rn.useState=function(de){return Yt.current.useState(de)},rn.useSyncExternalStore=function(de,Ue,zt){return Yt.current.useSyncExternalStore(de,Ue,zt)},rn.useTransition=function(){return Yt.current.useTransition()},rn.version="18.3.1",rn}var v4;function TD(){return v4||(v4=1,ON.exports=cte()),ON.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var S4;function lte(){if(S4)return Jy;S4=1;var s=TD(),i=Symbol.for("react.element"),a=Symbol.for("react.fragment"),c=Object.prototype.hasOwnProperty,p=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,_={key:!0,ref:!0,__self:!0,__source:!0};function y(T,C,I){var D,L={},j=null,Y=null;I!==void 0&&(j=""+I),C.key!==void 0&&(j=""+C.key),C.ref!==void 0&&(Y=C.ref);for(D in C)c.call(C,D)&&!_.hasOwnProperty(D)&&(L[D]=C[D]);if(T&&T.defaultProps)for(D in C=T.defaultProps,C)L[D]===void 0&&(L[D]=C[D]);return{$$typeof:i,type:T,key:j,ref:Y,props:L,_owner:p.current}}return Jy.Fragment=a,Jy.jsx=y,Jy.jsxs=y,Jy}var T4;function ute(){return T4||(T4=1,IN.exports=lte()),IN.exports}var H=ute(),_e=TD();const sa=BG(_e),dte=ate({__proto__:null,default:sa},[_e]);var sC={},NN={exports:{}},to={},PN={exports:{}},DN={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var R4;function hte(){return R4||(R4=1,function(s){function i(ze,Xe){var $e=ze.length;ze.push(Xe);e:for(;0<$e;){var de=$e-1>>>1,Ue=ze[de];if(0<p(Ue,Xe))ze[de]=Xe,ze[$e]=Ue,$e=de;else break e}}function a(ze){return ze.length===0?null:ze[0]}function c(ze){if(ze.length===0)return null;var Xe=ze[0],$e=ze.pop();if($e!==Xe){ze[0]=$e;e:for(var de=0,Ue=ze.length,zt=Ue>>>1;de<zt;){var Dt=2*(de+1)-1,sn=ze[Dt],Ht=Dt+1,Gn=ze[Ht];if(0>p(sn,$e))Ht<Ue&&0>p(Gn,sn)?(ze[de]=Gn,ze[Ht]=$e,de=Ht):(ze[de]=sn,ze[Dt]=$e,de=Dt);else if(Ht<Ue&&0>p(Gn,$e))ze[de]=Gn,ze[Ht]=$e,de=Ht;else break e}}return Xe}function p(ze,Xe){var $e=ze.sortIndex-Xe.sortIndex;return $e!==0?$e:ze.id-Xe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var _=performance;s.unstable_now=function(){return _.now()}}else{var y=Date,T=y.now();s.unstable_now=function(){return y.now()-T}}var C=[],I=[],D=1,L=null,j=3,Y=!1,X=!1,ee=!1,Q=typeof setTimeout=="function"?setTimeout:null,se=typeof clearTimeout=="function"?clearTimeout:null,fe=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function me(ze){for(var Xe=a(I);Xe!==null;){if(Xe.callback===null)c(I);else if(Xe.startTime<=ze)c(I),Xe.sortIndex=Xe.expirationTime,i(C,Xe);else break;Xe=a(I)}}function Oe(ze){if(ee=!1,me(ze),!X)if(a(C)!==null)X=!0,xn(Ve);else{var Xe=a(I);Xe!==null&&Yt(Oe,Xe.startTime-ze)}}function Ve(ze,Xe){X=!1,ee&&(ee=!1,se(rt),rt=-1),Y=!0;var $e=j;try{for(me(Xe),L=a(C);L!==null&&(!(L.expirationTime>Xe)||ze&&!bi());){var de=L.callback;if(typeof de=="function"){L.callback=null,j=L.priorityLevel;var Ue=de(L.expirationTime<=Xe);Xe=s.unstable_now(),typeof Ue=="function"?L.callback=Ue:L===a(C)&&c(C),me(Xe)}else c(C);L=a(C)}if(L!==null)var zt=!0;else{var Dt=a(I);Dt!==null&&Yt(Oe,Dt.startTime-Xe),zt=!1}return zt}finally{L=null,j=$e,Y=!1}}var Ze=!1,ut=null,rt=-1,dn=5,tn=-1;function bi(){return!(s.unstable_now()-tn<dn)}function Ai(){if(ut!==null){var ze=s.unstable_now();tn=ze;var Xe=!0;try{Xe=ut(!0,ze)}finally{Xe?Qi():(Ze=!1,ut=null)}}else Ze=!1}var Qi;if(typeof fe=="function")Qi=function(){fe(Ai)};else if(typeof MessageChannel<"u"){var qt=new MessageChannel,Tr=qt.port2;qt.port1.onmessage=Ai,Qi=function(){Tr.postMessage(null)}}else Qi=function(){Q(Ai,0)};function xn(ze){ut=ze,Ze||(Ze=!0,Qi())}function Yt(ze,Xe){rt=Q(function(){ze(s.unstable_now())},Xe)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(ze){ze.callback=null},s.unstable_continueExecution=function(){X||Y||(X=!0,xn(Ve))},s.unstable_forceFrameRate=function(ze){0>ze||125<ze?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):dn=0<ze?Math.floor(1e3/ze):5},s.unstable_getCurrentPriorityLevel=function(){return j},s.unstable_getFirstCallbackNode=function(){return a(C)},s.unstable_next=function(ze){switch(j){case 1:case 2:case 3:var Xe=3;break;default:Xe=j}var $e=j;j=Xe;try{return ze()}finally{j=$e}},s.unstable_pauseExecution=function(){},s.unstable_requestPaint=function(){},s.unstable_runWithPriority=function(ze,Xe){switch(ze){case 1:case 2:case 3:case 4:case 5:break;default:ze=3}var $e=j;j=ze;try{return Xe()}finally{j=$e}},s.unstable_scheduleCallback=function(ze,Xe,$e){var de=s.unstable_now();switch(typeof $e=="object"&&$e!==null?($e=$e.delay,$e=typeof $e=="number"&&0<$e?de+$e:de):$e=de,ze){case 1:var Ue=-1;break;case 2:Ue=250;break;case 5:Ue=1073741823;break;case 4:Ue=1e4;break;default:Ue=5e3}return Ue=$e+Ue,ze={id:D++,callback:Xe,priorityLevel:ze,startTime:$e,expirationTime:Ue,sortIndex:-1},$e>de?(ze.sortIndex=$e,i(I,ze),a(C)===null&&ze===a(I)&&(ee?(se(rt),rt=-1):ee=!0,Yt(Oe,$e-de))):(ze.sortIndex=Ue,i(C,ze),X||Y||(X=!0,xn(Ve))),ze},s.unstable_shouldYield=bi,s.unstable_wrapCallback=function(ze){var Xe=j;return function(){var $e=j;j=Xe;try{return ze.apply(this,arguments)}finally{j=$e}}}}(DN)),DN}var w4;function pte(){return w4||(w4=1,PN.exports=hte()),PN.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var C4;function fte(){if(C4)return to;C4=1;var s=TD(),i=pte();function a(d){for(var f="https://reactjs.org/docs/error-decoder.html?invariant="+d,v=1;v<arguments.length;v++)f+="&args[]="+encodeURIComponent(arguments[v]);return"Minified React error #"+d+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var c=new Set,p={};function _(d,f){y(d,f),y(d+"Capture",f)}function y(d,f){for(p[d]=f,d=0;d<f.length;d++)c.add(f[d])}var T=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),C=Object.prototype.hasOwnProperty,I=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,D={},L={};function j(d){return C.call(L,d)?!0:C.call(D,d)?!1:I.test(d)?L[d]=!0:(D[d]=!0,!1)}function Y(d,f,v,w){if(v!==null&&v.type===0)return!1;switch(typeof f){case"function":case"symbol":return!0;case"boolean":return w?!1:v!==null?!v.acceptsBooleans:(d=d.toLowerCase().slice(0,5),d!=="data-"&&d!=="aria-");default:return!1}}function X(d,f,v,w){if(f===null||typeof f>"u"||Y(d,f,v,w))return!0;if(w)return!1;if(v!==null)switch(v.type){case 3:return!f;case 4:return f===!1;case 5:return isNaN(f);case 6:return isNaN(f)||1>f}return!1}function ee(d,f,v,w,N,M,z){this.acceptsBooleans=f===2||f===3||f===4,this.attributeName=w,this.attributeNamespace=N,this.mustUseProperty=v,this.propertyName=d,this.type=f,this.sanitizeURL=M,this.removeEmptyString=z}var Q={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(d){Q[d]=new ee(d,0,!1,d,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(d){var f=d[0];Q[f]=new ee(f,1,!1,d[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(d){Q[d]=new ee(d,2,!1,d.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(d){Q[d]=new ee(d,2,!1,d,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(d){Q[d]=new ee(d,3,!1,d.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(d){Q[d]=new ee(d,3,!0,d,null,!1,!1)}),["capture","download"].forEach(function(d){Q[d]=new ee(d,4,!1,d,null,!1,!1)}),["cols","rows","size","span"].forEach(function(d){Q[d]=new ee(d,6,!1,d,null,!1,!1)}),["rowSpan","start"].forEach(function(d){Q[d]=new ee(d,5,!1,d.toLowerCase(),null,!1,!1)});var se=/[\-:]([a-z])/g;function fe(d){return d[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(d){var f=d.replace(se,fe);Q[f]=new ee(f,1,!1,d,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(d){var f=d.replace(se,fe);Q[f]=new ee(f,1,!1,d,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(d){var f=d.replace(se,fe);Q[f]=new ee(f,1,!1,d,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(d){Q[d]=new ee(d,1,!1,d.toLowerCase(),null,!1,!1)}),Q.xlinkHref=new ee("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(d){Q[d]=new ee(d,1,!1,d.toLowerCase(),null,!0,!0)});function me(d,f,v,w){var N=Q.hasOwnProperty(f)?Q[f]:null;(N!==null?N.type!==0:w||!(2<f.length)||f[0]!=="o"&&f[0]!=="O"||f[1]!=="n"&&f[1]!=="N")&&(X(f,v,N,w)&&(v=null),w||N===null?j(f)&&(v===null?d.removeAttribute(f):d.setAttribute(f,""+v)):N.mustUseProperty?d[N.propertyName]=v===null?N.type===3?!1:"":v:(f=N.attributeName,w=N.attributeNamespace,v===null?d.removeAttribute(f):(N=N.type,v=N===3||N===4&&v===!0?"":""+v,w?d.setAttributeNS(w,f,v):d.setAttribute(f,v))))}var Oe=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ve=Symbol.for("react.element"),Ze=Symbol.for("react.portal"),ut=Symbol.for("react.fragment"),rt=Symbol.for("react.strict_mode"),dn=Symbol.for("react.profiler"),tn=Symbol.for("react.provider"),bi=Symbol.for("react.context"),Ai=Symbol.for("react.forward_ref"),Qi=Symbol.for("react.suspense"),qt=Symbol.for("react.suspense_list"),Tr=Symbol.for("react.memo"),xn=Symbol.for("react.lazy"),Yt=Symbol.for("react.offscreen"),ze=Symbol.iterator;function Xe(d){return d===null||typeof d!="object"?null:(d=ze&&d[ze]||d["@@iterator"],typeof d=="function"?d:null)}var $e=Object.assign,de;function Ue(d){if(de===void 0)try{throw Error()}catch(v){var f=v.stack.trim().match(/\n( *(at )?)/);de=f&&f[1]||""}return`
`+de+d}var zt=!1;function Dt(d,f){if(!d||zt)return"";zt=!0;var v=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(f)if(f=function(){throw Error()},Object.defineProperty(f.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(f,[])}catch(ve){var w=ve}Reflect.construct(d,[],f)}else{try{f.call()}catch(ve){w=ve}d.call(f.prototype)}else{try{throw Error()}catch(ve){w=ve}d()}}catch(ve){if(ve&&w&&typeof ve.stack=="string"){for(var N=ve.stack.split(`
`),M=w.stack.split(`
`),z=N.length-1,te=M.length-1;1<=z&&0<=te&&N[z]!==M[te];)te--;for(;1<=z&&0<=te;z--,te--)if(N[z]!==M[te]){if(z!==1||te!==1)do if(z--,te--,0>te||N[z]!==M[te]){var ae=`
`+N[z].replace(" at new "," at ");return d.displayName&&ae.includes("<anonymous>")&&(ae=ae.replace("<anonymous>",d.displayName)),ae}while(1<=z&&0<=te);break}}}finally{zt=!1,Error.prepareStackTrace=v}return(d=d?d.displayName||d.name:"")?Ue(d):""}function sn(d){switch(d.tag){case 5:return Ue(d.type);case 16:return Ue("Lazy");case 13:return Ue("Suspense");case 19:return Ue("SuspenseList");case 0:case 2:case 15:return d=Dt(d.type,!1),d;case 11:return d=Dt(d.type.render,!1),d;case 1:return d=Dt(d.type,!0),d;default:return""}}function Ht(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case ut:return"Fragment";case Ze:return"Portal";case dn:return"Profiler";case rt:return"StrictMode";case Qi:return"Suspense";case qt:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case bi:return(d.displayName||"Context")+".Consumer";case tn:return(d._context.displayName||"Context")+".Provider";case Ai:var f=d.render;return d=d.displayName,d||(d=f.displayName||f.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case Tr:return f=d.displayName||null,f!==null?f:Ht(d.type)||"Memo";case xn:f=d._payload,d=d._init;try{return Ht(d(f))}catch{}}return null}function Gn(d){var f=d.type;switch(d.tag){case 24:return"Cache";case 9:return(f.displayName||"Context")+".Consumer";case 10:return(f._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return d=f.render,d=d.displayName||d.name||"",f.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case 7:return"Fragment";case 5:return f;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ht(f);case 8:return f===rt?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f}return null}function On(d){switch(typeof d){case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function Wn(d){var f=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(f==="checkbox"||f==="radio")}function ps(d){var f=Wn(d)?"checked":"value",v=Object.getOwnPropertyDescriptor(d.constructor.prototype,f),w=""+d[f];if(!d.hasOwnProperty(f)&&typeof v<"u"&&typeof v.get=="function"&&typeof v.set=="function"){var N=v.get,M=v.set;return Object.defineProperty(d,f,{configurable:!0,get:function(){return N.call(this)},set:function(z){w=""+z,M.call(this,z)}}),Object.defineProperty(d,f,{enumerable:v.enumerable}),{getValue:function(){return w},setValue:function(z){w=""+z},stopTracking:function(){d._valueTracker=null,delete d[f]}}}}function Qc(d){d._valueTracker||(d._valueTracker=ps(d))}function Zc(d){if(!d)return!1;var f=d._valueTracker;if(!f)return!0;var v=f.getValue(),w="";return d&&(w=Wn(d)?d.checked?"true":"false":d.value),d=w,d!==v?(f.setValue(d),!0):!1}function Hp(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}function c_(d,f){var v=f.checked;return $e({},f,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:v??d._wrapperState.initialChecked})}function el(d,f){var v=f.defaultValue==null?"":f.defaultValue,w=f.checked!=null?f.checked:f.defaultChecked;v=On(f.value!=null?f.value:v),d._wrapperState={initialChecked:w,initialValue:v,controlled:f.type==="checkbox"||f.type==="radio"?f.checked!=null:f.value!=null}}function Hv(d,f){f=f.checked,f!=null&&me(d,"checked",f,!1)}function l_(d,f){Hv(d,f);var v=On(f.value),w=f.type;if(v!=null)w==="number"?(v===0&&d.value===""||d.value!=v)&&(d.value=""+v):d.value!==""+v&&(d.value=""+v);else if(w==="submit"||w==="reset"){d.removeAttribute("value");return}f.hasOwnProperty("value")?Kp(d,f.type,v):f.hasOwnProperty("defaultValue")&&Kp(d,f.type,On(f.defaultValue)),f.checked==null&&f.defaultChecked!=null&&(d.defaultChecked=!!f.defaultChecked)}function ca(d,f,v){if(f.hasOwnProperty("value")||f.hasOwnProperty("defaultValue")){var w=f.type;if(!(w!=="submit"&&w!=="reset"||f.value!==void 0&&f.value!==null))return;f=""+d._wrapperState.initialValue,v||f===d.value||(d.value=f),d.defaultValue=f}v=d.name,v!==""&&(d.name=""),d.defaultChecked=!!d._wrapperState.initialChecked,v!==""&&(d.name=v)}function Kp(d,f,v){(f!=="number"||Hp(d.ownerDocument)!==d)&&(v==null?d.defaultValue=""+d._wrapperState.initialValue:d.defaultValue!==""+v&&(d.defaultValue=""+v))}var Md=Array.isArray;function ji(d,f,v,w){if(d=d.options,f){f={};for(var N=0;N<v.length;N++)f["$"+v[N]]=!0;for(v=0;v<d.length;v++)N=f.hasOwnProperty("$"+d[v].value),d[v].selected!==N&&(d[v].selected=N),N&&w&&(d[v].defaultSelected=!0)}else{for(v=""+On(v),f=null,N=0;N<d.length;N++){if(d[N].value===v){d[N].selected=!0,w&&(d[N].defaultSelected=!0);return}f!==null||d[N].disabled||(f=d[N])}f!==null&&(f.selected=!0)}}function Rr(d,f){if(f.dangerouslySetInnerHTML!=null)throw Error(a(91));return $e({},f,{value:void 0,defaultValue:void 0,children:""+d._wrapperState.initialValue})}function qp(d,f){var v=f.value;if(v==null){if(v=f.children,f=f.defaultValue,v!=null){if(f!=null)throw Error(a(92));if(Md(v)){if(1<v.length)throw Error(a(93));v=v[0]}f=v}f==null&&(f=""),v=f}d._wrapperState={initialValue:On(v)}}function Yp(d,f){var v=On(f.value),w=On(f.defaultValue);v!=null&&(v=""+v,v!==d.value&&(d.value=v),f.defaultValue==null&&d.defaultValue!==v&&(d.defaultValue=v)),w!=null&&(d.defaultValue=""+w)}function Kv(d){var f=d.textContent;f===d._wrapperState.initialValue&&f!==""&&f!==null&&(d.value=f)}function u_(d){switch(d){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Zi(d,f){return d==null||d==="http://www.w3.org/1999/xhtml"?u_(f):d==="http://www.w3.org/2000/svg"&&f==="foreignObject"?"http://www.w3.org/1999/xhtml":d}var oo,d_=function(d){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(f,v,w,N){MSApp.execUnsafeLocalFunction(function(){return d(f,v,w,N)})}:d}(function(d,f){if(d.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in d)d.innerHTML=f;else{for(oo=oo||document.createElement("div"),oo.innerHTML="<svg>"+f.valueOf().toString()+"</svg>",f=oo.firstChild;d.firstChild;)d.removeChild(d.firstChild);for(;f.firstChild;)d.appendChild(f.firstChild)}});function tl(d,f){if(f){var v=d.firstChild;if(v&&v===d.lastChild&&v.nodeType===3){v.nodeValue=f;return}}d.textContent=f}var au={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qv=["Webkit","ms","Moz","O"];Object.keys(au).forEach(function(d){qv.forEach(function(f){f=f+d.charAt(0).toUpperCase()+d.substring(1),au[f]=au[d]})});function h_(d,f,v){return f==null||typeof f=="boolean"||f===""?"":v||typeof f!="number"||f===0||au.hasOwnProperty(d)&&au[d]?(""+f).trim():f+"px"}function p_(d,f){d=d.style;for(var v in f)if(f.hasOwnProperty(v)){var w=v.indexOf("--")===0,N=h_(v,f[v],w);v==="float"&&(v="cssFloat"),w?d.setProperty(v,N):d[v]=N}}var nl=$e({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Xp(d,f){if(f){if(nl[d]&&(f.children!=null||f.dangerouslySetInnerHTML!=null))throw Error(a(137,d));if(f.dangerouslySetInnerHTML!=null){if(f.children!=null)throw Error(a(60));if(typeof f.dangerouslySetInnerHTML!="object"||!("__html"in f.dangerouslySetInnerHTML))throw Error(a(61))}if(f.style!=null&&typeof f.style!="object")throw Error(a(62))}}function f_(d,f){if(d.indexOf("-")===-1)return typeof f.is=="string";switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var m_=null;function Xa(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var Jp=null,cu=null,lu=null;function Yv(d){if(d=Ru(d)){if(typeof Jp!="function")throw Error(a(280));var f=d.stateNode;f&&(f=wu(f),Jp(d.stateNode,d.type,f))}}function Xv(d){cu?lu?lu.push(d):lu=[d]:cu=d}function uu(){if(cu){var d=cu,f=lu;if(lu=cu=null,Yv(d),f)for(d=0;d<f.length;d++)Yv(f[d])}}function Jv(d,f){return d(f)}function il(){}var g_=!1;function $v(d,f,v){if(g_)return d(f,v);g_=!0;try{return Jv(d,f,v)}finally{g_=!1,(cu!==null||lu!==null)&&(il(),uu())}}function Ud(d,f){var v=d.stateNode;if(v===null)return null;var w=wu(v);if(w===null)return null;v=w[f];e:switch(f){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(w=!w.disabled)||(d=d.type,w=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!w;break e;default:d=!1}if(d)return null;if(v&&typeof v!="function")throw Error(a(231,f,typeof v));return v}var wr=!1;if(T)try{var Vd={};Object.defineProperty(Vd,"passive",{get:function(){wr=!0}}),window.addEventListener("test",Vd,Vd),window.removeEventListener("test",Vd,Vd)}catch{wr=!1}function Ob(d,f,v,w,N,M,z,te,ae){var ve=Array.prototype.slice.call(arguments,3);try{f.apply(v,ve)}catch(Fe){this.onError(Fe)}}var Ja=!1,Fd=null,Bd=!1,$p=null,Nb={onError:function(d){Ja=!0,Fd=d}};function Qv(d,f,v,w,N,M,z,te,ae){Ja=!1,Fd=null,Ob.apply(Nb,arguments)}function Zv(d,f,v,w,N,M,z,te,ae){if(Qv.apply(this,arguments),Ja){if(Ja){var ve=Fd;Ja=!1,Fd=null}else throw Error(a(198));Bd||(Bd=!0,$p=ve)}}function rl(d){var f=d,v=d;if(d.alternate)for(;f.return;)f=f.return;else{d=f;do f=d,(f.flags&4098)!==0&&(v=f.return),d=f.return;while(d)}return f.tag===3?v:null}function eS(d){if(d.tag===13){var f=d.memoizedState;if(f===null&&(d=d.alternate,d!==null&&(f=d.memoizedState)),f!==null)return f.dehydrated}return null}function __(d){if(rl(d)!==d)throw Error(a(188))}function E_(d){var f=d.alternate;if(!f){if(f=rl(d),f===null)throw Error(a(188));return f!==d?null:d}for(var v=d,w=f;;){var N=v.return;if(N===null)break;var M=N.alternate;if(M===null){if(w=N.return,w!==null){v=w;continue}break}if(N.child===M.child){for(M=N.child;M;){if(M===v)return __(N),d;if(M===w)return __(N),f;M=M.sibling}throw Error(a(188))}if(v.return!==w.return)v=N,w=M;else{for(var z=!1,te=N.child;te;){if(te===v){z=!0,v=N,w=M;break}if(te===w){z=!0,w=N,v=M;break}te=te.sibling}if(!z){for(te=M.child;te;){if(te===v){z=!0,v=M,w=N;break}if(te===w){z=!0,w=M,v=N;break}te=te.sibling}if(!z)throw Error(a(189))}}if(v.alternate!==w)throw Error(a(190))}if(v.tag!==3)throw Error(a(188));return v.stateNode.current===v?d:f}function y_(d){return d=E_(d),d!==null?sl(d):null}function sl(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){var f=sl(d);if(f!==null)return f;d=d.sibling}return null}var tS=i.unstable_scheduleCallback,nS=i.unstable_cancelCallback,bo=i.unstable_shouldYield,Pb=i.unstable_requestPaint,Ei=i.unstable_now,yi=i.unstable_getCurrentPriorityLevel,v_=i.unstable_ImmediatePriority,iS=i.unstable_UserBlockingPriority,Qp=i.unstable_NormalPriority,Db=i.unstable_LowPriority,Zp=i.unstable_IdlePriority,ef=null,ao=null;function kb(d){if(ao&&typeof ao.onCommitFiberRoot=="function")try{ao.onCommitFiberRoot(ef,d,void 0,(d.current.flags&128)===128)}catch{}}var co=Math.clz32?Math.clz32:S_,Lb=Math.log,du=Math.LN2;function S_(d){return d>>>=0,d===0?32:31-(Lb(d)/du|0)|0}var tf=64,_n=4194304;function jd(d){switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return d&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return d}}function Gd(d,f){var v=d.pendingLanes;if(v===0)return 0;var w=0,N=d.suspendedLanes,M=d.pingedLanes,z=v&268435455;if(z!==0){var te=z&~N;te!==0?w=jd(te):(M&=z,M!==0&&(w=jd(M)))}else z=v&~N,z!==0?w=jd(z):M!==0&&(w=jd(M));if(w===0)return 0;if(f!==0&&f!==w&&(f&N)===0&&(N=w&-w,M=f&-f,N>=M||N===16&&(M&4194240)!==0))return f;if((w&4)!==0&&(w|=v&16),f=d.entangledLanes,f!==0)for(d=d.entanglements,f&=w;0<f;)v=31-co(f),N=1<<v,w|=d[v],f&=~N;return w}function rS(d,f){switch(d){case 1:case 2:case 4:return f+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function xb(d,f){for(var v=d.suspendedLanes,w=d.pingedLanes,N=d.expirationTimes,M=d.pendingLanes;0<M;){var z=31-co(M),te=1<<z,ae=N[z];ae===-1?((te&v)===0||(te&w)!==0)&&(N[z]=rS(te,f)):ae<=f&&(d.expiredLanes|=te),M&=~te}}function T_(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function sS(){var d=tf;return tf<<=1,(tf&4194240)===0&&(tf=64),d}function R_(d){for(var f=[],v=0;31>v;v++)f.push(d);return f}function Wd(d,f,v){d.pendingLanes|=f,f!==536870912&&(d.suspendedLanes=0,d.pingedLanes=0),d=d.eventTimes,f=31-co(f),d[f]=v}function Mb(d,f){var v=d.pendingLanes&~f;d.pendingLanes=f,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=f,d.mutableReadLanes&=f,d.entangledLanes&=f,f=d.entanglements;var w=d.eventTimes;for(d=d.expirationTimes;0<v;){var N=31-co(v),M=1<<N;f[N]=0,w[N]=-1,d[N]=-1,v&=~M}}function hu(d,f){var v=d.entangledLanes|=f;for(d=d.entanglements;v;){var w=31-co(v),N=1<<w;N&f|d[w]&f&&(d[w]|=f),v&=~N}}var Cn=0;function nf(d){return d&=-d,1<d?4<d?(d&268435455)!==0?16:536870912:4:1}var oS,zd,aS,w_,cS,C_=!1,rf=[],$a=null,Qa=null,Za=null,Hd=new Map,Kd=new Map,la=[],Ub="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function lS(d,f){switch(d){case"focusin":case"focusout":$a=null;break;case"dragenter":case"dragleave":Qa=null;break;case"mouseover":case"mouseout":Za=null;break;case"pointerover":case"pointerout":Hd.delete(f.pointerId);break;case"gotpointercapture":case"lostpointercapture":Kd.delete(f.pointerId)}}function qd(d,f,v,w,N,M){return d===null||d.nativeEvent!==M?(d={blockedOn:f,domEventName:v,eventSystemFlags:w,nativeEvent:M,targetContainers:[N]},f!==null&&(f=Ru(f),f!==null&&zd(f)),d):(d.eventSystemFlags|=w,f=d.targetContainers,N!==null&&f.indexOf(N)===-1&&f.push(N),d)}function Yd(d,f,v,w,N){switch(f){case"focusin":return $a=qd($a,d,f,v,w,N),!0;case"dragenter":return Qa=qd(Qa,d,f,v,w,N),!0;case"mouseover":return Za=qd(Za,d,f,v,w,N),!0;case"pointerover":var M=N.pointerId;return Hd.set(M,qd(Hd.get(M)||null,d,f,v,w,N)),!0;case"gotpointercapture":return M=N.pointerId,Kd.set(M,qd(Kd.get(M)||null,d,f,v,w,N)),!0}return!1}function uS(d){var f=ml(d.target);if(f!==null){var v=rl(f);if(v!==null){if(f=v.tag,f===13){if(f=eS(v),f!==null){d.blockedOn=f,cS(d.priority,function(){aS(v)});return}}else if(f===3&&v.stateNode.current.memoizedState.isDehydrated){d.blockedOn=v.tag===3?v.stateNode.containerInfo:null;return}}}d.blockedOn=null}function sf(d){if(d.blockedOn!==null)return!1;for(var f=d.targetContainers;0<f.length;){var v=b_(d.domEventName,d.eventSystemFlags,f[0],d.nativeEvent);if(v===null){v=d.nativeEvent;var w=new v.constructor(v.type,v);m_=w,v.target.dispatchEvent(w),m_=null}else return f=Ru(v),f!==null&&zd(f),d.blockedOn=v,!1;f.shift()}return!0}function dS(d,f,v){sf(d)&&v.delete(f)}function Vb(){C_=!1,$a!==null&&sf($a)&&($a=null),Qa!==null&&sf(Qa)&&(Qa=null),Za!==null&&sf(Za)&&(Za=null),Hd.forEach(dS),Kd.forEach(dS)}function pu(d,f){d.blockedOn===f&&(d.blockedOn=null,C_||(C_=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Vb)))}function Xd(d){function f(N){return pu(N,d)}if(0<rf.length){pu(rf[0],d);for(var v=1;v<rf.length;v++){var w=rf[v];w.blockedOn===d&&(w.blockedOn=null)}}for($a!==null&&pu($a,d),Qa!==null&&pu(Qa,d),Za!==null&&pu(Za,d),Hd.forEach(f),Kd.forEach(f),v=0;v<la.length;v++)w=la[v],w.blockedOn===d&&(w.blockedOn=null);for(;0<la.length&&(v=la[0],v.blockedOn===null);)uS(v),v.blockedOn===null&&la.shift()}var fu=Oe.ReactCurrentBatchConfig,of=!0;function ec(d,f,v,w){var N=Cn,M=fu.transition;fu.transition=null;try{Cn=1,af(d,f,v,w)}finally{Cn=N,fu.transition=M}}function Os(d,f,v,w){var N=Cn,M=fu.transition;fu.transition=null;try{Cn=4,af(d,f,v,w)}finally{Cn=N,fu.transition=M}}function af(d,f,v,w){if(of){var N=b_(d,f,v,w);if(N===null)mf(d,f,w,cf,v),lS(d,w);else if(Yd(N,d,f,v,w))w.stopPropagation();else if(lS(d,w),f&4&&-1<Ub.indexOf(d)){for(;N!==null;){var M=Ru(N);if(M!==null&&oS(M),M=b_(d,f,v,w),M===null&&mf(d,f,w,cf,v),M===N)break;N=M}N!==null&&w.stopPropagation()}else mf(d,f,w,null,v)}}var cf=null;function b_(d,f,v,w){if(cf=null,d=Xa(w),d=ml(d),d!==null)if(f=rl(d),f===null)d=null;else if(v=f.tag,v===13){if(d=eS(f),d!==null)return d;d=null}else if(v===3){if(f.stateNode.current.memoizedState.isDehydrated)return f.tag===3?f.stateNode.containerInfo:null;d=null}else f!==d&&(d=null);return cf=d,null}function hS(d){switch(d){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(yi()){case v_:return 1;case iS:return 4;case Qp:case Db:return 16;case Zp:return 536870912;default:return 16}default:return 16}}var ii=null,A_=null,lf=null;function pS(){if(lf)return lf;var d,f=A_,v=f.length,w,N="value"in ii?ii.value:ii.textContent,M=N.length;for(d=0;d<v&&f[d]===N[d];d++);var z=v-d;for(w=1;w<=z&&f[v-w]===N[M-w];w++);return lf=N.slice(d,1<w?1-w:void 0)}function ol(d){var f=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&f===13&&(d=13)):d=f,d===10&&(d=13),32<=d||d===13?d:0}function Jd(){return!0}function fS(){return!1}function Cr(d){function f(v,w,N,M,z){this._reactName=v,this._targetInst=N,this.type=w,this.nativeEvent=M,this.target=z,this.currentTarget=null;for(var te in d)d.hasOwnProperty(te)&&(v=d[te],this[te]=v?v(M):M[te]);return this.isDefaultPrevented=(M.defaultPrevented!=null?M.defaultPrevented:M.returnValue===!1)?Jd:fS,this.isPropagationStopped=fS,this}return $e(f.prototype,{preventDefault:function(){this.defaultPrevented=!0;var v=this.nativeEvent;v&&(v.preventDefault?v.preventDefault():typeof v.returnValue!="unknown"&&(v.returnValue=!1),this.isDefaultPrevented=Jd)},stopPropagation:function(){var v=this.nativeEvent;v&&(v.stopPropagation?v.stopPropagation():typeof v.cancelBubble!="unknown"&&(v.cancelBubble=!0),this.isPropagationStopped=Jd)},persist:function(){},isPersistent:Jd}),f}var mu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},$d=Cr(mu),al=$e({},mu,{view:0,detail:0}),I_=Cr(al),O_,N_,Ns,cl=$e({},al,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Qd,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==Ns&&(Ns&&d.type==="mousemove"?(O_=d.screenX-Ns.screenX,N_=d.screenY-Ns.screenY):N_=O_=0,Ns=d),O_)},movementY:function(d){return"movementY"in d?d.movementY:N_}}),mS=Cr(cl),Fb=$e({},cl,{dataTransfer:0}),Bb=Cr(Fb),jb=$e({},al,{relatedTarget:0}),P_=Cr(jb),gu=$e({},mu,{animationName:0,elapsedTime:0,pseudoElement:0}),Gb=Cr(gu),_u=$e({},mu,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),gS=Cr(_u),Wb=$e({},mu,{data:0}),xt=Cr(Wb),zb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Hb={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Kb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function qb(d){var f=this.nativeEvent;return f.getModifierState?f.getModifierState(d):(d=Kb[d])?!!f[d]:!1}function Qd(){return qb}var Yb=$e({},al,{key:function(d){if(d.key){var f=zb[d.key]||d.key;if(f!=="Unidentified")return f}return d.type==="keypress"?(d=ol(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?Hb[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Qd,charCode:function(d){return d.type==="keypress"?ol(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?ol(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),Xb=Cr(Yb),Jb=$e({},cl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),uf=Cr(Jb),$b=$e({},al,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Qd}),Qb=Cr($b),_S=$e({},mu,{propertyName:0,elapsedTime:0,pseudoElement:0}),Zb=Cr(_S),ua=$e({},cl,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),e0=Cr(ua),t0=[9,13,27,32],D_=T&&"CompositionEvent"in window,Eu=null;T&&"documentMode"in document&&(Eu=document.documentMode);var k_=T&&"TextEvent"in window&&!Eu,ES=T&&(!D_||Eu&&8<Eu&&11>=Eu),yS=" ",fs=!1;function vS(d,f){switch(d){case"keyup":return t0.indexOf(f.keyCode)!==-1;case"keydown":return f.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function SS(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var yu=!1;function n0(d,f){switch(d){case"compositionend":return SS(f);case"keypress":return f.which!==32?null:(fs=!0,yS);case"textInput":return d=f.data,d===yS&&fs?null:d;default:return null}}function TS(d,f){if(yu)return d==="compositionend"||!D_&&vS(d,f)?(d=pS(),lf=A_=ii=null,yu=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(f.ctrlKey||f.altKey||f.metaKey)||f.ctrlKey&&f.altKey){if(f.char&&1<f.char.length)return f.char;if(f.which)return String.fromCharCode(f.which)}return null;case"compositionend":return ES&&f.locale!=="ko"?null:f.data;default:return null}}var i0={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function RS(d){var f=d&&d.nodeName&&d.nodeName.toLowerCase();return f==="input"?!!i0[d.type]:f==="textarea"}function L_(d,f,v,w){Xv(w),f=gf(f,"onChange"),0<f.length&&(v=new $d("onChange","change",null,v,w),d.push({event:v,listeners:f}))}var ll=null,Zd=null;function r0(d){j_(d,0)}function ul(d){var f=gl(d);if(Zc(f))return d}function s0(d,f){if(d==="change")return f}var wS=!1;if(T){var x_;if(T){var Ps="oninput"in document;if(!Ps){var CS=document.createElement("div");CS.setAttribute("oninput","return;"),Ps=typeof CS.oninput=="function"}x_=Ps}else x_=!1;wS=x_&&(!document.documentMode||9<document.documentMode)}function bS(){ll&&(ll.detachEvent("onpropertychange",Wr),Zd=ll=null)}function Wr(d){if(d.propertyName==="value"&&ul(Zd)){var f=[];L_(f,Zd,d,Xa(d)),$v(r0,f)}}function o0(d,f,v){d==="focusin"?(bS(),ll=f,Zd=v,ll.attachEvent("onpropertychange",Wr)):d==="focusout"&&bS()}function a0(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return ul(Zd)}function c0(d,f){if(d==="click")return ul(f)}function l0(d,f){if(d==="input"||d==="change")return ul(f)}function AS(d,f){return d===f&&(d!==0||1/d===1/f)||d!==d&&f!==f}var lo=typeof Object.is=="function"?Object.is:AS;function eh(d,f){if(lo(d,f))return!0;if(typeof d!="object"||d===null||typeof f!="object"||f===null)return!1;var v=Object.keys(d),w=Object.keys(f);if(v.length!==w.length)return!1;for(w=0;w<v.length;w++){var N=v[w];if(!C.call(f,N)||!lo(d[N],f[N]))return!1}return!0}function IS(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function M_(d,f){var v=IS(d);d=0;for(var w;v;){if(v.nodeType===3){if(w=d+v.textContent.length,d<=f&&w>=f)return{node:v,offset:f-d};d=w}e:{for(;v;){if(v.nextSibling){v=v.nextSibling;break e}v=v.parentNode}v=void 0}v=IS(v)}}function OS(d,f){return d&&f?d===f?!0:d&&d.nodeType===3?!1:f&&f.nodeType===3?OS(d,f.parentNode):"contains"in d?d.contains(f):d.compareDocumentPosition?!!(d.compareDocumentPosition(f)&16):!1:!1}function NS(){for(var d=window,f=Hp();f instanceof d.HTMLIFrameElement;){try{var v=typeof f.contentWindow.location.href=="string"}catch{v=!1}if(v)d=f.contentWindow;else break;f=Hp(d.document)}return f}function th(d){var f=d&&d.nodeName&&d.nodeName.toLowerCase();return f&&(f==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||f==="textarea"||d.contentEditable==="true")}function U_(d){var f=NS(),v=d.focusedElem,w=d.selectionRange;if(f!==v&&v&&v.ownerDocument&&OS(v.ownerDocument.documentElement,v)){if(w!==null&&th(v)){if(f=w.start,d=w.end,d===void 0&&(d=f),"selectionStart"in v)v.selectionStart=f,v.selectionEnd=Math.min(d,v.value.length);else if(d=(f=v.ownerDocument||document)&&f.defaultView||window,d.getSelection){d=d.getSelection();var N=v.textContent.length,M=Math.min(w.start,N);w=w.end===void 0?M:Math.min(w.end,N),!d.extend&&M>w&&(N=w,w=M,M=N),N=M_(v,M);var z=M_(v,w);N&&z&&(d.rangeCount!==1||d.anchorNode!==N.node||d.anchorOffset!==N.offset||d.focusNode!==z.node||d.focusOffset!==z.offset)&&(f=f.createRange(),f.setStart(N.node,N.offset),d.removeAllRanges(),M>w?(d.addRange(f),d.extend(z.node,z.offset)):(f.setEnd(z.node,z.offset),d.addRange(f)))}}for(f=[],d=v;d=d.parentNode;)d.nodeType===1&&f.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof v.focus=="function"&&v.focus(),v=0;v<f.length;v++)d=f[v],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var u0=T&&"documentMode"in document&&11>=document.documentMode,Te=null,V_=null,nh=null,F_=!1;function PS(d,f,v){var w=v.window===v?v.document:v.nodeType===9?v:v.ownerDocument;F_||Te==null||Te!==Hp(w)||(w=Te,"selectionStart"in w&&th(w)?w={start:w.selectionStart,end:w.selectionEnd}:(w=(w.ownerDocument&&w.ownerDocument.defaultView||window).getSelection(),w={anchorNode:w.anchorNode,anchorOffset:w.anchorOffset,focusNode:w.focusNode,focusOffset:w.focusOffset}),nh&&eh(nh,w)||(nh=w,w=gf(V_,"onSelect"),0<w.length&&(f=new $d("onSelect","select",null,f,v),d.push({event:f,listeners:w}),f.target=Te)))}function df(d,f){var v={};return v[d.toLowerCase()]=f.toLowerCase(),v["Webkit"+d]="webkit"+f,v["Moz"+d]="moz"+f,v}var vu={animationend:df("Animation","AnimationEnd"),animationiteration:df("Animation","AnimationIteration"),animationstart:df("Animation","AnimationStart"),transitionend:df("Transition","TransitionEnd")},B_={},DS={};T&&(DS=document.createElement("div").style,"AnimationEvent"in window||(delete vu.animationend.animation,delete vu.animationiteration.animation,delete vu.animationstart.animation),"TransitionEvent"in window||delete vu.transitionend.transition);function dl(d){if(B_[d])return B_[d];if(!vu[d])return d;var f=vu[d],v;for(v in f)if(f.hasOwnProperty(v)&&v in DS)return B_[d]=f[v];return d}var hl=dl("animationend"),kS=dl("animationiteration"),LS=dl("animationstart"),xS=dl("transitionend"),MS=new Map,hf="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function tc(d,f){MS.set(d,f),_(f,[d])}for(var pf=0;pf<hf.length;pf++){var ms=hf[pf],d0=ms.toLowerCase(),ih=ms[0].toUpperCase()+ms.slice(1);tc(d0,"on"+ih)}tc(hl,"onAnimationEnd"),tc(kS,"onAnimationIteration"),tc(LS,"onAnimationStart"),tc("dblclick","onDoubleClick"),tc("focusin","onFocus"),tc("focusout","onBlur"),tc(xS,"onTransitionEnd"),y("onMouseEnter",["mouseout","mouseover"]),y("onMouseLeave",["mouseout","mouseover"]),y("onPointerEnter",["pointerout","pointerover"]),y("onPointerLeave",["pointerout","pointerover"]),_("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),_("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),_("onBeforeInput",["compositionend","keypress","textInput","paste"]),_("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),_("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),_("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var rh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),h0=new Set("cancel close invalid load scroll toggle".split(" ").concat(rh));function US(d,f,v){var w=d.type||"unknown-event";d.currentTarget=v,Zv(w,f,void 0,d),d.currentTarget=null}function j_(d,f){f=(f&4)!==0;for(var v=0;v<d.length;v++){var w=d[v],N=w.event;w=w.listeners;e:{var M=void 0;if(f)for(var z=w.length-1;0<=z;z--){var te=w[z],ae=te.instance,ve=te.currentTarget;if(te=te.listener,ae!==M&&N.isPropagationStopped())break e;US(N,te,ve),M=ae}else for(z=0;z<w.length;z++){if(te=w[z],ae=te.instance,ve=te.currentTarget,te=te.listener,ae!==M&&N.isPropagationStopped())break e;US(N,te,ve),M=ae}}}if(Bd)throw d=$p,Bd=!1,$p=null,d}function Xn(d,f){var v=f[ch];v===void 0&&(v=f[ch]=new Set);var w=d+"__bubble";v.has(w)||(VS(f,d,2,!1),v.add(w))}function G_(d,f,v){var w=0;f&&(w|=4),VS(v,d,w,f)}var ff="_reactListening"+Math.random().toString(36).slice(2);function pl(d){if(!d[ff]){d[ff]=!0,c.forEach(function(v){v!=="selectionchange"&&(h0.has(v)||G_(v,!1,d),G_(v,!0,d))});var f=d.nodeType===9?d:d.ownerDocument;f===null||f[ff]||(f[ff]=!0,G_("selectionchange",!1,f))}}function VS(d,f,v,w){switch(hS(f)){case 1:var N=ec;break;case 4:N=Os;break;default:N=af}v=N.bind(null,f,v,d),N=void 0,!wr||f!=="touchstart"&&f!=="touchmove"&&f!=="wheel"||(N=!0),w?N!==void 0?d.addEventListener(f,v,{capture:!0,passive:N}):d.addEventListener(f,v,!0):N!==void 0?d.addEventListener(f,v,{passive:N}):d.addEventListener(f,v,!1)}function mf(d,f,v,w,N){var M=w;if((f&1)===0&&(f&2)===0&&w!==null)e:for(;;){if(w===null)return;var z=w.tag;if(z===3||z===4){var te=w.stateNode.containerInfo;if(te===N||te.nodeType===8&&te.parentNode===N)break;if(z===4)for(z=w.return;z!==null;){var ae=z.tag;if((ae===3||ae===4)&&(ae=z.stateNode.containerInfo,ae===N||ae.nodeType===8&&ae.parentNode===N))return;z=z.return}for(;te!==null;){if(z=ml(te),z===null)return;if(ae=z.tag,ae===5||ae===6){w=M=z;continue e}te=te.parentNode}}w=w.return}$v(function(){var ve=M,Fe=Xa(v),Be=[];e:{var Me=MS.get(d);if(Me!==void 0){var et=$d,ot=d;switch(d){case"keypress":if(ol(v)===0)break e;case"keydown":case"keyup":et=Xb;break;case"focusin":ot="focus",et=P_;break;case"focusout":ot="blur",et=P_;break;case"beforeblur":case"afterblur":et=P_;break;case"click":if(v.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":et=mS;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":et=Bb;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":et=Qb;break;case hl:case kS:case LS:et=Gb;break;case xS:et=Zb;break;case"scroll":et=I_;break;case"wheel":et=e0;break;case"copy":case"cut":case"paste":et=gS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":et=uf}var at=(f&4)!==0,pi=!at&&d==="scroll",ge=at?Me!==null?Me+"Capture":null:Me;at=[];for(var ce=ve,ye;ce!==null;){ye=ce;var Ge=ye.stateNode;if(ye.tag===5&&Ge!==null&&(ye=Ge,ge!==null&&(Ge=Ud(ce,ge),Ge!=null&&at.push(Su(ce,Ge,ye)))),pi)break;ce=ce.return}0<at.length&&(Me=new et(Me,ot,null,v,Fe),Be.push({event:Me,listeners:at}))}}if((f&7)===0){e:{if(Me=d==="mouseover"||d==="pointerover",et=d==="mouseout"||d==="pointerout",Me&&v!==m_&&(ot=v.relatedTarget||v.fromElement)&&(ml(ot)||ot[Ds]))break e;if((et||Me)&&(Me=Fe.window===Fe?Fe:(Me=Fe.ownerDocument)?Me.defaultView||Me.parentWindow:window,et?(ot=v.relatedTarget||v.toElement,et=ve,ot=ot?ml(ot):null,ot!==null&&(pi=rl(ot),ot!==pi||ot.tag!==5&&ot.tag!==6)&&(ot=null)):(et=null,ot=ve),et!==ot)){if(at=mS,Ge="onMouseLeave",ge="onMouseEnter",ce="mouse",(d==="pointerout"||d==="pointerover")&&(at=uf,Ge="onPointerLeave",ge="onPointerEnter",ce="pointer"),pi=et==null?Me:gl(et),ye=ot==null?Me:gl(ot),Me=new at(Ge,ce+"leave",et,v,Fe),Me.target=pi,Me.relatedTarget=ye,Ge=null,ml(Fe)===ve&&(at=new at(ge,ce+"enter",ot,v,Fe),at.target=ye,at.relatedTarget=pi,Ge=at),pi=Ge,et&&ot)t:{for(at=et,ge=ot,ce=0,ye=at;ye;ye=fl(ye))ce++;for(ye=0,Ge=ge;Ge;Ge=fl(Ge))ye++;for(;0<ce-ye;)at=fl(at),ce--;for(;0<ye-ce;)ge=fl(ge),ye--;for(;ce--;){if(at===ge||ge!==null&&at===ge.alternate)break t;at=fl(at),ge=fl(ge)}at=null}else at=null;et!==null&&sh(Be,Me,et,at,!1),ot!==null&&pi!==null&&sh(Be,pi,ot,at,!0)}}e:{if(Me=ve?gl(ve):window,et=Me.nodeName&&Me.nodeName.toLowerCase(),et==="select"||et==="input"&&Me.type==="file")var ct=s0;else if(RS(Me))if(wS)ct=l0;else{ct=a0;var ht=o0}else(et=Me.nodeName)&&et.toLowerCase()==="input"&&(Me.type==="checkbox"||Me.type==="radio")&&(ct=c0);if(ct&&(ct=ct(d,ve))){L_(Be,ct,v,Fe);break e}ht&&ht(d,Me,ve),d==="focusout"&&(ht=Me._wrapperState)&&ht.controlled&&Me.type==="number"&&Kp(Me,"number",Me.value)}switch(ht=ve?gl(ve):window,d){case"focusin":(RS(ht)||ht.contentEditable==="true")&&(Te=ht,V_=ve,nh=null);break;case"focusout":nh=V_=Te=null;break;case"mousedown":F_=!0;break;case"contextmenu":case"mouseup":case"dragend":F_=!1,PS(Be,v,Fe);break;case"selectionchange":if(u0)break;case"keydown":case"keyup":PS(Be,v,Fe)}var gt;if(D_)e:{switch(d){case"compositionstart":var Ct="onCompositionStart";break e;case"compositionend":Ct="onCompositionEnd";break e;case"compositionupdate":Ct="onCompositionUpdate";break e}Ct=void 0}else yu?vS(d,v)&&(Ct="onCompositionEnd"):d==="keydown"&&v.keyCode===229&&(Ct="onCompositionStart");Ct&&(ES&&v.locale!=="ko"&&(yu||Ct!=="onCompositionStart"?Ct==="onCompositionEnd"&&yu&&(gt=pS()):(ii=Fe,A_="value"in ii?ii.value:ii.textContent,yu=!0)),ht=gf(ve,Ct),0<ht.length&&(Ct=new xt(Ct,d,null,v,Fe),Be.push({event:Ct,listeners:ht}),gt?Ct.data=gt:(gt=SS(v),gt!==null&&(Ct.data=gt)))),(gt=k_?n0(d,v):TS(d,v))&&(ve=gf(ve,"onBeforeInput"),0<ve.length&&(Fe=new xt("onBeforeInput","beforeinput",null,v,Fe),Be.push({event:Fe,listeners:ve}),Fe.data=gt))}j_(Be,f)})}function Su(d,f,v){return{instance:d,listener:f,currentTarget:v}}function gf(d,f){for(var v=f+"Capture",w=[];d!==null;){var N=d,M=N.stateNode;N.tag===5&&M!==null&&(N=M,M=Ud(d,v),M!=null&&w.unshift(Su(d,M,N)),M=Ud(d,f),M!=null&&w.push(Su(d,M,N))),d=d.return}return w}function fl(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5);return d||null}function sh(d,f,v,w,N){for(var M=f._reactName,z=[];v!==null&&v!==w;){var te=v,ae=te.alternate,ve=te.stateNode;if(ae!==null&&ae===w)break;te.tag===5&&ve!==null&&(te=ve,N?(ae=Ud(v,M),ae!=null&&z.unshift(Su(v,ae,te))):N||(ae=Ud(v,M),ae!=null&&z.push(Su(v,ae,te)))),v=v.return}z.length!==0&&d.push({event:f,listeners:z})}var p0=/\r\n?/g,f0=/\u0000|\uFFFD/g;function FS(d){return(typeof d=="string"?d:""+d).replace(p0,`
`).replace(f0,"")}function _f(d,f,v){if(f=FS(f),FS(d)!==f&&v)throw Error(a(425))}function Ef(){}var yf=null,oh=null;function W_(d,f){return d==="textarea"||d==="noscript"||typeof f.children=="string"||typeof f.children=="number"||typeof f.dangerouslySetInnerHTML=="object"&&f.dangerouslySetInnerHTML!==null&&f.dangerouslySetInnerHTML.__html!=null}var ah=typeof setTimeout=="function"?setTimeout:void 0,m0=typeof clearTimeout=="function"?clearTimeout:void 0,BS=typeof Promise=="function"?Promise:void 0,g0=typeof queueMicrotask=="function"?queueMicrotask:typeof BS<"u"?function(d){return BS.resolve(null).then(d).catch(_0)}:ah;function _0(d){setTimeout(function(){throw d})}function z_(d,f){var v=f,w=0;do{var N=v.nextSibling;if(d.removeChild(v),N&&N.nodeType===8)if(v=N.data,v==="/$"){if(w===0){d.removeChild(N),Xd(f);return}w--}else v!=="$"&&v!=="$?"&&v!=="$!"||w++;v=N}while(v);Xd(f)}function nc(d){for(;d!=null;d=d.nextSibling){var f=d.nodeType;if(f===1||f===3)break;if(f===8){if(f=d.data,f==="$"||f==="$!"||f==="$?")break;if(f==="/$")return null}}return d}function jS(d){d=d.previousSibling;for(var f=0;d;){if(d.nodeType===8){var v=d.data;if(v==="$"||v==="$!"||v==="$?"){if(f===0)return d;f--}else v==="/$"&&f++}d=d.previousSibling}return null}var Tu=Math.random().toString(36).slice(2),Ao="__reactFiber$"+Tu,ic="__reactProps$"+Tu,Ds="__reactContainer$"+Tu,ch="__reactEvents$"+Tu,E0="__reactListeners$"+Tu,y0="__reactHandles$"+Tu;function ml(d){var f=d[Ao];if(f)return f;for(var v=d.parentNode;v;){if(f=v[Ds]||v[Ao]){if(v=f.alternate,f.child!==null||v!==null&&v.child!==null)for(d=jS(d);d!==null;){if(v=d[Ao])return v;d=jS(d)}return f}d=v,v=d.parentNode}return null}function Ru(d){return d=d[Ao]||d[Ds],!d||d.tag!==5&&d.tag!==6&&d.tag!==13&&d.tag!==3?null:d}function gl(d){if(d.tag===5||d.tag===6)return d.stateNode;throw Error(a(33))}function wu(d){return d[ic]||null}var H_=[],Cu=-1;function ks(d){return{current:d}}function Jn(d){0>Cu||(d.current=H_[Cu],H_[Cu]=null,Cu--)}function zn(d,f){Cu++,H_[Cu]=d.current,d.current=f}var rc={},cr=ks(rc),zr=ks(!1),_l=rc;function El(d,f){var v=d.type.contextTypes;if(!v)return rc;var w=d.stateNode;if(w&&w.__reactInternalMemoizedUnmaskedChildContext===f)return w.__reactInternalMemoizedMaskedChildContext;var N={},M;for(M in v)N[M]=f[M];return w&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=f,d.__reactInternalMemoizedMaskedChildContext=N),N}function Hr(d){return d=d.childContextTypes,d!=null}function vf(){Jn(zr),Jn(cr)}function GS(d,f,v){if(cr.current!==rc)throw Error(a(168));zn(cr,f),zn(zr,v)}function Sf(d,f,v){var w=d.stateNode;if(f=f.childContextTypes,typeof w.getChildContext!="function")return v;w=w.getChildContext();for(var N in w)if(!(N in f))throw Error(a(108,Gn(d)||"Unknown",N));return $e({},v,w)}function Tf(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||rc,_l=cr.current,zn(cr,d),zn(zr,zr.current),!0}function WS(d,f,v){var w=d.stateNode;if(!w)throw Error(a(169));v?(d=Sf(d,f,_l),w.__reactInternalMemoizedMergedChildContext=d,Jn(zr),Jn(cr),zn(cr,d)):Jn(zr),zn(zr,v)}var Ls=null,Rf=!1,K_=!1;function zS(d){Ls===null?Ls=[d]:Ls.push(d)}function v0(d){Rf=!0,zS(d)}function sc(){if(!K_&&Ls!==null){K_=!0;var d=0,f=Cn;try{var v=Ls;for(Cn=1;d<v.length;d++){var w=v[d];do w=w(!0);while(w!==null)}Ls=null,Rf=!1}catch(N){throw Ls!==null&&(Ls=Ls.slice(d+1)),tS(v_,sc),N}finally{Cn=f,K_=!1}}return null}var bu=[],da=0,lh=null,wf=0,xs=[],gs=0,yl=null,ha=1,pa="";function fa(d,f){bu[da++]=wf,bu[da++]=lh,lh=d,wf=f}function Cf(d,f,v){xs[gs++]=ha,xs[gs++]=pa,xs[gs++]=yl,yl=d;var w=ha;d=pa;var N=32-co(w)-1;w&=~(1<<N),v+=1;var M=32-co(f)+N;if(30<M){var z=N-N%5;M=(w&(1<<z)-1).toString(32),w>>=z,N-=z,ha=1<<32-co(f)+N|v<<N|w,pa=M+d}else ha=1<<M|v<<N|w,pa=d}function bf(d){d.return!==null&&(fa(d,1),Cf(d,1,0))}function uh(d){for(;d===lh;)lh=bu[--da],bu[da]=null,wf=bu[--da],bu[da]=null;for(;d===yl;)yl=xs[--gs],xs[gs]=null,pa=xs[--gs],xs[gs]=null,ha=xs[--gs],xs[gs]=null}var Kr=null,qr=null,Mn=!1,br=null;function HS(d,f){var v=ys(5,null,null,0);v.elementType="DELETED",v.stateNode=f,v.return=d,f=d.deletions,f===null?(d.deletions=[v],d.flags|=16):f.push(v)}function KS(d,f){switch(d.tag){case 5:var v=d.type;return f=f.nodeType!==1||v.toLowerCase()!==f.nodeName.toLowerCase()?null:f,f!==null?(d.stateNode=f,Kr=d,qr=nc(f.firstChild),!0):!1;case 6:return f=d.pendingProps===""||f.nodeType!==3?null:f,f!==null?(d.stateNode=f,Kr=d,qr=null,!0):!1;case 13:return f=f.nodeType!==8?null:f,f!==null?(v=yl!==null?{id:ha,overflow:pa}:null,d.memoizedState={dehydrated:f,treeContext:v,retryLane:1073741824},v=ys(18,null,null,0),v.stateNode=f,v.return=d,d.child=v,Kr=d,qr=null,!0):!1;default:return!1}}function Af(d){return(d.mode&1)!==0&&(d.flags&128)===0}function q_(d){if(Mn){var f=qr;if(f){var v=f;if(!KS(d,f)){if(Af(d))throw Error(a(418));f=nc(v.nextSibling);var w=Kr;f&&KS(d,f)?HS(w,v):(d.flags=d.flags&-4097|2,Mn=!1,Kr=d)}}else{if(Af(d))throw Error(a(418));d.flags=d.flags&-4097|2,Mn=!1,Kr=d}}}function qS(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;Kr=d}function dh(d){if(d!==Kr)return!1;if(!Mn)return qS(d),Mn=!0,!1;var f;if((f=d.tag!==3)&&!(f=d.tag!==5)&&(f=d.type,f=f!=="head"&&f!=="body"&&!W_(d.type,d.memoizedProps)),f&&(f=qr)){if(Af(d))throw YS(),Error(a(418));for(;f;)HS(d,f),f=nc(f.nextSibling)}if(qS(d),d.tag===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(a(317));e:{for(d=d.nextSibling,f=0;d;){if(d.nodeType===8){var v=d.data;if(v==="/$"){if(f===0){qr=nc(d.nextSibling);break e}f--}else v!=="$"&&v!=="$!"&&v!=="$?"||f++}d=d.nextSibling}qr=null}}else qr=Kr?nc(d.stateNode.nextSibling):null;return!0}function YS(){for(var d=qr;d;)d=nc(d.nextSibling)}function Au(){qr=Kr=null,Mn=!1}function Y_(d){br===null?br=[d]:br.push(d)}var S0=Oe.ReactCurrentBatchConfig;function hh(d,f,v){if(d=v.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(v._owner){if(v=v._owner,v){if(v.tag!==1)throw Error(a(309));var w=v.stateNode}if(!w)throw Error(a(147,d));var N=w,M=""+d;return f!==null&&f.ref!==null&&typeof f.ref=="function"&&f.ref._stringRef===M?f.ref:(f=function(z){var te=N.refs;z===null?delete te[M]:te[M]=z},f._stringRef=M,f)}if(typeof d!="string")throw Error(a(284));if(!v._owner)throw Error(a(290,d))}return d}function If(d,f){throw d=Object.prototype.toString.call(f),Error(a(31,d==="[object Object]"?"object with keys {"+Object.keys(f).join(", ")+"}":d))}function X_(d){var f=d._init;return f(d._payload)}function oc(d){function f(ge,ce){if(d){var ye=ge.deletions;ye===null?(ge.deletions=[ce],ge.flags|=16):ye.push(ce)}}function v(ge,ce){if(!d)return null;for(;ce!==null;)f(ge,ce),ce=ce.sibling;return null}function w(ge,ce){for(ge=new Map;ce!==null;)ce.key!==null?ge.set(ce.key,ce):ge.set(ce.index,ce),ce=ce.sibling;return ge}function N(ge,ce){return ge=Ta(ge,ce),ge.index=0,ge.sibling=null,ge}function M(ge,ce,ye){return ge.index=ye,d?(ye=ge.alternate,ye!==null?(ye=ye.index,ye<ce?(ge.flags|=2,ce):ye):(ge.flags|=2,ce)):(ge.flags|=1048576,ce)}function z(ge){return d&&ge.alternate===null&&(ge.flags|=2),ge}function te(ge,ce,ye,Ge){return ce===null||ce.tag!==6?(ce=DE(ye,ge.mode,Ge),ce.return=ge,ce):(ce=N(ce,ye),ce.return=ge,ce)}function ae(ge,ce,ye,Ge){var ct=ye.type;return ct===ut?Fe(ge,ce,ye.props.children,Ge,ye.key):ce!==null&&(ce.elementType===ct||typeof ct=="object"&&ct!==null&&ct.$$typeof===xn&&X_(ct)===ce.type)?(Ge=N(ce,ye.props),Ge.ref=hh(ge,ce,ye),Ge.return=ge,Ge):(Ge=fm(ye.type,ye.key,ye.props,null,ge.mode,Ge),Ge.ref=hh(ge,ce,ye),Ge.return=ge,Ge)}function ve(ge,ce,ye,Ge){return ce===null||ce.tag!==4||ce.stateNode.containerInfo!==ye.containerInfo||ce.stateNode.implementation!==ye.implementation?(ce=kE(ye,ge.mode,Ge),ce.return=ge,ce):(ce=N(ce,ye.children||[]),ce.return=ge,ce)}function Fe(ge,ce,ye,Ge,ct){return ce===null||ce.tag!==7?(ce=Pl(ye,ge.mode,Ge,ct),ce.return=ge,ce):(ce=N(ce,ye),ce.return=ge,ce)}function Be(ge,ce,ye){if(typeof ce=="string"&&ce!==""||typeof ce=="number")return ce=DE(""+ce,ge.mode,ye),ce.return=ge,ce;if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case Ve:return ye=fm(ce.type,ce.key,ce.props,null,ge.mode,ye),ye.ref=hh(ge,null,ce),ye.return=ge,ye;case Ze:return ce=kE(ce,ge.mode,ye),ce.return=ge,ce;case xn:var Ge=ce._init;return Be(ge,Ge(ce._payload),ye)}if(Md(ce)||Xe(ce))return ce=Pl(ce,ge.mode,ye,null),ce.return=ge,ce;If(ge,ce)}return null}function Me(ge,ce,ye,Ge){var ct=ce!==null?ce.key:null;if(typeof ye=="string"&&ye!==""||typeof ye=="number")return ct!==null?null:te(ge,ce,""+ye,Ge);if(typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case Ve:return ye.key===ct?ae(ge,ce,ye,Ge):null;case Ze:return ye.key===ct?ve(ge,ce,ye,Ge):null;case xn:return ct=ye._init,Me(ge,ce,ct(ye._payload),Ge)}if(Md(ye)||Xe(ye))return ct!==null?null:Fe(ge,ce,ye,Ge,null);If(ge,ye)}return null}function et(ge,ce,ye,Ge,ct){if(typeof Ge=="string"&&Ge!==""||typeof Ge=="number")return ge=ge.get(ye)||null,te(ce,ge,""+Ge,ct);if(typeof Ge=="object"&&Ge!==null){switch(Ge.$$typeof){case Ve:return ge=ge.get(Ge.key===null?ye:Ge.key)||null,ae(ce,ge,Ge,ct);case Ze:return ge=ge.get(Ge.key===null?ye:Ge.key)||null,ve(ce,ge,Ge,ct);case xn:var ht=Ge._init;return et(ge,ce,ye,ht(Ge._payload),ct)}if(Md(Ge)||Xe(Ge))return ge=ge.get(ye)||null,Fe(ce,ge,Ge,ct,null);If(ce,Ge)}return null}function ot(ge,ce,ye,Ge){for(var ct=null,ht=null,gt=ce,Ct=ce=0,Di=null;gt!==null&&Ct<ye.length;Ct++){gt.index>Ct?(Di=gt,gt=null):Di=gt.sibling;var cn=Me(ge,gt,ye[Ct],Ge);if(cn===null){gt===null&&(gt=Di);break}d&&gt&&cn.alternate===null&&f(ge,gt),ce=M(cn,ce,Ct),ht===null?ct=cn:ht.sibling=cn,ht=cn,gt=Di}if(Ct===ye.length)return v(ge,gt),Mn&&fa(ge,Ct),ct;if(gt===null){for(;Ct<ye.length;Ct++)gt=Be(ge,ye[Ct],Ge),gt!==null&&(ce=M(gt,ce,Ct),ht===null?ct=gt:ht.sibling=gt,ht=gt);return Mn&&fa(ge,Ct),ct}for(gt=w(ge,gt);Ct<ye.length;Ct++)Di=et(gt,ge,Ct,ye[Ct],Ge),Di!==null&&(d&&Di.alternate!==null&&gt.delete(Di.key===null?Ct:Di.key),ce=M(Di,ce,Ct),ht===null?ct=Di:ht.sibling=Di,ht=Di);return d&&gt.forEach(function(_c){return f(ge,_c)}),Mn&&fa(ge,Ct),ct}function at(ge,ce,ye,Ge){var ct=Xe(ye);if(typeof ct!="function")throw Error(a(150));if(ye=ct.call(ye),ye==null)throw Error(a(151));for(var ht=ct=null,gt=ce,Ct=ce=0,Di=null,cn=ye.next();gt!==null&&!cn.done;Ct++,cn=ye.next()){gt.index>Ct?(Di=gt,gt=null):Di=gt.sibling;var _c=Me(ge,gt,cn.value,Ge);if(_c===null){gt===null&&(gt=Di);break}d&&gt&&_c.alternate===null&&f(ge,gt),ce=M(_c,ce,Ct),ht===null?ct=_c:ht.sibling=_c,ht=_c,gt=Di}if(cn.done)return v(ge,gt),Mn&&fa(ge,Ct),ct;if(gt===null){for(;!cn.done;Ct++,cn=ye.next())cn=Be(ge,cn.value,Ge),cn!==null&&(ce=M(cn,ce,Ct),ht===null?ct=cn:ht.sibling=cn,ht=cn);return Mn&&fa(ge,Ct),ct}for(gt=w(ge,gt);!cn.done;Ct++,cn=ye.next())cn=et(gt,ge,Ct,cn.value,Ge),cn!==null&&(d&&cn.alternate!==null&&gt.delete(cn.key===null?Ct:cn.key),ce=M(cn,ce,Ct),ht===null?ct=cn:ht.sibling=cn,ht=cn);return d&&gt.forEach(function(U0){return f(ge,U0)}),Mn&&fa(ge,Ct),ct}function pi(ge,ce,ye,Ge){if(typeof ye=="object"&&ye!==null&&ye.type===ut&&ye.key===null&&(ye=ye.props.children),typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case Ve:e:{for(var ct=ye.key,ht=ce;ht!==null;){if(ht.key===ct){if(ct=ye.type,ct===ut){if(ht.tag===7){v(ge,ht.sibling),ce=N(ht,ye.props.children),ce.return=ge,ge=ce;break e}}else if(ht.elementType===ct||typeof ct=="object"&&ct!==null&&ct.$$typeof===xn&&X_(ct)===ht.type){v(ge,ht.sibling),ce=N(ht,ye.props),ce.ref=hh(ge,ht,ye),ce.return=ge,ge=ce;break e}v(ge,ht);break}else f(ge,ht);ht=ht.sibling}ye.type===ut?(ce=Pl(ye.props.children,ge.mode,Ge,ye.key),ce.return=ge,ge=ce):(Ge=fm(ye.type,ye.key,ye.props,null,ge.mode,Ge),Ge.ref=hh(ge,ce,ye),Ge.return=ge,ge=Ge)}return z(ge);case Ze:e:{for(ht=ye.key;ce!==null;){if(ce.key===ht)if(ce.tag===4&&ce.stateNode.containerInfo===ye.containerInfo&&ce.stateNode.implementation===ye.implementation){v(ge,ce.sibling),ce=N(ce,ye.children||[]),ce.return=ge,ge=ce;break e}else{v(ge,ce);break}else f(ge,ce);ce=ce.sibling}ce=kE(ye,ge.mode,Ge),ce.return=ge,ge=ce}return z(ge);case xn:return ht=ye._init,pi(ge,ce,ht(ye._payload),Ge)}if(Md(ye))return ot(ge,ce,ye,Ge);if(Xe(ye))return at(ge,ce,ye,Ge);If(ge,ye)}return typeof ye=="string"&&ye!==""||typeof ye=="number"?(ye=""+ye,ce!==null&&ce.tag===6?(v(ge,ce.sibling),ce=N(ce,ye),ce.return=ge,ge=ce):(v(ge,ce),ce=DE(ye,ge.mode,Ge),ce.return=ge,ge=ce),z(ge)):v(ge,ce)}return pi}var Iu=oc(!0),XS=oc(!1),Of=ks(null),ph=null,Ou=null,Nf=null;function J_(){Nf=Ou=ph=null}function $_(d){var f=Of.current;Jn(Of),d._currentValue=f}function Q_(d,f,v){for(;d!==null;){var w=d.alternate;if((d.childLanes&f)!==f?(d.childLanes|=f,w!==null&&(w.childLanes|=f)):w!==null&&(w.childLanes&f)!==f&&(w.childLanes|=f),d===v)break;d=d.return}}function ma(d,f){ph=d,Nf=Ou=null,d=d.dependencies,d!==null&&d.firstContext!==null&&((d.lanes&f)!==0&&(Xr=!0),d.firstContext=null)}function Ms(d){var f=d._currentValue;if(Nf!==d)if(d={context:d,memoizedValue:f,next:null},Ou===null){if(ph===null)throw Error(a(308));Ou=d,ph.dependencies={lanes:0,firstContext:d}}else Ou=Ou.next=d;return f}var vl=null;function Z_(d){vl===null?vl=[d]:vl.push(d)}function JS(d,f,v,w){var N=f.interleaved;return N===null?(v.next=v,Z_(f)):(v.next=N.next,N.next=v),f.interleaved=v,ga(d,w)}function ga(d,f){d.lanes|=f;var v=d.alternate;for(v!==null&&(v.lanes|=f),v=d,d=d.return;d!==null;)d.childLanes|=f,v=d.alternate,v!==null&&(v.childLanes|=f),v=d,d=d.return;return v.tag===3?v.stateNode:null}var ac=!1;function fh(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function $S(d,f){d=d.updateQueue,f.updateQueue===d&&(f.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function Io(d,f){return{eventTime:d,lane:f,tag:0,payload:null,callback:null,next:null}}function cc(d,f,v){var w=d.updateQueue;if(w===null)return null;if(w=w.shared,(hn&2)!==0){var N=w.pending;return N===null?f.next=f:(f.next=N.next,N.next=f),w.pending=f,ga(d,v)}return N=w.interleaved,N===null?(f.next=f,Z_(w)):(f.next=N.next,N.next=f),w.interleaved=f,ga(d,v)}function mh(d,f,v){if(f=f.updateQueue,f!==null&&(f=f.shared,(v&4194240)!==0)){var w=f.lanes;w&=d.pendingLanes,v|=w,f.lanes=v,hu(d,v)}}function QS(d,f){var v=d.updateQueue,w=d.alternate;if(w!==null&&(w=w.updateQueue,v===w)){var N=null,M=null;if(v=v.firstBaseUpdate,v!==null){do{var z={eventTime:v.eventTime,lane:v.lane,tag:v.tag,payload:v.payload,callback:v.callback,next:null};M===null?N=M=z:M=M.next=z,v=v.next}while(v!==null);M===null?N=M=f:M=M.next=f}else N=M=f;v={baseState:w.baseState,firstBaseUpdate:N,lastBaseUpdate:M,shared:w.shared,effects:w.effects},d.updateQueue=v;return}d=v.lastBaseUpdate,d===null?v.firstBaseUpdate=f:d.next=f,v.lastBaseUpdate=f}function Pf(d,f,v,w){var N=d.updateQueue;ac=!1;var M=N.firstBaseUpdate,z=N.lastBaseUpdate,te=N.shared.pending;if(te!==null){N.shared.pending=null;var ae=te,ve=ae.next;ae.next=null,z===null?M=ve:z.next=ve,z=ae;var Fe=d.alternate;Fe!==null&&(Fe=Fe.updateQueue,te=Fe.lastBaseUpdate,te!==z&&(te===null?Fe.firstBaseUpdate=ve:te.next=ve,Fe.lastBaseUpdate=ae))}if(M!==null){var Be=N.baseState;z=0,Fe=ve=ae=null,te=M;do{var Me=te.lane,et=te.eventTime;if((w&Me)===Me){Fe!==null&&(Fe=Fe.next={eventTime:et,lane:0,tag:te.tag,payload:te.payload,callback:te.callback,next:null});e:{var ot=d,at=te;switch(Me=f,et=v,at.tag){case 1:if(ot=at.payload,typeof ot=="function"){Be=ot.call(et,Be,Me);break e}Be=ot;break e;case 3:ot.flags=ot.flags&-65537|128;case 0:if(ot=at.payload,Me=typeof ot=="function"?ot.call(et,Be,Me):ot,Me==null)break e;Be=$e({},Be,Me);break e;case 2:ac=!0}}te.callback!==null&&te.lane!==0&&(d.flags|=64,Me=N.effects,Me===null?N.effects=[te]:Me.push(te))}else et={eventTime:et,lane:Me,tag:te.tag,payload:te.payload,callback:te.callback,next:null},Fe===null?(ve=Fe=et,ae=Be):Fe=Fe.next=et,z|=Me;if(te=te.next,te===null){if(te=N.shared.pending,te===null)break;Me=te,te=Me.next,Me.next=null,N.lastBaseUpdate=Me,N.shared.pending=null}}while(!0);if(Fe===null&&(ae=Be),N.baseState=ae,N.firstBaseUpdate=ve,N.lastBaseUpdate=Fe,f=N.shared.interleaved,f!==null){N=f;do z|=N.lane,N=N.next;while(N!==f)}else M===null&&(N.shared.lanes=0);bl|=z,d.lanes=z,d.memoizedState=Be}}function ZS(d,f,v){if(d=f.effects,f.effects=null,d!==null)for(f=0;f<d.length;f++){var w=d[f],N=w.callback;if(N!==null){if(w.callback=null,w=v,typeof N!="function")throw Error(a(191,N));N.call(w)}}}var gh={},Oo=ks(gh),_h=ks(gh),Nu=ks(gh);function Sl(d){if(d===gh)throw Error(a(174));return d}function eE(d,f){switch(zn(Nu,f),zn(_h,d),zn(Oo,gh),d=f.nodeType,d){case 9:case 11:f=(f=f.documentElement)?f.namespaceURI:Zi(null,"");break;default:d=d===8?f.parentNode:f,f=d.namespaceURI||null,d=d.tagName,f=Zi(f,d)}Jn(Oo),zn(Oo,f)}function Tl(){Jn(Oo),Jn(_h),Jn(Nu)}function eT(d){Sl(Nu.current);var f=Sl(Oo.current),v=Zi(f,d.type);f!==v&&(zn(_h,d),zn(Oo,v))}function Pu(d){_h.current===d&&(Jn(Oo),Jn(_h))}var Zn=ks(0);function lc(d){for(var f=d;f!==null;){if(f.tag===13){var v=f.memoizedState;if(v!==null&&(v=v.dehydrated,v===null||v.data==="$?"||v.data==="$!"))return f}else if(f.tag===19&&f.memoizedProps.revealOrder!==void 0){if((f.flags&128)!==0)return f}else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===d)break;for(;f.sibling===null;){if(f.return===null||f.return===d)return null;f=f.return}f.sibling.return=f.return,f=f.sibling}return null}var tE=[];function nE(){for(var d=0;d<tE.length;d++)tE[d]._workInProgressVersionPrimary=null;tE.length=0}var Df=Oe.ReactCurrentDispatcher,iE=Oe.ReactCurrentBatchConfig,No=0,ri=null,Ii=null,Oi=null,Du=!1,Eh=!1,yh=0,T0=0;function lr(){throw Error(a(321))}function rE(d,f){if(f===null)return!1;for(var v=0;v<f.length&&v<d.length;v++)if(!lo(d[v],f[v]))return!1;return!0}function ku(d,f,v,w,N,M){if(No=M,ri=f,f.memoizedState=null,f.updateQueue=null,f.lanes=0,Df.current=d===null||d.memoizedState===null?C0:dT,d=v(w,N),Eh){M=0;do{if(Eh=!1,yh=0,25<=M)throw Error(a(301));M+=1,Oi=Ii=null,f.updateQueue=null,Df.current=b0,d=v(w,N)}while(Eh)}if(Df.current=Mf,f=Ii!==null&&Ii.next!==null,No=0,Oi=Ii=ri=null,Du=!1,f)throw Error(a(300));return d}function sE(){var d=yh!==0;return yh=0,d}function Ar(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Oi===null?ri.memoizedState=Oi=d:Oi=Oi.next=d,Oi}function Yr(){if(Ii===null){var d=ri.alternate;d=d!==null?d.memoizedState:null}else d=Ii.next;var f=Oi===null?ri.memoizedState:Oi.next;if(f!==null)Oi=f,Ii=d;else{if(d===null)throw Error(a(310));Ii=d,d={memoizedState:Ii.memoizedState,baseState:Ii.baseState,baseQueue:Ii.baseQueue,queue:Ii.queue,next:null},Oi===null?ri.memoizedState=Oi=d:Oi=Oi.next=d}return Oi}function uc(d,f){return typeof f=="function"?f(d):f}function Rl(d){var f=Yr(),v=f.queue;if(v===null)throw Error(a(311));v.lastRenderedReducer=d;var w=Ii,N=w.baseQueue,M=v.pending;if(M!==null){if(N!==null){var z=N.next;N.next=M.next,M.next=z}w.baseQueue=N=M,v.pending=null}if(N!==null){M=N.next,w=w.baseState;var te=z=null,ae=null,ve=M;do{var Fe=ve.lane;if((No&Fe)===Fe)ae!==null&&(ae=ae.next={lane:0,action:ve.action,hasEagerState:ve.hasEagerState,eagerState:ve.eagerState,next:null}),w=ve.hasEagerState?ve.eagerState:d(w,ve.action);else{var Be={lane:Fe,action:ve.action,hasEagerState:ve.hasEagerState,eagerState:ve.eagerState,next:null};ae===null?(te=ae=Be,z=w):ae=ae.next=Be,ri.lanes|=Fe,bl|=Fe}ve=ve.next}while(ve!==null&&ve!==M);ae===null?z=w:ae.next=te,lo(w,f.memoizedState)||(Xr=!0),f.memoizedState=w,f.baseState=z,f.baseQueue=ae,v.lastRenderedState=w}if(d=v.interleaved,d!==null){N=d;do M=N.lane,ri.lanes|=M,bl|=M,N=N.next;while(N!==d)}else N===null&&(v.lanes=0);return[f.memoizedState,v.dispatch]}function Lu(d){var f=Yr(),v=f.queue;if(v===null)throw Error(a(311));v.lastRenderedReducer=d;var w=v.dispatch,N=v.pending,M=f.memoizedState;if(N!==null){v.pending=null;var z=N=N.next;do M=d(M,z.action),z=z.next;while(z!==N);lo(M,f.memoizedState)||(Xr=!0),f.memoizedState=M,f.baseQueue===null&&(f.baseState=M),v.lastRenderedState=M}return[M,w]}function tT(){}function oE(d,f){var v=ri,w=Yr(),N=f(),M=!lo(w.memoizedState,N);if(M&&(w.memoizedState=N,Xr=!0),w=w.queue,Us(iT.bind(null,v,w,d),[d]),w.getSnapshot!==f||M||Oi!==null&&Oi.memoizedState.tag&1){if(v.flags|=2048,vh(9,aE.bind(null,v,w,N,f),void 0,null),Xi===null)throw Error(a(349));(No&30)!==0||nT(v,f,N)}return N}function nT(d,f,v){d.flags|=16384,d={getSnapshot:f,value:v},f=ri.updateQueue,f===null?(f={lastEffect:null,stores:null},ri.updateQueue=f,f.stores=[d]):(v=f.stores,v===null?f.stores=[d]:v.push(d))}function aE(d,f,v,w){f.value=v,f.getSnapshot=w,rT(f)&&kf(d)}function iT(d,f,v){return v(function(){rT(f)&&kf(d)})}function rT(d){var f=d.getSnapshot;d=d.value;try{var v=f();return!lo(d,v)}catch{return!0}}function kf(d){var f=ga(d,1);f!==null&&js(f,d,1,-1)}function Lf(d){var f=Ar();return typeof d=="function"&&(d=d()),f.memoizedState=f.baseState=d,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:uc,lastRenderedState:d},f.queue=d,d=d.dispatch=w0.bind(null,ri,d),[f.memoizedState,d]}function vh(d,f,v,w){return d={tag:d,create:f,destroy:v,deps:w,next:null},f=ri.updateQueue,f===null?(f={lastEffect:null,stores:null},ri.updateQueue=f,f.lastEffect=d.next=d):(v=f.lastEffect,v===null?f.lastEffect=d.next=d:(w=v.next,v.next=d,d.next=w,f.lastEffect=d)),d}function sT(){return Yr().memoizedState}function Sh(d,f,v,w){var N=Ar();ri.flags|=d,N.memoizedState=vh(1|f,v,void 0,w===void 0?null:w)}function xu(d,f,v,w){var N=Yr();w=w===void 0?null:w;var M=void 0;if(Ii!==null){var z=Ii.memoizedState;if(M=z.destroy,w!==null&&rE(w,z.deps)){N.memoizedState=vh(f,v,M,w);return}}ri.flags|=d,N.memoizedState=vh(1|f,v,M,w)}function oT(d,f){return Sh(8390656,8,d,f)}function Us(d,f){return xu(2048,8,d,f)}function wl(d,f){return xu(4,2,d,f)}function dc(d,f){return xu(4,4,d,f)}function cE(d,f){if(typeof f=="function")return d=d(),f(d),function(){f(null)};if(f!=null)return d=d(),f.current=d,function(){f.current=null}}function lE(d,f,v){return v=v!=null?v.concat([d]):null,xu(4,4,cE.bind(null,f,d),v)}function _a(){}function xf(d,f){var v=Yr();f=f===void 0?null:f;var w=v.memoizedState;return w!==null&&f!==null&&rE(f,w[1])?w[0]:(v.memoizedState=[d,f],d)}function aT(d,f){var v=Yr();f=f===void 0?null:f;var w=v.memoizedState;return w!==null&&f!==null&&rE(f,w[1])?w[0]:(d=d(),v.memoizedState=[d,f],d)}function uE(d,f,v){return(No&21)===0?(d.baseState&&(d.baseState=!1,Xr=!0),d.memoizedState=v):(lo(v,f)||(v=sS(),ri.lanes|=v,bl|=v,d.baseState=!0),f)}function R0(d,f){var v=Cn;Cn=v!==0&&4>v?v:4,d(!0);var w=iE.transition;iE.transition={};try{d(!1),f()}finally{Cn=v,iE.transition=w}}function dE(){return Yr().memoizedState}function cT(d,f,v){var w=Bs(d);if(v={lane:w,action:v,hasEagerState:!1,eagerState:null,next:null},Ea(d))lT(f,v);else if(v=JS(d,f,v,w),v!==null){var N=nr();js(v,d,w,N),uT(v,f,w)}}function w0(d,f,v){var w=Bs(d),N={lane:w,action:v,hasEagerState:!1,eagerState:null,next:null};if(Ea(d))lT(f,N);else{var M=d.alternate;if(d.lanes===0&&(M===null||M.lanes===0)&&(M=f.lastRenderedReducer,M!==null))try{var z=f.lastRenderedState,te=M(z,v);if(N.hasEagerState=!0,N.eagerState=te,lo(te,z)){var ae=f.interleaved;ae===null?(N.next=N,Z_(f)):(N.next=ae.next,ae.next=N),f.interleaved=N;return}}catch{}finally{}v=JS(d,f,N,w),v!==null&&(N=nr(),js(v,d,w,N),uT(v,f,w))}}function Ea(d){var f=d.alternate;return d===ri||f!==null&&f===ri}function lT(d,f){Eh=Du=!0;var v=d.pending;v===null?f.next=f:(f.next=v.next,v.next=f),d.pending=f}function uT(d,f,v){if((v&4194240)!==0){var w=f.lanes;w&=d.pendingLanes,v|=w,f.lanes=v,hu(d,v)}}var Mf={readContext:Ms,useCallback:lr,useContext:lr,useEffect:lr,useImperativeHandle:lr,useInsertionEffect:lr,useLayoutEffect:lr,useMemo:lr,useReducer:lr,useRef:lr,useState:lr,useDebugValue:lr,useDeferredValue:lr,useTransition:lr,useMutableSource:lr,useSyncExternalStore:lr,useId:lr,unstable_isNewReconciler:!1},C0={readContext:Ms,useCallback:function(d,f){return Ar().memoizedState=[d,f===void 0?null:f],d},useContext:Ms,useEffect:oT,useImperativeHandle:function(d,f,v){return v=v!=null?v.concat([d]):null,Sh(4194308,4,cE.bind(null,f,d),v)},useLayoutEffect:function(d,f){return Sh(4194308,4,d,f)},useInsertionEffect:function(d,f){return Sh(4,2,d,f)},useMemo:function(d,f){var v=Ar();return f=f===void 0?null:f,d=d(),v.memoizedState=[d,f],d},useReducer:function(d,f,v){var w=Ar();return f=v!==void 0?v(f):f,w.memoizedState=w.baseState=f,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:f},w.queue=d,d=d.dispatch=cT.bind(null,ri,d),[w.memoizedState,d]},useRef:function(d){var f=Ar();return d={current:d},f.memoizedState=d},useState:Lf,useDebugValue:_a,useDeferredValue:function(d){return Ar().memoizedState=d},useTransition:function(){var d=Lf(!1),f=d[0];return d=R0.bind(null,d[1]),Ar().memoizedState=d,[f,d]},useMutableSource:function(){},useSyncExternalStore:function(d,f,v){var w=ri,N=Ar();if(Mn){if(v===void 0)throw Error(a(407));v=v()}else{if(v=f(),Xi===null)throw Error(a(349));(No&30)!==0||nT(w,f,v)}N.memoizedState=v;var M={value:v,getSnapshot:f};return N.queue=M,oT(iT.bind(null,w,M,d),[d]),w.flags|=2048,vh(9,aE.bind(null,w,M,v,f),void 0,null),v},useId:function(){var d=Ar(),f=Xi.identifierPrefix;if(Mn){var v=pa,w=ha;v=(w&~(1<<32-co(w)-1)).toString(32)+v,f=":"+f+"R"+v,v=yh++,0<v&&(f+="H"+v.toString(32)),f+=":"}else v=T0++,f=":"+f+"r"+v.toString(32)+":";return d.memoizedState=f},unstable_isNewReconciler:!1},dT={readContext:Ms,useCallback:xf,useContext:Ms,useEffect:Us,useImperativeHandle:lE,useInsertionEffect:wl,useLayoutEffect:dc,useMemo:aT,useReducer:Rl,useRef:sT,useState:function(){return Rl(uc)},useDebugValue:_a,useDeferredValue:function(d){var f=Yr();return uE(f,Ii.memoizedState,d)},useTransition:function(){var d=Rl(uc)[0],f=Yr().memoizedState;return[d,f]},useMutableSource:tT,useSyncExternalStore:oE,useId:dE,unstable_isNewReconciler:!1},b0={readContext:Ms,useCallback:xf,useContext:Ms,useEffect:Us,useImperativeHandle:lE,useInsertionEffect:wl,useLayoutEffect:dc,useMemo:aT,useReducer:Lu,useRef:sT,useState:function(){return Lu(uc)},useDebugValue:_a,useDeferredValue:function(d){var f=Yr();return Ii===null?f.memoizedState=d:uE(f,Ii.memoizedState,d)},useTransition:function(){var d=Lu(uc)[0],f=Yr().memoizedState;return[d,f]},useMutableSource:tT,useSyncExternalStore:oE,useId:dE,unstable_isNewReconciler:!1};function _s(d,f){if(d&&d.defaultProps){f=$e({},f),d=d.defaultProps;for(var v in d)f[v]===void 0&&(f[v]=d[v]);return f}return f}function Uf(d,f,v,w){f=d.memoizedState,v=v(w,f),v=v==null?f:$e({},f,v),d.memoizedState=v,d.lanes===0&&(d.updateQueue.baseState=v)}var Vf={isMounted:function(d){return(d=d._reactInternals)?rl(d)===d:!1},enqueueSetState:function(d,f,v){d=d._reactInternals;var w=nr(),N=Bs(d),M=Io(w,N);M.payload=f,v!=null&&(M.callback=v),f=cc(d,M,N),f!==null&&(js(f,d,N,w),mh(f,d,N))},enqueueReplaceState:function(d,f,v){d=d._reactInternals;var w=nr(),N=Bs(d),M=Io(w,N);M.tag=1,M.payload=f,v!=null&&(M.callback=v),f=cc(d,M,N),f!==null&&(js(f,d,N,w),mh(f,d,N))},enqueueForceUpdate:function(d,f){d=d._reactInternals;var v=nr(),w=Bs(d),N=Io(v,w);N.tag=2,f!=null&&(N.callback=f),f=cc(d,N,w),f!==null&&(js(f,d,w,v),mh(f,d,w))}};function hE(d,f,v,w,N,M,z){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(w,M,z):f.prototype&&f.prototype.isPureReactComponent?!eh(v,w)||!eh(N,M):!0}function hT(d,f,v){var w=!1,N=rc,M=f.contextType;return typeof M=="object"&&M!==null?M=Ms(M):(N=Hr(f)?_l:cr.current,w=f.contextTypes,M=(w=w!=null)?El(d,N):rc),f=new f(v,M),d.memoizedState=f.state!==null&&f.state!==void 0?f.state:null,f.updater=Vf,d.stateNode=f,f._reactInternals=d,w&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=N,d.__reactInternalMemoizedMaskedChildContext=M),f}function pT(d,f,v,w){d=f.state,typeof f.componentWillReceiveProps=="function"&&f.componentWillReceiveProps(v,w),typeof f.UNSAFE_componentWillReceiveProps=="function"&&f.UNSAFE_componentWillReceiveProps(v,w),f.state!==d&&Vf.enqueueReplaceState(f,f.state,null)}function pE(d,f,v,w){var N=d.stateNode;N.props=v,N.state=d.memoizedState,N.refs={},fh(d);var M=f.contextType;typeof M=="object"&&M!==null?N.context=Ms(M):(M=Hr(f)?_l:cr.current,N.context=El(d,M)),N.state=d.memoizedState,M=f.getDerivedStateFromProps,typeof M=="function"&&(Uf(d,f,M,v),N.state=d.memoizedState),typeof f.getDerivedStateFromProps=="function"||typeof N.getSnapshotBeforeUpdate=="function"||typeof N.UNSAFE_componentWillMount!="function"&&typeof N.componentWillMount!="function"||(f=N.state,typeof N.componentWillMount=="function"&&N.componentWillMount(),typeof N.UNSAFE_componentWillMount=="function"&&N.UNSAFE_componentWillMount(),f!==N.state&&Vf.enqueueReplaceState(N,N.state,null),Pf(d,v,N,w),N.state=d.memoizedState),typeof N.componentDidMount=="function"&&(d.flags|=4194308)}function Mu(d,f){try{var v="",w=f;do v+=sn(w),w=w.return;while(w);var N=v}catch(M){N=`
Error generating stack: `+M.message+`
`+M.stack}return{value:d,source:f,stack:N,digest:null}}function fE(d,f,v){return{value:d,source:null,stack:v??null,digest:f??null}}function mE(d,f){try{console.error(f.value)}catch(v){setTimeout(function(){throw v})}}var A0=typeof WeakMap=="function"?WeakMap:Map;function gE(d,f,v){v=Io(-1,v),v.tag=3,v.payload={element:null};var w=f.value;return v.callback=function(){nm||(nm=!0,AE=w),mE(d,f)},v}function ya(d,f,v){v=Io(-1,v),v.tag=3;var w=d.type.getDerivedStateFromError;if(typeof w=="function"){var N=f.value;v.payload=function(){return w(N)},v.callback=function(){mE(d,f)}}var M=d.stateNode;return M!==null&&typeof M.componentDidCatch=="function"&&(v.callback=function(){mE(d,f),typeof w!="function"&&(hc===null?hc=new Set([this]):hc.add(this));var z=f.stack;this.componentDidCatch(f.value,{componentStack:z!==null?z:""})}),v}function fT(d,f,v){var w=d.pingCache;if(w===null){w=d.pingCache=new A0;var N=new Set;w.set(f,N)}else N=w.get(f),N===void 0&&(N=new Set,w.set(f,N));N.has(v)||(N.add(v),d=VT.bind(null,d,f,v),f.then(d,d))}function mT(d){do{var f;if((f=d.tag===13)&&(f=d.memoizedState,f=f!==null?f.dehydrated!==null:!0),f)return d;d=d.return}while(d!==null);return null}function gT(d,f,v,w,N){return(d.mode&1)===0?(d===f?d.flags|=65536:(d.flags|=128,v.flags|=131072,v.flags&=-52805,v.tag===1&&(v.alternate===null?v.tag=17:(f=Io(-1,1),f.tag=2,cc(v,f,1))),v.lanes|=1),d):(d.flags|=65536,d.lanes=N,d)}var I0=Oe.ReactCurrentOwner,Xr=!1;function Ir(d,f,v,w){f.child=d===null?XS(f,null,v,w):Iu(f,d.child,v,w)}function Ff(d,f,v,w,N){v=v.render;var M=f.ref;return ma(f,N),w=ku(d,f,v,w,M,N),v=sE(),d!==null&&!Xr?(f.updateQueue=d.updateQueue,f.flags&=-2053,d.lanes&=~N,Po(d,f,N)):(Mn&&v&&bf(f),f.flags|=1,Ir(d,f,w,N),f.child)}function _T(d,f,v,w,N){if(d===null){var M=v.type;return typeof M=="function"&&!fc(M)&&M.defaultProps===void 0&&v.compare===null&&v.defaultProps===void 0?(f.tag=15,f.type=M,ET(d,f,M,w,N)):(d=fm(v.type,null,w,f,f.mode,N),d.ref=f.ref,d.return=f,f.child=d)}if(M=d.child,(d.lanes&N)===0){var z=M.memoizedProps;if(v=v.compare,v=v!==null?v:eh,v(z,w)&&d.ref===f.ref)return Po(d,f,N)}return f.flags|=1,d=Ta(M,w),d.ref=f.ref,d.return=f,f.child=d}function ET(d,f,v,w,N){if(d!==null){var M=d.memoizedProps;if(eh(M,w)&&d.ref===f.ref)if(Xr=!1,f.pendingProps=w=M,(d.lanes&N)!==0)(d.flags&131072)!==0&&(Xr=!0);else return f.lanes=d.lanes,Po(d,f,N)}return _E(d,f,v,w,N)}function yT(d,f,v){var w=f.pendingProps,N=w.children,M=d!==null?d.memoizedState:null;if(w.mode==="hidden")if((f.mode&1)===0)f.memoizedState={baseLanes:0,cachePool:null,transitions:null},zn(uo,Es),Es|=v;else{if((v&1073741824)===0)return d=M!==null?M.baseLanes|v:v,f.lanes=f.childLanes=1073741824,f.memoizedState={baseLanes:d,cachePool:null,transitions:null},f.updateQueue=null,zn(uo,Es),Es|=d,null;f.memoizedState={baseLanes:0,cachePool:null,transitions:null},w=M!==null?M.baseLanes:v,zn(uo,Es),Es|=w}else M!==null?(w=M.baseLanes|v,f.memoizedState=null):w=v,zn(uo,Es),Es|=w;return Ir(d,f,N,v),f.child}function vT(d,f){var v=f.ref;(d===null&&v!==null||d!==null&&d.ref!==v)&&(f.flags|=512,f.flags|=2097152)}function _E(d,f,v,w,N){var M=Hr(v)?_l:cr.current;return M=El(f,M),ma(f,N),v=ku(d,f,v,w,M,N),w=sE(),d!==null&&!Xr?(f.updateQueue=d.updateQueue,f.flags&=-2053,d.lanes&=~N,Po(d,f,N)):(Mn&&w&&bf(f),f.flags|=1,Ir(d,f,v,N),f.child)}function ST(d,f,v,w,N){if(Hr(v)){var M=!0;Tf(f)}else M=!1;if(ma(f,N),f.stateNode===null)Hf(d,f),hT(f,v,w),pE(f,v,w,N),w=!0;else if(d===null){var z=f.stateNode,te=f.memoizedProps;z.props=te;var ae=z.context,ve=v.contextType;typeof ve=="object"&&ve!==null?ve=Ms(ve):(ve=Hr(v)?_l:cr.current,ve=El(f,ve));var Fe=v.getDerivedStateFromProps,Be=typeof Fe=="function"||typeof z.getSnapshotBeforeUpdate=="function";Be||typeof z.UNSAFE_componentWillReceiveProps!="function"&&typeof z.componentWillReceiveProps!="function"||(te!==w||ae!==ve)&&pT(f,z,w,ve),ac=!1;var Me=f.memoizedState;z.state=Me,Pf(f,w,z,N),ae=f.memoizedState,te!==w||Me!==ae||zr.current||ac?(typeof Fe=="function"&&(Uf(f,v,Fe,w),ae=f.memoizedState),(te=ac||hE(f,v,te,w,Me,ae,ve))?(Be||typeof z.UNSAFE_componentWillMount!="function"&&typeof z.componentWillMount!="function"||(typeof z.componentWillMount=="function"&&z.componentWillMount(),typeof z.UNSAFE_componentWillMount=="function"&&z.UNSAFE_componentWillMount()),typeof z.componentDidMount=="function"&&(f.flags|=4194308)):(typeof z.componentDidMount=="function"&&(f.flags|=4194308),f.memoizedProps=w,f.memoizedState=ae),z.props=w,z.state=ae,z.context=ve,w=te):(typeof z.componentDidMount=="function"&&(f.flags|=4194308),w=!1)}else{z=f.stateNode,$S(d,f),te=f.memoizedProps,ve=f.type===f.elementType?te:_s(f.type,te),z.props=ve,Be=f.pendingProps,Me=z.context,ae=v.contextType,typeof ae=="object"&&ae!==null?ae=Ms(ae):(ae=Hr(v)?_l:cr.current,ae=El(f,ae));var et=v.getDerivedStateFromProps;(Fe=typeof et=="function"||typeof z.getSnapshotBeforeUpdate=="function")||typeof z.UNSAFE_componentWillReceiveProps!="function"&&typeof z.componentWillReceiveProps!="function"||(te!==Be||Me!==ae)&&pT(f,z,w,ae),ac=!1,Me=f.memoizedState,z.state=Me,Pf(f,w,z,N);var ot=f.memoizedState;te!==Be||Me!==ot||zr.current||ac?(typeof et=="function"&&(Uf(f,v,et,w),ot=f.memoizedState),(ve=ac||hE(f,v,ve,w,Me,ot,ae)||!1)?(Fe||typeof z.UNSAFE_componentWillUpdate!="function"&&typeof z.componentWillUpdate!="function"||(typeof z.componentWillUpdate=="function"&&z.componentWillUpdate(w,ot,ae),typeof z.UNSAFE_componentWillUpdate=="function"&&z.UNSAFE_componentWillUpdate(w,ot,ae)),typeof z.componentDidUpdate=="function"&&(f.flags|=4),typeof z.getSnapshotBeforeUpdate=="function"&&(f.flags|=1024)):(typeof z.componentDidUpdate!="function"||te===d.memoizedProps&&Me===d.memoizedState||(f.flags|=4),typeof z.getSnapshotBeforeUpdate!="function"||te===d.memoizedProps&&Me===d.memoizedState||(f.flags|=1024),f.memoizedProps=w,f.memoizedState=ot),z.props=w,z.state=ot,z.context=ae,w=ve):(typeof z.componentDidUpdate!="function"||te===d.memoizedProps&&Me===d.memoizedState||(f.flags|=4),typeof z.getSnapshotBeforeUpdate!="function"||te===d.memoizedProps&&Me===d.memoizedState||(f.flags|=1024),w=!1)}return Bf(d,f,v,w,M,N)}function Bf(d,f,v,w,N,M){vT(d,f);var z=(f.flags&128)!==0;if(!w&&!z)return N&&WS(f,v,!1),Po(d,f,M);w=f.stateNode,I0.current=f;var te=z&&typeof v.getDerivedStateFromError!="function"?null:w.render();return f.flags|=1,d!==null&&z?(f.child=Iu(f,d.child,null,M),f.child=Iu(f,null,te,M)):Ir(d,f,te,M),f.memoizedState=w.state,N&&WS(f,v,!0),f.child}function EE(d){var f=d.stateNode;f.pendingContext?GS(d,f.pendingContext,f.pendingContext!==f.context):f.context&&GS(d,f.context,!1),eE(d,f.containerInfo)}function TT(d,f,v,w,N){return Au(),Y_(N),f.flags|=256,Ir(d,f,v,w),f.child}var yE={dehydrated:null,treeContext:null,retryLane:0};function Uu(d){return{baseLanes:d,cachePool:null,transitions:null}}function jf(d,f,v){var w=f.pendingProps,N=Zn.current,M=!1,z=(f.flags&128)!==0,te;if((te=z)||(te=d!==null&&d.memoizedState===null?!1:(N&2)!==0),te?(M=!0,f.flags&=-129):(d===null||d.memoizedState!==null)&&(N|=1),zn(Zn,N&1),d===null)return q_(f),d=f.memoizedState,d!==null&&(d=d.dehydrated,d!==null)?((f.mode&1)===0?f.lanes=1:d.data==="$!"?f.lanes=8:f.lanes=1073741824,null):(z=w.children,d=w.fallback,M?(w=f.mode,M=f.child,z={mode:"hidden",children:z},(w&1)===0&&M!==null?(M.childLanes=0,M.pendingProps=z):M=mc(z,w,0,null),d=Pl(d,w,v,null),M.return=f,d.return=f,M.sibling=d,f.child=M,f.child.memoizedState=Uu(v),f.memoizedState=yE,d):Gf(f,z));if(N=d.memoizedState,N!==null&&(te=N.dehydrated,te!==null))return RT(d,f,z,w,te,N,v);if(M){M=w.fallback,z=f.mode,N=d.child,te=N.sibling;var ae={mode:"hidden",children:w.children};return(z&1)===0&&f.child!==N?(w=f.child,w.childLanes=0,w.pendingProps=ae,f.deletions=null):(w=Ta(N,ae),w.subtreeFlags=N.subtreeFlags&14680064),te!==null?M=Ta(te,M):(M=Pl(M,z,v,null),M.flags|=2),M.return=f,w.return=f,w.sibling=M,f.child=w,w=M,M=f.child,z=d.child.memoizedState,z=z===null?Uu(v):{baseLanes:z.baseLanes|v,cachePool:null,transitions:z.transitions},M.memoizedState=z,M.childLanes=d.childLanes&~v,f.memoizedState=yE,w}return M=d.child,d=M.sibling,w=Ta(M,{mode:"visible",children:w.children}),(f.mode&1)===0&&(w.lanes=v),w.return=f,w.sibling=null,d!==null&&(v=f.deletions,v===null?(f.deletions=[d],f.flags|=16):v.push(d)),f.child=w,f.memoizedState=null,w}function Gf(d,f){return f=mc({mode:"visible",children:f},d.mode,0,null),f.return=d,d.child=f}function Cl(d,f,v,w){return w!==null&&Y_(w),Iu(f,d.child,null,v),d=Gf(f,f.pendingProps.children),d.flags|=2,f.memoizedState=null,d}function RT(d,f,v,w,N,M,z){if(v)return f.flags&256?(f.flags&=-257,w=fE(Error(a(422))),Cl(d,f,z,w)):f.memoizedState!==null?(f.child=d.child,f.flags|=128,null):(M=w.fallback,N=f.mode,w=mc({mode:"visible",children:w.children},N,0,null),M=Pl(M,N,z,null),M.flags|=2,w.return=f,M.return=f,w.sibling=M,f.child=w,(f.mode&1)!==0&&Iu(f,d.child,null,z),f.child.memoizedState=Uu(z),f.memoizedState=yE,M);if((f.mode&1)===0)return Cl(d,f,z,null);if(N.data==="$!"){if(w=N.nextSibling&&N.nextSibling.dataset,w)var te=w.dgst;return w=te,M=Error(a(419)),w=fE(M,w,void 0),Cl(d,f,z,w)}if(te=(z&d.childLanes)!==0,Xr||te){if(w=Xi,w!==null){switch(z&-z){case 4:N=2;break;case 16:N=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:N=32;break;case 536870912:N=268435456;break;default:N=0}N=(N&(w.suspendedLanes|z))!==0?0:N,N!==0&&N!==M.retryLane&&(M.retryLane=N,ga(d,N),js(w,d,N,-1))}return NE(),w=fE(Error(a(421))),Cl(d,f,z,w)}return N.data==="$?"?(f.flags|=128,f.child=d.child,f=dm.bind(null,d),N._reactRetry=f,null):(d=M.treeContext,qr=nc(N.nextSibling),Kr=f,Mn=!0,br=null,d!==null&&(xs[gs++]=ha,xs[gs++]=pa,xs[gs++]=yl,ha=d.id,pa=d.overflow,yl=f),f=Gf(f,w.children),f.flags|=4096,f)}function wT(d,f,v){d.lanes|=f;var w=d.alternate;w!==null&&(w.lanes|=f),Q_(d.return,f,v)}function Wf(d,f,v,w,N){var M=d.memoizedState;M===null?d.memoizedState={isBackwards:f,rendering:null,renderingStartTime:0,last:w,tail:v,tailMode:N}:(M.isBackwards=f,M.rendering=null,M.renderingStartTime=0,M.last=w,M.tail=v,M.tailMode=N)}function zf(d,f,v){var w=f.pendingProps,N=w.revealOrder,M=w.tail;if(Ir(d,f,w.children,v),w=Zn.current,(w&2)!==0)w=w&1|2,f.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=f.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&wT(d,v,f);else if(d.tag===19)wT(d,v,f);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===f)break e;for(;d.sibling===null;){if(d.return===null||d.return===f)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}w&=1}if(zn(Zn,w),(f.mode&1)===0)f.memoizedState=null;else switch(N){case"forwards":for(v=f.child,N=null;v!==null;)d=v.alternate,d!==null&&lc(d)===null&&(N=v),v=v.sibling;v=N,v===null?(N=f.child,f.child=null):(N=v.sibling,v.sibling=null),Wf(f,!1,N,v,M);break;case"backwards":for(v=null,N=f.child,f.child=null;N!==null;){if(d=N.alternate,d!==null&&lc(d)===null){f.child=N;break}d=N.sibling,N.sibling=v,v=N,N=d}Wf(f,!0,v,null,M);break;case"together":Wf(f,!1,null,null,void 0);break;default:f.memoizedState=null}return f.child}function Hf(d,f){(f.mode&1)===0&&d!==null&&(d.alternate=null,f.alternate=null,f.flags|=2)}function Po(d,f,v){if(d!==null&&(f.dependencies=d.dependencies),bl|=f.lanes,(v&f.childLanes)===0)return null;if(d!==null&&f.child!==d.child)throw Error(a(153));if(f.child!==null){for(d=f.child,v=Ta(d,d.pendingProps),f.child=v,v.return=f;d.sibling!==null;)d=d.sibling,v=v.sibling=Ta(d,d.pendingProps),v.return=f;v.sibling=null}return f.child}function CT(d,f,v){switch(f.tag){case 3:EE(f),Au();break;case 5:eT(f);break;case 1:Hr(f.type)&&Tf(f);break;case 4:eE(f,f.stateNode.containerInfo);break;case 10:var w=f.type._context,N=f.memoizedProps.value;zn(Of,w._currentValue),w._currentValue=N;break;case 13:if(w=f.memoizedState,w!==null)return w.dehydrated!==null?(zn(Zn,Zn.current&1),f.flags|=128,null):(v&f.child.childLanes)!==0?jf(d,f,v):(zn(Zn,Zn.current&1),d=Po(d,f,v),d!==null?d.sibling:null);zn(Zn,Zn.current&1);break;case 19:if(w=(v&f.childLanes)!==0,(d.flags&128)!==0){if(w)return zf(d,f,v);f.flags|=128}if(N=f.memoizedState,N!==null&&(N.rendering=null,N.tail=null,N.lastEffect=null),zn(Zn,Zn.current),w)break;return null;case 22:case 23:return f.lanes=0,yT(d,f,v)}return Po(d,f,v)}var bT,Kf,vE,AT;bT=function(d,f){for(var v=f.child;v!==null;){if(v.tag===5||v.tag===6)d.appendChild(v.stateNode);else if(v.tag!==4&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===f)break;for(;v.sibling===null;){if(v.return===null||v.return===f)return;v=v.return}v.sibling.return=v.return,v=v.sibling}},Kf=function(){},vE=function(d,f,v,w){var N=d.memoizedProps;if(N!==w){d=f.stateNode,Sl(Oo.current);var M=null;switch(v){case"input":N=c_(d,N),w=c_(d,w),M=[];break;case"select":N=$e({},N,{value:void 0}),w=$e({},w,{value:void 0}),M=[];break;case"textarea":N=Rr(d,N),w=Rr(d,w),M=[];break;default:typeof N.onClick!="function"&&typeof w.onClick=="function"&&(d.onclick=Ef)}Xp(v,w);var z;v=null;for(ve in N)if(!w.hasOwnProperty(ve)&&N.hasOwnProperty(ve)&&N[ve]!=null)if(ve==="style"){var te=N[ve];for(z in te)te.hasOwnProperty(z)&&(v||(v={}),v[z]="")}else ve!=="dangerouslySetInnerHTML"&&ve!=="children"&&ve!=="suppressContentEditableWarning"&&ve!=="suppressHydrationWarning"&&ve!=="autoFocus"&&(p.hasOwnProperty(ve)?M||(M=[]):(M=M||[]).push(ve,null));for(ve in w){var ae=w[ve];if(te=N!=null?N[ve]:void 0,w.hasOwnProperty(ve)&&ae!==te&&(ae!=null||te!=null))if(ve==="style")if(te){for(z in te)!te.hasOwnProperty(z)||ae&&ae.hasOwnProperty(z)||(v||(v={}),v[z]="");for(z in ae)ae.hasOwnProperty(z)&&te[z]!==ae[z]&&(v||(v={}),v[z]=ae[z])}else v||(M||(M=[]),M.push(ve,v)),v=ae;else ve==="dangerouslySetInnerHTML"?(ae=ae?ae.__html:void 0,te=te?te.__html:void 0,ae!=null&&te!==ae&&(M=M||[]).push(ve,ae)):ve==="children"?typeof ae!="string"&&typeof ae!="number"||(M=M||[]).push(ve,""+ae):ve!=="suppressContentEditableWarning"&&ve!=="suppressHydrationWarning"&&(p.hasOwnProperty(ve)?(ae!=null&&ve==="onScroll"&&Xn("scroll",d),M||te===ae||(M=[])):(M=M||[]).push(ve,ae))}v&&(M=M||[]).push("style",v);var ve=M;(f.updateQueue=ve)&&(f.flags|=4)}},AT=function(d,f,v,w){v!==w&&(f.flags|=4)};function Th(d,f){if(!Mn)switch(d.tailMode){case"hidden":f=d.tail;for(var v=null;f!==null;)f.alternate!==null&&(v=f),f=f.sibling;v===null?d.tail=null:v.sibling=null;break;case"collapsed":v=d.tail;for(var w=null;v!==null;)v.alternate!==null&&(w=v),v=v.sibling;w===null?f||d.tail===null?d.tail=null:d.tail.sibling=null:w.sibling=null}}function ur(d){var f=d.alternate!==null&&d.alternate.child===d.child,v=0,w=0;if(f)for(var N=d.child;N!==null;)v|=N.lanes|N.childLanes,w|=N.subtreeFlags&14680064,w|=N.flags&14680064,N.return=d,N=N.sibling;else for(N=d.child;N!==null;)v|=N.lanes|N.childLanes,w|=N.subtreeFlags,w|=N.flags,N.return=d,N=N.sibling;return d.subtreeFlags|=w,d.childLanes=v,f}function qf(d,f,v){var w=f.pendingProps;switch(uh(f),f.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ur(f),null;case 1:return Hr(f.type)&&vf(),ur(f),null;case 3:return w=f.stateNode,Tl(),Jn(zr),Jn(cr),nE(),w.pendingContext&&(w.context=w.pendingContext,w.pendingContext=null),(d===null||d.child===null)&&(dh(f)?f.flags|=4:d===null||d.memoizedState.isDehydrated&&(f.flags&256)===0||(f.flags|=1024,br!==null&&(am(br),br=null))),Kf(d,f),ur(f),null;case 5:Pu(f);var N=Sl(Nu.current);if(v=f.type,d!==null&&f.stateNode!=null)vE(d,f,v,w,N),d.ref!==f.ref&&(f.flags|=512,f.flags|=2097152);else{if(!w){if(f.stateNode===null)throw Error(a(166));return ur(f),null}if(d=Sl(Oo.current),dh(f)){w=f.stateNode,v=f.type;var M=f.memoizedProps;switch(w[Ao]=f,w[ic]=M,d=(f.mode&1)!==0,v){case"dialog":Xn("cancel",w),Xn("close",w);break;case"iframe":case"object":case"embed":Xn("load",w);break;case"video":case"audio":for(N=0;N<rh.length;N++)Xn(rh[N],w);break;case"source":Xn("error",w);break;case"img":case"image":case"link":Xn("error",w),Xn("load",w);break;case"details":Xn("toggle",w);break;case"input":el(w,M),Xn("invalid",w);break;case"select":w._wrapperState={wasMultiple:!!M.multiple},Xn("invalid",w);break;case"textarea":qp(w,M),Xn("invalid",w)}Xp(v,M),N=null;for(var z in M)if(M.hasOwnProperty(z)){var te=M[z];z==="children"?typeof te=="string"?w.textContent!==te&&(M.suppressHydrationWarning!==!0&&_f(w.textContent,te,d),N=["children",te]):typeof te=="number"&&w.textContent!==""+te&&(M.suppressHydrationWarning!==!0&&_f(w.textContent,te,d),N=["children",""+te]):p.hasOwnProperty(z)&&te!=null&&z==="onScroll"&&Xn("scroll",w)}switch(v){case"input":Qc(w),ca(w,M,!0);break;case"textarea":Qc(w),Kv(w);break;case"select":case"option":break;default:typeof M.onClick=="function"&&(w.onclick=Ef)}w=N,f.updateQueue=w,w!==null&&(f.flags|=4)}else{z=N.nodeType===9?N:N.ownerDocument,d==="http://www.w3.org/1999/xhtml"&&(d=u_(v)),d==="http://www.w3.org/1999/xhtml"?v==="script"?(d=z.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild)):typeof w.is=="string"?d=z.createElement(v,{is:w.is}):(d=z.createElement(v),v==="select"&&(z=d,w.multiple?z.multiple=!0:w.size&&(z.size=w.size))):d=z.createElementNS(d,v),d[Ao]=f,d[ic]=w,bT(d,f,!1,!1),f.stateNode=d;e:{switch(z=f_(v,w),v){case"dialog":Xn("cancel",d),Xn("close",d),N=w;break;case"iframe":case"object":case"embed":Xn("load",d),N=w;break;case"video":case"audio":for(N=0;N<rh.length;N++)Xn(rh[N],d);N=w;break;case"source":Xn("error",d),N=w;break;case"img":case"image":case"link":Xn("error",d),Xn("load",d),N=w;break;case"details":Xn("toggle",d),N=w;break;case"input":el(d,w),N=c_(d,w),Xn("invalid",d);break;case"option":N=w;break;case"select":d._wrapperState={wasMultiple:!!w.multiple},N=$e({},w,{value:void 0}),Xn("invalid",d);break;case"textarea":qp(d,w),N=Rr(d,w),Xn("invalid",d);break;default:N=w}Xp(v,N),te=N;for(M in te)if(te.hasOwnProperty(M)){var ae=te[M];M==="style"?p_(d,ae):M==="dangerouslySetInnerHTML"?(ae=ae?ae.__html:void 0,ae!=null&&d_(d,ae)):M==="children"?typeof ae=="string"?(v!=="textarea"||ae!=="")&&tl(d,ae):typeof ae=="number"&&tl(d,""+ae):M!=="suppressContentEditableWarning"&&M!=="suppressHydrationWarning"&&M!=="autoFocus"&&(p.hasOwnProperty(M)?ae!=null&&M==="onScroll"&&Xn("scroll",d):ae!=null&&me(d,M,ae,z))}switch(v){case"input":Qc(d),ca(d,w,!1);break;case"textarea":Qc(d),Kv(d);break;case"option":w.value!=null&&d.setAttribute("value",""+On(w.value));break;case"select":d.multiple=!!w.multiple,M=w.value,M!=null?ji(d,!!w.multiple,M,!1):w.defaultValue!=null&&ji(d,!!w.multiple,w.defaultValue,!0);break;default:typeof N.onClick=="function"&&(d.onclick=Ef)}switch(v){case"button":case"input":case"select":case"textarea":w=!!w.autoFocus;break e;case"img":w=!0;break e;default:w=!1}}w&&(f.flags|=4)}f.ref!==null&&(f.flags|=512,f.flags|=2097152)}return ur(f),null;case 6:if(d&&f.stateNode!=null)AT(d,f,d.memoizedProps,w);else{if(typeof w!="string"&&f.stateNode===null)throw Error(a(166));if(v=Sl(Nu.current),Sl(Oo.current),dh(f)){if(w=f.stateNode,v=f.memoizedProps,w[Ao]=f,(M=w.nodeValue!==v)&&(d=Kr,d!==null))switch(d.tag){case 3:_f(w.nodeValue,v,(d.mode&1)!==0);break;case 5:d.memoizedProps.suppressHydrationWarning!==!0&&_f(w.nodeValue,v,(d.mode&1)!==0)}M&&(f.flags|=4)}else w=(v.nodeType===9?v:v.ownerDocument).createTextNode(w),w[Ao]=f,f.stateNode=w}return ur(f),null;case 13:if(Jn(Zn),w=f.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(Mn&&qr!==null&&(f.mode&1)!==0&&(f.flags&128)===0)YS(),Au(),f.flags|=98560,M=!1;else if(M=dh(f),w!==null&&w.dehydrated!==null){if(d===null){if(!M)throw Error(a(318));if(M=f.memoizedState,M=M!==null?M.dehydrated:null,!M)throw Error(a(317));M[Ao]=f}else Au(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;ur(f),M=!1}else br!==null&&(am(br),br=null),M=!0;if(!M)return f.flags&65536?f:null}return(f.flags&128)!==0?(f.lanes=v,f):(w=w!==null,w!==(d!==null&&d.memoizedState!==null)&&w&&(f.child.flags|=8192,(f.mode&1)!==0&&(d===null||(Zn.current&1)!==0?Pi===0&&(Pi=3):NE())),f.updateQueue!==null&&(f.flags|=4),ur(f),null);case 4:return Tl(),Kf(d,f),d===null&&pl(f.stateNode.containerInfo),ur(f),null;case 10:return $_(f.type._context),ur(f),null;case 17:return Hr(f.type)&&vf(),ur(f),null;case 19:if(Jn(Zn),M=f.memoizedState,M===null)return ur(f),null;if(w=(f.flags&128)!==0,z=M.rendering,z===null)if(w)Th(M,!1);else{if(Pi!==0||d!==null&&(d.flags&128)!==0)for(d=f.child;d!==null;){if(z=lc(d),z!==null){for(f.flags|=128,Th(M,!1),w=z.updateQueue,w!==null&&(f.updateQueue=w,f.flags|=4),f.subtreeFlags=0,w=v,v=f.child;v!==null;)M=v,d=w,M.flags&=14680066,z=M.alternate,z===null?(M.childLanes=0,M.lanes=d,M.child=null,M.subtreeFlags=0,M.memoizedProps=null,M.memoizedState=null,M.updateQueue=null,M.dependencies=null,M.stateNode=null):(M.childLanes=z.childLanes,M.lanes=z.lanes,M.child=z.child,M.subtreeFlags=0,M.deletions=null,M.memoizedProps=z.memoizedProps,M.memoizedState=z.memoizedState,M.updateQueue=z.updateQueue,M.type=z.type,d=z.dependencies,M.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),v=v.sibling;return zn(Zn,Zn.current&1|2),f.child}d=d.sibling}M.tail!==null&&Ei()>Bu&&(f.flags|=128,w=!0,Th(M,!1),f.lanes=4194304)}else{if(!w)if(d=lc(z),d!==null){if(f.flags|=128,w=!0,v=d.updateQueue,v!==null&&(f.updateQueue=v,f.flags|=4),Th(M,!0),M.tail===null&&M.tailMode==="hidden"&&!z.alternate&&!Mn)return ur(f),null}else 2*Ei()-M.renderingStartTime>Bu&&v!==1073741824&&(f.flags|=128,w=!0,Th(M,!1),f.lanes=4194304);M.isBackwards?(z.sibling=f.child,f.child=z):(v=M.last,v!==null?v.sibling=z:f.child=z,M.last=z)}return M.tail!==null?(f=M.tail,M.rendering=f,M.tail=f.sibling,M.renderingStartTime=Ei(),f.sibling=null,v=Zn.current,zn(Zn,w?v&1|2:v&1),f):(ur(f),null);case 22:case 23:return Nh(),w=f.memoizedState!==null,d!==null&&d.memoizedState!==null!==w&&(f.flags|=8192),w&&(f.mode&1)!==0?(Es&1073741824)!==0&&(ur(f),f.subtreeFlags&6&&(f.flags|=8192)):ur(f),null;case 24:return null;case 25:return null}throw Error(a(156,f.tag))}function O0(d,f){switch(uh(f),f.tag){case 1:return Hr(f.type)&&vf(),d=f.flags,d&65536?(f.flags=d&-65537|128,f):null;case 3:return Tl(),Jn(zr),Jn(cr),nE(),d=f.flags,(d&65536)!==0&&(d&128)===0?(f.flags=d&-65537|128,f):null;case 5:return Pu(f),null;case 13:if(Jn(Zn),d=f.memoizedState,d!==null&&d.dehydrated!==null){if(f.alternate===null)throw Error(a(340));Au()}return d=f.flags,d&65536?(f.flags=d&-65537|128,f):null;case 19:return Jn(Zn),null;case 4:return Tl(),null;case 10:return $_(f.type._context),null;case 22:case 23:return Nh(),null;case 24:return null;default:return null}}var Yf=!1,dr=!1,IT=typeof WeakSet=="function"?WeakSet:Set,st=null;function Vu(d,f){var v=d.ref;if(v!==null)if(typeof v=="function")try{v(null)}catch(w){si(d,f,w)}else v.current=null}function Rh(d,f,v){try{v()}catch(w){si(d,f,w)}}var OT=!1;function SE(d,f){if(yf=of,d=NS(),th(d)){if("selectionStart"in d)var v={start:d.selectionStart,end:d.selectionEnd};else e:{v=(v=d.ownerDocument)&&v.defaultView||window;var w=v.getSelection&&v.getSelection();if(w&&w.rangeCount!==0){v=w.anchorNode;var N=w.anchorOffset,M=w.focusNode;w=w.focusOffset;try{v.nodeType,M.nodeType}catch{v=null;break e}var z=0,te=-1,ae=-1,ve=0,Fe=0,Be=d,Me=null;t:for(;;){for(var et;Be!==v||N!==0&&Be.nodeType!==3||(te=z+N),Be!==M||w!==0&&Be.nodeType!==3||(ae=z+w),Be.nodeType===3&&(z+=Be.nodeValue.length),(et=Be.firstChild)!==null;)Me=Be,Be=et;for(;;){if(Be===d)break t;if(Me===v&&++ve===N&&(te=z),Me===M&&++Fe===w&&(ae=z),(et=Be.nextSibling)!==null)break;Be=Me,Me=Be.parentNode}Be=et}v=te===-1||ae===-1?null:{start:te,end:ae}}else v=null}v=v||{start:0,end:0}}else v=null;for(oh={focusedElem:d,selectionRange:v},of=!1,st=f;st!==null;)if(f=st,d=f.child,(f.subtreeFlags&1028)!==0&&d!==null)d.return=f,st=d;else for(;st!==null;){f=st;try{var ot=f.alternate;if((f.flags&1024)!==0)switch(f.tag){case 0:case 11:case 15:break;case 1:if(ot!==null){var at=ot.memoizedProps,pi=ot.memoizedState,ge=f.stateNode,ce=ge.getSnapshotBeforeUpdate(f.elementType===f.type?at:_s(f.type,at),pi);ge.__reactInternalSnapshotBeforeUpdate=ce}break;case 3:var ye=f.stateNode.containerInfo;ye.nodeType===1?ye.textContent="":ye.nodeType===9&&ye.documentElement&&ye.removeChild(ye.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(a(163))}}catch(Ge){si(f,f.return,Ge)}if(d=f.sibling,d!==null){d.return=f.return,st=d;break}st=f.return}return ot=OT,OT=!1,ot}function wh(d,f,v){var w=f.updateQueue;if(w=w!==null?w.lastEffect:null,w!==null){var N=w=w.next;do{if((N.tag&d)===d){var M=N.destroy;N.destroy=void 0,M!==void 0&&Rh(f,v,M)}N=N.next}while(N!==w)}}function Ch(d,f){if(f=f.updateQueue,f=f!==null?f.lastEffect:null,f!==null){var v=f=f.next;do{if((v.tag&d)===d){var w=v.create;v.destroy=w()}v=v.next}while(v!==f)}}function TE(d){var f=d.ref;if(f!==null){var v=d.stateNode;switch(d.tag){case 5:d=v;break;default:d=v}typeof f=="function"?f(d):f.current=d}}function NT(d){var f=d.alternate;f!==null&&(d.alternate=null,NT(f)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(f=d.stateNode,f!==null&&(delete f[Ao],delete f[ic],delete f[ch],delete f[E0],delete f[y0])),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function RE(d){return d.tag===5||d.tag===3||d.tag===4}function PT(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||RE(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function wE(d,f,v){var w=d.tag;if(w===5||w===6)d=d.stateNode,f?v.nodeType===8?v.parentNode.insertBefore(d,f):v.insertBefore(d,f):(v.nodeType===8?(f=v.parentNode,f.insertBefore(d,v)):(f=v,f.appendChild(d)),v=v._reactRootContainer,v!=null||f.onclick!==null||(f.onclick=Ef));else if(w!==4&&(d=d.child,d!==null))for(wE(d,f,v),d=d.sibling;d!==null;)wE(d,f,v),d=d.sibling}function Xf(d,f,v){var w=d.tag;if(w===5||w===6)d=d.stateNode,f?v.insertBefore(d,f):v.appendChild(d);else if(w!==4&&(d=d.child,d!==null))for(Xf(d,f,v),d=d.sibling;d!==null;)Xf(d,f,v),d=d.sibling}var er=null,Vs=!1;function Do(d,f,v){for(v=v.child;v!==null;)DT(d,f,v),v=v.sibling}function DT(d,f,v){if(ao&&typeof ao.onCommitFiberUnmount=="function")try{ao.onCommitFiberUnmount(ef,v)}catch{}switch(v.tag){case 5:dr||Vu(v,f);case 6:var w=er,N=Vs;er=null,Do(d,f,v),er=w,Vs=N,er!==null&&(Vs?(d=er,v=v.stateNode,d.nodeType===8?d.parentNode.removeChild(v):d.removeChild(v)):er.removeChild(v.stateNode));break;case 18:er!==null&&(Vs?(d=er,v=v.stateNode,d.nodeType===8?z_(d.parentNode,v):d.nodeType===1&&z_(d,v),Xd(d)):z_(er,v.stateNode));break;case 4:w=er,N=Vs,er=v.stateNode.containerInfo,Vs=!0,Do(d,f,v),er=w,Vs=N;break;case 0:case 11:case 14:case 15:if(!dr&&(w=v.updateQueue,w!==null&&(w=w.lastEffect,w!==null))){N=w=w.next;do{var M=N,z=M.destroy;M=M.tag,z!==void 0&&((M&2)!==0||(M&4)!==0)&&Rh(v,f,z),N=N.next}while(N!==w)}Do(d,f,v);break;case 1:if(!dr&&(Vu(v,f),w=v.stateNode,typeof w.componentWillUnmount=="function"))try{w.props=v.memoizedProps,w.state=v.memoizedState,w.componentWillUnmount()}catch(te){si(v,f,te)}Do(d,f,v);break;case 21:Do(d,f,v);break;case 22:v.mode&1?(dr=(w=dr)||v.memoizedState!==null,Do(d,f,v),dr=w):Do(d,f,v);break;default:Do(d,f,v)}}function kT(d){var f=d.updateQueue;if(f!==null){d.updateQueue=null;var v=d.stateNode;v===null&&(v=d.stateNode=new IT),f.forEach(function(w){var N=FT.bind(null,d,w);v.has(w)||(v.add(w),w.then(N,N))})}}function Or(d,f){var v=f.deletions;if(v!==null)for(var w=0;w<v.length;w++){var N=v[w];try{var M=d,z=f,te=z;e:for(;te!==null;){switch(te.tag){case 5:er=te.stateNode,Vs=!1;break e;case 3:er=te.stateNode.containerInfo,Vs=!0;break e;case 4:er=te.stateNode.containerInfo,Vs=!0;break e}te=te.return}if(er===null)throw Error(a(160));DT(M,z,N),er=null,Vs=!1;var ae=N.alternate;ae!==null&&(ae.return=null),N.return=null}catch(ve){si(N,f,ve)}}if(f.subtreeFlags&12854)for(f=f.child;f!==null;)CE(f,d),f=f.sibling}function CE(d,f){var v=d.alternate,w=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:if(Or(f,d),Jr(d),w&4){try{wh(3,d,d.return),Ch(3,d)}catch(at){si(d,d.return,at)}try{wh(5,d,d.return)}catch(at){si(d,d.return,at)}}break;case 1:Or(f,d),Jr(d),w&512&&v!==null&&Vu(v,v.return);break;case 5:if(Or(f,d),Jr(d),w&512&&v!==null&&Vu(v,v.return),d.flags&32){var N=d.stateNode;try{tl(N,"")}catch(at){si(d,d.return,at)}}if(w&4&&(N=d.stateNode,N!=null)){var M=d.memoizedProps,z=v!==null?v.memoizedProps:M,te=d.type,ae=d.updateQueue;if(d.updateQueue=null,ae!==null)try{te==="input"&&M.type==="radio"&&M.name!=null&&Hv(N,M),f_(te,z);var ve=f_(te,M);for(z=0;z<ae.length;z+=2){var Fe=ae[z],Be=ae[z+1];Fe==="style"?p_(N,Be):Fe==="dangerouslySetInnerHTML"?d_(N,Be):Fe==="children"?tl(N,Be):me(N,Fe,Be,ve)}switch(te){case"input":l_(N,M);break;case"textarea":Yp(N,M);break;case"select":var Me=N._wrapperState.wasMultiple;N._wrapperState.wasMultiple=!!M.multiple;var et=M.value;et!=null?ji(N,!!M.multiple,et,!1):Me!==!!M.multiple&&(M.defaultValue!=null?ji(N,!!M.multiple,M.defaultValue,!0):ji(N,!!M.multiple,M.multiple?[]:"",!1))}N[ic]=M}catch(at){si(d,d.return,at)}}break;case 6:if(Or(f,d),Jr(d),w&4){if(d.stateNode===null)throw Error(a(162));N=d.stateNode,M=d.memoizedProps;try{N.nodeValue=M}catch(at){si(d,d.return,at)}}break;case 3:if(Or(f,d),Jr(d),w&4&&v!==null&&v.memoizedState.isDehydrated)try{Xd(f.containerInfo)}catch(at){si(d,d.return,at)}break;case 4:Or(f,d),Jr(d);break;case 13:Or(f,d),Jr(d),N=d.child,N.flags&8192&&(M=N.memoizedState!==null,N.stateNode.isHidden=M,!M||N.alternate!==null&&N.alternate.memoizedState!==null||(tm=Ei())),w&4&&kT(d);break;case 22:if(Fe=v!==null&&v.memoizedState!==null,d.mode&1?(dr=(ve=dr)||Fe,Or(f,d),dr=ve):Or(f,d),Jr(d),w&8192){if(ve=d.memoizedState!==null,(d.stateNode.isHidden=ve)&&!Fe&&(d.mode&1)!==0)for(st=d,Fe=d.child;Fe!==null;){for(Be=st=Fe;st!==null;){switch(Me=st,et=Me.child,Me.tag){case 0:case 11:case 14:case 15:wh(4,Me,Me.return);break;case 1:Vu(Me,Me.return);var ot=Me.stateNode;if(typeof ot.componentWillUnmount=="function"){w=Me,v=Me.return;try{f=w,ot.props=f.memoizedProps,ot.state=f.memoizedState,ot.componentWillUnmount()}catch(at){si(w,v,at)}}break;case 5:Vu(Me,Me.return);break;case 22:if(Me.memoizedState!==null){bh(Be);continue}}et!==null?(et.return=Me,st=et):bh(Be)}Fe=Fe.sibling}e:for(Fe=null,Be=d;;){if(Be.tag===5){if(Fe===null){Fe=Be;try{N=Be.stateNode,ve?(M=N.style,typeof M.setProperty=="function"?M.setProperty("display","none","important"):M.display="none"):(te=Be.stateNode,ae=Be.memoizedProps.style,z=ae!=null&&ae.hasOwnProperty("display")?ae.display:null,te.style.display=h_("display",z))}catch(at){si(d,d.return,at)}}}else if(Be.tag===6){if(Fe===null)try{Be.stateNode.nodeValue=ve?"":Be.memoizedProps}catch(at){si(d,d.return,at)}}else if((Be.tag!==22&&Be.tag!==23||Be.memoizedState===null||Be===d)&&Be.child!==null){Be.child.return=Be,Be=Be.child;continue}if(Be===d)break e;for(;Be.sibling===null;){if(Be.return===null||Be.return===d)break e;Fe===Be&&(Fe=null),Be=Be.return}Fe===Be&&(Fe=null),Be.sibling.return=Be.return,Be=Be.sibling}}break;case 19:Or(f,d),Jr(d),w&4&&kT(d);break;case 21:break;default:Or(f,d),Jr(d)}}function Jr(d){var f=d.flags;if(f&2){try{e:{for(var v=d.return;v!==null;){if(RE(v)){var w=v;break e}v=v.return}throw Error(a(160))}switch(w.tag){case 5:var N=w.stateNode;w.flags&32&&(tl(N,""),w.flags&=-33);var M=PT(d);Xf(d,M,N);break;case 3:case 4:var z=w.stateNode.containerInfo,te=PT(d);wE(d,te,z);break;default:throw Error(a(161))}}catch(ae){si(d,d.return,ae)}d.flags&=-3}f&4096&&(d.flags&=-4097)}function Fu(d,f,v){st=d,bE(d)}function bE(d,f,v){for(var w=(d.mode&1)!==0;st!==null;){var N=st,M=N.child;if(N.tag===22&&w){var z=N.memoizedState!==null||Yf;if(!z){var te=N.alternate,ae=te!==null&&te.memoizedState!==null||dr;te=Yf;var ve=dr;if(Yf=z,(dr=ae)&&!ve)for(st=N;st!==null;)z=st,ae=z.child,z.tag===22&&z.memoizedState!==null?LT(N):ae!==null?(ae.return=z,st=ae):LT(N);for(;M!==null;)st=M,bE(M),M=M.sibling;st=N,Yf=te,dr=ve}Jf(d)}else(N.subtreeFlags&8772)!==0&&M!==null?(M.return=N,st=M):Jf(d)}}function Jf(d){for(;st!==null;){var f=st;if((f.flags&8772)!==0){var v=f.alternate;try{if((f.flags&8772)!==0)switch(f.tag){case 0:case 11:case 15:dr||Ch(5,f);break;case 1:var w=f.stateNode;if(f.flags&4&&!dr)if(v===null)w.componentDidMount();else{var N=f.elementType===f.type?v.memoizedProps:_s(f.type,v.memoizedProps);w.componentDidUpdate(N,v.memoizedState,w.__reactInternalSnapshotBeforeUpdate)}var M=f.updateQueue;M!==null&&ZS(f,M,w);break;case 3:var z=f.updateQueue;if(z!==null){if(v=null,f.child!==null)switch(f.child.tag){case 5:v=f.child.stateNode;break;case 1:v=f.child.stateNode}ZS(f,z,v)}break;case 5:var te=f.stateNode;if(v===null&&f.flags&4){v=te;var ae=f.memoizedProps;switch(f.type){case"button":case"input":case"select":case"textarea":ae.autoFocus&&v.focus();break;case"img":ae.src&&(v.src=ae.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(f.memoizedState===null){var ve=f.alternate;if(ve!==null){var Fe=ve.memoizedState;if(Fe!==null){var Be=Fe.dehydrated;Be!==null&&Xd(Be)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(a(163))}dr||f.flags&512&&TE(f)}catch(Me){si(f,f.return,Me)}}if(f===d){st=null;break}if(v=f.sibling,v!==null){v.return=f.return,st=v;break}st=f.return}}function bh(d){for(;st!==null;){var f=st;if(f===d){st=null;break}var v=f.sibling;if(v!==null){v.return=f.return,st=v;break}st=f.return}}function LT(d){for(;st!==null;){var f=st;try{switch(f.tag){case 0:case 11:case 15:var v=f.return;try{Ch(4,f)}catch(ae){si(f,v,ae)}break;case 1:var w=f.stateNode;if(typeof w.componentDidMount=="function"){var N=f.return;try{w.componentDidMount()}catch(ae){si(f,N,ae)}}var M=f.return;try{TE(f)}catch(ae){si(f,M,ae)}break;case 5:var z=f.return;try{TE(f)}catch(ae){si(f,z,ae)}}}catch(ae){si(f,f.return,ae)}if(f===d){st=null;break}var te=f.sibling;if(te!==null){te.return=f.return,st=te;break}st=f.return}}var N0=Math.ceil,$f=Oe.ReactCurrentDispatcher,Qf=Oe.ReactCurrentOwner,Fs=Oe.ReactCurrentBatchConfig,hn=0,Xi=null,hi=null,Ni=0,Es=0,uo=ks(0),Pi=0,tr=null,bl=0,Zf=0,em=0,Ah=null,Nr=null,tm=0,Bu=1/0,ko=null,nm=!1,AE=null,hc=null,ju=!1,Lo=null,im=0,Al=0,IE=null,Ih=-1,rm=0;function nr(){return(hn&6)!==0?Ei():Ih!==-1?Ih:Ih=Ei()}function Bs(d){return(d.mode&1)===0?1:(hn&2)!==0&&Ni!==0?Ni&-Ni:S0.transition!==null?(rm===0&&(rm=sS()),rm):(d=Cn,d!==0||(d=window.event,d=d===void 0?16:hS(d.type)),d)}function js(d,f,v,w){if(50<Al)throw Al=0,IE=null,Error(a(185));Wd(d,v,w),((hn&2)===0||d!==Xi)&&(d===Xi&&((hn&2)===0&&(Zf|=v),Pi===4&&va(d,Ni)),hr(d,w),v===1&&hn===0&&(f.mode&1)===0&&(Bu=Ei()+500,Rf&&sc()))}function hr(d,f){var v=d.callbackNode;xb(d,f);var w=Gd(d,d===Xi?Ni:0);if(w===0)v!==null&&nS(v),d.callbackNode=null,d.callbackPriority=0;else if(f=w&-w,d.callbackPriority!==f){if(v!=null&&nS(v),f===1)d.tag===0?v0(Il.bind(null,d)):zS(Il.bind(null,d)),g0(function(){(hn&6)===0&&sc()}),v=null;else{switch(nf(w)){case 1:v=v_;break;case 4:v=iS;break;case 16:v=Qp;break;case 536870912:v=Zp;break;default:v=Qp}v=Ph(v,sm.bind(null,d))}d.callbackPriority=f,d.callbackNode=v}}function sm(d,f){if(Ih=-1,rm=0,(hn&6)!==0)throw Error(a(327));var v=d.callbackNode;if(Gu()&&d.callbackNode!==v)return null;var w=Gd(d,d===Xi?Ni:0);if(w===0)return null;if((w&30)!==0||(w&d.expiredLanes)!==0||f)f=xo(d,w);else{f=w;var N=hn;hn|=2;var M=xT();(Xi!==d||Ni!==f)&&(ko=null,Bu=Ei()+500,pc(d,f));do try{P0();break}catch(te){OE(d,te)}while(!0);J_(),$f.current=M,hn=N,hi!==null?f=0:(Xi=null,Ni=0,f=Pi)}if(f!==0){if(f===2&&(N=T_(d),N!==0&&(w=N,f=om(d,N))),f===1)throw v=tr,pc(d,0),va(d,w),hr(d,Ei()),v;if(f===6)va(d,w);else{if(N=d.current.alternate,(w&30)===0&&!cm(N)&&(f=xo(d,w),f===2&&(M=T_(d),M!==0&&(w=M,f=om(d,M))),f===1))throw v=tr,pc(d,0),va(d,w),hr(d,Ei()),v;switch(d.finishedWork=N,d.finishedLanes=w,f){case 0:case 1:throw Error(a(345));case 2:Ol(d,Nr,ko);break;case 3:if(va(d,w),(w&130023424)===w&&(f=tm+500-Ei(),10<f)){if(Gd(d,0)!==0)break;if(N=d.suspendedLanes,(N&w)!==w){nr(),d.pingedLanes|=d.suspendedLanes&N;break}d.timeoutHandle=ah(Ol.bind(null,d,Nr,ko),f);break}Ol(d,Nr,ko);break;case 4:if(va(d,w),(w&4194240)===w)break;for(f=d.eventTimes,N=-1;0<w;){var z=31-co(w);M=1<<z,z=f[z],z>N&&(N=z),w&=~M}if(w=N,w=Ei()-w,w=(120>w?120:480>w?480:1080>w?1080:1920>w?1920:3e3>w?3e3:4320>w?4320:1960*N0(w/1960))-w,10<w){d.timeoutHandle=ah(Ol.bind(null,d,Nr,ko),w);break}Ol(d,Nr,ko);break;case 5:Ol(d,Nr,ko);break;default:throw Error(a(329))}}}return hr(d,Ei()),d.callbackNode===v?sm.bind(null,d):null}function om(d,f){var v=Ah;return d.current.memoizedState.isDehydrated&&(pc(d,f).flags|=256),d=xo(d,f),d!==2&&(f=Nr,Nr=v,f!==null&&am(f)),d}function am(d){Nr===null?Nr=d:Nr.push.apply(Nr,d)}function cm(d){for(var f=d;;){if(f.flags&16384){var v=f.updateQueue;if(v!==null&&(v=v.stores,v!==null))for(var w=0;w<v.length;w++){var N=v[w],M=N.getSnapshot;N=N.value;try{if(!lo(M(),N))return!1}catch{return!1}}}if(v=f.child,f.subtreeFlags&16384&&v!==null)v.return=f,f=v;else{if(f===d)break;for(;f.sibling===null;){if(f.return===null||f.return===d)return!0;f=f.return}f.sibling.return=f.return,f=f.sibling}}return!0}function va(d,f){for(f&=~em,f&=~Zf,d.suspendedLanes|=f,d.pingedLanes&=~f,d=d.expirationTimes;0<f;){var v=31-co(f),w=1<<v;d[v]=-1,f&=~w}}function Il(d){if((hn&6)!==0)throw Error(a(327));Gu();var f=Gd(d,0);if((f&1)===0)return hr(d,Ei()),null;var v=xo(d,f);if(d.tag!==0&&v===2){var w=T_(d);w!==0&&(f=w,v=om(d,w))}if(v===1)throw v=tr,pc(d,0),va(d,f),hr(d,Ei()),v;if(v===6)throw Error(a(345));return d.finishedWork=d.current.alternate,d.finishedLanes=f,Ol(d,Nr,ko),hr(d,Ei()),null}function Oh(d,f){var v=hn;hn|=1;try{return d(f)}finally{hn=v,hn===0&&(Bu=Ei()+500,Rf&&sc())}}function Sa(d){Lo!==null&&Lo.tag===0&&(hn&6)===0&&Gu();var f=hn;hn|=1;var v=Fs.transition,w=Cn;try{if(Fs.transition=null,Cn=1,d)return d()}finally{Cn=w,Fs.transition=v,hn=f,(hn&6)===0&&sc()}}function Nh(){Es=uo.current,Jn(uo)}function pc(d,f){d.finishedWork=null,d.finishedLanes=0;var v=d.timeoutHandle;if(v!==-1&&(d.timeoutHandle=-1,m0(v)),hi!==null)for(v=hi.return;v!==null;){var w=v;switch(uh(w),w.tag){case 1:w=w.type.childContextTypes,w!=null&&vf();break;case 3:Tl(),Jn(zr),Jn(cr),nE();break;case 5:Pu(w);break;case 4:Tl();break;case 13:Jn(Zn);break;case 19:Jn(Zn);break;case 10:$_(w.type._context);break;case 22:case 23:Nh()}v=v.return}if(Xi=d,hi=d=Ta(d.current,null),Ni=Es=f,Pi=0,tr=null,em=Zf=bl=0,Nr=Ah=null,vl!==null){for(f=0;f<vl.length;f++)if(v=vl[f],w=v.interleaved,w!==null){v.interleaved=null;var N=w.next,M=v.pending;if(M!==null){var z=M.next;M.next=N,w.next=z}v.pending=w}vl=null}return d}function OE(d,f){do{var v=hi;try{if(J_(),Df.current=Mf,Du){for(var w=ri.memoizedState;w!==null;){var N=w.queue;N!==null&&(N.pending=null),w=w.next}Du=!1}if(No=0,Oi=Ii=ri=null,Eh=!1,yh=0,Qf.current=null,v===null||v.return===null){Pi=1,tr=f,hi=null;break}e:{var M=d,z=v.return,te=v,ae=f;if(f=Ni,te.flags|=32768,ae!==null&&typeof ae=="object"&&typeof ae.then=="function"){var ve=ae,Fe=te,Be=Fe.tag;if((Fe.mode&1)===0&&(Be===0||Be===11||Be===15)){var Me=Fe.alternate;Me?(Fe.updateQueue=Me.updateQueue,Fe.memoizedState=Me.memoizedState,Fe.lanes=Me.lanes):(Fe.updateQueue=null,Fe.memoizedState=null)}var et=mT(z);if(et!==null){et.flags&=-257,gT(et,z,te,M,f),et.mode&1&&fT(M,ve,f),f=et,ae=ve;var ot=f.updateQueue;if(ot===null){var at=new Set;at.add(ae),f.updateQueue=at}else ot.add(ae);break e}else{if((f&1)===0){fT(M,ve,f),NE();break e}ae=Error(a(426))}}else if(Mn&&te.mode&1){var pi=mT(z);if(pi!==null){(pi.flags&65536)===0&&(pi.flags|=256),gT(pi,z,te,M,f),Y_(Mu(ae,te));break e}}M=ae=Mu(ae,te),Pi!==4&&(Pi=2),Ah===null?Ah=[M]:Ah.push(M),M=z;do{switch(M.tag){case 3:M.flags|=65536,f&=-f,M.lanes|=f;var ge=gE(M,ae,f);QS(M,ge);break e;case 1:te=ae;var ce=M.type,ye=M.stateNode;if((M.flags&128)===0&&(typeof ce.getDerivedStateFromError=="function"||ye!==null&&typeof ye.componentDidCatch=="function"&&(hc===null||!hc.has(ye)))){M.flags|=65536,f&=-f,M.lanes|=f;var Ge=ya(M,te,f);QS(M,Ge);break e}}M=M.return}while(M!==null)}UT(v)}catch(ct){f=ct,hi===v&&v!==null&&(hi=v=v.return);continue}break}while(!0)}function xT(){var d=$f.current;return $f.current=Mf,d===null?Mf:d}function NE(){(Pi===0||Pi===3||Pi===2)&&(Pi=4),Xi===null||(bl&268435455)===0&&(Zf&268435455)===0||va(Xi,Ni)}function xo(d,f){var v=hn;hn|=2;var w=xT();(Xi!==d||Ni!==f)&&(ko=null,pc(d,f));do try{MT();break}catch(N){OE(d,N)}while(!0);if(J_(),hn=v,$f.current=w,hi!==null)throw Error(a(261));return Xi=null,Ni=0,Pi}function MT(){for(;hi!==null;)lm(hi)}function P0(){for(;hi!==null&&!bo();)lm(hi)}function lm(d){var f=hm(d.alternate,d,Es);d.memoizedProps=d.pendingProps,f===null?UT(d):hi=f,Qf.current=null}function UT(d){var f=d;do{var v=f.alternate;if(d=f.return,(f.flags&32768)===0){if(v=qf(v,f,Es),v!==null){hi=v;return}}else{if(v=O0(v,f),v!==null){v.flags&=32767,hi=v;return}if(d!==null)d.flags|=32768,d.subtreeFlags=0,d.deletions=null;else{Pi=6,hi=null;return}}if(f=f.sibling,f!==null){hi=f;return}hi=f=d}while(f!==null);Pi===0&&(Pi=5)}function Ol(d,f,v){var w=Cn,N=Fs.transition;try{Fs.transition=null,Cn=1,D0(d,f,v,w)}finally{Fs.transition=N,Cn=w}return null}function D0(d,f,v,w){do Gu();while(Lo!==null);if((hn&6)!==0)throw Error(a(327));v=d.finishedWork;var N=d.finishedLanes;if(v===null)return null;if(d.finishedWork=null,d.finishedLanes=0,v===d.current)throw Error(a(177));d.callbackNode=null,d.callbackPriority=0;var M=v.lanes|v.childLanes;if(Mb(d,M),d===Xi&&(hi=Xi=null,Ni=0),(v.subtreeFlags&2064)===0&&(v.flags&2064)===0||ju||(ju=!0,Ph(Qp,function(){return Gu(),null})),M=(v.flags&15990)!==0,(v.subtreeFlags&15990)!==0||M){M=Fs.transition,Fs.transition=null;var z=Cn;Cn=1;var te=hn;hn|=4,Qf.current=null,SE(d,v),CE(v,d),U_(oh),of=!!yf,oh=yf=null,d.current=v,Fu(v),Pb(),hn=te,Cn=z,Fs.transition=M}else d.current=v;if(ju&&(ju=!1,Lo=d,im=N),M=d.pendingLanes,M===0&&(hc=null),kb(v.stateNode),hr(d,Ei()),f!==null)for(w=d.onRecoverableError,v=0;v<f.length;v++)N=f[v],w(N.value,{componentStack:N.stack,digest:N.digest});if(nm)throw nm=!1,d=AE,AE=null,d;return(im&1)!==0&&d.tag!==0&&Gu(),M=d.pendingLanes,(M&1)!==0?d===IE?Al++:(Al=0,IE=d):Al=0,sc(),null}function Gu(){if(Lo!==null){var d=nf(im),f=Fs.transition,v=Cn;try{if(Fs.transition=null,Cn=16>d?16:d,Lo===null)var w=!1;else{if(d=Lo,Lo=null,im=0,(hn&6)!==0)throw Error(a(331));var N=hn;for(hn|=4,st=d.current;st!==null;){var M=st,z=M.child;if((st.flags&16)!==0){var te=M.deletions;if(te!==null){for(var ae=0;ae<te.length;ae++){var ve=te[ae];for(st=ve;st!==null;){var Fe=st;switch(Fe.tag){case 0:case 11:case 15:wh(8,Fe,M)}var Be=Fe.child;if(Be!==null)Be.return=Fe,st=Be;else for(;st!==null;){Fe=st;var Me=Fe.sibling,et=Fe.return;if(NT(Fe),Fe===ve){st=null;break}if(Me!==null){Me.return=et,st=Me;break}st=et}}}var ot=M.alternate;if(ot!==null){var at=ot.child;if(at!==null){ot.child=null;do{var pi=at.sibling;at.sibling=null,at=pi}while(at!==null)}}st=M}}if((M.subtreeFlags&2064)!==0&&z!==null)z.return=M,st=z;else e:for(;st!==null;){if(M=st,(M.flags&2048)!==0)switch(M.tag){case 0:case 11:case 15:wh(9,M,M.return)}var ge=M.sibling;if(ge!==null){ge.return=M.return,st=ge;break e}st=M.return}}var ce=d.current;for(st=ce;st!==null;){z=st;var ye=z.child;if((z.subtreeFlags&2064)!==0&&ye!==null)ye.return=z,st=ye;else e:for(z=ce;st!==null;){if(te=st,(te.flags&2048)!==0)try{switch(te.tag){case 0:case 11:case 15:Ch(9,te)}}catch(ct){si(te,te.return,ct)}if(te===z){st=null;break e}var Ge=te.sibling;if(Ge!==null){Ge.return=te.return,st=Ge;break e}st=te.return}}if(hn=N,sc(),ao&&typeof ao.onPostCommitFiberRoot=="function")try{ao.onPostCommitFiberRoot(ef,d)}catch{}w=!0}return w}finally{Cn=v,Fs.transition=f}}return!1}function um(d,f,v){f=Mu(v,f),f=gE(d,f,1),d=cc(d,f,1),f=nr(),d!==null&&(Wd(d,1,f),hr(d,f))}function si(d,f,v){if(d.tag===3)um(d,d,v);else for(;f!==null;){if(f.tag===3){um(f,d,v);break}else if(f.tag===1){var w=f.stateNode;if(typeof f.type.getDerivedStateFromError=="function"||typeof w.componentDidCatch=="function"&&(hc===null||!hc.has(w))){d=Mu(v,d),d=ya(f,d,1),f=cc(f,d,1),d=nr(),f!==null&&(Wd(f,1,d),hr(f,d));break}}f=f.return}}function VT(d,f,v){var w=d.pingCache;w!==null&&w.delete(f),f=nr(),d.pingedLanes|=d.suspendedLanes&v,Xi===d&&(Ni&v)===v&&(Pi===4||Pi===3&&(Ni&130023424)===Ni&&500>Ei()-tm?pc(d,0):em|=v),hr(d,f)}function PE(d,f){f===0&&((d.mode&1)===0?f=1:(f=_n,_n<<=1,(_n&130023424)===0&&(_n=4194304)));var v=nr();d=ga(d,f),d!==null&&(Wd(d,f,v),hr(d,v))}function dm(d){var f=d.memoizedState,v=0;f!==null&&(v=f.retryLane),PE(d,v)}function FT(d,f){var v=0;switch(d.tag){case 13:var w=d.stateNode,N=d.memoizedState;N!==null&&(v=N.retryLane);break;case 19:w=d.stateNode;break;default:throw Error(a(314))}w!==null&&w.delete(f),PE(d,v)}var hm;hm=function(d,f,v){if(d!==null)if(d.memoizedProps!==f.pendingProps||zr.current)Xr=!0;else{if((d.lanes&v)===0&&(f.flags&128)===0)return Xr=!1,CT(d,f,v);Xr=(d.flags&131072)!==0}else Xr=!1,Mn&&(f.flags&1048576)!==0&&Cf(f,wf,f.index);switch(f.lanes=0,f.tag){case 2:var w=f.type;Hf(d,f),d=f.pendingProps;var N=El(f,cr.current);ma(f,v),N=ku(null,f,w,d,N,v);var M=sE();return f.flags|=1,typeof N=="object"&&N!==null&&typeof N.render=="function"&&N.$$typeof===void 0?(f.tag=1,f.memoizedState=null,f.updateQueue=null,Hr(w)?(M=!0,Tf(f)):M=!1,f.memoizedState=N.state!==null&&N.state!==void 0?N.state:null,fh(f),N.updater=Vf,f.stateNode=N,N._reactInternals=f,pE(f,w,d,v),f=Bf(null,f,w,!0,M,v)):(f.tag=0,Mn&&M&&bf(f),Ir(null,f,N,v),f=f.child),f;case 16:w=f.elementType;e:{switch(Hf(d,f),d=f.pendingProps,N=w._init,w=N(w._payload),f.type=w,N=f.tag=Nl(w),d=_s(w,d),N){case 0:f=_E(null,f,w,d,v);break e;case 1:f=ST(null,f,w,d,v);break e;case 11:f=Ff(null,f,w,d,v);break e;case 14:f=_T(null,f,w,_s(w.type,d),v);break e}throw Error(a(306,w,""))}return f;case 0:return w=f.type,N=f.pendingProps,N=f.elementType===w?N:_s(w,N),_E(d,f,w,N,v);case 1:return w=f.type,N=f.pendingProps,N=f.elementType===w?N:_s(w,N),ST(d,f,w,N,v);case 3:e:{if(EE(f),d===null)throw Error(a(387));w=f.pendingProps,M=f.memoizedState,N=M.element,$S(d,f),Pf(f,w,null,v);var z=f.memoizedState;if(w=z.element,M.isDehydrated)if(M={element:w,isDehydrated:!1,cache:z.cache,pendingSuspenseBoundaries:z.pendingSuspenseBoundaries,transitions:z.transitions},f.updateQueue.baseState=M,f.memoizedState=M,f.flags&256){N=Mu(Error(a(423)),f),f=TT(d,f,w,v,N);break e}else if(w!==N){N=Mu(Error(a(424)),f),f=TT(d,f,w,v,N);break e}else for(qr=nc(f.stateNode.containerInfo.firstChild),Kr=f,Mn=!0,br=null,v=XS(f,null,w,v),f.child=v;v;)v.flags=v.flags&-3|4096,v=v.sibling;else{if(Au(),w===N){f=Po(d,f,v);break e}Ir(d,f,w,v)}f=f.child}return f;case 5:return eT(f),d===null&&q_(f),w=f.type,N=f.pendingProps,M=d!==null?d.memoizedProps:null,z=N.children,W_(w,N)?z=null:M!==null&&W_(w,M)&&(f.flags|=32),vT(d,f),Ir(d,f,z,v),f.child;case 6:return d===null&&q_(f),null;case 13:return jf(d,f,v);case 4:return eE(f,f.stateNode.containerInfo),w=f.pendingProps,d===null?f.child=Iu(f,null,w,v):Ir(d,f,w,v),f.child;case 11:return w=f.type,N=f.pendingProps,N=f.elementType===w?N:_s(w,N),Ff(d,f,w,N,v);case 7:return Ir(d,f,f.pendingProps,v),f.child;case 8:return Ir(d,f,f.pendingProps.children,v),f.child;case 12:return Ir(d,f,f.pendingProps.children,v),f.child;case 10:e:{if(w=f.type._context,N=f.pendingProps,M=f.memoizedProps,z=N.value,zn(Of,w._currentValue),w._currentValue=z,M!==null)if(lo(M.value,z)){if(M.children===N.children&&!zr.current){f=Po(d,f,v);break e}}else for(M=f.child,M!==null&&(M.return=f);M!==null;){var te=M.dependencies;if(te!==null){z=M.child;for(var ae=te.firstContext;ae!==null;){if(ae.context===w){if(M.tag===1){ae=Io(-1,v&-v),ae.tag=2;var ve=M.updateQueue;if(ve!==null){ve=ve.shared;var Fe=ve.pending;Fe===null?ae.next=ae:(ae.next=Fe.next,Fe.next=ae),ve.pending=ae}}M.lanes|=v,ae=M.alternate,ae!==null&&(ae.lanes|=v),Q_(M.return,v,f),te.lanes|=v;break}ae=ae.next}}else if(M.tag===10)z=M.type===f.type?null:M.child;else if(M.tag===18){if(z=M.return,z===null)throw Error(a(341));z.lanes|=v,te=z.alternate,te!==null&&(te.lanes|=v),Q_(z,v,f),z=M.sibling}else z=M.child;if(z!==null)z.return=M;else for(z=M;z!==null;){if(z===f){z=null;break}if(M=z.sibling,M!==null){M.return=z.return,z=M;break}z=z.return}M=z}Ir(d,f,N.children,v),f=f.child}return f;case 9:return N=f.type,w=f.pendingProps.children,ma(f,v),N=Ms(N),w=w(N),f.flags|=1,Ir(d,f,w,v),f.child;case 14:return w=f.type,N=_s(w,f.pendingProps),N=_s(w.type,N),_T(d,f,w,N,v);case 15:return ET(d,f,f.type,f.pendingProps,v);case 17:return w=f.type,N=f.pendingProps,N=f.elementType===w?N:_s(w,N),Hf(d,f),f.tag=1,Hr(w)?(d=!0,Tf(f)):d=!1,ma(f,v),hT(f,w,N),pE(f,w,N,v),Bf(null,f,w,!0,d,v);case 19:return zf(d,f,v);case 22:return yT(d,f,v)}throw Error(a(156,f.tag))};function Ph(d,f){return tS(d,f)}function pm(d,f,v,w){this.tag=d,this.key=v,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=f,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=w,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ys(d,f,v,w){return new pm(d,f,v,w)}function fc(d){return d=d.prototype,!(!d||!d.isReactComponent)}function Nl(d){if(typeof d=="function")return fc(d)?1:0;if(d!=null){if(d=d.$$typeof,d===Ai)return 11;if(d===Tr)return 14}return 2}function Ta(d,f){var v=d.alternate;return v===null?(v=ys(d.tag,f,d.key,d.mode),v.elementType=d.elementType,v.type=d.type,v.stateNode=d.stateNode,v.alternate=d,d.alternate=v):(v.pendingProps=f,v.type=d.type,v.flags=0,v.subtreeFlags=0,v.deletions=null),v.flags=d.flags&14680064,v.childLanes=d.childLanes,v.lanes=d.lanes,v.child=d.child,v.memoizedProps=d.memoizedProps,v.memoizedState=d.memoizedState,v.updateQueue=d.updateQueue,f=d.dependencies,v.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext},v.sibling=d.sibling,v.index=d.index,v.ref=d.ref,v}function fm(d,f,v,w,N,M){var z=2;if(w=d,typeof d=="function")fc(d)&&(z=1);else if(typeof d=="string")z=5;else e:switch(d){case ut:return Pl(v.children,N,M,f);case rt:z=8,N|=8;break;case dn:return d=ys(12,v,f,N|2),d.elementType=dn,d.lanes=M,d;case Qi:return d=ys(13,v,f,N),d.elementType=Qi,d.lanes=M,d;case qt:return d=ys(19,v,f,N),d.elementType=qt,d.lanes=M,d;case Yt:return mc(v,N,M,f);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case tn:z=10;break e;case bi:z=9;break e;case Ai:z=11;break e;case Tr:z=14;break e;case xn:z=16,w=null;break e}throw Error(a(130,d==null?d:typeof d,""))}return f=ys(z,v,f,N),f.elementType=d,f.type=w,f.lanes=M,f}function Pl(d,f,v,w){return d=ys(7,d,w,f),d.lanes=v,d}function mc(d,f,v,w){return d=ys(22,d,w,f),d.elementType=Yt,d.lanes=v,d.stateNode={isHidden:!1},d}function DE(d,f,v){return d=ys(6,d,null,f),d.lanes=v,d}function kE(d,f,v){return f=ys(4,d.children!==null?d.children:[],d.key,f),f.lanes=v,f.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},f}function k0(d,f,v,w,N){this.tag=f,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=R_(0),this.expirationTimes=R_(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=R_(0),this.identifierPrefix=w,this.onRecoverableError=N,this.mutableSourceEagerHydrationData=null}function LE(d,f,v,w,N,M,z,te,ae){return d=new k0(d,f,v,te,ae),f===1?(f=1,M===!0&&(f|=8)):f=0,M=ys(3,null,null,f),d.current=M,M.stateNode=d,M.memoizedState={element:w,isDehydrated:v,cache:null,transitions:null,pendingSuspenseBoundaries:null},fh(M),d}function L0(d,f,v){var w=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ze,key:w==null?null:""+w,children:d,containerInfo:f,implementation:v}}function BT(d){if(!d)return rc;d=d._reactInternals;e:{if(rl(d)!==d||d.tag!==1)throw Error(a(170));var f=d;do{switch(f.tag){case 3:f=f.stateNode.context;break e;case 1:if(Hr(f.type)){f=f.stateNode.__reactInternalMemoizedMergedChildContext;break e}}f=f.return}while(f!==null);throw Error(a(171))}if(d.tag===1){var v=d.type;if(Hr(v))return Sf(d,v,f)}return f}function mm(d,f,v,w,N,M,z,te,ae){return d=LE(v,w,!0,d,N,M,z,te,ae),d.context=BT(null),v=d.current,w=nr(),N=Bs(v),M=Io(w,N),M.callback=f??null,cc(v,M,N),d.current.lanes=N,Wd(d,N,w),hr(d,w),d}function Dh(d,f,v,w){var N=f.current,M=nr(),z=Bs(N);return v=BT(v),f.context===null?f.context=v:f.pendingContext=v,f=Io(M,z),f.payload={element:d},w=w===void 0?null:w,w!==null&&(f.callback=w),d=cc(N,f,z),d!==null&&(js(d,N,z,M),mh(d,N,z)),z}function gm(d){if(d=d.current,!d.child)return null;switch(d.child.tag){case 5:return d.child.stateNode;default:return d.child.stateNode}}function xE(d,f){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var v=d.retryLane;d.retryLane=v!==0&&v<f?v:f}}function ME(d,f){xE(d,f),(d=d.alternate)&&xE(d,f)}function kh(){return null}var ho=typeof reportError=="function"?reportError:function(d){console.error(d)};function _m(d){this._internalRoot=d}Em.prototype.render=_m.prototype.render=function(d){var f=this._internalRoot;if(f===null)throw Error(a(409));Dh(d,f,null,null)},Em.prototype.unmount=_m.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var f=d.containerInfo;Sa(function(){Dh(null,d,null,null)}),f[Ds]=null}};function Em(d){this._internalRoot=d}Em.prototype.unstable_scheduleHydration=function(d){if(d){var f=w_();d={blockedOn:null,target:d,priority:f};for(var v=0;v<la.length&&f!==0&&f<la[v].priority;v++);la.splice(v,0,d),v===0&&uS(d)}};function UE(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function Wu(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11&&(d.nodeType!==8||d.nodeValue!==" react-mount-point-unstable "))}function VE(){}function x0(d,f,v,w,N){if(N){if(typeof w=="function"){var M=w;w=function(){var ve=gm(z);M.call(ve)}}var z=mm(f,w,d,0,null,!1,!1,"",VE);return d._reactRootContainer=z,d[Ds]=z.current,pl(d.nodeType===8?d.parentNode:d),Sa(),z}for(;N=d.lastChild;)d.removeChild(N);if(typeof w=="function"){var te=w;w=function(){var ve=gm(ae);te.call(ve)}}var ae=LE(d,0,!1,null,null,!1,!1,"",VE);return d._reactRootContainer=ae,d[Ds]=ae.current,pl(d.nodeType===8?d.parentNode:d),Sa(function(){Dh(f,ae,v,w)}),ae}function Dl(d,f,v,w,N){var M=v._reactRootContainer;if(M){var z=M;if(typeof N=="function"){var te=N;N=function(){var ae=gm(z);te.call(ae)}}Dh(f,z,d,N)}else z=x0(v,f,d,N,w);return gm(z)}oS=function(d){switch(d.tag){case 3:var f=d.stateNode;if(f.current.memoizedState.isDehydrated){var v=jd(f.pendingLanes);v!==0&&(hu(f,v|1),hr(f,Ei()),(hn&6)===0&&(Bu=Ei()+500,sc()))}break;case 13:Sa(function(){var w=ga(d,1);if(w!==null){var N=nr();js(w,d,1,N)}}),ME(d,1)}},zd=function(d){if(d.tag===13){var f=ga(d,134217728);if(f!==null){var v=nr();js(f,d,134217728,v)}ME(d,134217728)}},aS=function(d){if(d.tag===13){var f=Bs(d),v=ga(d,f);if(v!==null){var w=nr();js(v,d,f,w)}ME(d,f)}},w_=function(){return Cn},cS=function(d,f){var v=Cn;try{return Cn=d,f()}finally{Cn=v}},Jp=function(d,f,v){switch(f){case"input":if(l_(d,v),f=v.name,v.type==="radio"&&f!=null){for(v=d;v.parentNode;)v=v.parentNode;for(v=v.querySelectorAll("input[name="+JSON.stringify(""+f)+'][type="radio"]'),f=0;f<v.length;f++){var w=v[f];if(w!==d&&w.form===d.form){var N=wu(w);if(!N)throw Error(a(90));Zc(w),l_(w,N)}}}break;case"textarea":Yp(d,v);break;case"select":f=v.value,f!=null&&ji(d,!!v.multiple,f,!1)}},Jv=Oh,il=Sa;var gc={usingClientEntryPoint:!1,Events:[Ru,gl,wu,Xv,uu,Oh]},Ra={findFiberByHostInstance:ml,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},M0={bundleType:Ra.bundleType,version:Ra.version,rendererPackageName:Ra.rendererPackageName,rendererConfig:Ra.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Oe.ReactCurrentDispatcher,findHostInstanceByFiber:function(d){return d=y_(d),d===null?null:d.stateNode},findFiberByHostInstance:Ra.findFiberByHostInstance||kh,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ym=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ym.isDisabled&&ym.supportsFiber)try{ef=ym.inject(M0),ao=ym}catch{}}return to.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=gc,to.createPortal=function(d,f){var v=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!UE(f))throw Error(a(200));return L0(d,f,null,v)},to.createRoot=function(d,f){if(!UE(d))throw Error(a(299));var v=!1,w="",N=ho;return f!=null&&(f.unstable_strictMode===!0&&(v=!0),f.identifierPrefix!==void 0&&(w=f.identifierPrefix),f.onRecoverableError!==void 0&&(N=f.onRecoverableError)),f=LE(d,1,!1,null,null,v,!1,w,N),d[Ds]=f.current,pl(d.nodeType===8?d.parentNode:d),new _m(f)},to.findDOMNode=function(d){if(d==null)return null;if(d.nodeType===1)return d;var f=d._reactInternals;if(f===void 0)throw typeof d.render=="function"?Error(a(188)):(d=Object.keys(d).join(","),Error(a(268,d)));return d=y_(f),d=d===null?null:d.stateNode,d},to.flushSync=function(d){return Sa(d)},to.hydrate=function(d,f,v){if(!Wu(f))throw Error(a(200));return Dl(null,d,f,!0,v)},to.hydrateRoot=function(d,f,v){if(!UE(d))throw Error(a(405));var w=v!=null&&v.hydratedSources||null,N=!1,M="",z=ho;if(v!=null&&(v.unstable_strictMode===!0&&(N=!0),v.identifierPrefix!==void 0&&(M=v.identifierPrefix),v.onRecoverableError!==void 0&&(z=v.onRecoverableError)),f=mm(f,null,d,1,v??null,N,!1,M,z),d[Ds]=f.current,pl(d),w)for(d=0;d<w.length;d++)v=w[d],N=v._getVersion,N=N(v._source),f.mutableSourceEagerHydrationData==null?f.mutableSourceEagerHydrationData=[v,N]:f.mutableSourceEagerHydrationData.push(v,N);return new Em(f)},to.render=function(d,f,v){if(!Wu(f))throw Error(a(200));return Dl(null,d,f,!1,v)},to.unmountComponentAtNode=function(d){if(!Wu(d))throw Error(a(40));return d._reactRootContainer?(Sa(function(){Dl(null,null,d,!1,function(){d._reactRootContainer=null,d[Ds]=null})}),!0):!1},to.unstable_batchedUpdates=Oh,to.unstable_renderSubtreeIntoContainer=function(d,f,v,w){if(!Wu(v))throw Error(a(200));if(d==null||d._reactInternals===void 0)throw Error(a(38));return Dl(d,f,v,!1,w)},to.version="18.3.1-next-f1338f8080-20240426",to}var b4;function jG(){if(b4)return NN.exports;b4=1;function s(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s)}catch(i){console.error(i)}}return s(),NN.exports=fte(),NN.exports}var A4;function mte(){if(A4)return sC;A4=1;var s=jG();return sC.createRoot=s.createRoot,sC.hydrateRoot=s.hydrateRoot,sC}var gte=mte();jG();/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _v(){return _v=Object.assign?Object.assign.bind():function(s){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(s[c]=a[c])}return s},_v.apply(this,arguments)}var vd;(function(s){s.Pop="POP",s.Push="PUSH",s.Replace="REPLACE"})(vd||(vd={}));const I4="popstate";function _te(s){s===void 0&&(s={});function i(c,p){let{pathname:_,search:y,hash:T}=c.location;return CP("",{pathname:_,search:y,hash:T},p.state&&p.state.usr||null,p.state&&p.state.key||"default")}function a(c,p){return typeof p=="string"?p:FC(p)}return yte(i,a,null,s)}function qi(s,i){if(s===!1||s===null||typeof s>"u")throw new Error(i)}function GG(s,i){if(!s){typeof console<"u"&&console.warn(i);try{throw new Error(i)}catch{}}}function Ete(){return Math.random().toString(36).substr(2,8)}function O4(s,i){return{usr:s.state,key:s.key,idx:i}}function CP(s,i,a,c){return a===void 0&&(a=null),_v({pathname:typeof s=="string"?s:s.pathname,search:"",hash:""},typeof i=="string"?Zg(i):i,{state:a,key:i&&i.key||c||Ete()})}function FC(s){let{pathname:i="/",search:a="",hash:c=""}=s;return a&&a!=="?"&&(i+=a.charAt(0)==="?"?a:"?"+a),c&&c!=="#"&&(i+=c.charAt(0)==="#"?c:"#"+c),i}function Zg(s){let i={};if(s){let a=s.indexOf("#");a>=0&&(i.hash=s.substr(a),s=s.substr(0,a));let c=s.indexOf("?");c>=0&&(i.search=s.substr(c),s=s.substr(0,c)),s&&(i.pathname=s)}return i}function yte(s,i,a,c){c===void 0&&(c={});let{window:p=document.defaultView,v5Compat:_=!1}=c,y=p.history,T=vd.Pop,C=null,I=D();I==null&&(I=0,y.replaceState(_v({},y.state,{idx:I}),""));function D(){return(y.state||{idx:null}).idx}function L(){T=vd.Pop;let Q=D(),se=Q==null?null:Q-I;I=Q,C&&C({action:T,location:ee.location,delta:se})}function j(Q,se){T=vd.Push;let fe=CP(ee.location,Q,se);I=D()+1;let me=O4(fe,I),Oe=ee.createHref(fe);try{y.pushState(me,"",Oe)}catch(Ve){if(Ve instanceof DOMException&&Ve.name==="DataCloneError")throw Ve;p.location.assign(Oe)}_&&C&&C({action:T,location:ee.location,delta:1})}function Y(Q,se){T=vd.Replace;let fe=CP(ee.location,Q,se);I=D();let me=O4(fe,I),Oe=ee.createHref(fe);y.replaceState(me,"",Oe),_&&C&&C({action:T,location:ee.location,delta:0})}function X(Q){let se=p.location.origin!=="null"?p.location.origin:p.location.href,fe=typeof Q=="string"?Q:FC(Q);return fe=fe.replace(/ $/,"%20"),qi(se,"No window.location.(origin|href) available to create URL for href: "+fe),new URL(fe,se)}let ee={get action(){return T},get location(){return s(p,y)},listen(Q){if(C)throw new Error("A history only accepts one active listener");return p.addEventListener(I4,L),C=Q,()=>{p.removeEventListener(I4,L),C=null}},createHref(Q){return i(p,Q)},createURL:X,encodeLocation(Q){let se=X(Q);return{pathname:se.pathname,search:se.search,hash:se.hash}},push:j,replace:Y,go(Q){return y.go(Q)}};return ee}var N4;(function(s){s.data="data",s.deferred="deferred",s.redirect="redirect",s.error="error"})(N4||(N4={}));function vte(s,i,a){return a===void 0&&(a="/"),Ste(s,i,a)}function Ste(s,i,a,c){let p=typeof i=="string"?Zg(i):i,_=RD(p.pathname||"/",a);if(_==null)return null;let y=WG(s);Tte(y);let T=null;for(let C=0;T==null&&C<y.length;++C){let I=Lte(_);T=Pte(y[C],I)}return T}function WG(s,i,a,c){i===void 0&&(i=[]),a===void 0&&(a=[]),c===void 0&&(c="");let p=(_,y,T)=>{let C={relativePath:T===void 0?_.path||"":T,caseSensitive:_.caseSensitive===!0,childrenIndex:y,route:_};C.relativePath.startsWith("/")&&(qi(C.relativePath.startsWith(c),'Absolute route path "'+C.relativePath+'" nested under path '+('"'+c+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),C.relativePath=C.relativePath.slice(c.length));let I=Td([c,C.relativePath]),D=a.concat(C);_.children&&_.children.length>0&&(qi(_.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+I+'".')),WG(_.children,i,D,I)),!(_.path==null&&!_.index)&&i.push({path:I,score:Ote(I,_.index),routesMeta:D})};return s.forEach((_,y)=>{var T;if(_.path===""||!((T=_.path)!=null&&T.includes("?")))p(_,y);else for(let C of zG(_.path))p(_,y,C)}),i}function zG(s){let i=s.split("/");if(i.length===0)return[];let[a,...c]=i,p=a.endsWith("?"),_=a.replace(/\?$/,"");if(c.length===0)return p?[_,""]:[_];let y=zG(c.join("/")),T=[];return T.push(...y.map(C=>C===""?_:[_,C].join("/"))),p&&T.push(...y),T.map(C=>s.startsWith("/")&&C===""?"/":C)}function Tte(s){s.sort((i,a)=>i.score!==a.score?a.score-i.score:Nte(i.routesMeta.map(c=>c.childrenIndex),a.routesMeta.map(c=>c.childrenIndex)))}const Rte=/^:[\w-]+$/,wte=3,Cte=2,bte=1,Ate=10,Ite=-2,P4=s=>s==="*";function Ote(s,i){let a=s.split("/"),c=a.length;return a.some(P4)&&(c+=Ite),i&&(c+=Cte),a.filter(p=>!P4(p)).reduce((p,_)=>p+(Rte.test(_)?wte:_===""?bte:Ate),c)}function Nte(s,i){return s.length===i.length&&s.slice(0,-1).every((c,p)=>c===i[p])?s[s.length-1]-i[i.length-1]:0}function Pte(s,i,a){let{routesMeta:c}=s,p={},_="/",y=[];for(let T=0;T<c.length;++T){let C=c[T],I=T===c.length-1,D=_==="/"?i:i.slice(_.length)||"/",L=Dte({path:C.relativePath,caseSensitive:C.caseSensitive,end:I},D),j=C.route;if(!L)return null;Object.assign(p,L.params),y.push({params:p,pathname:Td([_,L.pathname]),pathnameBase:Vte(Td([_,L.pathnameBase])),route:j}),L.pathnameBase!=="/"&&(_=Td([_,L.pathnameBase]))}return y}function Dte(s,i){typeof s=="string"&&(s={path:s,caseSensitive:!1,end:!0});let[a,c]=kte(s.path,s.caseSensitive,s.end),p=i.match(a);if(!p)return null;let _=p[0],y=_.replace(/(.)\/+$/,"$1"),T=p.slice(1);return{params:c.reduce((I,D,L)=>{let{paramName:j,isOptional:Y}=D;if(j==="*"){let ee=T[L]||"";y=_.slice(0,_.length-ee.length).replace(/(.)\/+$/,"$1")}const X=T[L];return Y&&!X?I[j]=void 0:I[j]=(X||"").replace(/%2F/g,"/"),I},{}),pathname:_,pathnameBase:y,pattern:s}}function kte(s,i,a){i===void 0&&(i=!1),a===void 0&&(a=!0),GG(s==="*"||!s.endsWith("*")||s.endsWith("/*"),'Route path "'+s+'" will be treated as if it were '+('"'+s.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+s.replace(/\*$/,"/*")+'".'));let c=[],p="^"+s.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(y,T,C)=>(c.push({paramName:T,isOptional:C!=null}),C?"/?([^\\/]+)?":"/([^\\/]+)"));return s.endsWith("*")?(c.push({paramName:"*"}),p+=s==="*"||s==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?p+="\\/*$":s!==""&&s!=="/"&&(p+="(?:(?=\\/|$))"),[new RegExp(p,i?void 0:"i"),c]}function Lte(s){try{return s.split("/").map(i=>decodeURIComponent(i).replace(/\//g,"%2F")).join("/")}catch(i){return GG(!1,'The URL path "'+s+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+i+").")),s}}function RD(s,i){if(i==="/")return s;if(!s.toLowerCase().startsWith(i.toLowerCase()))return null;let a=i.endsWith("/")?i.length-1:i.length,c=s.charAt(a);return c&&c!=="/"?null:s.slice(a)||"/"}function xte(s,i){i===void 0&&(i="/");let{pathname:a,search:c="",hash:p=""}=typeof s=="string"?Zg(s):s;return{pathname:a?a.startsWith("/")?a:Mte(a,i):i,search:Fte(c),hash:Bte(p)}}function Mte(s,i){let a=i.replace(/\/+$/,"").split("/");return s.split("/").forEach(p=>{p===".."?a.length>1&&a.pop():p!=="."&&a.push(p)}),a.length>1?a.join("/"):"/"}function kN(s,i,a,c){return"Cannot include a '"+s+"' character in a manually specified "+("`to."+i+"` field ["+JSON.stringify(c)+"].  Please separate it out to the ")+("`to."+a+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Ute(s){return s.filter((i,a)=>a===0||i.route.path&&i.route.path.length>0)}function wD(s,i){let a=Ute(s);return i?a.map((c,p)=>p===a.length-1?c.pathname:c.pathnameBase):a.map(c=>c.pathnameBase)}function CD(s,i,a,c){c===void 0&&(c=!1);let p;typeof s=="string"?p=Zg(s):(p=_v({},s),qi(!p.pathname||!p.pathname.includes("?"),kN("?","pathname","search",p)),qi(!p.pathname||!p.pathname.includes("#"),kN("#","pathname","hash",p)),qi(!p.search||!p.search.includes("#"),kN("#","search","hash",p)));let _=s===""||p.pathname==="",y=_?"/":p.pathname,T;if(y==null)T=a;else{let L=i.length-1;if(!c&&y.startsWith("..")){let j=y.split("/");for(;j[0]==="..";)j.shift(),L-=1;p.pathname=j.join("/")}T=L>=0?i[L]:"/"}let C=xte(p,T),I=y&&y!=="/"&&y.endsWith("/"),D=(_||y===".")&&a.endsWith("/");return!C.pathname.endsWith("/")&&(I||D)&&(C.pathname+="/"),C}const Td=s=>s.join("/").replace(/\/\/+/g,"/"),Vte=s=>s.replace(/\/+$/,"").replace(/^\/*/,"/"),Fte=s=>!s||s==="?"?"":s.startsWith("?")?s:"?"+s,Bte=s=>!s||s==="#"?"":s.startsWith("#")?s:"#"+s;function jte(s){return s!=null&&typeof s.status=="number"&&typeof s.statusText=="string"&&typeof s.internal=="boolean"&&"data"in s}const HG=["post","put","patch","delete"];new Set(HG);const Gte=["get",...HG];new Set(Gte);/**
 * React Router v6.30.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ev(){return Ev=Object.assign?Object.assign.bind():function(s){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(s[c]=a[c])}return s},Ev.apply(this,arguments)}const bD=_e.createContext(null),Wte=_e.createContext(null),Pd=_e.createContext(null),lb=_e.createContext(null),Dd=_e.createContext({outlet:null,matches:[],isDataRoute:!1}),KG=_e.createContext(null);function zte(s,i){let{relative:a}=i===void 0?{}:i;e_()||qi(!1);let{basename:c,navigator:p}=_e.useContext(Pd),{hash:_,pathname:y,search:T}=XG(s,{relative:a}),C=y;return c!=="/"&&(C=y==="/"?c:Td([c,y])),p.createHref({pathname:C,search:T,hash:_})}function e_(){return _e.useContext(lb)!=null}function t_(){return e_()||qi(!1),_e.useContext(lb).location}function qG(s){_e.useContext(Pd).static||_e.useLayoutEffect(s)}function YG(){let{isDataRoute:s}=_e.useContext(Dd);return s?ine():Hte()}function Hte(){e_()||qi(!1);let s=_e.useContext(bD),{basename:i,future:a,navigator:c}=_e.useContext(Pd),{matches:p}=_e.useContext(Dd),{pathname:_}=t_(),y=JSON.stringify(wD(p,a.v7_relativeSplatPath)),T=_e.useRef(!1);return qG(()=>{T.current=!0}),_e.useCallback(function(I,D){if(D===void 0&&(D={}),!T.current)return;if(typeof I=="number"){c.go(I);return}let L=CD(I,JSON.parse(y),_,D.relative==="path");s==null&&i!=="/"&&(L.pathname=L.pathname==="/"?i:Td([i,L.pathname])),(D.replace?c.replace:c.push)(L,D.state,D)},[i,c,y,_,s])}function XG(s,i){let{relative:a}=i===void 0?{}:i,{future:c}=_e.useContext(Pd),{matches:p}=_e.useContext(Dd),{pathname:_}=t_(),y=JSON.stringify(wD(p,c.v7_relativeSplatPath));return _e.useMemo(()=>CD(s,JSON.parse(y),_,a==="path"),[s,y,_,a])}function Kte(s,i){return qte(s,i)}function qte(s,i,a,c){e_()||qi(!1);let{navigator:p,static:_}=_e.useContext(Pd),{matches:y}=_e.useContext(Dd),T=y[y.length-1],C=T?T.params:{};T&&T.pathname;let I=T?T.pathnameBase:"/";T&&T.route;let D=t_(),L;if(i){var j;let se=typeof i=="string"?Zg(i):i;I==="/"||(j=se.pathname)!=null&&j.startsWith(I)||qi(!1),L=se}else L=D;let Y=L.pathname||"/",X=Y;if(I!=="/"){let se=I.replace(/^\//,"").split("/");X="/"+Y.replace(/^\//,"").split("/").slice(se.length).join("/")}let ee=vte(s,{pathname:X}),Q=Qte(ee&&ee.map(se=>Object.assign({},se,{params:Object.assign({},C,se.params),pathname:Td([I,p.encodeLocation?p.encodeLocation(se.pathname).pathname:se.pathname]),pathnameBase:se.pathnameBase==="/"?I:Td([I,p.encodeLocation?p.encodeLocation(se.pathnameBase).pathname:se.pathnameBase])})),y,a,c);return i&&Q?_e.createElement(lb.Provider,{value:{location:Ev({pathname:"/",search:"",hash:"",state:null,key:"default"},L),navigationType:vd.Pop}},Q):Q}function Yte(){let s=nne(),i=jte(s)?s.status+" "+s.statusText:s instanceof Error?s.message:JSON.stringify(s),a=s instanceof Error?s.stack:null,p={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return _e.createElement(_e.Fragment,null,_e.createElement("h2",null,"Unexpected Application Error!"),_e.createElement("h3",{style:{fontStyle:"italic"}},i),a?_e.createElement("pre",{style:p},a):null,null)}const Xte=_e.createElement(Yte,null);class Jte extends _e.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,a){return a.location!==i.location||a.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:a.error,location:a.location,revalidation:i.revalidation||a.revalidation}}componentDidCatch(i,a){console.error("React Router caught the following error during render",i,a)}render(){return this.state.error!==void 0?_e.createElement(Dd.Provider,{value:this.props.routeContext},_e.createElement(KG.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function $te(s){let{routeContext:i,match:a,children:c}=s,p=_e.useContext(bD);return p&&p.static&&p.staticContext&&(a.route.errorElement||a.route.ErrorBoundary)&&(p.staticContext._deepestRenderedBoundaryId=a.route.id),_e.createElement(Dd.Provider,{value:i},c)}function Qte(s,i,a,c){var p;if(i===void 0&&(i=[]),a===void 0&&(a=null),c===void 0&&(c=null),s==null){var _;if(!a)return null;if(a.errors)s=a.matches;else if((_=c)!=null&&_.v7_partialHydration&&i.length===0&&!a.initialized&&a.matches.length>0)s=a.matches;else return null}let y=s,T=(p=a)==null?void 0:p.errors;if(T!=null){let D=y.findIndex(L=>L.route.id&&(T==null?void 0:T[L.route.id])!==void 0);D>=0||qi(!1),y=y.slice(0,Math.min(y.length,D+1))}let C=!1,I=-1;if(a&&c&&c.v7_partialHydration)for(let D=0;D<y.length;D++){let L=y[D];if((L.route.HydrateFallback||L.route.hydrateFallbackElement)&&(I=D),L.route.id){let{loaderData:j,errors:Y}=a,X=L.route.loader&&j[L.route.id]===void 0&&(!Y||Y[L.route.id]===void 0);if(L.route.lazy||X){C=!0,I>=0?y=y.slice(0,I+1):y=[y[0]];break}}}return y.reduceRight((D,L,j)=>{let Y,X=!1,ee=null,Q=null;a&&(Y=T&&L.route.id?T[L.route.id]:void 0,ee=L.route.errorElement||Xte,C&&(I<0&&j===0?(rne("route-fallback"),X=!0,Q=null):I===j&&(X=!0,Q=L.route.hydrateFallbackElement||null)));let se=i.concat(y.slice(0,j+1)),fe=()=>{let me;return Y?me=ee:X?me=Q:L.route.Component?me=_e.createElement(L.route.Component,null):L.route.element?me=L.route.element:me=D,_e.createElement($te,{match:L,routeContext:{outlet:D,matches:se,isDataRoute:a!=null},children:me})};return a&&(L.route.ErrorBoundary||L.route.errorElement||j===0)?_e.createElement(Jte,{location:a.location,revalidation:a.revalidation,component:ee,error:Y,children:fe(),routeContext:{outlet:null,matches:se,isDataRoute:!0}}):fe()},null)}var JG=function(s){return s.UseBlocker="useBlocker",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s}(JG||{}),$G=function(s){return s.UseBlocker="useBlocker",s.UseLoaderData="useLoaderData",s.UseActionData="useActionData",s.UseRouteError="useRouteError",s.UseNavigation="useNavigation",s.UseRouteLoaderData="useRouteLoaderData",s.UseMatches="useMatches",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s.UseRouteId="useRouteId",s}($G||{});function Zte(s){let i=_e.useContext(bD);return i||qi(!1),i}function ene(s){let i=_e.useContext(Wte);return i||qi(!1),i}function tne(s){let i=_e.useContext(Dd);return i||qi(!1),i}function QG(s){let i=tne(),a=i.matches[i.matches.length-1];return a.route.id||qi(!1),a.route.id}function nne(){var s;let i=_e.useContext(KG),a=ene(),c=QG();return i!==void 0?i:(s=a.errors)==null?void 0:s[c]}function ine(){let{router:s}=Zte(JG.UseNavigateStable),i=QG($G.UseNavigateStable),a=_e.useRef(!1);return qG(()=>{a.current=!0}),_e.useCallback(function(p,_){_===void 0&&(_={}),a.current&&(typeof p=="number"?s.navigate(p):s.navigate(p,Ev({fromRouteId:i},_)))},[s,i])}const D4={};function rne(s,i,a){D4[s]||(D4[s]=!0)}function sne(s,i){s==null||s.v7_startTransition,s==null||s.v7_relativeSplatPath}function oC(s){let{to:i,replace:a,state:c,relative:p}=s;e_()||qi(!1);let{future:_,static:y}=_e.useContext(Pd),{matches:T}=_e.useContext(Dd),{pathname:C}=t_(),I=YG(),D=CD(i,wD(T,_.v7_relativeSplatPath),C,p==="path"),L=JSON.stringify(D);return _e.useEffect(()=>I(JSON.parse(L),{replace:a,state:c,relative:p}),[I,L,p,a,c]),null}function Zl(s){qi(!1)}function one(s){let{basename:i="/",children:a=null,location:c,navigationType:p=vd.Pop,navigator:_,static:y=!1,future:T}=s;e_()&&qi(!1);let C=i.replace(/^\/*/,"/"),I=_e.useMemo(()=>({basename:C,navigator:_,static:y,future:Ev({v7_relativeSplatPath:!1},T)}),[C,T,_,y]);typeof c=="string"&&(c=Zg(c));let{pathname:D="/",search:L="",hash:j="",state:Y=null,key:X="default"}=c,ee=_e.useMemo(()=>{let Q=RD(D,C);return Q==null?null:{location:{pathname:Q,search:L,hash:j,state:Y,key:X},navigationType:p}},[C,D,L,j,Y,X,p]);return ee==null?null:_e.createElement(Pd.Provider,{value:I},_e.createElement(lb.Provider,{children:a,value:ee}))}function ane(s){let{children:i,location:a}=s;return Kte(bP(i),a)}new Promise(()=>{});function bP(s,i){i===void 0&&(i=[]);let a=[];return _e.Children.forEach(s,(c,p)=>{if(!_e.isValidElement(c))return;let _=[...i,p];if(c.type===_e.Fragment){a.push.apply(a,bP(c.props.children,_));return}c.type!==Zl&&qi(!1),!c.props.index||!c.props.children||qi(!1);let y={id:c.props.id||_.join("-"),caseSensitive:c.props.caseSensitive,element:c.props.element,Component:c.props.Component,index:c.props.index,path:c.props.path,loader:c.props.loader,action:c.props.action,errorElement:c.props.errorElement,ErrorBoundary:c.props.ErrorBoundary,hasErrorBoundary:c.props.ErrorBoundary!=null||c.props.errorElement!=null,shouldRevalidate:c.props.shouldRevalidate,handle:c.props.handle,lazy:c.props.lazy};c.props.children&&(y.children=bP(c.props.children,_)),a.push(y)}),a}/**
 * React Router DOM v6.30.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function AP(){return AP=Object.assign?Object.assign.bind():function(s){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(s[c]=a[c])}return s},AP.apply(this,arguments)}function cne(s,i){if(s==null)return{};var a={},c=Object.keys(s),p,_;for(_=0;_<c.length;_++)p=c[_],!(i.indexOf(p)>=0)&&(a[p]=s[p]);return a}function lne(s){return!!(s.metaKey||s.altKey||s.ctrlKey||s.shiftKey)}function une(s,i){return s.button===0&&(!i||i==="_self")&&!lne(s)}const dne=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],hne="6";try{window.__reactRouterVersion=hne}catch{}const pne="startTransition",k4=dte[pne];function fne(s){let{basename:i,children:a,future:c,window:p}=s,_=_e.useRef();_.current==null&&(_.current=_te({window:p,v5Compat:!0}));let y=_.current,[T,C]=_e.useState({action:y.action,location:y.location}),{v7_startTransition:I}=c||{},D=_e.useCallback(L=>{I&&k4?k4(()=>C(L)):C(L)},[C,I]);return _e.useLayoutEffect(()=>y.listen(D),[y,D]),_e.useEffect(()=>sne(c),[c]),_e.createElement(one,{basename:i,children:a,location:T.location,navigationType:T.action,navigator:y,future:c})}const mne=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",gne=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Vr=_e.forwardRef(function(i,a){let{onClick:c,relative:p,reloadDocument:_,replace:y,state:T,target:C,to:I,preventScrollReset:D,viewTransition:L}=i,j=cne(i,dne),{basename:Y}=_e.useContext(Pd),X,ee=!1;if(typeof I=="string"&&gne.test(I)&&(X=I,mne))try{let me=new URL(window.location.href),Oe=I.startsWith("//")?new URL(me.protocol+I):new URL(I),Ve=RD(Oe.pathname,Y);Oe.origin===me.origin&&Ve!=null?I=Ve+Oe.search+Oe.hash:ee=!0}catch{}let Q=zte(I,{relative:p}),se=_ne(I,{replace:y,state:T,target:C,preventScrollReset:D,relative:p,viewTransition:L});function fe(me){c&&c(me),me.defaultPrevented||se(me)}return _e.createElement("a",AP({},j,{href:X||Q,onClick:ee||_?c:fe,ref:a,target:C}))});var L4;(function(s){s.UseScrollRestoration="useScrollRestoration",s.UseSubmit="useSubmit",s.UseSubmitFetcher="useSubmitFetcher",s.UseFetcher="useFetcher",s.useViewTransitionState="useViewTransitionState"})(L4||(L4={}));var x4;(function(s){s.UseFetcher="useFetcher",s.UseFetchers="useFetchers",s.UseScrollRestoration="useScrollRestoration"})(x4||(x4={}));function _ne(s,i){let{target:a,replace:c,state:p,preventScrollReset:_,relative:y,viewTransition:T}=i===void 0?{}:i,C=YG(),I=t_(),D=XG(s,{relative:y});return _e.useCallback(L=>{if(une(L,a)){L.preventDefault();let j=c!==void 0?c:FC(I)===FC(D);C(s,{replace:j,state:p,preventScrollReset:_,relative:y,viewTransition:T})}},[I,C,D,c,p,a,s,_,y,T])}const M4=s=>{let i;const a=new Set,c=(I,D)=>{const L=typeof I=="function"?I(i):I;if(!Object.is(L,i)){const j=i;i=D??(typeof L!="object"||L===null)?L:Object.assign({},i,L),a.forEach(Y=>Y(i,j))}},p=()=>i,T={setState:c,getState:p,getInitialState:()=>C,subscribe:I=>(a.add(I),()=>a.delete(I))},C=i=s(c,p,T);return T},Ene=s=>s?M4(s):M4,yne=s=>s;function vne(s,i=yne){const a=sa.useSyncExternalStore(s.subscribe,()=>i(s.getState()),()=>i(s.getInitialState()));return sa.useDebugValue(a),a}const U4=s=>{const i=Ene(s),a=c=>vne(i,c);return Object.assign(a,i),a},AD=s=>s?U4(s):U4;function ZG(s,i){return function(){return s.apply(i,arguments)}}const{toString:Sne}=Object.prototype,{getPrototypeOf:ID}=Object,ub=(s=>i=>{const a=Sne.call(i);return s[a]||(s[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),Ka=s=>(s=s.toLowerCase(),i=>ub(i)===s),db=s=>i=>typeof i===s,{isArray:n_}=Array,yv=db("undefined");function Tne(s){return s!==null&&!yv(s)&&s.constructor!==null&&!yv(s.constructor)&&wo(s.constructor.isBuffer)&&s.constructor.isBuffer(s)}const eW=Ka("ArrayBuffer");function Rne(s){let i;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?i=ArrayBuffer.isView(s):i=s&&s.buffer&&eW(s.buffer),i}const wne=db("string"),wo=db("function"),tW=db("number"),hb=s=>s!==null&&typeof s=="object",Cne=s=>s===!0||s===!1,TC=s=>{if(ub(s)!=="object")return!1;const i=ID(s);return(i===null||i===Object.prototype||Object.getPrototypeOf(i)===null)&&!(Symbol.toStringTag in s)&&!(Symbol.iterator in s)},bne=Ka("Date"),Ane=Ka("File"),Ine=Ka("Blob"),One=Ka("FileList"),Nne=s=>hb(s)&&wo(s.pipe),Pne=s=>{let i;return s&&(typeof FormData=="function"&&s instanceof FormData||wo(s.append)&&((i=ub(s))==="formdata"||i==="object"&&wo(s.toString)&&s.toString()==="[object FormData]"))},Dne=Ka("URLSearchParams"),[kne,Lne,xne,Mne]=["ReadableStream","Request","Response","Headers"].map(Ka),Une=s=>s.trim?s.trim():s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Dv(s,i,{allOwnKeys:a=!1}={}){if(s===null||typeof s>"u")return;let c,p;if(typeof s!="object"&&(s=[s]),n_(s))for(c=0,p=s.length;c<p;c++)i.call(null,s[c],c,s);else{const _=a?Object.getOwnPropertyNames(s):Object.keys(s),y=_.length;let T;for(c=0;c<y;c++)T=_[c],i.call(null,s[T],T,s)}}function nW(s,i){i=i.toLowerCase();const a=Object.keys(s);let c=a.length,p;for(;c-- >0;)if(p=a[c],i===p.toLowerCase())return p;return null}const Op=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,iW=s=>!yv(s)&&s!==Op;function IP(){const{caseless:s}=iW(this)&&this||{},i={},a=(c,p)=>{const _=s&&nW(i,p)||p;TC(i[_])&&TC(c)?i[_]=IP(i[_],c):TC(c)?i[_]=IP({},c):n_(c)?i[_]=c.slice():i[_]=c};for(let c=0,p=arguments.length;c<p;c++)arguments[c]&&Dv(arguments[c],a);return i}const Vne=(s,i,a,{allOwnKeys:c}={})=>(Dv(i,(p,_)=>{a&&wo(p)?s[_]=ZG(p,a):s[_]=p},{allOwnKeys:c}),s),Fne=s=>(s.charCodeAt(0)===65279&&(s=s.slice(1)),s),Bne=(s,i,a,c)=>{s.prototype=Object.create(i.prototype,c),s.prototype.constructor=s,Object.defineProperty(s,"super",{value:i.prototype}),a&&Object.assign(s.prototype,a)},jne=(s,i,a,c)=>{let p,_,y;const T={};if(i=i||{},s==null)return i;do{for(p=Object.getOwnPropertyNames(s),_=p.length;_-- >0;)y=p[_],(!c||c(y,s,i))&&!T[y]&&(i[y]=s[y],T[y]=!0);s=a!==!1&&ID(s)}while(s&&(!a||a(s,i))&&s!==Object.prototype);return i},Gne=(s,i,a)=>{s=String(s),(a===void 0||a>s.length)&&(a=s.length),a-=i.length;const c=s.indexOf(i,a);return c!==-1&&c===a},Wne=s=>{if(!s)return null;if(n_(s))return s;let i=s.length;if(!tW(i))return null;const a=new Array(i);for(;i-- >0;)a[i]=s[i];return a},zne=(s=>i=>s&&i instanceof s)(typeof Uint8Array<"u"&&ID(Uint8Array)),Hne=(s,i)=>{const c=(s&&s[Symbol.iterator]).call(s);let p;for(;(p=c.next())&&!p.done;){const _=p.value;i.call(s,_[0],_[1])}},Kne=(s,i)=>{let a;const c=[];for(;(a=s.exec(i))!==null;)c.push(a);return c},qne=Ka("HTMLFormElement"),Yne=s=>s.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(a,c,p){return c.toUpperCase()+p}),V4=(({hasOwnProperty:s})=>(i,a)=>s.call(i,a))(Object.prototype),Xne=Ka("RegExp"),rW=(s,i)=>{const a=Object.getOwnPropertyDescriptors(s),c={};Dv(a,(p,_)=>{let y;(y=i(p,_,s))!==!1&&(c[_]=y||p)}),Object.defineProperties(s,c)},Jne=s=>{rW(s,(i,a)=>{if(wo(s)&&["arguments","caller","callee"].indexOf(a)!==-1)return!1;const c=s[a];if(wo(c)){if(i.enumerable=!1,"writable"in i){i.writable=!1;return}i.set||(i.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")})}})},$ne=(s,i)=>{const a={},c=p=>{p.forEach(_=>{a[_]=!0})};return n_(s)?c(s):c(String(s).split(i)),a},Qne=()=>{},Zne=(s,i)=>s!=null&&Number.isFinite(s=+s)?s:i;function eie(s){return!!(s&&wo(s.append)&&s[Symbol.toStringTag]==="FormData"&&s[Symbol.iterator])}const tie=s=>{const i=new Array(10),a=(c,p)=>{if(hb(c)){if(i.indexOf(c)>=0)return;if(!("toJSON"in c)){i[p]=c;const _=n_(c)?[]:{};return Dv(c,(y,T)=>{const C=a(y,p+1);!yv(C)&&(_[T]=C)}),i[p]=void 0,_}}return c};return a(s,0)},nie=Ka("AsyncFunction"),iie=s=>s&&(hb(s)||wo(s))&&wo(s.then)&&wo(s.catch),sW=((s,i)=>s?setImmediate:i?((a,c)=>(Op.addEventListener("message",({source:p,data:_})=>{p===Op&&_===a&&c.length&&c.shift()()},!1),p=>{c.push(p),Op.postMessage(a,"*")}))(`axios@${Math.random()}`,[]):a=>setTimeout(a))(typeof setImmediate=="function",wo(Op.postMessage)),rie=typeof queueMicrotask<"u"?queueMicrotask.bind(Op):typeof process<"u"&&process.nextTick||sW,be={isArray:n_,isArrayBuffer:eW,isBuffer:Tne,isFormData:Pne,isArrayBufferView:Rne,isString:wne,isNumber:tW,isBoolean:Cne,isObject:hb,isPlainObject:TC,isReadableStream:kne,isRequest:Lne,isResponse:xne,isHeaders:Mne,isUndefined:yv,isDate:bne,isFile:Ane,isBlob:Ine,isRegExp:Xne,isFunction:wo,isStream:Nne,isURLSearchParams:Dne,isTypedArray:zne,isFileList:One,forEach:Dv,merge:IP,extend:Vne,trim:Une,stripBOM:Fne,inherits:Bne,toFlatObject:jne,kindOf:ub,kindOfTest:Ka,endsWith:Gne,toArray:Wne,forEachEntry:Hne,matchAll:Kne,isHTMLForm:qne,hasOwnProperty:V4,hasOwnProp:V4,reduceDescriptors:rW,freezeMethods:Jne,toObjectSet:$ne,toCamelCase:Yne,noop:Qne,toFiniteNumber:Zne,findKey:nW,global:Op,isContextDefined:iW,isSpecCompliantForm:eie,toJSONObject:tie,isAsyncFn:nie,isThenable:iie,setImmediate:sW,asap:rie};function Wt(s,i,a,c,p){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=s,this.name="AxiosError",i&&(this.code=i),a&&(this.config=a),c&&(this.request=c),p&&(this.response=p,this.status=p.status?p.status:null)}be.inherits(Wt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:be.toJSONObject(this.config),code:this.code,status:this.status}}});const oW=Wt.prototype,aW={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(s=>{aW[s]={value:s}});Object.defineProperties(Wt,aW);Object.defineProperty(oW,"isAxiosError",{value:!0});Wt.from=(s,i,a,c,p,_)=>{const y=Object.create(oW);return be.toFlatObject(s,y,function(C){return C!==Error.prototype},T=>T!=="isAxiosError"),Wt.call(y,s.message,i,a,c,p),y.cause=s,y.name=s.name,_&&Object.assign(y,_),y};const sie=null;function OP(s){return be.isPlainObject(s)||be.isArray(s)}function cW(s){return be.endsWith(s,"[]")?s.slice(0,-2):s}function F4(s,i,a){return s?s.concat(i).map(function(p,_){return p=cW(p),!a&&_?"["+p+"]":p}).join(a?".":""):i}function oie(s){return be.isArray(s)&&!s.some(OP)}const aie=be.toFlatObject(be,{},null,function(i){return/^is[A-Z]/.test(i)});function pb(s,i,a){if(!be.isObject(s))throw new TypeError("target must be an object");i=i||new FormData,a=be.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function(ee,Q){return!be.isUndefined(Q[ee])});const c=a.metaTokens,p=a.visitor||D,_=a.dots,y=a.indexes,C=(a.Blob||typeof Blob<"u"&&Blob)&&be.isSpecCompliantForm(i);if(!be.isFunction(p))throw new TypeError("visitor must be a function");function I(X){if(X===null)return"";if(be.isDate(X))return X.toISOString();if(!C&&be.isBlob(X))throw new Wt("Blob is not supported. Use a Buffer instead.");return be.isArrayBuffer(X)||be.isTypedArray(X)?C&&typeof Blob=="function"?new Blob([X]):Buffer.from(X):X}function D(X,ee,Q){let se=X;if(X&&!Q&&typeof X=="object"){if(be.endsWith(ee,"{}"))ee=c?ee:ee.slice(0,-2),X=JSON.stringify(X);else if(be.isArray(X)&&oie(X)||(be.isFileList(X)||be.endsWith(ee,"[]"))&&(se=be.toArray(X)))return ee=cW(ee),se.forEach(function(me,Oe){!(be.isUndefined(me)||me===null)&&i.append(y===!0?F4([ee],Oe,_):y===null?ee:ee+"[]",I(me))}),!1}return OP(X)?!0:(i.append(F4(Q,ee,_),I(X)),!1)}const L=[],j=Object.assign(aie,{defaultVisitor:D,convertValue:I,isVisitable:OP});function Y(X,ee){if(!be.isUndefined(X)){if(L.indexOf(X)!==-1)throw Error("Circular reference detected in "+ee.join("."));L.push(X),be.forEach(X,function(se,fe){(!(be.isUndefined(se)||se===null)&&p.call(i,se,be.isString(fe)?fe.trim():fe,ee,j))===!0&&Y(se,ee?ee.concat(fe):[fe])}),L.pop()}}if(!be.isObject(s))throw new TypeError("data must be an object");return Y(s),i}function B4(s){const i={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(s).replace(/[!'()~]|%20|%00/g,function(c){return i[c]})}function OD(s,i){this._pairs=[],s&&pb(s,this,i)}const lW=OD.prototype;lW.append=function(i,a){this._pairs.push([i,a])};lW.toString=function(i){const a=i?function(c){return i.call(this,c,B4)}:B4;return this._pairs.map(function(p){return a(p[0])+"="+a(p[1])},"").join("&")};function cie(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function uW(s,i,a){if(!i)return s;const c=a&&a.encode||cie;be.isFunction(a)&&(a={serialize:a});const p=a&&a.serialize;let _;if(p?_=p(i,a):_=be.isURLSearchParams(i)?i.toString():new OD(i,a).toString(c),_){const y=s.indexOf("#");y!==-1&&(s=s.slice(0,y)),s+=(s.indexOf("?")===-1?"?":"&")+_}return s}class j4{constructor(){this.handlers=[]}use(i,a,c){return this.handlers.push({fulfilled:i,rejected:a,synchronous:c?c.synchronous:!1,runWhen:c?c.runWhen:null}),this.handlers.length-1}eject(i){this.handlers[i]&&(this.handlers[i]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(i){be.forEach(this.handlers,function(c){c!==null&&i(c)})}}const dW={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},lie=typeof URLSearchParams<"u"?URLSearchParams:OD,uie=typeof FormData<"u"?FormData:null,die=typeof Blob<"u"?Blob:null,hie={isBrowser:!0,classes:{URLSearchParams:lie,FormData:uie,Blob:die},protocols:["http","https","file","blob","url","data"]},ND=typeof window<"u"&&typeof document<"u",NP=typeof navigator=="object"&&navigator||void 0,pie=ND&&(!NP||["ReactNative","NativeScript","NS"].indexOf(NP.product)<0),fie=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",mie=ND&&window.location.href||"http://localhost",gie=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:ND,hasStandardBrowserEnv:pie,hasStandardBrowserWebWorkerEnv:fie,navigator:NP,origin:mie},Symbol.toStringTag,{value:"Module"})),ss={...gie,...hie};function _ie(s,i){return pb(s,new ss.classes.URLSearchParams,Object.assign({visitor:function(a,c,p,_){return ss.isNode&&be.isBuffer(a)?(this.append(c,a.toString("base64")),!1):_.defaultVisitor.apply(this,arguments)}},i))}function Eie(s){return be.matchAll(/\w+|\[(\w*)]/g,s).map(i=>i[0]==="[]"?"":i[1]||i[0])}function yie(s){const i={},a=Object.keys(s);let c;const p=a.length;let _;for(c=0;c<p;c++)_=a[c],i[_]=s[_];return i}function hW(s){function i(a,c,p,_){let y=a[_++];if(y==="__proto__")return!0;const T=Number.isFinite(+y),C=_>=a.length;return y=!y&&be.isArray(p)?p.length:y,C?(be.hasOwnProp(p,y)?p[y]=[p[y],c]:p[y]=c,!T):((!p[y]||!be.isObject(p[y]))&&(p[y]=[]),i(a,c,p[y],_)&&be.isArray(p[y])&&(p[y]=yie(p[y])),!T)}if(be.isFormData(s)&&be.isFunction(s.entries)){const a={};return be.forEachEntry(s,(c,p)=>{i(Eie(c),p,a,0)}),a}return null}function vie(s,i,a){if(be.isString(s))try{return(i||JSON.parse)(s),be.trim(s)}catch(c){if(c.name!=="SyntaxError")throw c}return(a||JSON.stringify)(s)}const kv={transitional:dW,adapter:["xhr","http","fetch"],transformRequest:[function(i,a){const c=a.getContentType()||"",p=c.indexOf("application/json")>-1,_=be.isObject(i);if(_&&be.isHTMLForm(i)&&(i=new FormData(i)),be.isFormData(i))return p?JSON.stringify(hW(i)):i;if(be.isArrayBuffer(i)||be.isBuffer(i)||be.isStream(i)||be.isFile(i)||be.isBlob(i)||be.isReadableStream(i))return i;if(be.isArrayBufferView(i))return i.buffer;if(be.isURLSearchParams(i))return a.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),i.toString();let T;if(_){if(c.indexOf("application/x-www-form-urlencoded")>-1)return _ie(i,this.formSerializer).toString();if((T=be.isFileList(i))||c.indexOf("multipart/form-data")>-1){const C=this.env&&this.env.FormData;return pb(T?{"files[]":i}:i,C&&new C,this.formSerializer)}}return _||p?(a.setContentType("application/json",!1),vie(i)):i}],transformResponse:[function(i){const a=this.transitional||kv.transitional,c=a&&a.forcedJSONParsing,p=this.responseType==="json";if(be.isResponse(i)||be.isReadableStream(i))return i;if(i&&be.isString(i)&&(c&&!this.responseType||p)){const y=!(a&&a.silentJSONParsing)&&p;try{return JSON.parse(i)}catch(T){if(y)throw T.name==="SyntaxError"?Wt.from(T,Wt.ERR_BAD_RESPONSE,this,null,this.response):T}}return i}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ss.classes.FormData,Blob:ss.classes.Blob},validateStatus:function(i){return i>=200&&i<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};be.forEach(["delete","get","head","post","put","patch"],s=>{kv.headers[s]={}});const Sie=be.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Tie=s=>{const i={};let a,c,p;return s&&s.split(`
`).forEach(function(y){p=y.indexOf(":"),a=y.substring(0,p).trim().toLowerCase(),c=y.substring(p+1).trim(),!(!a||i[a]&&Sie[a])&&(a==="set-cookie"?i[a]?i[a].push(c):i[a]=[c]:i[a]=i[a]?i[a]+", "+c:c)}),i},G4=Symbol("internals");function $y(s){return s&&String(s).trim().toLowerCase()}function RC(s){return s===!1||s==null?s:be.isArray(s)?s.map(RC):String(s)}function Rie(s){const i=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let c;for(;c=a.exec(s);)i[c[1]]=c[2];return i}const wie=s=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(s.trim());function LN(s,i,a,c,p){if(be.isFunction(c))return c.call(this,i,a);if(p&&(i=a),!!be.isString(i)){if(be.isString(c))return i.indexOf(c)!==-1;if(be.isRegExp(c))return c.test(i)}}function Cie(s){return s.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(i,a,c)=>a.toUpperCase()+c)}function bie(s,i){const a=be.toCamelCase(" "+i);["get","set","has"].forEach(c=>{Object.defineProperty(s,c+a,{value:function(p,_,y){return this[c].call(this,i,p,_,y)},configurable:!0})})}let io=class{constructor(i){i&&this.set(i)}set(i,a,c){const p=this;function _(T,C,I){const D=$y(C);if(!D)throw new Error("header name must be a non-empty string");const L=be.findKey(p,D);(!L||p[L]===void 0||I===!0||I===void 0&&p[L]!==!1)&&(p[L||C]=RC(T))}const y=(T,C)=>be.forEach(T,(I,D)=>_(I,D,C));if(be.isPlainObject(i)||i instanceof this.constructor)y(i,a);else if(be.isString(i)&&(i=i.trim())&&!wie(i))y(Tie(i),a);else if(be.isHeaders(i))for(const[T,C]of i.entries())_(C,T,c);else i!=null&&_(a,i,c);return this}get(i,a){if(i=$y(i),i){const c=be.findKey(this,i);if(c){const p=this[c];if(!a)return p;if(a===!0)return Rie(p);if(be.isFunction(a))return a.call(this,p,c);if(be.isRegExp(a))return a.exec(p);throw new TypeError("parser must be boolean|regexp|function")}}}has(i,a){if(i=$y(i),i){const c=be.findKey(this,i);return!!(c&&this[c]!==void 0&&(!a||LN(this,this[c],c,a)))}return!1}delete(i,a){const c=this;let p=!1;function _(y){if(y=$y(y),y){const T=be.findKey(c,y);T&&(!a||LN(c,c[T],T,a))&&(delete c[T],p=!0)}}return be.isArray(i)?i.forEach(_):_(i),p}clear(i){const a=Object.keys(this);let c=a.length,p=!1;for(;c--;){const _=a[c];(!i||LN(this,this[_],_,i,!0))&&(delete this[_],p=!0)}return p}normalize(i){const a=this,c={};return be.forEach(this,(p,_)=>{const y=be.findKey(c,_);if(y){a[y]=RC(p),delete a[_];return}const T=i?Cie(_):String(_).trim();T!==_&&delete a[_],a[T]=RC(p),c[T]=!0}),this}concat(...i){return this.constructor.concat(this,...i)}toJSON(i){const a=Object.create(null);return be.forEach(this,(c,p)=>{c!=null&&c!==!1&&(a[p]=i&&be.isArray(c)?c.join(", "):c)}),a}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([i,a])=>i+": "+a).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(i){return i instanceof this?i:new this(i)}static concat(i,...a){const c=new this(i);return a.forEach(p=>c.set(p)),c}static accessor(i){const c=(this[G4]=this[G4]={accessors:{}}).accessors,p=this.prototype;function _(y){const T=$y(y);c[T]||(bie(p,y),c[T]=!0)}return be.isArray(i)?i.forEach(_):_(i),this}};io.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);be.reduceDescriptors(io.prototype,({value:s},i)=>{let a=i[0].toUpperCase()+i.slice(1);return{get:()=>s,set(c){this[a]=c}}});be.freezeMethods(io);function xN(s,i){const a=this||kv,c=i||a,p=io.from(c.headers);let _=c.data;return be.forEach(s,function(T){_=T.call(a,_,p.normalize(),i?i.status:void 0)}),p.normalize(),_}function pW(s){return!!(s&&s.__CANCEL__)}function i_(s,i,a){Wt.call(this,s??"canceled",Wt.ERR_CANCELED,i,a),this.name="CanceledError"}be.inherits(i_,Wt,{__CANCEL__:!0});function fW(s,i,a){const c=a.config.validateStatus;!a.status||!c||c(a.status)?s(a):i(new Wt("Request failed with status code "+a.status,[Wt.ERR_BAD_REQUEST,Wt.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a))}function Aie(s){const i=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return i&&i[1]||""}function Iie(s,i){s=s||10;const a=new Array(s),c=new Array(s);let p=0,_=0,y;return i=i!==void 0?i:1e3,function(C){const I=Date.now(),D=c[_];y||(y=I),a[p]=C,c[p]=I;let L=_,j=0;for(;L!==p;)j+=a[L++],L=L%s;if(p=(p+1)%s,p===_&&(_=(_+1)%s),I-y<i)return;const Y=D&&I-D;return Y?Math.round(j*1e3/Y):void 0}}function Oie(s,i){let a=0,c=1e3/i,p,_;const y=(I,D=Date.now())=>{a=D,p=null,_&&(clearTimeout(_),_=null),s.apply(null,I)};return[(...I)=>{const D=Date.now(),L=D-a;L>=c?y(I,D):(p=I,_||(_=setTimeout(()=>{_=null,y(p)},c-L)))},()=>p&&y(p)]}const BC=(s,i,a=3)=>{let c=0;const p=Iie(50,250);return Oie(_=>{const y=_.loaded,T=_.lengthComputable?_.total:void 0,C=y-c,I=p(C),D=y<=T;c=y;const L={loaded:y,total:T,progress:T?y/T:void 0,bytes:C,rate:I||void 0,estimated:I&&T&&D?(T-y)/I:void 0,event:_,lengthComputable:T!=null,[i?"download":"upload"]:!0};s(L)},a)},W4=(s,i)=>{const a=s!=null;return[c=>i[0]({lengthComputable:a,total:s,loaded:c}),i[1]]},z4=s=>(...i)=>be.asap(()=>s(...i)),Nie=ss.hasStandardBrowserEnv?((s,i)=>a=>(a=new URL(a,ss.origin),s.protocol===a.protocol&&s.host===a.host&&(i||s.port===a.port)))(new URL(ss.origin),ss.navigator&&/(msie|trident)/i.test(ss.navigator.userAgent)):()=>!0,Pie=ss.hasStandardBrowserEnv?{write(s,i,a,c,p,_){const y=[s+"="+encodeURIComponent(i)];be.isNumber(a)&&y.push("expires="+new Date(a).toGMTString()),be.isString(c)&&y.push("path="+c),be.isString(p)&&y.push("domain="+p),_===!0&&y.push("secure"),document.cookie=y.join("; ")},read(s){const i=document.cookie.match(new RegExp("(^|;\\s*)("+s+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove(s){this.write(s,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Die(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}function kie(s,i){return i?s.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):s}function mW(s,i,a){let c=!Die(i);return s&&(c||a==!1)?kie(s,i):i}const H4=s=>s instanceof io?{...s}:s;function Fp(s,i){i=i||{};const a={};function c(I,D,L,j){return be.isPlainObject(I)&&be.isPlainObject(D)?be.merge.call({caseless:j},I,D):be.isPlainObject(D)?be.merge({},D):be.isArray(D)?D.slice():D}function p(I,D,L,j){if(be.isUndefined(D)){if(!be.isUndefined(I))return c(void 0,I,L,j)}else return c(I,D,L,j)}function _(I,D){if(!be.isUndefined(D))return c(void 0,D)}function y(I,D){if(be.isUndefined(D)){if(!be.isUndefined(I))return c(void 0,I)}else return c(void 0,D)}function T(I,D,L){if(L in i)return c(I,D);if(L in s)return c(void 0,I)}const C={url:_,method:_,data:_,baseURL:y,transformRequest:y,transformResponse:y,paramsSerializer:y,timeout:y,timeoutMessage:y,withCredentials:y,withXSRFToken:y,adapter:y,responseType:y,xsrfCookieName:y,xsrfHeaderName:y,onUploadProgress:y,onDownloadProgress:y,decompress:y,maxContentLength:y,maxBodyLength:y,beforeRedirect:y,transport:y,httpAgent:y,httpsAgent:y,cancelToken:y,socketPath:y,responseEncoding:y,validateStatus:T,headers:(I,D,L)=>p(H4(I),H4(D),L,!0)};return be.forEach(Object.keys(Object.assign({},s,i)),function(D){const L=C[D]||p,j=L(s[D],i[D],D);be.isUndefined(j)&&L!==T||(a[D]=j)}),a}const gW=s=>{const i=Fp({},s);let{data:a,withXSRFToken:c,xsrfHeaderName:p,xsrfCookieName:_,headers:y,auth:T}=i;i.headers=y=io.from(y),i.url=uW(mW(i.baseURL,i.url,i.allowAbsoluteUrls),s.params,s.paramsSerializer),T&&y.set("Authorization","Basic "+btoa((T.username||"")+":"+(T.password?unescape(encodeURIComponent(T.password)):"")));let C;if(be.isFormData(a)){if(ss.hasStandardBrowserEnv||ss.hasStandardBrowserWebWorkerEnv)y.setContentType(void 0);else if((C=y.getContentType())!==!1){const[I,...D]=C?C.split(";").map(L=>L.trim()).filter(Boolean):[];y.setContentType([I||"multipart/form-data",...D].join("; "))}}if(ss.hasStandardBrowserEnv&&(c&&be.isFunction(c)&&(c=c(i)),c||c!==!1&&Nie(i.url))){const I=p&&_&&Pie.read(_);I&&y.set(p,I)}return i},Lie=typeof XMLHttpRequest<"u",xie=Lie&&function(s){return new Promise(function(a,c){const p=gW(s);let _=p.data;const y=io.from(p.headers).normalize();let{responseType:T,onUploadProgress:C,onDownloadProgress:I}=p,D,L,j,Y,X;function ee(){Y&&Y(),X&&X(),p.cancelToken&&p.cancelToken.unsubscribe(D),p.signal&&p.signal.removeEventListener("abort",D)}let Q=new XMLHttpRequest;Q.open(p.method.toUpperCase(),p.url,!0),Q.timeout=p.timeout;function se(){if(!Q)return;const me=io.from("getAllResponseHeaders"in Q&&Q.getAllResponseHeaders()),Ve={data:!T||T==="text"||T==="json"?Q.responseText:Q.response,status:Q.status,statusText:Q.statusText,headers:me,config:s,request:Q};fW(function(ut){a(ut),ee()},function(ut){c(ut),ee()},Ve),Q=null}"onloadend"in Q?Q.onloadend=se:Q.onreadystatechange=function(){!Q||Q.readyState!==4||Q.status===0&&!(Q.responseURL&&Q.responseURL.indexOf("file:")===0)||setTimeout(se)},Q.onabort=function(){Q&&(c(new Wt("Request aborted",Wt.ECONNABORTED,s,Q)),Q=null)},Q.onerror=function(){c(new Wt("Network Error",Wt.ERR_NETWORK,s,Q)),Q=null},Q.ontimeout=function(){let Oe=p.timeout?"timeout of "+p.timeout+"ms exceeded":"timeout exceeded";const Ve=p.transitional||dW;p.timeoutErrorMessage&&(Oe=p.timeoutErrorMessage),c(new Wt(Oe,Ve.clarifyTimeoutError?Wt.ETIMEDOUT:Wt.ECONNABORTED,s,Q)),Q=null},_===void 0&&y.setContentType(null),"setRequestHeader"in Q&&be.forEach(y.toJSON(),function(Oe,Ve){Q.setRequestHeader(Ve,Oe)}),be.isUndefined(p.withCredentials)||(Q.withCredentials=!!p.withCredentials),T&&T!=="json"&&(Q.responseType=p.responseType),I&&([j,X]=BC(I,!0),Q.addEventListener("progress",j)),C&&Q.upload&&([L,Y]=BC(C),Q.upload.addEventListener("progress",L),Q.upload.addEventListener("loadend",Y)),(p.cancelToken||p.signal)&&(D=me=>{Q&&(c(!me||me.type?new i_(null,s,Q):me),Q.abort(),Q=null)},p.cancelToken&&p.cancelToken.subscribe(D),p.signal&&(p.signal.aborted?D():p.signal.addEventListener("abort",D)));const fe=Aie(p.url);if(fe&&ss.protocols.indexOf(fe)===-1){c(new Wt("Unsupported protocol "+fe+":",Wt.ERR_BAD_REQUEST,s));return}Q.send(_||null)})},Mie=(s,i)=>{const{length:a}=s=s?s.filter(Boolean):[];if(i||a){let c=new AbortController,p;const _=function(I){if(!p){p=!0,T();const D=I instanceof Error?I:this.reason;c.abort(D instanceof Wt?D:new i_(D instanceof Error?D.message:D))}};let y=i&&setTimeout(()=>{y=null,_(new Wt(`timeout ${i} of ms exceeded`,Wt.ETIMEDOUT))},i);const T=()=>{s&&(y&&clearTimeout(y),y=null,s.forEach(I=>{I.unsubscribe?I.unsubscribe(_):I.removeEventListener("abort",_)}),s=null)};s.forEach(I=>I.addEventListener("abort",_));const{signal:C}=c;return C.unsubscribe=()=>be.asap(T),C}},Uie=function*(s,i){let a=s.byteLength;if(a<i){yield s;return}let c=0,p;for(;c<a;)p=c+i,yield s.slice(c,p),c=p},Vie=async function*(s,i){for await(const a of Fie(s))yield*Uie(a,i)},Fie=async function*(s){if(s[Symbol.asyncIterator]){yield*s;return}const i=s.getReader();try{for(;;){const{done:a,value:c}=await i.read();if(a)break;yield c}}finally{await i.cancel()}},K4=(s,i,a,c)=>{const p=Vie(s,i);let _=0,y,T=C=>{y||(y=!0,c&&c(C))};return new ReadableStream({async pull(C){try{const{done:I,value:D}=await p.next();if(I){T(),C.close();return}let L=D.byteLength;if(a){let j=_+=L;a(j)}C.enqueue(new Uint8Array(D))}catch(I){throw T(I),I}},cancel(C){return T(C),p.return()}},{highWaterMark:2})},fb=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",_W=fb&&typeof ReadableStream=="function",Bie=fb&&(typeof TextEncoder=="function"?(s=>i=>s.encode(i))(new TextEncoder):async s=>new Uint8Array(await new Response(s).arrayBuffer())),EW=(s,...i)=>{try{return!!s(...i)}catch{return!1}},jie=_W&&EW(()=>{let s=!1;const i=new Request(ss.origin,{body:new ReadableStream,method:"POST",get duplex(){return s=!0,"half"}}).headers.has("Content-Type");return s&&!i}),q4=64*1024,PP=_W&&EW(()=>be.isReadableStream(new Response("").body)),jC={stream:PP&&(s=>s.body)};fb&&(s=>{["text","arrayBuffer","blob","formData","stream"].forEach(i=>{!jC[i]&&(jC[i]=be.isFunction(s[i])?a=>a[i]():(a,c)=>{throw new Wt(`Response type '${i}' is not supported`,Wt.ERR_NOT_SUPPORT,c)})})})(new Response);const Gie=async s=>{if(s==null)return 0;if(be.isBlob(s))return s.size;if(be.isSpecCompliantForm(s))return(await new Request(ss.origin,{method:"POST",body:s}).arrayBuffer()).byteLength;if(be.isArrayBufferView(s)||be.isArrayBuffer(s))return s.byteLength;if(be.isURLSearchParams(s)&&(s=s+""),be.isString(s))return(await Bie(s)).byteLength},Wie=async(s,i)=>{const a=be.toFiniteNumber(s.getContentLength());return a??Gie(i)},zie=fb&&(async s=>{let{url:i,method:a,data:c,signal:p,cancelToken:_,timeout:y,onDownloadProgress:T,onUploadProgress:C,responseType:I,headers:D,withCredentials:L="same-origin",fetchOptions:j}=gW(s);I=I?(I+"").toLowerCase():"text";let Y=Mie([p,_&&_.toAbortSignal()],y),X;const ee=Y&&Y.unsubscribe&&(()=>{Y.unsubscribe()});let Q;try{if(C&&jie&&a!=="get"&&a!=="head"&&(Q=await Wie(D,c))!==0){let Ve=new Request(i,{method:"POST",body:c,duplex:"half"}),Ze;if(be.isFormData(c)&&(Ze=Ve.headers.get("content-type"))&&D.setContentType(Ze),Ve.body){const[ut,rt]=W4(Q,BC(z4(C)));c=K4(Ve.body,q4,ut,rt)}}be.isString(L)||(L=L?"include":"omit");const se="credentials"in Request.prototype;X=new Request(i,{...j,signal:Y,method:a.toUpperCase(),headers:D.normalize().toJSON(),body:c,duplex:"half",credentials:se?L:void 0});let fe=await fetch(X);const me=PP&&(I==="stream"||I==="response");if(PP&&(T||me&&ee)){const Ve={};["status","statusText","headers"].forEach(dn=>{Ve[dn]=fe[dn]});const Ze=be.toFiniteNumber(fe.headers.get("content-length")),[ut,rt]=T&&W4(Ze,BC(z4(T),!0))||[];fe=new Response(K4(fe.body,q4,ut,()=>{rt&&rt(),ee&&ee()}),Ve)}I=I||"text";let Oe=await jC[be.findKey(jC,I)||"text"](fe,s);return!me&&ee&&ee(),await new Promise((Ve,Ze)=>{fW(Ve,Ze,{data:Oe,headers:io.from(fe.headers),status:fe.status,statusText:fe.statusText,config:s,request:X})})}catch(se){throw ee&&ee(),se&&se.name==="TypeError"&&/fetch/i.test(se.message)?Object.assign(new Wt("Network Error",Wt.ERR_NETWORK,s,X),{cause:se.cause||se}):Wt.from(se,se&&se.code,s,X)}}),DP={http:sie,xhr:xie,fetch:zie};be.forEach(DP,(s,i)=>{if(s){try{Object.defineProperty(s,"name",{value:i})}catch{}Object.defineProperty(s,"adapterName",{value:i})}});const Y4=s=>`- ${s}`,Hie=s=>be.isFunction(s)||s===null||s===!1,yW={getAdapter:s=>{s=be.isArray(s)?s:[s];const{length:i}=s;let a,c;const p={};for(let _=0;_<i;_++){a=s[_];let y;if(c=a,!Hie(a)&&(c=DP[(y=String(a)).toLowerCase()],c===void 0))throw new Wt(`Unknown adapter '${y}'`);if(c)break;p[y||"#"+_]=c}if(!c){const _=Object.entries(p).map(([T,C])=>`adapter ${T} `+(C===!1?"is not supported by the environment":"is not available in the build"));let y=i?_.length>1?`since :
`+_.map(Y4).join(`
`):" "+Y4(_[0]):"as no adapter specified";throw new Wt("There is no suitable adapter to dispatch the request "+y,"ERR_NOT_SUPPORT")}return c},adapters:DP};function MN(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new i_(null,s)}function X4(s){return MN(s),s.headers=io.from(s.headers),s.data=xN.call(s,s.transformRequest),["post","put","patch"].indexOf(s.method)!==-1&&s.headers.setContentType("application/x-www-form-urlencoded",!1),yW.getAdapter(s.adapter||kv.adapter)(s).then(function(c){return MN(s),c.data=xN.call(s,s.transformResponse,c),c.headers=io.from(c.headers),c},function(c){return pW(c)||(MN(s),c&&c.response&&(c.response.data=xN.call(s,s.transformResponse,c.response),c.response.headers=io.from(c.response.headers))),Promise.reject(c)})}const vW="1.8.4",mb={};["object","boolean","number","function","string","symbol"].forEach((s,i)=>{mb[s]=function(c){return typeof c===s||"a"+(i<1?"n ":" ")+s}});const J4={};mb.transitional=function(i,a,c){function p(_,y){return"[Axios v"+vW+"] Transitional option '"+_+"'"+y+(c?". "+c:"")}return(_,y,T)=>{if(i===!1)throw new Wt(p(y," has been removed"+(a?" in "+a:"")),Wt.ERR_DEPRECATED);return a&&!J4[y]&&(J4[y]=!0,console.warn(p(y," has been deprecated since v"+a+" and will be removed in the near future"))),i?i(_,y,T):!0}};mb.spelling=function(i){return(a,c)=>(console.warn(`${c} is likely a misspelling of ${i}`),!0)};function Kie(s,i,a){if(typeof s!="object")throw new Wt("options must be an object",Wt.ERR_BAD_OPTION_VALUE);const c=Object.keys(s);let p=c.length;for(;p-- >0;){const _=c[p],y=i[_];if(y){const T=s[_],C=T===void 0||y(T,_,s);if(C!==!0)throw new Wt("option "+_+" must be "+C,Wt.ERR_BAD_OPTION_VALUE);continue}if(a!==!0)throw new Wt("Unknown option "+_,Wt.ERR_BAD_OPTION)}}const wC={assertOptions:Kie,validators:mb},Fc=wC.validators;let Mp=class{constructor(i){this.defaults=i,this.interceptors={request:new j4,response:new j4}}async request(i,a){try{return await this._request(i,a)}catch(c){if(c instanceof Error){let p={};Error.captureStackTrace?Error.captureStackTrace(p):p=new Error;const _=p.stack?p.stack.replace(/^.+\n/,""):"";try{c.stack?_&&!String(c.stack).endsWith(_.replace(/^.+\n.+\n/,""))&&(c.stack+=`
`+_):c.stack=_}catch{}}throw c}}_request(i,a){typeof i=="string"?(a=a||{},a.url=i):a=i||{},a=Fp(this.defaults,a);const{transitional:c,paramsSerializer:p,headers:_}=a;c!==void 0&&wC.assertOptions(c,{silentJSONParsing:Fc.transitional(Fc.boolean),forcedJSONParsing:Fc.transitional(Fc.boolean),clarifyTimeoutError:Fc.transitional(Fc.boolean)},!1),p!=null&&(be.isFunction(p)?a.paramsSerializer={serialize:p}:wC.assertOptions(p,{encode:Fc.function,serialize:Fc.function},!0)),a.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?a.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:a.allowAbsoluteUrls=!0),wC.assertOptions(a,{baseUrl:Fc.spelling("baseURL"),withXsrfToken:Fc.spelling("withXSRFToken")},!0),a.method=(a.method||this.defaults.method||"get").toLowerCase();let y=_&&be.merge(_.common,_[a.method]);_&&be.forEach(["delete","get","head","post","put","patch","common"],X=>{delete _[X]}),a.headers=io.concat(y,_);const T=[];let C=!0;this.interceptors.request.forEach(function(ee){typeof ee.runWhen=="function"&&ee.runWhen(a)===!1||(C=C&&ee.synchronous,T.unshift(ee.fulfilled,ee.rejected))});const I=[];this.interceptors.response.forEach(function(ee){I.push(ee.fulfilled,ee.rejected)});let D,L=0,j;if(!C){const X=[X4.bind(this),void 0];for(X.unshift.apply(X,T),X.push.apply(X,I),j=X.length,D=Promise.resolve(a);L<j;)D=D.then(X[L++],X[L++]);return D}j=T.length;let Y=a;for(L=0;L<j;){const X=T[L++],ee=T[L++];try{Y=X(Y)}catch(Q){ee.call(this,Q);break}}try{D=X4.call(this,Y)}catch(X){return Promise.reject(X)}for(L=0,j=I.length;L<j;)D=D.then(I[L++],I[L++]);return D}getUri(i){i=Fp(this.defaults,i);const a=mW(i.baseURL,i.url,i.allowAbsoluteUrls);return uW(a,i.params,i.paramsSerializer)}};be.forEach(["delete","get","head","options"],function(i){Mp.prototype[i]=function(a,c){return this.request(Fp(c||{},{method:i,url:a,data:(c||{}).data}))}});be.forEach(["post","put","patch"],function(i){function a(c){return function(_,y,T){return this.request(Fp(T||{},{method:i,headers:c?{"Content-Type":"multipart/form-data"}:{},url:_,data:y}))}}Mp.prototype[i]=a(),Mp.prototype[i+"Form"]=a(!0)});let qie=class SW{constructor(i){if(typeof i!="function")throw new TypeError("executor must be a function.");let a;this.promise=new Promise(function(_){a=_});const c=this;this.promise.then(p=>{if(!c._listeners)return;let _=c._listeners.length;for(;_-- >0;)c._listeners[_](p);c._listeners=null}),this.promise.then=p=>{let _;const y=new Promise(T=>{c.subscribe(T),_=T}).then(p);return y.cancel=function(){c.unsubscribe(_)},y},i(function(_,y,T){c.reason||(c.reason=new i_(_,y,T),a(c.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(i){if(this.reason){i(this.reason);return}this._listeners?this._listeners.push(i):this._listeners=[i]}unsubscribe(i){if(!this._listeners)return;const a=this._listeners.indexOf(i);a!==-1&&this._listeners.splice(a,1)}toAbortSignal(){const i=new AbortController,a=c=>{i.abort(c)};return this.subscribe(a),i.signal.unsubscribe=()=>this.unsubscribe(a),i.signal}static source(){let i;return{token:new SW(function(p){i=p}),cancel:i}}};function Yie(s){return function(a){return s.apply(null,a)}}function Xie(s){return be.isObject(s)&&s.isAxiosError===!0}const kP={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(kP).forEach(([s,i])=>{kP[i]=s});function TW(s){const i=new Mp(s),a=ZG(Mp.prototype.request,i);return be.extend(a,Mp.prototype,i,{allOwnKeys:!0}),be.extend(a,i,null,{allOwnKeys:!0}),a.create=function(p){return TW(Fp(s,p))},a}const Yi=TW(kv);Yi.Axios=Mp;Yi.CanceledError=i_;Yi.CancelToken=qie;Yi.isCancel=pW;Yi.VERSION=vW;Yi.toFormData=pb;Yi.AxiosError=Wt;Yi.Cancel=Yi.CanceledError;Yi.all=function(i){return Promise.all(i)};Yi.spread=Yie;Yi.isAxiosError=Xie;Yi.mergeConfig=Fp;Yi.AxiosHeaders=io;Yi.formToJSON=s=>hW(be.isHTMLForm(s)?new FormData(s):s);Yi.getAdapter=yW.getAdapter;Yi.HttpStatusCode=kP;Yi.default=Yi;const{Axios:Uye,AxiosError:Vye,CanceledError:Fye,isCancel:Bye,CancelToken:jye,VERSION:Gye,all:Wye,Cancel:zye,isAxiosError:Hye,spread:Kye,toFormData:qye,AxiosHeaders:Yye,HttpStatusCode:Xye,formToJSON:Jye,getAdapter:$ye,mergeConfig:Qye}=Yi,gd=Yi.create({baseURL:"/api",withCredentials:!0});let Jie={data:""},$ie=s=>typeof window=="object"?((s?s.querySelector("#_goober"):window._goober)||Object.assign((s||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:s||Jie,Qie=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,Zie=/\/\*[^]*?\*\/|  +/g,$4=/\n+/g,_d=(s,i)=>{let a="",c="",p="";for(let _ in s){let y=s[_];_[0]=="@"?_[1]=="i"?a=_+" "+y+";":c+=_[1]=="f"?_d(y,_):_+"{"+_d(y,_[1]=="k"?"":i)+"}":typeof y=="object"?c+=_d(y,i?i.replace(/([^,])+/g,T=>_.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,C=>/&/.test(C)?C.replace(/&/g,T):T?T+" "+C:C)):_):y!=null&&(_=/^--/.test(_)?_:_.replace(/[A-Z]/g,"-$&").toLowerCase(),p+=_d.p?_d.p(_,y):_+":"+y+";")}return a+(i&&p?i+"{"+p+"}":p)+c},Ql={},RW=s=>{if(typeof s=="object"){let i="";for(let a in s)i+=a+RW(s[a]);return i}return s},ere=(s,i,a,c,p)=>{let _=RW(s),y=Ql[_]||(Ql[_]=(C=>{let I=0,D=11;for(;I<C.length;)D=101*D+C.charCodeAt(I++)>>>0;return"go"+D})(_));if(!Ql[y]){let C=_!==s?s:(I=>{let D,L,j=[{}];for(;D=Qie.exec(I.replace(Zie,""));)D[4]?j.shift():D[3]?(L=D[3].replace($4," ").trim(),j.unshift(j[0][L]=j[0][L]||{})):j[0][D[1]]=D[2].replace($4," ").trim();return j[0]})(s);Ql[y]=_d(p?{["@keyframes "+y]:C}:C,a?"":"."+y)}let T=a&&Ql.g?Ql.g:null;return a&&(Ql.g=Ql[y]),((C,I,D,L)=>{L?I.data=I.data.replace(L,C):I.data.indexOf(C)===-1&&(I.data=D?C+I.data:I.data+C)})(Ql[y],i,c,T),y},tre=(s,i,a)=>s.reduce((c,p,_)=>{let y=i[_];if(y&&y.call){let T=y(a),C=T&&T.props&&T.props.className||/^go/.test(T)&&T;y=C?"."+C:T&&typeof T=="object"?T.props?"":_d(T,""):T===!1?"":T}return c+p+(y??"")},"");function gb(s){let i=this||{},a=s.call?s(i.p):s;return ere(a.unshift?a.raw?tre(a,[].slice.call(arguments,1),i.p):a.reduce((c,p)=>Object.assign(c,p&&p.call?p(i.p):p),{}):a,$ie(i.target),i.g,i.o,i.k)}let wW,LP,xP;gb.bind({g:1});let tu=gb.bind({k:1});function nre(s,i,a,c){_d.p=i,wW=s,LP=a,xP=c}function kd(s,i){let a=this||{};return function(){let c=arguments;function p(_,y){let T=Object.assign({},_),C=T.className||p.className;a.p=Object.assign({theme:LP&&LP()},T),a.o=/ *go\d+/.test(C),T.className=gb.apply(a,c)+(C?" "+C:"");let I=s;return s[0]&&(I=T.as||s,delete T.as),xP&&I[0]&&xP(T),wW(I,T)}return p}}var ire=s=>typeof s=="function",GC=(s,i)=>ire(s)?s(i):s,rre=(()=>{let s=0;return()=>(++s).toString()})(),CW=(()=>{let s;return()=>{if(s===void 0&&typeof window<"u"){let i=matchMedia("(prefers-reduced-motion: reduce)");s=!i||i.matches}return s}})(),sre=20,bW=(s,i)=>{switch(i.type){case 0:return{...s,toasts:[i.toast,...s.toasts].slice(0,sre)};case 1:return{...s,toasts:s.toasts.map(_=>_.id===i.toast.id?{..._,...i.toast}:_)};case 2:let{toast:a}=i;return bW(s,{type:s.toasts.find(_=>_.id===a.id)?1:0,toast:a});case 3:let{toastId:c}=i;return{...s,toasts:s.toasts.map(_=>_.id===c||c===void 0?{..._,dismissed:!0,visible:!1}:_)};case 4:return i.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(_=>_.id!==i.toastId)};case 5:return{...s,pausedAt:i.time};case 6:let p=i.time-(s.pausedAt||0);return{...s,pausedAt:void 0,toasts:s.toasts.map(_=>({..._,pauseDuration:_.pauseDuration+p}))}}},CC=[],Np={toasts:[],pausedAt:void 0},Wp=s=>{Np=bW(Np,s),CC.forEach(i=>{i(Np)})},ore={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},are=(s={})=>{let[i,a]=_e.useState(Np),c=_e.useRef(Np);_e.useEffect(()=>(c.current!==Np&&a(Np),CC.push(a),()=>{let _=CC.indexOf(a);_>-1&&CC.splice(_,1)}),[]);let p=i.toasts.map(_=>{var y,T,C;return{...s,...s[_.type],..._,removeDelay:_.removeDelay||((y=s[_.type])==null?void 0:y.removeDelay)||(s==null?void 0:s.removeDelay),duration:_.duration||((T=s[_.type])==null?void 0:T.duration)||(s==null?void 0:s.duration)||ore[_.type],style:{...s.style,...(C=s[_.type])==null?void 0:C.style,..._.style}}});return{...i,toasts:p}},cre=(s,i="blank",a)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:i,ariaProps:{role:"status","aria-live":"polite"},message:s,pauseDuration:0,...a,id:(a==null?void 0:a.id)||rre()}),Lv=s=>(i,a)=>{let c=cre(i,s,a);return Wp({type:2,toast:c}),c.id},Cs=(s,i)=>Lv("blank")(s,i);Cs.error=Lv("error");Cs.success=Lv("success");Cs.loading=Lv("loading");Cs.custom=Lv("custom");Cs.dismiss=s=>{Wp({type:3,toastId:s})};Cs.remove=s=>Wp({type:4,toastId:s});Cs.promise=(s,i,a)=>{let c=Cs.loading(i.loading,{...a,...a==null?void 0:a.loading});return typeof s=="function"&&(s=s()),s.then(p=>{let _=i.success?GC(i.success,p):void 0;return _?Cs.success(_,{id:c,...a,...a==null?void 0:a.success}):Cs.dismiss(c),p}).catch(p=>{let _=i.error?GC(i.error,p):void 0;_?Cs.error(_,{id:c,...a,...a==null?void 0:a.error}):Cs.dismiss(c)}),s};var lre=(s,i)=>{Wp({type:1,toast:{id:s,height:i}})},ure=()=>{Wp({type:5,time:Date.now()})},cv=new Map,dre=1e3,hre=(s,i=dre)=>{if(cv.has(s))return;let a=setTimeout(()=>{cv.delete(s),Wp({type:4,toastId:s})},i);cv.set(s,a)},pre=s=>{let{toasts:i,pausedAt:a}=are(s);_e.useEffect(()=>{if(a)return;let _=Date.now(),y=i.map(T=>{if(T.duration===1/0)return;let C=(T.duration||0)+T.pauseDuration-(_-T.createdAt);if(C<0){T.visible&&Cs.dismiss(T.id);return}return setTimeout(()=>Cs.dismiss(T.id),C)});return()=>{y.forEach(T=>T&&clearTimeout(T))}},[i,a]);let c=_e.useCallback(()=>{a&&Wp({type:6,time:Date.now()})},[a]),p=_e.useCallback((_,y)=>{let{reverseOrder:T=!1,gutter:C=8,defaultPosition:I}=y||{},D=i.filter(Y=>(Y.position||I)===(_.position||I)&&Y.height),L=D.findIndex(Y=>Y.id===_.id),j=D.filter((Y,X)=>X<L&&Y.visible).length;return D.filter(Y=>Y.visible).slice(...T?[j+1]:[0,j]).reduce((Y,X)=>Y+(X.height||0)+C,0)},[i]);return _e.useEffect(()=>{i.forEach(_=>{if(_.dismissed)hre(_.id,_.removeDelay);else{let y=cv.get(_.id);y&&(clearTimeout(y),cv.delete(_.id))}})},[i]),{toasts:i,handlers:{updateHeight:lre,startPause:ure,endPause:c,calculateOffset:p}}},fre=tu`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,mre=tu`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,gre=tu`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,_re=kd("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${s=>s.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${fre} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${mre} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${s=>s.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${gre} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,Ere=tu`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,yre=kd("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${s=>s.secondary||"#e0e0e0"};
  border-right-color: ${s=>s.primary||"#616161"};
  animation: ${Ere} 1s linear infinite;
`,vre=tu`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,Sre=tu`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Tre=kd("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${s=>s.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${vre} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${Sre} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${s=>s.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Rre=kd("div")`
  position: absolute;
`,wre=kd("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Cre=tu`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,bre=kd("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Cre} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Are=({toast:s})=>{let{icon:i,type:a,iconTheme:c}=s;return i!==void 0?typeof i=="string"?_e.createElement(bre,null,i):i:a==="blank"?null:_e.createElement(wre,null,_e.createElement(yre,{...c}),a!=="loading"&&_e.createElement(Rre,null,a==="error"?_e.createElement(_re,{...c}):_e.createElement(Tre,{...c})))},Ire=s=>`
0% {transform: translate3d(0,${s*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,Ore=s=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${s*-150}%,-1px) scale(.6); opacity:0;}
`,Nre="0%{opacity:0;} 100%{opacity:1;}",Pre="0%{opacity:1;} 100%{opacity:0;}",Dre=kd("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,kre=kd("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Lre=(s,i)=>{let a=s.includes("top")?1:-1,[c,p]=CW()?[Nre,Pre]:[Ire(a),Ore(a)];return{animation:i?`${tu(c)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${tu(p)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},xre=_e.memo(({toast:s,position:i,style:a,children:c})=>{let p=s.height?Lre(s.position||i||"top-center",s.visible):{opacity:0},_=_e.createElement(Are,{toast:s}),y=_e.createElement(kre,{...s.ariaProps},GC(s.message,s));return _e.createElement(Dre,{className:s.className,style:{...p,...a,...s.style}},typeof c=="function"?c({icon:_,message:y}):_e.createElement(_e.Fragment,null,_,y))});nre(_e.createElement);var Mre=({id:s,className:i,style:a,onHeightUpdate:c,children:p})=>{let _=_e.useCallback(y=>{if(y){let T=()=>{let C=y.getBoundingClientRect().height;c(s,C)};T(),new MutationObserver(T).observe(y,{subtree:!0,childList:!0,characterData:!0})}},[s,c]);return _e.createElement("div",{ref:_,className:i,style:a},p)},Ure=(s,i)=>{let a=s.includes("top"),c=a?{top:0}:{bottom:0},p=s.includes("center")?{justifyContent:"center"}:s.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:CW()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${i*(a?1:-1)}px)`,...c,...p}},Vre=gb`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,aC=16,Fre=({reverseOrder:s,position:i="top-center",toastOptions:a,gutter:c,children:p,containerStyle:_,containerClassName:y})=>{let{toasts:T,handlers:C}=pre(a);return _e.createElement("div",{id:"_rht_toaster",style:{position:"fixed",zIndex:9999,top:aC,left:aC,right:aC,bottom:aC,pointerEvents:"none",..._},className:y,onMouseEnter:C.startPause,onMouseLeave:C.endPause},T.map(I=>{let D=I.position||i,L=C.calculateOffset(I,{reverseOrder:s,gutter:c,defaultPosition:i}),j=Ure(D,L);return _e.createElement(Mre,{id:I.id,key:I.id,onHeightUpdate:C.updateHeight,className:I.visible?Vre:"",style:j},I.type==="custom"?GC(I.message,I):p?p(I):_e.createElement(xre,{toast:I,position:D}))}))},Br=Cs;const Jc=Object.create(null);Jc.open="0";Jc.close="1";Jc.ping="2";Jc.pong="3";Jc.message="4";Jc.upgrade="5";Jc.noop="6";const bC=Object.create(null);Object.keys(Jc).forEach(s=>{bC[Jc[s]]=s});const MP={type:"error",data:"parser error"},AW=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",IW=typeof ArrayBuffer=="function",OW=s=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(s):s&&s.buffer instanceof ArrayBuffer,PD=({type:s,data:i},a,c)=>AW&&i instanceof Blob?a?c(i):Q4(i,c):IW&&(i instanceof ArrayBuffer||OW(i))?a?c(i):Q4(new Blob([i]),c):c(Jc[s]+(i||"")),Q4=(s,i)=>{const a=new FileReader;return a.onload=function(){const c=a.result.split(",")[1];i("b"+(c||""))},a.readAsDataURL(s)};function Z4(s){return s instanceof Uint8Array?s:s instanceof ArrayBuffer?new Uint8Array(s):new Uint8Array(s.buffer,s.byteOffset,s.byteLength)}let UN;function Bre(s,i){if(AW&&s.data instanceof Blob)return s.data.arrayBuffer().then(Z4).then(i);if(IW&&(s.data instanceof ArrayBuffer||OW(s.data)))return i(Z4(s.data));PD(s,!1,a=>{UN||(UN=new TextEncoder),i(UN.encode(a))})}const e5="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",nv=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let s=0;s<e5.length;s++)nv[e5.charCodeAt(s)]=s;const jre=s=>{let i=s.length*.75,a=s.length,c,p=0,_,y,T,C;s[s.length-1]==="="&&(i--,s[s.length-2]==="="&&i--);const I=new ArrayBuffer(i),D=new Uint8Array(I);for(c=0;c<a;c+=4)_=nv[s.charCodeAt(c)],y=nv[s.charCodeAt(c+1)],T=nv[s.charCodeAt(c+2)],C=nv[s.charCodeAt(c+3)],D[p++]=_<<2|y>>4,D[p++]=(y&15)<<4|T>>2,D[p++]=(T&3)<<6|C&63;return I},Gre=typeof ArrayBuffer=="function",DD=(s,i)=>{if(typeof s!="string")return{type:"message",data:NW(s,i)};const a=s.charAt(0);return a==="b"?{type:"message",data:Wre(s.substring(1),i)}:bC[a]?s.length>1?{type:bC[a],data:s.substring(1)}:{type:bC[a]}:MP},Wre=(s,i)=>{if(Gre){const a=jre(s);return NW(a,i)}else return{base64:!0,data:s}},NW=(s,i)=>{switch(i){case"blob":return s instanceof Blob?s:new Blob([s]);case"arraybuffer":default:return s instanceof ArrayBuffer?s:s.buffer}},PW="",zre=(s,i)=>{const a=s.length,c=new Array(a);let p=0;s.forEach((_,y)=>{PD(_,!1,T=>{c[y]=T,++p===a&&i(c.join(PW))})})},Hre=(s,i)=>{const a=s.split(PW),c=[];for(let p=0;p<a.length;p++){const _=DD(a[p],i);if(c.push(_),_.type==="error")break}return c};function Kre(){return new TransformStream({transform(s,i){Bre(s,a=>{const c=a.length;let p;if(c<126)p=new Uint8Array(1),new DataView(p.buffer).setUint8(0,c);else if(c<65536){p=new Uint8Array(3);const _=new DataView(p.buffer);_.setUint8(0,126),_.setUint16(1,c)}else{p=new Uint8Array(9);const _=new DataView(p.buffer);_.setUint8(0,127),_.setBigUint64(1,BigInt(c))}s.data&&typeof s.data!="string"&&(p[0]|=128),i.enqueue(p),i.enqueue(a)})}})}let VN;function cC(s){return s.reduce((i,a)=>i+a.length,0)}function lC(s,i){if(s[0].length===i)return s.shift();const a=new Uint8Array(i);let c=0;for(let p=0;p<i;p++)a[p]=s[0][c++],c===s[0].length&&(s.shift(),c=0);return s.length&&c<s[0].length&&(s[0]=s[0].slice(c)),a}function qre(s,i){VN||(VN=new TextDecoder);const a=[];let c=0,p=-1,_=!1;return new TransformStream({transform(y,T){for(a.push(y);;){if(c===0){if(cC(a)<1)break;const C=lC(a,1);_=(C[0]&128)===128,p=C[0]&127,p<126?c=3:p===126?c=1:c=2}else if(c===1){if(cC(a)<2)break;const C=lC(a,2);p=new DataView(C.buffer,C.byteOffset,C.length).getUint16(0),c=3}else if(c===2){if(cC(a)<8)break;const C=lC(a,8),I=new DataView(C.buffer,C.byteOffset,C.length),D=I.getUint32(0);if(D>Math.pow(2,21)-1){T.enqueue(MP);break}p=D*Math.pow(2,32)+I.getUint32(4),c=3}else{if(cC(a)<p)break;const C=lC(a,p);T.enqueue(DD(_?C:VN.decode(C),i)),c=0}if(p===0||p>s){T.enqueue(MP);break}}}})}const DW=4;function $i(s){if(s)return Yre(s)}function Yre(s){for(var i in $i.prototype)s[i]=$i.prototype[i];return s}$i.prototype.on=$i.prototype.addEventListener=function(s,i){return this._callbacks=this._callbacks||{},(this._callbacks["$"+s]=this._callbacks["$"+s]||[]).push(i),this};$i.prototype.once=function(s,i){function a(){this.off(s,a),i.apply(this,arguments)}return a.fn=i,this.on(s,a),this};$i.prototype.off=$i.prototype.removeListener=$i.prototype.removeAllListeners=$i.prototype.removeEventListener=function(s,i){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var a=this._callbacks["$"+s];if(!a)return this;if(arguments.length==1)return delete this._callbacks["$"+s],this;for(var c,p=0;p<a.length;p++)if(c=a[p],c===i||c.fn===i){a.splice(p,1);break}return a.length===0&&delete this._callbacks["$"+s],this};$i.prototype.emit=function(s){this._callbacks=this._callbacks||{};for(var i=new Array(arguments.length-1),a=this._callbacks["$"+s],c=1;c<arguments.length;c++)i[c-1]=arguments[c];if(a){a=a.slice(0);for(var c=0,p=a.length;c<p;++c)a[c].apply(this,i)}return this};$i.prototype.emitReserved=$i.prototype.emit;$i.prototype.listeners=function(s){return this._callbacks=this._callbacks||{},this._callbacks["$"+s]||[]};$i.prototype.hasListeners=function(s){return!!this.listeners(s).length};const _b=typeof Promise=="function"&&typeof Promise.resolve=="function"?i=>Promise.resolve().then(i):(i,a)=>a(i,0),ra=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),Xre="arraybuffer";function kW(s,...i){return i.reduce((a,c)=>(s.hasOwnProperty(c)&&(a[c]=s[c]),a),{})}const Jre=ra.setTimeout,$re=ra.clearTimeout;function Eb(s,i){i.useNativeTimers?(s.setTimeoutFn=Jre.bind(ra),s.clearTimeoutFn=$re.bind(ra)):(s.setTimeoutFn=ra.setTimeout.bind(ra),s.clearTimeoutFn=ra.clearTimeout.bind(ra))}const Qre=1.33;function Zre(s){return typeof s=="string"?ese(s):Math.ceil((s.byteLength||s.size)*Qre)}function ese(s){let i=0,a=0;for(let c=0,p=s.length;c<p;c++)i=s.charCodeAt(c),i<128?a+=1:i<2048?a+=2:i<55296||i>=57344?a+=3:(c++,a+=4);return a}function LW(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function tse(s){let i="";for(let a in s)s.hasOwnProperty(a)&&(i.length&&(i+="&"),i+=encodeURIComponent(a)+"="+encodeURIComponent(s[a]));return i}function nse(s){let i={},a=s.split("&");for(let c=0,p=a.length;c<p;c++){let _=a[c].split("=");i[decodeURIComponent(_[0])]=decodeURIComponent(_[1])}return i}class ise extends Error{constructor(i,a,c){super(i),this.description=a,this.context=c,this.type="TransportError"}}class kD extends $i{constructor(i){super(),this.writable=!1,Eb(this,i),this.opts=i,this.query=i.query,this.socket=i.socket,this.supportsBinary=!i.forceBase64}onError(i,a,c){return super.emitReserved("error",new ise(i,a,c)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(i){this.readyState==="open"&&this.write(i)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(i){const a=DD(i,this.socket.binaryType);this.onPacket(a)}onPacket(i){super.emitReserved("packet",i)}onClose(i){this.readyState="closed",super.emitReserved("close",i)}pause(i){}createUri(i,a={}){return i+"://"+this._hostname()+this._port()+this.opts.path+this._query(a)}_hostname(){const i=this.opts.hostname;return i.indexOf(":")===-1?i:"["+i+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(i){const a=tse(i);return a.length?"?"+a:""}}class rse extends kD{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(i){this.readyState="pausing";const a=()=>{this.readyState="paused",i()};if(this._polling||!this.writable){let c=0;this._polling&&(c++,this.once("pollComplete",function(){--c||a()})),this.writable||(c++,this.once("drain",function(){--c||a()}))}else a()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(i){const a=c=>{if(this.readyState==="opening"&&c.type==="open"&&this.onOpen(),c.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(c)};Hre(i,this.socket.binaryType).forEach(a),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const i=()=>{this.write([{type:"close"}])};this.readyState==="open"?i():this.once("open",i)}write(i){this.writable=!1,zre(i,a=>{this.doWrite(a,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const i=this.opts.secure?"https":"http",a=this.query||{};return this.opts.timestampRequests!==!1&&(a[this.opts.timestampParam]=LW()),!this.supportsBinary&&!a.sid&&(a.b64=1),this.createUri(i,a)}}let xW=!1;try{xW=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const sse=xW;function ose(){}class ase extends rse{constructor(i){if(super(i),typeof location<"u"){const a=location.protocol==="https:";let c=location.port;c||(c=a?"443":"80"),this.xd=typeof location<"u"&&i.hostname!==location.hostname||c!==i.port}}doWrite(i,a){const c=this.request({method:"POST",data:i});c.on("success",a),c.on("error",(p,_)=>{this.onError("xhr post error",p,_)})}doPoll(){const i=this.request();i.on("data",this.onData.bind(this)),i.on("error",(a,c)=>{this.onError("xhr poll error",a,c)}),this.pollXhr=i}}let Vg=class AC extends $i{constructor(i,a,c){super(),this.createRequest=i,Eb(this,c),this._opts=c,this._method=c.method||"GET",this._uri=a,this._data=c.data!==void 0?c.data:null,this._create()}_create(){var i;const a=kW(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");a.xdomain=!!this._opts.xd;const c=this._xhr=this.createRequest(a);try{c.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){c.setDisableHeaderCheck&&c.setDisableHeaderCheck(!0);for(let p in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(p)&&c.setRequestHeader(p,this._opts.extraHeaders[p])}}catch{}if(this._method==="POST")try{c.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{c.setRequestHeader("Accept","*/*")}catch{}(i=this._opts.cookieJar)===null||i===void 0||i.addCookies(c),"withCredentials"in c&&(c.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(c.timeout=this._opts.requestTimeout),c.onreadystatechange=()=>{var p;c.readyState===3&&((p=this._opts.cookieJar)===null||p===void 0||p.parseCookies(c.getResponseHeader("set-cookie"))),c.readyState===4&&(c.status===200||c.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof c.status=="number"?c.status:0)},0))},c.send(this._data)}catch(p){this.setTimeoutFn(()=>{this._onError(p)},0);return}typeof document<"u"&&(this._index=AC.requestsCount++,AC.requests[this._index]=this)}_onError(i){this.emitReserved("error",i,this._xhr),this._cleanup(!0)}_cleanup(i){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=ose,i)try{this._xhr.abort()}catch{}typeof document<"u"&&delete AC.requests[this._index],this._xhr=null}}_onLoad(){const i=this._xhr.responseText;i!==null&&(this.emitReserved("data",i),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};Vg.requestsCount=0;Vg.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",t5);else if(typeof addEventListener=="function"){const s="onpagehide"in ra?"pagehide":"unload";addEventListener(s,t5,!1)}}function t5(){for(let s in Vg.requests)Vg.requests.hasOwnProperty(s)&&Vg.requests[s].abort()}const cse=function(){const s=MW({xdomain:!1});return s&&s.responseType!==null}();class lse extends ase{constructor(i){super(i);const a=i&&i.forceBase64;this.supportsBinary=cse&&!a}request(i={}){return Object.assign(i,{xd:this.xd},this.opts),new Vg(MW,this.uri(),i)}}function MW(s){const i=s.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!i||sse))return new XMLHttpRequest}catch{}if(!i)try{return new ra[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const UW=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class use extends kD{get name(){return"websocket"}doOpen(){const i=this.uri(),a=this.opts.protocols,c=UW?{}:kW(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(c.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(i,a,c)}catch(p){return this.emitReserved("error",p)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=i=>this.onClose({description:"websocket connection closed",context:i}),this.ws.onmessage=i=>this.onData(i.data),this.ws.onerror=i=>this.onError("websocket error",i)}write(i){this.writable=!1;for(let a=0;a<i.length;a++){const c=i[a],p=a===i.length-1;PD(c,this.supportsBinary,_=>{try{this.doWrite(c,_)}catch{}p&&_b(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const i=this.opts.secure?"wss":"ws",a=this.query||{};return this.opts.timestampRequests&&(a[this.opts.timestampParam]=LW()),this.supportsBinary||(a.b64=1),this.createUri(i,a)}}const FN=ra.WebSocket||ra.MozWebSocket;class dse extends use{createSocket(i,a,c){return UW?new FN(i,a,c):a?new FN(i,a):new FN(i)}doWrite(i,a){this.ws.send(a)}}class hse extends kD{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(i){return this.emitReserved("error",i)}this._transport.closed.then(()=>{this.onClose()}).catch(i=>{this.onError("webtransport error",i)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(i=>{const a=qre(Number.MAX_SAFE_INTEGER,this.socket.binaryType),c=i.readable.pipeThrough(a).getReader(),p=Kre();p.readable.pipeTo(i.writable),this._writer=p.writable.getWriter();const _=()=>{c.read().then(({done:T,value:C})=>{T||(this.onPacket(C),_())}).catch(T=>{})};_();const y={type:"open"};this.query.sid&&(y.data=`{"sid":"${this.query.sid}"}`),this._writer.write(y).then(()=>this.onOpen())})})}write(i){this.writable=!1;for(let a=0;a<i.length;a++){const c=i[a],p=a===i.length-1;this._writer.write(c).then(()=>{p&&_b(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var i;(i=this._transport)===null||i===void 0||i.close()}}const pse={websocket:dse,webtransport:hse,polling:lse},fse=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,mse=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function UP(s){if(s.length>8e3)throw"URI too long";const i=s,a=s.indexOf("["),c=s.indexOf("]");a!=-1&&c!=-1&&(s=s.substring(0,a)+s.substring(a,c).replace(/:/g,";")+s.substring(c,s.length));let p=fse.exec(s||""),_={},y=14;for(;y--;)_[mse[y]]=p[y]||"";return a!=-1&&c!=-1&&(_.source=i,_.host=_.host.substring(1,_.host.length-1).replace(/;/g,":"),_.authority=_.authority.replace("[","").replace("]","").replace(/;/g,":"),_.ipv6uri=!0),_.pathNames=gse(_,_.path),_.queryKey=_se(_,_.query),_}function gse(s,i){const a=/\/{2,9}/g,c=i.replace(a,"/").split("/");return(i.slice(0,1)=="/"||i.length===0)&&c.splice(0,1),i.slice(-1)=="/"&&c.splice(c.length-1,1),c}function _se(s,i){const a={};return i.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(c,p,_){p&&(a[p]=_)}),a}const VP=typeof addEventListener=="function"&&typeof removeEventListener=="function",IC=[];VP&&addEventListener("offline",()=>{IC.forEach(s=>s())},!1);class Rd extends $i{constructor(i,a){if(super(),this.binaryType=Xre,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,i&&typeof i=="object"&&(a=i,i=null),i){const c=UP(i);a.hostname=c.host,a.secure=c.protocol==="https"||c.protocol==="wss",a.port=c.port,c.query&&(a.query=c.query)}else a.host&&(a.hostname=UP(a.host).host);Eb(this,a),this.secure=a.secure!=null?a.secure:typeof location<"u"&&location.protocol==="https:",a.hostname&&!a.port&&(a.port=this.secure?"443":"80"),this.hostname=a.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=a.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},a.transports.forEach(c=>{const p=c.prototype.name;this.transports.push(p),this._transportsByName[p]=c}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},a),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=nse(this.opts.query)),VP&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},IC.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(i){const a=Object.assign({},this.opts.query);a.EIO=DW,a.transport=i,this.id&&(a.sid=this.id);const c=Object.assign({},this.opts,{query:a,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[i]);return new this._transportsByName[i](c)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const i=this.opts.rememberUpgrade&&Rd.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const a=this.createTransport(i);a.open(),this.setTransport(a)}setTransport(i){this.transport&&this.transport.removeAllListeners(),this.transport=i,i.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",a=>this._onClose("transport close",a))}onOpen(){this.readyState="open",Rd.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(i){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",i),this.emitReserved("heartbeat"),i.type){case"open":this.onHandshake(JSON.parse(i.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const a=new Error("server error");a.code=i.data,this._onError(a);break;case"message":this.emitReserved("data",i.data),this.emitReserved("message",i.data);break}}onHandshake(i){this.emitReserved("handshake",i),this.id=i.sid,this.transport.query.sid=i.sid,this._pingInterval=i.pingInterval,this._pingTimeout=i.pingTimeout,this._maxPayload=i.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const i=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+i,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},i),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const i=this._getWritablePackets();this.transport.send(i),this._prevBufferLen=i.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let a=1;for(let c=0;c<this.writeBuffer.length;c++){const p=this.writeBuffer[c].data;if(p&&(a+=Zre(p)),c>0&&a>this._maxPayload)return this.writeBuffer.slice(0,c);a+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const i=Date.now()>this._pingTimeoutTime;return i&&(this._pingTimeoutTime=0,_b(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),i}write(i,a,c){return this._sendPacket("message",i,a,c),this}send(i,a,c){return this._sendPacket("message",i,a,c),this}_sendPacket(i,a,c,p){if(typeof a=="function"&&(p=a,a=void 0),typeof c=="function"&&(p=c,c=null),this.readyState==="closing"||this.readyState==="closed")return;c=c||{},c.compress=c.compress!==!1;const _={type:i,data:a,options:c};this.emitReserved("packetCreate",_),this.writeBuffer.push(_),p&&this.once("flush",p),this.flush()}close(){const i=()=>{this._onClose("forced close"),this.transport.close()},a=()=>{this.off("upgrade",a),this.off("upgradeError",a),i()},c=()=>{this.once("upgrade",a),this.once("upgradeError",a)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?c():i()}):this.upgrading?c():i()),this}_onError(i){if(Rd.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",i),this._onClose("transport error",i)}_onClose(i,a){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),VP&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const c=IC.indexOf(this._offlineEventListener);c!==-1&&IC.splice(c,1)}this.readyState="closed",this.id=null,this.emitReserved("close",i,a),this.writeBuffer=[],this._prevBufferLen=0}}}Rd.protocol=DW;class Ese extends Rd{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let i=0;i<this._upgrades.length;i++)this._probe(this._upgrades[i])}_probe(i){let a=this.createTransport(i),c=!1;Rd.priorWebsocketSuccess=!1;const p=()=>{c||(a.send([{type:"ping",data:"probe"}]),a.once("packet",L=>{if(!c)if(L.type==="pong"&&L.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",a),!a)return;Rd.priorWebsocketSuccess=a.name==="websocket",this.transport.pause(()=>{c||this.readyState!=="closed"&&(D(),this.setTransport(a),a.send([{type:"upgrade"}]),this.emitReserved("upgrade",a),a=null,this.upgrading=!1,this.flush())})}else{const j=new Error("probe error");j.transport=a.name,this.emitReserved("upgradeError",j)}}))};function _(){c||(c=!0,D(),a.close(),a=null)}const y=L=>{const j=new Error("probe error: "+L);j.transport=a.name,_(),this.emitReserved("upgradeError",j)};function T(){y("transport closed")}function C(){y("socket closed")}function I(L){a&&L.name!==a.name&&_()}const D=()=>{a.removeListener("open",p),a.removeListener("error",y),a.removeListener("close",T),this.off("close",C),this.off("upgrading",I)};a.once("open",p),a.once("error",y),a.once("close",T),this.once("close",C),this.once("upgrading",I),this._upgrades.indexOf("webtransport")!==-1&&i!=="webtransport"?this.setTimeoutFn(()=>{c||a.open()},200):a.open()}onHandshake(i){this._upgrades=this._filterUpgrades(i.upgrades),super.onHandshake(i)}_filterUpgrades(i){const a=[];for(let c=0;c<i.length;c++)~this.transports.indexOf(i[c])&&a.push(i[c]);return a}}let yse=class extends Ese{constructor(i,a={}){const c=typeof i=="object"?i:a;(!c.transports||c.transports&&typeof c.transports[0]=="string")&&(c.transports=(c.transports||["polling","websocket","webtransport"]).map(p=>pse[p]).filter(p=>!!p)),super(i,c)}};function vse(s,i="",a){let c=s;a=a||typeof location<"u"&&location,s==null&&(s=a.protocol+"//"+a.host),typeof s=="string"&&(s.charAt(0)==="/"&&(s.charAt(1)==="/"?s=a.protocol+s:s=a.host+s),/^(https?|wss?):\/\//.test(s)||(typeof a<"u"?s=a.protocol+"//"+s:s="https://"+s),c=UP(s)),c.port||(/^(http|ws)$/.test(c.protocol)?c.port="80":/^(http|ws)s$/.test(c.protocol)&&(c.port="443")),c.path=c.path||"/";const _=c.host.indexOf(":")!==-1?"["+c.host+"]":c.host;return c.id=c.protocol+"://"+_+":"+c.port+i,c.href=c.protocol+"://"+_+(a&&a.port===c.port?"":":"+c.port),c}const Sse=typeof ArrayBuffer=="function",Tse=s=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(s):s.buffer instanceof ArrayBuffer,VW=Object.prototype.toString,Rse=typeof Blob=="function"||typeof Blob<"u"&&VW.call(Blob)==="[object BlobConstructor]",wse=typeof File=="function"||typeof File<"u"&&VW.call(File)==="[object FileConstructor]";function LD(s){return Sse&&(s instanceof ArrayBuffer||Tse(s))||Rse&&s instanceof Blob||wse&&s instanceof File}function OC(s,i){if(!s||typeof s!="object")return!1;if(Array.isArray(s)){for(let a=0,c=s.length;a<c;a++)if(OC(s[a]))return!0;return!1}if(LD(s))return!0;if(s.toJSON&&typeof s.toJSON=="function"&&arguments.length===1)return OC(s.toJSON(),!0);for(const a in s)if(Object.prototype.hasOwnProperty.call(s,a)&&OC(s[a]))return!0;return!1}function Cse(s){const i=[],a=s.data,c=s;return c.data=FP(a,i),c.attachments=i.length,{packet:c,buffers:i}}function FP(s,i){if(!s)return s;if(LD(s)){const a={_placeholder:!0,num:i.length};return i.push(s),a}else if(Array.isArray(s)){const a=new Array(s.length);for(let c=0;c<s.length;c++)a[c]=FP(s[c],i);return a}else if(typeof s=="object"&&!(s instanceof Date)){const a={};for(const c in s)Object.prototype.hasOwnProperty.call(s,c)&&(a[c]=FP(s[c],i));return a}return s}function bse(s,i){return s.data=BP(s.data,i),delete s.attachments,s}function BP(s,i){if(!s)return s;if(s&&s._placeholder===!0){if(typeof s.num=="number"&&s.num>=0&&s.num<i.length)return i[s.num];throw new Error("illegal attachments")}else if(Array.isArray(s))for(let a=0;a<s.length;a++)s[a]=BP(s[a],i);else if(typeof s=="object")for(const a in s)Object.prototype.hasOwnProperty.call(s,a)&&(s[a]=BP(s[a],i));return s}const Ase=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Ise=5;var gn;(function(s){s[s.CONNECT=0]="CONNECT",s[s.DISCONNECT=1]="DISCONNECT",s[s.EVENT=2]="EVENT",s[s.ACK=3]="ACK",s[s.CONNECT_ERROR=4]="CONNECT_ERROR",s[s.BINARY_EVENT=5]="BINARY_EVENT",s[s.BINARY_ACK=6]="BINARY_ACK"})(gn||(gn={}));class Ose{constructor(i){this.replacer=i}encode(i){return(i.type===gn.EVENT||i.type===gn.ACK)&&OC(i)?this.encodeAsBinary({type:i.type===gn.EVENT?gn.BINARY_EVENT:gn.BINARY_ACK,nsp:i.nsp,data:i.data,id:i.id}):[this.encodeAsString(i)]}encodeAsString(i){let a=""+i.type;return(i.type===gn.BINARY_EVENT||i.type===gn.BINARY_ACK)&&(a+=i.attachments+"-"),i.nsp&&i.nsp!=="/"&&(a+=i.nsp+","),i.id!=null&&(a+=i.id),i.data!=null&&(a+=JSON.stringify(i.data,this.replacer)),a}encodeAsBinary(i){const a=Cse(i),c=this.encodeAsString(a.packet),p=a.buffers;return p.unshift(c),p}}function n5(s){return Object.prototype.toString.call(s)==="[object Object]"}class xD extends $i{constructor(i){super(),this.reviver=i}add(i){let a;if(typeof i=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");a=this.decodeString(i);const c=a.type===gn.BINARY_EVENT;c||a.type===gn.BINARY_ACK?(a.type=c?gn.EVENT:gn.ACK,this.reconstructor=new Nse(a),a.attachments===0&&super.emitReserved("decoded",a)):super.emitReserved("decoded",a)}else if(LD(i)||i.base64)if(this.reconstructor)a=this.reconstructor.takeBinaryData(i),a&&(this.reconstructor=null,super.emitReserved("decoded",a));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+i)}decodeString(i){let a=0;const c={type:Number(i.charAt(0))};if(gn[c.type]===void 0)throw new Error("unknown packet type "+c.type);if(c.type===gn.BINARY_EVENT||c.type===gn.BINARY_ACK){const _=a+1;for(;i.charAt(++a)!=="-"&&a!=i.length;);const y=i.substring(_,a);if(y!=Number(y)||i.charAt(a)!=="-")throw new Error("Illegal attachments");c.attachments=Number(y)}if(i.charAt(a+1)==="/"){const _=a+1;for(;++a&&!(i.charAt(a)===","||a===i.length););c.nsp=i.substring(_,a)}else c.nsp="/";const p=i.charAt(a+1);if(p!==""&&Number(p)==p){const _=a+1;for(;++a;){const y=i.charAt(a);if(y==null||Number(y)!=y){--a;break}if(a===i.length)break}c.id=Number(i.substring(_,a+1))}if(i.charAt(++a)){const _=this.tryParse(i.substr(a));if(xD.isPayloadValid(c.type,_))c.data=_;else throw new Error("invalid payload")}return c}tryParse(i){try{return JSON.parse(i,this.reviver)}catch{return!1}}static isPayloadValid(i,a){switch(i){case gn.CONNECT:return n5(a);case gn.DISCONNECT:return a===void 0;case gn.CONNECT_ERROR:return typeof a=="string"||n5(a);case gn.EVENT:case gn.BINARY_EVENT:return Array.isArray(a)&&(typeof a[0]=="number"||typeof a[0]=="string"&&Ase.indexOf(a[0])===-1);case gn.ACK:case gn.BINARY_ACK:return Array.isArray(a)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Nse{constructor(i){this.packet=i,this.buffers=[],this.reconPack=i}takeBinaryData(i){if(this.buffers.push(i),this.buffers.length===this.reconPack.attachments){const a=bse(this.reconPack,this.buffers);return this.finishedReconstruction(),a}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Pse=Object.freeze(Object.defineProperty({__proto__:null,Decoder:xD,Encoder:Ose,get PacketType(){return gn},protocol:Ise},Symbol.toStringTag,{value:"Module"}));function Wa(s,i,a){return s.on(i,a),function(){s.off(i,a)}}const Dse=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class FW extends $i{constructor(i,a,c){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=i,this.nsp=a,c&&c.auth&&(this.auth=c.auth),this._opts=Object.assign({},c),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const i=this.io;this.subs=[Wa(i,"open",this.onopen.bind(this)),Wa(i,"packet",this.onpacket.bind(this)),Wa(i,"error",this.onerror.bind(this)),Wa(i,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...i){return i.unshift("message"),this.emit.apply(this,i),this}emit(i,...a){var c,p,_;if(Dse.hasOwnProperty(i))throw new Error('"'+i.toString()+'" is a reserved event name');if(a.unshift(i),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(a),this;const y={type:gn.EVENT,data:a};if(y.options={},y.options.compress=this.flags.compress!==!1,typeof a[a.length-1]=="function"){const D=this.ids++,L=a.pop();this._registerAckCallback(D,L),y.id=D}const T=(p=(c=this.io.engine)===null||c===void 0?void 0:c.transport)===null||p===void 0?void 0:p.writable,C=this.connected&&!(!((_=this.io.engine)===null||_===void 0)&&_._hasPingExpired());return this.flags.volatile&&!T||(C?(this.notifyOutgoingListeners(y),this.packet(y)):this.sendBuffer.push(y)),this.flags={},this}_registerAckCallback(i,a){var c;const p=(c=this.flags.timeout)!==null&&c!==void 0?c:this._opts.ackTimeout;if(p===void 0){this.acks[i]=a;return}const _=this.io.setTimeoutFn(()=>{delete this.acks[i];for(let T=0;T<this.sendBuffer.length;T++)this.sendBuffer[T].id===i&&this.sendBuffer.splice(T,1);a.call(this,new Error("operation has timed out"))},p),y=(...T)=>{this.io.clearTimeoutFn(_),a.apply(this,T)};y.withError=!0,this.acks[i]=y}emitWithAck(i,...a){return new Promise((c,p)=>{const _=(y,T)=>y?p(y):c(T);_.withError=!0,a.push(_),this.emit(i,...a)})}_addToQueue(i){let a;typeof i[i.length-1]=="function"&&(a=i.pop());const c={id:this._queueSeq++,tryCount:0,pending:!1,args:i,flags:Object.assign({fromQueue:!0},this.flags)};i.push((p,..._)=>c!==this._queue[0]?void 0:(p!==null?c.tryCount>this._opts.retries&&(this._queue.shift(),a&&a(p)):(this._queue.shift(),a&&a(null,..._)),c.pending=!1,this._drainQueue())),this._queue.push(c),this._drainQueue()}_drainQueue(i=!1){if(!this.connected||this._queue.length===0)return;const a=this._queue[0];a.pending&&!i||(a.pending=!0,a.tryCount++,this.flags=a.flags,this.emit.apply(this,a.args))}packet(i){i.nsp=this.nsp,this.io._packet(i)}onopen(){typeof this.auth=="function"?this.auth(i=>{this._sendConnectPacket(i)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(i){this.packet({type:gn.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},i):i})}onerror(i){this.connected||this.emitReserved("connect_error",i)}onclose(i,a){this.connected=!1,delete this.id,this.emitReserved("disconnect",i,a),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(i=>{if(!this.sendBuffer.some(c=>String(c.id)===i)){const c=this.acks[i];delete this.acks[i],c.withError&&c.call(this,new Error("socket has been disconnected"))}})}onpacket(i){if(i.nsp===this.nsp)switch(i.type){case gn.CONNECT:i.data&&i.data.sid?this.onconnect(i.data.sid,i.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case gn.EVENT:case gn.BINARY_EVENT:this.onevent(i);break;case gn.ACK:case gn.BINARY_ACK:this.onack(i);break;case gn.DISCONNECT:this.ondisconnect();break;case gn.CONNECT_ERROR:this.destroy();const c=new Error(i.data.message);c.data=i.data.data,this.emitReserved("connect_error",c);break}}onevent(i){const a=i.data||[];i.id!=null&&a.push(this.ack(i.id)),this.connected?this.emitEvent(a):this.receiveBuffer.push(Object.freeze(a))}emitEvent(i){if(this._anyListeners&&this._anyListeners.length){const a=this._anyListeners.slice();for(const c of a)c.apply(this,i)}super.emit.apply(this,i),this._pid&&i.length&&typeof i[i.length-1]=="string"&&(this._lastOffset=i[i.length-1])}ack(i){const a=this;let c=!1;return function(...p){c||(c=!0,a.packet({type:gn.ACK,id:i,data:p}))}}onack(i){const a=this.acks[i.id];typeof a=="function"&&(delete this.acks[i.id],a.withError&&i.data.unshift(null),a.apply(this,i.data))}onconnect(i,a){this.id=i,this.recovered=a&&this._pid===a,this._pid=a,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(i=>this.emitEvent(i)),this.receiveBuffer=[],this.sendBuffer.forEach(i=>{this.notifyOutgoingListeners(i),this.packet(i)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(i=>i()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:gn.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(i){return this.flags.compress=i,this}get volatile(){return this.flags.volatile=!0,this}timeout(i){return this.flags.timeout=i,this}onAny(i){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(i),this}prependAny(i){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(i),this}offAny(i){if(!this._anyListeners)return this;if(i){const a=this._anyListeners;for(let c=0;c<a.length;c++)if(i===a[c])return a.splice(c,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(i){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(i),this}prependAnyOutgoing(i){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(i),this}offAnyOutgoing(i){if(!this._anyOutgoingListeners)return this;if(i){const a=this._anyOutgoingListeners;for(let c=0;c<a.length;c++)if(i===a[c])return a.splice(c,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(i){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const a=this._anyOutgoingListeners.slice();for(const c of a)c.apply(this,i.data)}}}function r_(s){s=s||{},this.ms=s.min||100,this.max=s.max||1e4,this.factor=s.factor||2,this.jitter=s.jitter>0&&s.jitter<=1?s.jitter:0,this.attempts=0}r_.prototype.duration=function(){var s=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var i=Math.random(),a=Math.floor(i*this.jitter*s);s=(Math.floor(i*10)&1)==0?s-a:s+a}return Math.min(s,this.max)|0};r_.prototype.reset=function(){this.attempts=0};r_.prototype.setMin=function(s){this.ms=s};r_.prototype.setMax=function(s){this.max=s};r_.prototype.setJitter=function(s){this.jitter=s};class jP extends $i{constructor(i,a){var c;super(),this.nsps={},this.subs=[],i&&typeof i=="object"&&(a=i,i=void 0),a=a||{},a.path=a.path||"/socket.io",this.opts=a,Eb(this,a),this.reconnection(a.reconnection!==!1),this.reconnectionAttempts(a.reconnectionAttempts||1/0),this.reconnectionDelay(a.reconnectionDelay||1e3),this.reconnectionDelayMax(a.reconnectionDelayMax||5e3),this.randomizationFactor((c=a.randomizationFactor)!==null&&c!==void 0?c:.5),this.backoff=new r_({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(a.timeout==null?2e4:a.timeout),this._readyState="closed",this.uri=i;const p=a.parser||Pse;this.encoder=new p.Encoder,this.decoder=new p.Decoder,this._autoConnect=a.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(i){return arguments.length?(this._reconnection=!!i,i||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(i){return i===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=i,this)}reconnectionDelay(i){var a;return i===void 0?this._reconnectionDelay:(this._reconnectionDelay=i,(a=this.backoff)===null||a===void 0||a.setMin(i),this)}randomizationFactor(i){var a;return i===void 0?this._randomizationFactor:(this._randomizationFactor=i,(a=this.backoff)===null||a===void 0||a.setJitter(i),this)}reconnectionDelayMax(i){var a;return i===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=i,(a=this.backoff)===null||a===void 0||a.setMax(i),this)}timeout(i){return arguments.length?(this._timeout=i,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(i){if(~this._readyState.indexOf("open"))return this;this.engine=new yse(this.uri,this.opts);const a=this.engine,c=this;this._readyState="opening",this.skipReconnect=!1;const p=Wa(a,"open",function(){c.onopen(),i&&i()}),_=T=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",T),i?i(T):this.maybeReconnectOnOpen()},y=Wa(a,"error",_);if(this._timeout!==!1){const T=this._timeout,C=this.setTimeoutFn(()=>{p(),_(new Error("timeout")),a.close()},T);this.opts.autoUnref&&C.unref(),this.subs.push(()=>{this.clearTimeoutFn(C)})}return this.subs.push(p),this.subs.push(y),this}connect(i){return this.open(i)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const i=this.engine;this.subs.push(Wa(i,"ping",this.onping.bind(this)),Wa(i,"data",this.ondata.bind(this)),Wa(i,"error",this.onerror.bind(this)),Wa(i,"close",this.onclose.bind(this)),Wa(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(i){try{this.decoder.add(i)}catch(a){this.onclose("parse error",a)}}ondecoded(i){_b(()=>{this.emitReserved("packet",i)},this.setTimeoutFn)}onerror(i){this.emitReserved("error",i)}socket(i,a){let c=this.nsps[i];return c?this._autoConnect&&!c.active&&c.connect():(c=new FW(this,i,a),this.nsps[i]=c),c}_destroy(i){const a=Object.keys(this.nsps);for(const c of a)if(this.nsps[c].active)return;this._close()}_packet(i){const a=this.encoder.encode(i);for(let c=0;c<a.length;c++)this.engine.write(a[c],i.options)}cleanup(){this.subs.forEach(i=>i()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(i,a){var c;this.cleanup(),(c=this.engine)===null||c===void 0||c.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",i,a),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const i=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const a=this.backoff.duration();this._reconnecting=!0;const c=this.setTimeoutFn(()=>{i.skipReconnect||(this.emitReserved("reconnect_attempt",i.backoff.attempts),!i.skipReconnect&&i.open(p=>{p?(i._reconnecting=!1,i.reconnect(),this.emitReserved("reconnect_error",p)):i.onreconnect()}))},a);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}}onreconnect(){const i=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",i)}}const Qy={};function lv(s,i){typeof s=="object"&&(i=s,s=void 0),i=i||{};const a=vse(s,i.path||"/socket.io"),c=a.source,p=a.id,_=a.path,y=Qy[p]&&_ in Qy[p].nsps,T=i.forceNew||i["force new connection"]||i.multiplex===!1||y;let C;return T?C=new jP(c,i):(Qy[p]||(Qy[p]=new jP(c,i)),C=Qy[p]),a.query&&!i.query&&(i.query=a.queryKey),C.socket(a.path,i)}Object.assign(lv,{Manager:jP,Socket:FW,io:lv,connect:lv});const kse="/",$c=AD((s,i)=>({authUser:null,isSigningUp:!1,isLoggingIn:!1,isUpdatingProfile:!1,isCheckingAuth:!0,onlineUsers:[],socket:null,checkAuth:async()=>{try{const a=await gd.get("/auth/check");s({authUser:a.data}),i().connectSocket()}catch(a){console.log("Error in checkAuth:",a),s({authUser:null})}finally{s({isCheckingAuth:!1})}},signup:async a=>{s({isSigningUp:!0});try{const c=await gd.post("/auth/signup",a);s({authUser:c.data}),Br.success("Account created successfully"),i().connectSocket()}catch(c){Br.error(c.response.data.message)}finally{s({isSigningUp:!1})}},login:async a=>{s({isLoggingIn:!0});try{const c=await gd.post("/auth/login",a);s({authUser:c.data}),Br.success("Logged in successfully"),i().connectSocket()}catch(c){Br.error(c.response.data.message)}finally{s({isLoggingIn:!1})}},logout:async()=>{try{await gd.post("/auth/logout"),s({authUser:null}),Br.success("Logged out successfully"),i().disconnectSocket()}catch(a){Br.error(a.response.data.message)}},updateProfile:async a=>{s({isUpdatingProfile:!0});try{const c=await gd.put("/auth/update-profile",a);s({authUser:c.data}),Br.success("Profile updated successfully")}catch(c){console.log("error in update profile:",c),Br.error(c.response.data.message)}finally{s({isUpdatingProfile:!1})}},connectSocket:()=>{var p;const{authUser:a}=i();if(!a||(p=i().socket)!=null&&p.connected)return;const c=lv(kse,{query:{userId:a._id}});c.connect(),s({socket:c}),c.on("getOnlineUsers",_=>{s({onlineUsers:_})})},disconnectSocket:()=>{var a;(a=i().socket)!=null&&a.connected&&i().socket.disconnect()}}));/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lse=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),BW=(...s)=>s.filter((i,a,c)=>!!i&&i.trim()!==""&&c.indexOf(i)===a).join(" ").trim();/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var xse={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mse=_e.forwardRef(({color:s="currentColor",size:i=24,strokeWidth:a=2,absoluteStrokeWidth:c,className:p="",children:_,iconNode:y,...T},C)=>_e.createElement("svg",{ref:C,...xse,width:i,height:i,stroke:s,strokeWidth:c?Number(a)*24/Number(i):a,className:BW("lucide",p),...T},[...y.map(([I,D])=>_e.createElement(I,D)),...Array.isArray(_)?_:[_]]));/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gr=(s,i)=>{const a=_e.forwardRef(({className:c,...p},_)=>_e.createElement(Mse,{ref:_,iconNode:i,className:BW(`lucide-${Lse(s)}`,c),...p}));return a.displayName=`${s}`,a};/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Use=Gr("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jW=Gr("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GW=Gr("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vse=Gr("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WW=Gr("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fse=Gr("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zW=Gr("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i5=Gr("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MD=Gr("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bse=Gr("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vv=Gr("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r5=Gr("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HW=Gr("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s5=Gr("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ag=Gr("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KW=Gr("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.459.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qW=Gr("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),jse=()=>{const{logout:s,authUser:i}=$c(),a=t_(),[c,p]=_e.useState(!1),[_,y]=_e.useState("text-black"),T=a.pathname==="/"||a.pathname==="/call"||a.pathname==="/list",C=()=>p(!c),I=()=>{const D=document.querySelector("header");if(D){const j=window.getComputedStyle(D).backgroundColor.match(/\d+/g);return(j?.2126*parseInt(j[0])+.7152*parseInt(j[1])+.0722*parseInt(j[2]):255)<128?"dark":"light"}return"light"};return _e.useEffect(()=>{const D=()=>{const L=I();y(L==="dark"?"text-white":"text-black")};return D(),window.addEventListener("resize",D),()=>window.removeEventListener("resize",D)},[]),H.jsxs("header",{className:"bg-base-100 border-b border-base-300 fixed w-full top-0 z-40 backdrop-blur-lg",children:[H.jsxs("div",{className:"container mx-auto px-6 py-4 flex items-center justify-between",children:[H.jsx("div",{className:"flex items-center"}),H.jsxs("div",{className:"hidden sm:flex items-center gap-8",children:[H.jsx(Vr,{to:"/",className:"btn btn-sm gap-2 text-base-content hover:text-primary",children:"Home"}),H.jsxs(Vr,{to:"/list",className:"btn btn-sm gap-2 text-base-content hover:text-primary",children:[H.jsx(Ag,{className:"size-5"}),"Listener"]}),H.jsxs(Vr,{to:"/call",className:"btn btn-sm gap-2 text-base-content hover:text-primary",children:[H.jsx(r5,{className:"size-5"}),"Call"]}),H.jsxs(Vr,{to:"/home",className:"btn btn-sm gap-2 text-base-content hover:text-primary",children:[H.jsx(vv,{className:"size-5"}),"Chatty"]})]}),H.jsx("div",{className:"hidden sm:flex items-center gap-6",children:!T&&H.jsxs(H.Fragment,{children:[H.jsxs(Vr,{to:"/settings",className:"btn btn-sm gap-2 text-base-content hover:text-primary",children:[H.jsx(s5,{className:"size-5"}),"Settings"]}),i&&H.jsxs(H.Fragment,{children:[H.jsxs(Vr,{to:"/profile",className:"btn btn-sm gap-2 text-base-content hover:text-primary",children:[H.jsx(Ag,{className:"size-5"}),"Profile"]}),H.jsxs("button",{onClick:s,className:"btn btn-sm gap-2 bg-red-500 text-white hover:bg-red-600",children:[H.jsx(i5,{className:"size-5"}),"Logout"]})]})]})}),H.jsx("div",{className:"sm:hidden flex items-center gap-4",children:H.jsx("button",{onClick:C,className:"btn btn-sm",children:H.jsx(Bse,{className:`w-6 h-6 ${_} transition-colors`})})})]}),c&&H.jsxs("div",{className:"sm:hidden bg-base-100 w-full p-4 absolute top-16 left-0 flex flex-col gap-4 border-t border-base-300",children:[H.jsx(Vr,{to:"/",className:"btn btn-sm gap-2 text-base-content",onClick:C,children:"Home"}),H.jsxs(Vr,{to:"/list",className:"btn btn-sm gap-2 text-base-content",onClick:C,children:[H.jsx(Ag,{className:"size-5"}),"Listener"]}),H.jsxs(Vr,{to:"/call",className:"btn btn-sm gap-2 text-base-content",onClick:C,children:[H.jsx(r5,{className:"size-5"}),"Call"]}),H.jsxs(Vr,{to:"/home",className:"btn btn-sm gap-2 text-base-content",onClick:C,children:[H.jsx(vv,{className:"size-5"}),"Chatty"]}),i&&H.jsxs(H.Fragment,{children:[H.jsxs(Vr,{to:"/settings",className:"btn btn-sm gap-2 text-base-content",onClick:C,children:[H.jsx(s5,{className:"size-5"}),"Settings"]}),H.jsxs(Vr,{to:"/profile",className:"btn btn-sm gap-2 text-base-content",onClick:C,children:[H.jsx(Ag,{className:"size-5"}),"Profile"]}),H.jsxs("button",{onClick:()=>{s(),C()},className:"btn btn-sm gap-2 bg-red-500 text-white hover:bg-red-600",children:[H.jsx(i5,{className:"size-5"}),"Logout"]})]})]})]})},xv=AD((s,i)=>({messages:[],users:[],selectedUser:null,isUsersLoading:!1,isMessagesLoading:!1,getUsers:async()=>{s({isUsersLoading:!0});try{const a=await gd.get("/messages/users");s({users:a.data})}catch(a){Br.error(a.response.data.message)}finally{s({isUsersLoading:!1})}},getMessages:async a=>{s({isMessagesLoading:!0});try{const c=await gd.get(`/messages/${a}`);s({messages:c.data})}catch(c){Br.error(c.response.data.message)}finally{s({isMessagesLoading:!1})}},sendMessage:async a=>{const{selectedUser:c,messages:p}=i();try{const _=await gd.post(`/messages/send/${c._id}`,a);s({messages:[...p,_.data]})}catch(_){Br.error(_.response.data.message)}},subscribeToMessages:()=>{const{selectedUser:a}=i();if(!a)return;$c.getState().socket.on("newMessage",p=>{p.senderId===a._id&&s({messages:[...i().messages,p]})})},unsubscribeFromMessages:()=>{$c.getState().socket.off("newMessage")},setSelectedUser:a=>s({selectedUser:a})})),Gse=()=>{const s=Array(8).fill(null);return H.jsxs("aside",{className:`h-full w-20 lg:w-72 border-r border-base-300 
    flex flex-col transition-all duration-200`,children:[H.jsx("div",{className:"border-b border-base-300 w-full p-5",children:H.jsxs("div",{className:"flex items-center gap-2",children:[H.jsx(KW,{className:"w-6 h-6"}),H.jsx("span",{className:"font-medium hidden lg:block",children:"Contacts"})]})}),H.jsx("div",{className:"overflow-y-auto w-full py-3",children:s.map((i,a)=>H.jsxs("div",{className:"w-full p-3 flex items-center gap-3",children:[H.jsx("div",{className:"relative mx-auto lg:mx-0",children:H.jsx("div",{className:"skeleton size-12 rounded-full"})}),H.jsxs("div",{className:"hidden lg:block text-left min-w-0 flex-1",children:[H.jsx("div",{className:"skeleton h-4 w-32 mb-2"}),H.jsx("div",{className:"skeleton h-3 w-16"})]})]},a))})]})},Wse=()=>{const{getUsers:s,users:i,selectedUser:a,setSelectedUser:c,isUsersLoading:p}=xv(),{onlineUsers:_}=$c(),[y,T]=_e.useState(!1);_e.useEffect(()=>{s()},[s]);const C=y?i.filter(I=>_.includes(I._id)):i;return p?H.jsx(Gse,{}):H.jsxs("aside",{className:"h-full w-20 lg:w-72 border-r border-base-300 flex flex-col transition-all duration-200",children:[H.jsxs("div",{className:"border-b border-base-300 w-full p-5",children:[H.jsxs("div",{className:"flex items-center gap-2",children:[H.jsx(KW,{className:"size-6"}),H.jsx("span",{className:"font-medium hidden lg:block",children:"Contacts"})]}),H.jsxs("div",{className:"mt-3 hidden lg:flex items-center gap-2",children:[H.jsxs("label",{className:"cursor-pointer flex items-center gap-2",children:[H.jsx("input",{type:"checkbox",checked:y,onChange:I=>T(I.target.checked),className:"checkbox checkbox-sm"}),H.jsx("span",{className:"text-sm",children:"Show online only"})]}),H.jsxs("span",{className:"text-xs text-zinc-500",children:["(",_.length-1," online)"]})]})]}),H.jsxs("div",{className:"overflow-y-auto w-full py-3",children:[C.map(I=>H.jsxs("button",{onClick:()=>c(I),className:`
              w-full p-3 flex items-center gap-3
              hover:bg-base-300 transition-colors
              ${(a==null?void 0:a._id)===I._id?"bg-base-300 ring-1 ring-base-300":""}
            `,children:[H.jsxs("div",{className:"relative mx-auto lg:mx-0",children:[H.jsx("img",{src:I.profilePic||"/avatar.png",alt:I.name,className:"size-12 object-cover rounded-full"}),_.includes(I._id)&&H.jsx("span",{className:`absolute bottom-0 right-0 size-3 bg-green-500 
                  rounded-full ring-2 ring-zinc-900`})]}),H.jsxs("div",{className:"hidden lg:block text-left min-w-0",children:[H.jsx("div",{className:"font-medium truncate",children:I.fullName}),H.jsx("div",{className:"text-sm text-zinc-400",children:_.includes(I._id)?"Online":"Offline"})]})]},I._id)),C.length===0&&H.jsx("div",{className:"text-center text-zinc-500 py-4",children:"No online users"})]})]})},zse=()=>H.jsx("div",{className:"w-full flex flex-1 flex-col items-center justify-center p-16 bg-base-100/50",children:H.jsxs("div",{className:"max-w-md text-center space-y-6",children:[H.jsx("div",{className:"flex justify-center gap-4 mb-4",children:H.jsx("div",{className:"relative",children:H.jsx("div",{className:`w-16 h-16 rounded-2xl bg-primary/10 flex items-center
             justify-center animate-bounce`,children:H.jsx(vv,{className:"w-8 h-8 text-primary "})})})}),H.jsx("h2",{className:"text-2xl font-bold",children:"Welcome to Chatty!"}),H.jsx("p",{className:"text-base-content/60",children:"Select a conversation from the sidebar to start chatting"})]})}),o5=()=>{const{selectedUser:s,setSelectedUser:i}=xv(),{onlineUsers:a}=$c();return H.jsx("div",{className:"p-2.5 border-b border-base-300",children:H.jsxs("div",{className:"flex items-center justify-between",children:[H.jsxs("div",{className:"flex items-center gap-3",children:[H.jsx("div",{className:"avatar",children:H.jsx("div",{className:"size-10 rounded-full relative",children:H.jsx("img",{src:s.profilePic||"/avatar.png",alt:s.fullName})})}),H.jsxs("div",{children:[H.jsx("h3",{className:"font-medium",children:s.fullName}),H.jsx("p",{className:"text-sm text-base-content/70",children:a.includes(s._id)?"Online":"Offline"})]})]}),H.jsx("button",{onClick:()=>i(null),children:H.jsx(qW,{})})]})})},a5=()=>{const[s,i]=_e.useState(""),[a,c]=_e.useState(null),p=_e.useRef(null),{sendMessage:_}=xv(),y=I=>{const D=I.target.files[0];if(!D.type.startsWith("image/")){Br.error("Please select an image file");return}const L=new FileReader;L.onloadend=()=>{c(L.result)},L.readAsDataURL(D)},T=()=>{c(null),p.current&&(p.current.value="")},C=async I=>{if(I.preventDefault(),!(!s.trim()&&!a))try{await _({text:s.trim(),image:a}),i(""),c(null),p.current&&(p.current.value="")}catch(D){console.error("Failed to send message:",D)}};return H.jsxs("div",{className:"p-4 w-full",children:[a&&H.jsx("div",{className:"mb-3 flex items-center gap-2",children:H.jsxs("div",{className:"relative",children:[H.jsx("img",{src:a,alt:"Preview",className:"w-20 h-20 object-cover rounded-lg border border-zinc-700"}),H.jsx("button",{onClick:T,className:`absolute -top-1.5 -right-1.5 w-5 h-5 rounded-full bg-base-300
              flex items-center justify-center`,type:"button",children:H.jsx(qW,{className:"size-3"})})]})}),H.jsxs("form",{onSubmit:C,className:"flex items-center gap-2",children:[H.jsxs("div",{className:"flex-1 flex gap-2",children:[H.jsx("input",{type:"text",className:"w-full input input-bordered rounded-lg input-sm sm:input-md",placeholder:"Type a message...",value:s,onChange:I=>i(I.target.value)}),H.jsx("input",{type:"file",accept:"image/*",className:"hidden",ref:p,onChange:y}),H.jsx("button",{type:"button",className:`hidden sm:flex btn btn-circle
                     ${a?"text-emerald-500":"text-zinc-400"}`,onClick:()=>{var I;return(I=p.current)==null?void 0:I.click()},children:H.jsx(Vse,{size:20})})]}),H.jsx("button",{type:"submit",className:"btn btn-sm btn-circle",disabled:!s.trim()&&!a,children:H.jsx(HW,{size:22})})]})]})},Hse=()=>{const s=Array(6).fill(null);return H.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:s.map((i,a)=>H.jsxs("div",{className:`chat ${a%2===0?"chat-start":"chat-end"}`,children:[H.jsx("div",{className:"chat-image avatar",children:H.jsx("div",{className:"size-10 rounded-full",children:H.jsx("div",{className:"skeleton w-full h-full rounded-full"})})}),H.jsx("div",{className:"chat-header mb-1",children:H.jsx("div",{className:"skeleton h-4 w-16"})}),H.jsx("div",{className:"chat-bubble bg-transparent p-0",children:H.jsx("div",{className:"skeleton h-16 w-[200px]"})})]},a))})};function Kse(s){return new Date(s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})}const qse=()=>{const{messages:s,getMessages:i,isMessagesLoading:a,selectedUser:c,subscribeToMessages:p,unsubscribeFromMessages:_}=xv(),{authUser:y}=$c(),T=_e.useRef(null);return _e.useEffect(()=>(i(c._id),p(),()=>_()),[c._id,i,p,_]),_e.useEffect(()=>{T.current&&s&&T.current.scrollIntoView({behavior:"smooth"})},[s]),a?H.jsxs("div",{className:"flex-1 flex flex-col overflow-auto",children:[H.jsx(o5,{}),H.jsx(Hse,{}),H.jsx(a5,{})]}):H.jsxs("div",{className:"flex-1 flex flex-col overflow-auto",children:[H.jsx(o5,{}),H.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:s.map(C=>H.jsxs("div",{className:`chat ${C.senderId===y._id?"chat-end":"chat-start"}`,ref:T,children:[H.jsx("div",{className:" chat-image avatar",children:H.jsx("div",{className:"size-10 rounded-full border",children:H.jsx("img",{src:C.senderId===y._id?y.profilePic||"/avatar.png":c.profilePic||"/avatar.png",alt:"profile pic"})})}),H.jsx("div",{className:"chat-header mb-1",children:H.jsx("time",{className:"text-xs opacity-50 ml-1",children:Kse(C.createdAt)})}),H.jsxs("div",{className:"chat-bubble flex flex-col",children:[C.image&&H.jsx("img",{src:C.image,alt:"Attachment",className:"sm:max-w-[200px] rounded-md mb-2"}),C.text&&H.jsx("p",{children:C.text})]})]},C._id))}),H.jsx(a5,{})]})},Yse=()=>{const{selectedUser:s}=xv();return H.jsx("div",{className:"h-screen bg-base-200",children:H.jsx("div",{className:"flex items-center justify-center pt-20 px-4",children:H.jsx("div",{className:"bg-base-100 rounded-lg shadow-cl w-full max-w-6xl h-[calc(100vh-8rem)]",children:H.jsxs("div",{className:"flex h-full rounded-lg overflow-hidden",children:[H.jsx(Wse,{}),s?H.jsx(qse,{}):H.jsx(zse,{})]})})})})},YW=({title:s,subtitle:i})=>H.jsx("div",{className:"hidden lg:flex items-center justify-center bg-base-200 p-12",children:H.jsxs("div",{className:"max-w-md text-center",children:[H.jsx("div",{className:"grid grid-cols-3 gap-3 mb-8",children:[...Array(9)].map((a,c)=>H.jsx("div",{className:`aspect-square rounded-2xl bg-primary/10 ${c%2===0?"animate-pulse":""}`},c))}),H.jsx("h2",{className:"text-2xl font-bold mb-4",children:s}),H.jsx("p",{className:"text-base-content/60",children:i})]})}),Xse=()=>{const[s,i]=_e.useState(!1),[a,c]=_e.useState({fullName:"",email:"",password:""}),{signup:p,isSigningUp:_}=$c(),y=()=>a.fullName.trim()?a.email.trim()?/\S+@\S+\.\S+/.test(a.email)?a.password?a.password.length<6?Br.error("Password must be at least 6 characters"):!0:Br.error("Password is required"):Br.error("Invalid email format"):Br.error("Email is required"):Br.error("Full name is required"),T=C=>{C.preventDefault(),y()===!0&&p(a)};return H.jsxs("div",{className:"flex flex-col justify-center items-center p-6 sm:p-12 pt-20 sm:pt-12",children:[H.jsx("div",{className:"flex flex-col justify-center items-center p-6 sm:p-12",children:H.jsxs("div",{className:"w-full max-w-md space-y-8",children:[H.jsx("div",{className:"text-center mb-8",children:H.jsxs("div",{className:"flex flex-col items-center gap-2 group",children:[H.jsx("div",{className:`size-12 rounded-xl bg-primary/10 flex items-center justify-center 
              group-hover:bg-primary/20 transition-colors`,children:H.jsx(vv,{className:"size-6 text-primary"})}),H.jsx("h1",{className:"text-2xl font-bold mt-2",children:"Create Account"}),H.jsx("p",{className:"text-base-content/60",children:"Get started with your free account"})]})}),H.jsxs("form",{onSubmit:T,className:"space-y-6",children:[H.jsxs("div",{className:"form-control",children:[H.jsx("label",{className:"label",children:H.jsx("span",{className:"label-text font-medium",children:"Full Name"})}),H.jsxs("div",{className:"relative",children:[H.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:H.jsx(Ag,{className:"size-5 text-base-content/40"})}),H.jsx("input",{type:"text",className:"input input-bordered w-full pl-10",placeholder:"John Doe",value:a.fullName,onChange:C=>c({...a,fullName:C.target.value})})]})]}),H.jsxs("div",{className:"form-control",children:[H.jsx("label",{className:"label",children:H.jsx("span",{className:"label-text font-medium",children:"Email"})}),H.jsxs("div",{className:"relative",children:[H.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:H.jsx(MD,{className:"size-5 text-base-content/40"})}),H.jsx("input",{type:"email",className:"input input-bordered w-full pl-10",placeholder:"you@example.com",value:a.email,onChange:C=>c({...a,email:C.target.value})})]})]}),H.jsxs("div",{className:"form-control",children:[H.jsx("label",{className:"label",children:H.jsx("span",{className:"label-text font-medium",children:"Password"})}),H.jsxs("div",{className:"relative",children:[H.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:H.jsx(zW,{className:"size-5 text-base-content/40"})}),H.jsx("input",{type:s?"text":"password",className:"input input-bordered w-full pl-10",placeholder:"",value:a.password,onChange:C=>c({...a,password:C.target.value})}),H.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>i(!s),children:s?H.jsx(jW,{className:"size-5 text-base-content/40"}):H.jsx(GW,{className:"size-5 text-base-content/40"})})]})]}),H.jsx("button",{type:"submit",className:"btn btn-primary w-full",disabled:_,children:_?H.jsxs(H.Fragment,{children:[H.jsx(WW,{className:"size-5 animate-spin"}),"Loading..."]}):"Create Account"})]}),H.jsx("div",{className:"text-center",children:H.jsxs("p",{className:"text-base-content/60",children:["Already have an account?"," ",H.jsx(Vr,{to:"/login",className:"link link-primary",children:"Sign in"})]})})]})}),H.jsx(YW,{title:"Join our community",subtitle:"Connect with friends, share moments, and stay in touch with your loved ones."})]})},Jse=()=>{const[s,i]=_e.useState(!1),[a,c]=_e.useState({email:"",password:""}),{login:p,isLoggingIn:_}=$c(),y=async T=>{T.preventDefault(),p(a)};return H.jsxs("div",{className:"flex flex-col justify-center items-center p-6 sm:p-12 pt-20 sm:pt-12",children:[H.jsx("div",{className:"flex flex-col justify-center items-center p-6 sm:p-12",children:H.jsxs("div",{className:"w-full max-w-md space-y-8",children:[H.jsx("div",{className:"text-center mb-8",children:H.jsxs("div",{className:"flex flex-col items-center gap-2 group",children:[H.jsx("div",{className:`w-12 h-12 rounded-xl bg-primary/10 flex items-center justify-center group-hover:bg-primary/20
              transition-colors`,children:H.jsx(vv,{className:"w-6 h-6 text-primary"})}),H.jsx("h1",{className:"text-2xl font-bold mt-2",children:"Welcome Back"}),H.jsx("p",{className:"text-base-content/60",children:"Sign in to your account"})]})}),H.jsxs("form",{onSubmit:y,className:"space-y-6",children:[H.jsxs("div",{className:"form-control",children:[H.jsx("label",{className:"label",children:H.jsx("span",{className:"label-text font-medium",children:"Email"})}),H.jsxs("div",{className:"relative",children:[H.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:H.jsx(MD,{className:"h-5 w-5 text-base-content/40"})}),H.jsx("input",{type:"email",className:"input input-bordered w-full pl-10",placeholder:"you@example.com",value:a.email,onChange:T=>c({...a,email:T.target.value})})]})]}),H.jsxs("div",{className:"form-control",children:[H.jsx("label",{className:"label",children:H.jsx("span",{className:"label-text font-medium",children:"Password"})}),H.jsxs("div",{className:"relative",children:[H.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:H.jsx(zW,{className:"h-5 w-5 text-base-content/40"})}),H.jsx("input",{type:s?"text":"password",className:"input input-bordered w-full pl-10",placeholder:"",value:a.password,onChange:T=>c({...a,password:T.target.value})}),H.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>i(!s),children:s?H.jsx(jW,{className:"h-5 w-5 text-base-content/40"}):H.jsx(GW,{className:"h-5 w-5 text-base-content/40"})})]})]}),H.jsx("button",{type:"submit",className:"btn btn-primary w-full",disabled:_,children:_?H.jsxs(H.Fragment,{children:[H.jsx(WW,{className:"h-5 w-5 animate-spin"}),"Loading..."]}):"Sign in"})]}),H.jsx("div",{className:"text-center",children:H.jsxs("p",{className:"text-base-content/60",children:["Don't have an account?"," ",H.jsx(Vr,{to:"/signup",className:"link link-primary",children:"Create account"})]})})]})}),H.jsx(YW,{title:"Welcome back!",subtitle:"Sign in to continue your conversations and catch up with your messages."})]})},$se=["light","dark","cupcake","bumblebee","emerald","corporate","synthwave","retro","cyberpunk","valentine","halloween","garden","forest","aqua","lofi","pastel","fantasy","wireframe","black","luxury","dracula","cmyk","autumn","business","acid","lemonade","night","coffee","winter","dim","nord","sunset"],XW=AD(s=>({theme:localStorage.getItem("chat-theme")||"coffee",setTheme:i=>{localStorage.setItem("chat-theme",i),s({theme:i})}})),Qse=[{id:1,content:"Hey! How's it going?",isSent:!1},{id:2,content:"I'm doing great! Just working on some new features.",isSent:!0}],Zse=()=>{const{theme:s,setTheme:i}=XW();return H.jsx("div",{className:"h-screen container mx-auto px-4 pt-20 max-w-5xl",children:H.jsxs("div",{className:"space-y-6",children:[H.jsxs("div",{className:"flex flex-col gap-1",children:[H.jsx("h2",{className:"text-lg font-semibold",children:"Theme"}),H.jsx("p",{className:"text-sm text-base-content/70",children:"Choose a theme for your chat interface"})]}),H.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-2",children:$se.map(a=>H.jsxs("button",{className:`
                group flex flex-col items-center gap-1.5 p-2 rounded-lg transition-colors
                ${s===a?"bg-base-200":"hover:bg-base-200/50"}
              `,onClick:()=>i(a),children:[H.jsx("div",{className:"relative h-8 w-full rounded-md overflow-hidden","data-theme":a,children:H.jsxs("div",{className:"absolute inset-0 grid grid-cols-4 gap-px p-1",children:[H.jsx("div",{className:"rounded bg-primary"}),H.jsx("div",{className:"rounded bg-secondary"}),H.jsx("div",{className:"rounded bg-accent"}),H.jsx("div",{className:"rounded bg-neutral"})]})}),H.jsx("span",{className:"text-[11px] font-medium truncate w-full text-center",children:a.charAt(0).toUpperCase()+a.slice(1)})]},a))}),H.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Preview"}),H.jsx("div",{className:"rounded-xl border border-base-300 overflow-hidden bg-base-100 shadow-lg",children:H.jsx("div",{className:"p-4 bg-base-200",children:H.jsx("div",{className:"max-w-lg mx-auto",children:H.jsxs("div",{className:"bg-base-100 rounded-xl shadow-sm overflow-hidden",children:[H.jsx("div",{className:"px-4 py-3 border-b border-base-300 bg-base-100",children:H.jsxs("div",{className:"flex items-center gap-3",children:[H.jsx("div",{className:"w-8 h-8 rounded-full bg-primary flex items-center justify-center text-primary-content font-medium",children:"J"}),H.jsxs("div",{children:[H.jsx("h3",{className:"font-medium text-sm",children:"John Doe"}),H.jsx("p",{className:"text-xs text-base-content/70",children:"Online"})]})]})}),H.jsx("div",{className:"p-4 space-y-4 min-h-[200px] max-h-[200px] overflow-y-auto bg-base-100",children:Qse.map(a=>H.jsx("div",{className:`flex ${a.isSent?"justify-end":"justify-start"}`,children:H.jsxs("div",{className:`
                          max-w-[80%] rounded-xl p-3 shadow-sm
                          ${a.isSent?"bg-primary text-primary-content":"bg-base-200"}
                        `,children:[H.jsx("p",{className:"text-sm",children:a.content}),H.jsx("p",{className:`
                            text-[10px] mt-1.5
                            ${a.isSent?"text-primary-content/70":"text-base-content/70"}
                          `,children:"12:00 PM"})]})},a.id))}),H.jsx("div",{className:"p-4 border-t border-base-300 bg-base-100",children:H.jsxs("div",{className:"flex gap-2",children:[H.jsx("input",{type:"text",className:"input input-bordered flex-1 text-sm h-10",placeholder:"Type a message...",value:"This is a preview",readOnly:!0}),H.jsx("button",{className:"btn btn-primary h-10 min-h-0",children:H.jsx(HW,{size:18})})]})})]})})})})]})})},eoe=()=>{var y;const{authUser:s,isUpdatingProfile:i,updateProfile:a}=$c(),[c,p]=_e.useState(null),_=async T=>{const C=T.target.files[0];if(!C)return;const I=new FileReader;I.readAsDataURL(C),I.onload=async()=>{const D=I.result;p(D),await a({profilePic:D})}};return H.jsx("div",{className:"bg-gradient-to-r from-indigo-800 via-purple-700 to-pink-600 min-h-screen flex items-center justify-center pt-24 overflow-y-auto",children:H.jsxs("div",{className:"max-w-lg w-full p-8 bg-white rounded-2xl shadow-lg border border-gray-200",children:[H.jsxs("div",{className:"text-center mb-8",children:[H.jsx("h1",{className:"text-3xl font-semibold text-gray-800",children:"Profile"}),H.jsx("p",{className:"text-lg text-gray-500 mt-2",children:"Manage your personal information"})]}),H.jsxs("div",{className:"flex flex-col items-center gap-4 mb-6",children:[H.jsxs("div",{className:"relative",children:[H.jsx("img",{src:c||s.profilePic||"/avatar.png",alt:"Profile",className:"w-36 h-36 rounded-full object-cover border-4 border-indigo-600 shadow-xl transition-all duration-300 hover:scale-105"}),H.jsxs("label",{htmlFor:"avatar-upload",className:`absolute bottom-0 right-0 bg-indigo-600 p-3 rounded-full cursor-pointer 
                ${i?"animate-pulse pointer-events-none":""}`,children:[H.jsx(Use,{className:"w-6 h-6 text-white"}),H.jsx("input",{type:"file",id:"avatar-upload",className:"hidden",accept:"image/*",onChange:_,disabled:i})]})]}),H.jsx("p",{className:"text-sm text-gray-400",children:i?"Uploading...":"Click the camera icon to update your photo"})]}),H.jsxs("div",{className:"space-y-6",children:[H.jsxs("div",{className:"space-y-1.5",children:[H.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-2",children:[H.jsx(Ag,{className:"w-4 h-4"}),"Full Name"]}),H.jsx("p",{className:"px-4 py-2.5 bg-gray-50 rounded-lg border text-gray-700",children:s==null?void 0:s.fullName})]}),H.jsxs("div",{className:"space-y-1.5",children:[H.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-2",children:[H.jsx(MD,{className:"w-4 h-4"}),"Email Address"]}),H.jsx("p",{className:"px-4 py-2.5 bg-gray-50 rounded-lg border text-gray-700",children:s==null?void 0:s.email})]})]}),H.jsxs("div",{className:"mt-8 bg-gray-50 p-6 rounded-xl shadow-sm",children:[H.jsx("h2",{className:"text-lg font-medium text-gray-800 mb-4",children:"Account Information"}),H.jsxs("div",{className:"space-y-3 text-sm text-gray-600",children:[H.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-300",children:[H.jsx("span",{children:"Member Since"}),H.jsx("span",{children:(y=s.createdAt)==null?void 0:y.split("T")[0]})]}),H.jsxs("div",{className:"flex items-center justify-between py-2",children:[H.jsx("span",{children:"Account Status"}),H.jsx("span",{className:"text-green-500 font-semibold",children:"Active"})]})]})]}),H.jsx("div",{className:"mt-8 flex justify-between items-center space-x-4",children:H.jsx("button",{onClick:()=>{},className:"w-full bg-blue-600 text-white py-2 rounded-xl text-lg font-semibold transition-all duration-300 hover:bg-blue-700",children:"Save Changes"})})]})})};var JW={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},c5=sa.createContext&&sa.createContext(JW),toe=["attr","size","title"];function noe(s,i){if(s==null)return{};var a=ioe(s,i),c,p;if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(s);for(p=0;p<_.length;p++)c=_[p],!(i.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(s,c)&&(a[c]=s[c])}return a}function ioe(s,i){if(s==null)return{};var a={};for(var c in s)if(Object.prototype.hasOwnProperty.call(s,c)){if(i.indexOf(c)>=0)continue;a[c]=s[c]}return a}function WC(){return WC=Object.assign?Object.assign.bind():function(s){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(s[c]=a[c])}return s},WC.apply(this,arguments)}function l5(s,i){var a=Object.keys(s);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(s);i&&(c=c.filter(function(p){return Object.getOwnPropertyDescriptor(s,p).enumerable})),a.push.apply(a,c)}return a}function zC(s){for(var i=1;i<arguments.length;i++){var a=arguments[i]!=null?arguments[i]:{};i%2?l5(Object(a),!0).forEach(function(c){roe(s,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(a)):l5(Object(a)).forEach(function(c){Object.defineProperty(s,c,Object.getOwnPropertyDescriptor(a,c))})}return s}function roe(s,i,a){return i=soe(i),i in s?Object.defineProperty(s,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):s[i]=a,s}function soe(s){var i=ooe(s,"string");return typeof i=="symbol"?i:i+""}function ooe(s,i){if(typeof s!="object"||!s)return s;var a=s[Symbol.toPrimitive];if(a!==void 0){var c=a.call(s,i);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(s)}function $W(s){return s&&s.map((i,a)=>sa.createElement(i.tag,zC({key:a},i.attr),$W(i.child)))}function ou(s){return i=>sa.createElement(aoe,WC({attr:zC({},s.attr)},i),$W(s.child))}function aoe(s){var i=a=>{var{attr:c,size:p,title:_}=s,y=noe(s,toe),T=p||a.size||"1em",C;return a.className&&(C=a.className),s.className&&(C=(C?C+" ":"")+s.className),sa.createElement("svg",WC({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},a.attr,c,y,{className:C,style:zC(zC({color:s.color||a.color},a.style),s.style),height:T,width:T,xmlns:"http://www.w3.org/2000/svg"}),_&&sa.createElement("title",null,_),s.children)};return c5!==void 0?sa.createElement(c5.Consumer,null,a=>i(a)):i(JW)}function coe(s){return ou({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M416 192c0-88.4-93.1-160-208-160S0 103.6 0 192c0 34.3 14.1 65.9 38 92-13.4 30.2-35.5 54.2-35.8 54.5-2.2 2.3-2.8 5.7-1.5 8.7S4.8 352 8 352c36.6 0 66.9-12.3 88.7-25 32.2 15.7 70.3 25 111.3 25 114.9 0 208-71.6 208-160zm122 220c23.9-26 38-57.7 38-92 0-66.9-53.5-124.2-129.3-148.1.9 6.6 1.3 13.3 1.3 20.1 0 105.9-107.7 192-240 192-10.8 0-21.3-.8-31.7-1.9C207.8 439.6 281.8 480 368 480c41 0 79.1-9.2 111.3-25 21.8 12.7 52.1 25 88.7 25 3.2 0 6.1-1.9 7.3-4.8 1.3-2.9.7-6.3-1.5-8.7-.3-.3-22.4-24.2-35.8-54.5z"},child:[]}]})(s)}function loe(s){return ou({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M320 400c-75.85 0-137.25-58.71-142.9-133.11L72.2 185.82c-13.79 17.3-26.48 35.59-36.72 55.59a32.35 32.35 0 0 0 0 29.19C89.71 376.41 197.07 448 320 448c26.91 0 52.87-4 77.89-10.46L346 397.39a144.13 144.13 0 0 1-26 2.61zm313.82 58.1l-110.55-85.44a331.25 331.25 0 0 0 81.25-102.07 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64a308.15 308.15 0 0 0-147.32 37.7L45.46 3.37A16 16 0 0 0 23 6.18L3.37 31.45A16 16 0 0 0 6.18 53.9l588.36 454.73a16 16 0 0 0 22.46-2.81l19.64-25.27a16 16 0 0 0-2.82-22.45zm-183.72-142l-39.3-30.38A94.75 94.75 0 0 0 416 256a94.76 94.76 0 0 0-121.31-92.21A47.65 47.65 0 0 1 304 192a46.64 46.64 0 0 1-1.54 10l-73.61-56.89A142.31 142.31 0 0 1 320 112a143.92 143.92 0 0 1 144 144c0 21.63-5.29 41.79-13.9 60.11z"},child:[]}]})(s)}function uoe(s){return ou({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"},child:[]}]})(s)}function doe(s){return ou({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 32C114.52 32 0 146.496 0 288v48a32 32 0 0 0 17.689 28.622l14.383 7.191C34.083 431.903 83.421 480 144 480h24c13.255 0 24-10.745 24-24V280c0-13.255-10.745-24-24-24h-24c-31.342 0-59.671 12.879-80 33.627V288c0-105.869 86.131-192 192-192s192 86.131 192 192v1.627C427.671 268.879 399.342 256 368 256h-24c-13.255 0-24 10.745-24 24v176c0 13.255 10.745 24 24 24h24c60.579 0 109.917-48.098 111.928-108.187l14.382-7.191A32 32 0 0 0 512 336v-48c0-141.479-114.496-256-256-256z"},child:[]}]})(s)}function hoe(s){return ou({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"},child:[]}]})(s)}function QW(s){return ou({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M497.39 361.8l-112-48a24 24 0 0 0-28 6.9l-49.6 60.6A370.66 370.66 0 0 1 130.6 204.11l60.6-49.6a23.94 23.94 0 0 0 6.9-28l-48-112A24.16 24.16 0 0 0 122.6.61l-104 24A24 24 0 0 0 0 48c0 256.5 207.9 464 464 464a24 24 0 0 0 23.4-18.6l24-104a24.29 24.29 0 0 0-14.01-27.6z"},child:[]}]})(s)}function poe(s){return ou({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M268.2 381.4l-49.6-60.6c-6.8-8.3-18.2-11.1-28-6.9l-112 48c-10.7 4.6-16.5 16.1-13.9 27.5l24 104c2.5 10.8 12.1 18.6 23.4 18.6 100.7 0 193.7-32.4 269.7-86.9l-80-61.8c-10.9 6.5-22.1 12.7-33.6 18.1zm365.6 76.7L475.1 335.5C537.9 256.4 576 156.9 576 48c0-11.2-7.7-20.9-18.6-23.4l-104-24c-11.3-2.6-22.9 3.3-27.5 13.9l-48 112c-4.2 9.8-1.4 21.3 6.9 28l60.6 49.6c-12.2 26.1-27.9 50.3-46 72.8L45.5 3.4C38.5-2 28.5-.8 23 6.2L3.4 31.4c-5.4 7-4.2 17 2.8 22.4l588.4 454.7c7 5.4 17 4.2 22.5-2.8l19.6-25.3c5.4-6.8 4.1-16.9-2.9-22.3z"},child:[]}]})(s)}function foe(s){return ou({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M493.4 24.6l-104-24c-11.3-2.6-22.9 3.3-27.5 13.9l-48 112c-4.2 9.8-1.4 21.3 6.9 28l60.6 49.6c-36 76.7-98.9 140.5-177.2 177.2l-49.6-60.6c-6.8-8.3-18.2-11.1-28-6.9l-112 48C3.9 366.5-2 378.1.6 389.4l24 104C27.1 504.2 36.7 512 48 512c256.1 0 464-207.5 464-464 0-11.2-7.7-20.9-18.6-23.4z"},child:[]}]})(s)}function moe(s){return ou({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"},child:[]}]})(s)}const ZW=_e.createContext({});function goe(s){const i=_e.useRef(null);return i.current===null&&(i.current=s()),i.current}const UD=typeof window<"u",_oe=UD?_e.useLayoutEffect:_e.useEffect,VD=_e.createContext(null),ez=_e.createContext({transformPagePoint:s=>s,isStatic:!1,reducedMotion:"never"});function Eoe(s=!0){const i=_e.useContext(VD);if(i===null)return[!0,null];const{isPresent:a,onExitComplete:c,register:p}=i,_=_e.useId();_e.useEffect(()=>{if(s)return p(_)},[s]);const y=_e.useCallback(()=>s&&c&&c(_),[_,c,s]);return!a&&c?[!1,y]:[!0]}function FD(s,i){s.indexOf(i)===-1&&s.push(i)}function BD(s,i){const a=s.indexOf(i);a>-1&&s.splice(a,1)}let tz=()=>{};const GP={useManualTiming:!1};function jD(s){let i;return()=>(i===void 0&&(i=s()),i)}const oa=s=>s,Sv=(s,i,a)=>{const c=i-s;return c===0?1:(a-s)/c};class GD{constructor(){this.subscriptions=[]}add(i){return FD(this.subscriptions,i),()=>BD(this.subscriptions,i)}notify(i,a,c){const p=this.subscriptions.length;if(p)if(p===1)this.subscriptions[0](i,a,c);else for(let _=0;_<p;_++){const y=this.subscriptions[_];y&&y(i,a,c)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const zc=s=>s*1e3,Hc=s=>s/1e3;function nz(s,i){return i?s*(1e3/i):0}const yoe=jD(()=>window.ScrollTimeline!==void 0);class voe{constructor(i){this.stop=()=>this.runAll("stop"),this.animations=i.filter(Boolean)}get finished(){return Promise.all(this.animations.map(i=>i.finished))}getAll(i){return this.animations[0][i]}setAll(i,a){for(let c=0;c<this.animations.length;c++)this.animations[c][i]=a}attachTimeline(i,a){const c=this.animations.map(p=>{if(yoe()&&p.attachTimeline)return p.attachTimeline(i);if(typeof a=="function")return a(p)});return()=>{c.forEach((p,_)=>{p&&p(),this.animations[_].stop()})}}get time(){return this.getAll("time")}set time(i){this.setAll("time",i)}get speed(){return this.getAll("speed")}set speed(i){this.setAll("speed",i)}get startTime(){return this.getAll("startTime")}get duration(){let i=0;for(let a=0;a<this.animations.length;a++)i=Math.max(i,this.animations[a].duration);return i}runAll(i){this.animations.forEach(a=>a[i]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class Soe extends voe{then(i,a){return this.finished.finally(i).then(()=>{})}}const u5={value:null},WD=s=>Array.isArray(s)&&typeof s[0]=="number",Toe={};function Roe(s,i){const a=jD(s);return()=>Toe[i]??a()}const Tv=Roe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),iz=(s,i,a=10)=>{let c="";const p=Math.max(Math.round(i/a),2);for(let _=0;_<p;_++)c+=s(_/(p-1))+", ";return`linear(${c.substring(0,c.length-2)})`},iv=([s,i,a,c])=>`cubic-bezier(${s}, ${i}, ${a}, ${c})`,WP={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:iv([0,.65,.55,1]),circOut:iv([.55,0,1,.45]),backIn:iv([.31,.01,.66,-.59]),backOut:iv([.33,1.53,.69,.99])};function rz(s,i){if(s)return typeof s=="function"&&Tv()?iz(s,i):WD(s)?iv(s):Array.isArray(s)?s.map(a=>rz(a,i)||WP.easeOut):WP[s]}function woe(s,i,a,{delay:c=0,duration:p=300,repeat:_=0,repeatType:y="loop",ease:T="easeInOut",times:C}={},I=void 0){const D={[i]:a};C&&(D.offset=C);const L=rz(T,p);return Array.isArray(L)&&(D.easing=L),s.animate(D,{delay:c,duration:p,easing:Array.isArray(L)?"linear":L,fill:"both",iterations:_+1,direction:y==="reverse"?"alternate":"normal",pseudoElement:I})}function zD(s){return typeof s=="function"&&"applyToOptions"in s}function HD(s,i){return(s==null?void 0:s[i])??(s==null?void 0:s.default)??s}const HC=2e4;function KD(s){let i=0;const a=50;let c=s.next(i);for(;!c.done&&i<HC;)i+=a,c=s.next(i);return i>=HC?1/0:i}function Coe(s,i=100,a){const c=a({...s,keyframes:[0,i]}),p=Math.min(KD(c),HC);return{type:"keyframes",ease:_=>c.next(p*_).value/i,duration:Hc(p)}}function sz(s){return!!(typeof s=="function"&&Tv()||!s||typeof s=="string"&&(s in WP||Tv())||WD(s)||Array.isArray(s)&&s.every(sz))}function d5(s,i){s.timeline=i,s.onfinish=null}const rv=["read","resolveKeyframes","update","preRender","render","postRender"];function boe(s,i){let a=new Set,c=new Set,p=!1,_=!1;const y=new WeakSet;let T={delta:0,timestamp:0,isProcessing:!1},C=0;function I(L){y.has(L)&&(D.schedule(L),s()),C++,L(T)}const D={schedule:(L,j=!1,Y=!1)=>{const ee=Y&&p?a:c;return j&&y.add(L),ee.has(L)||ee.add(L),L},cancel:L=>{c.delete(L),y.delete(L)},process:L=>{if(T=L,p){_=!0;return}p=!0,[a,c]=[c,a],a.forEach(I),i&&u5.value&&u5.value.frameloop[i].push(C),C=0,a.clear(),p=!1,_&&(_=!1,D.process(L))}};return D}const Aoe=40;function oz(s,i){let a=!1,c=!0;const p={delta:0,timestamp:0,isProcessing:!1},_=()=>a=!0,y=rv.reduce((se,fe)=>(se[fe]=boe(_,i?fe:void 0),se),{}),{read:T,resolveKeyframes:C,update:I,preRender:D,render:L,postRender:j}=y,Y=()=>{const se=performance.now();a=!1,p.delta=c?1e3/60:Math.max(Math.min(se-p.timestamp,Aoe),1),p.timestamp=se,p.isProcessing=!0,T.process(p),C.process(p),I.process(p),D.process(p),L.process(p),j.process(p),p.isProcessing=!1,a&&i&&(c=!1,s(Y))},X=()=>{a=!0,c=!0,p.isProcessing||s(Y)};return{schedule:rv.reduce((se,fe)=>{const me=y[fe];return se[fe]=(Oe,Ve=!1,Ze=!1)=>(a||X(),me.schedule(Oe,Ve,Ze)),se},{}),cancel:se=>{for(let fe=0;fe<rv.length;fe++)y[rv[fe]].cancel(se)},state:p,steps:y}}const{schedule:ni,cancel:nu,state:Fr,steps:BN}=oz(typeof requestAnimationFrame<"u"?requestAnimationFrame:oa,!0),{schedule:qD}=oz(queueMicrotask,!1);let NC;function Ioe(){NC=void 0}const Kc={now:()=>(NC===void 0&&Kc.set(Fr.isProcessing||GP.useManualTiming?Fr.timestamp:performance.now()),NC),set:s=>{NC=s,queueMicrotask(Ioe)}},Ba={x:!1,y:!1};function az(){return Ba.x||Ba.y}function Ooe(s){return s==="x"||s==="y"?Ba[s]?null:(Ba[s]=!0,()=>{Ba[s]=!1}):Ba.x||Ba.y?null:(Ba.x=Ba.y=!0,()=>{Ba.x=Ba.y=!1})}function Noe(s,i,a){if(s instanceof EventTarget)return[s];if(typeof s=="string"){const p=document.querySelectorAll(s);return p?Array.from(p):[]}return Array.from(s)}function cz(s,i){const a=Noe(s),c=new AbortController,p={passive:!0,...i,signal:c.signal};return[a,p,()=>c.abort()]}function h5(s){return!(s.pointerType==="touch"||az())}function Poe(s,i,a={}){const[c,p,_]=cz(s,a),y=T=>{if(!h5(T))return;const{target:C}=T,I=i(C,T);if(typeof I!="function"||!C)return;const D=L=>{h5(L)&&(I(L),C.removeEventListener("pointerleave",D))};C.addEventListener("pointerleave",D,p)};return c.forEach(T=>{T.addEventListener("pointerenter",y,p)}),_}const lz=(s,i)=>i?s===i?!0:lz(s,i.parentElement):!1,YD=s=>s.pointerType==="mouse"?typeof s.button!="number"||s.button<=0:s.isPrimary!==!1,Doe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function koe(s){return Doe.has(s.tagName)||s.tabIndex!==-1}const sv=new WeakSet;function p5(s){return i=>{i.key==="Enter"&&s(i)}}function jN(s,i){s.dispatchEvent(new PointerEvent("pointer"+i,{isPrimary:!0,bubbles:!0}))}const Loe=(s,i)=>{const a=s.currentTarget;if(!a)return;const c=p5(()=>{if(sv.has(a))return;jN(a,"down");const p=p5(()=>{jN(a,"up")}),_=()=>jN(a,"cancel");a.addEventListener("keyup",p,i),a.addEventListener("blur",_,i)});a.addEventListener("keydown",c,i),a.addEventListener("blur",()=>a.removeEventListener("keydown",c),i)};function f5(s){return YD(s)&&!az()}function xoe(s,i,a={}){const[c,p,_]=cz(s,a),y=T=>{const C=T.currentTarget;if(!f5(T)||sv.has(C))return;sv.add(C);const I=i(C,T),D=(Y,X)=>{window.removeEventListener("pointerup",L),window.removeEventListener("pointercancel",j),!(!f5(Y)||!sv.has(C))&&(sv.delete(C),typeof I=="function"&&I(Y,{success:X}))},L=Y=>{D(Y,C===window||C===document||a.useGlobalTarget||lz(C,Y.target))},j=Y=>{D(Y,!1)};window.addEventListener("pointerup",L,p),window.addEventListener("pointercancel",j,p)};return c.forEach(T=>{(a.useGlobalTarget?window:T).addEventListener("pointerdown",y,p),T instanceof HTMLElement&&(T.addEventListener("focus",I=>Loe(I,p)),!koe(T)&&!T.hasAttribute("tabindex")&&(T.tabIndex=0))}),_}const m5=30,Moe=s=>!isNaN(parseFloat(s));class Uoe{constructor(i,a={}){this.version="12.6.5",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(c,p=!0)=>{const _=Kc.now();this.updatedAt!==_&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(c),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),p&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(i),this.owner=a.owner}setCurrent(i){this.current=i,this.updatedAt=Kc.now(),this.canTrackVelocity===null&&i!==void 0&&(this.canTrackVelocity=Moe(this.current))}setPrevFrameValue(i=this.current){this.prevFrameValue=i,this.prevUpdatedAt=this.updatedAt}onChange(i){return this.on("change",i)}on(i,a){this.events[i]||(this.events[i]=new GD);const c=this.events[i].add(a);return i==="change"?()=>{c(),ni.read(()=>{this.events.change.getSize()||this.stop()})}:c}clearListeners(){for(const i in this.events)this.events[i].clear()}attach(i,a){this.passiveEffect=i,this.stopPassiveEffect=a}set(i,a=!0){!a||!this.passiveEffect?this.updateAndNotify(i,a):this.passiveEffect(i,this.updateAndNotify)}setWithVelocity(i,a,c){this.set(a),this.prev=void 0,this.prevFrameValue=i,this.prevUpdatedAt=this.updatedAt-c}jump(i,a=!0){this.updateAndNotify(i),this.prev=i,this.prevUpdatedAt=this.prevFrameValue=void 0,a&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const i=Kc.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||i-this.updatedAt>m5)return 0;const a=Math.min(this.updatedAt-this.prevUpdatedAt,m5);return nz(parseFloat(this.current)-parseFloat(this.prevFrameValue),a)}start(i){return this.stop(),new Promise(a=>{this.hasAnimated=!0,this.animation=i(a),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Rv(s,i){return new Uoe(s,i)}rv.reduce((s,i)=>(s[i]=a=>nu(a),s),{});const uz=_e.createContext({strict:!1}),g5={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Kg={};for(const s in g5)Kg[s]={isEnabled:i=>g5[s].some(a=>!!i[a])};function Voe(s){for(const i in s)Kg[i]={...Kg[i],...s[i]}}const Foe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function KC(s){return s.startsWith("while")||s.startsWith("drag")&&s!=="draggable"||s.startsWith("layout")||s.startsWith("onTap")||s.startsWith("onPan")||s.startsWith("onLayout")||Foe.has(s)}let dz=s=>!KC(s);function Boe(s){s&&(dz=i=>i.startsWith("on")?!KC(i):s(i))}try{Boe(require("@emotion/is-prop-valid").default)}catch{}function joe(s,i,a){const c={};for(const p in s)p==="values"&&typeof s.values=="object"||(dz(p)||a===!0&&KC(p)||!i&&!KC(p)||s.draggable&&p.startsWith("onDrag"))&&(c[p]=s[p]);return c}function Goe(s){if(typeof Proxy>"u")return s;const i=new Map,a=(...c)=>s(...c);return new Proxy(a,{get:(c,p)=>p==="create"?s:(i.has(p)||i.set(p,s(p)),i.get(p))})}const yb=_e.createContext({});function vb(s){return s!==null&&typeof s=="object"&&typeof s.start=="function"}function wv(s){return typeof s=="string"||Array.isArray(s)}const XD=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],JD=["initial",...XD];function Sb(s){return vb(s.animate)||JD.some(i=>wv(s[i]))}function hz(s){return!!(Sb(s)||s.variants)}function Woe(s,i){if(Sb(s)){const{initial:a,animate:c}=s;return{initial:a===!1||wv(a)?a:void 0,animate:wv(c)?c:void 0}}return s.inherit!==!1?i:{}}function zoe(s){const{initial:i,animate:a}=Woe(s,_e.useContext(yb));return _e.useMemo(()=>({initial:i,animate:a}),[_5(i),_5(a)])}function _5(s){return Array.isArray(s)?s.join(" "):s}const Hoe=Symbol.for("motionComponentSymbol");function Ig(s){return s&&typeof s=="object"&&Object.prototype.hasOwnProperty.call(s,"current")}function Koe(s,i,a){return _e.useCallback(c=>{c&&s.onMount&&s.onMount(c),i&&(c?i.mount(c):i.unmount()),a&&(typeof a=="function"?a(c):Ig(a)&&(a.current=c))},[i])}const $D=s=>s.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),qoe="framerAppearId",pz="data-"+$D(qoe),fz=_e.createContext({});function Yoe(s,i,a,c,p){var ee,Q;const{visualElement:_}=_e.useContext(yb),y=_e.useContext(uz),T=_e.useContext(VD),C=_e.useContext(ez).reducedMotion,I=_e.useRef(null);c=c||y.renderer,!I.current&&c&&(I.current=c(s,{visualState:i,parent:_,props:a,presenceContext:T,blockInitialAnimation:T?T.initial===!1:!1,reducedMotionConfig:C}));const D=I.current,L=_e.useContext(fz);D&&!D.projection&&p&&(D.type==="html"||D.type==="svg")&&Xoe(I.current,a,p,L);const j=_e.useRef(!1);_e.useInsertionEffect(()=>{D&&j.current&&D.update(a,T)});const Y=a[pz],X=_e.useRef(!!Y&&!((ee=window.MotionHandoffIsComplete)!=null&&ee.call(window,Y))&&((Q=window.MotionHasOptimisedAnimation)==null?void 0:Q.call(window,Y)));return _oe(()=>{D&&(j.current=!0,window.MotionIsMounted=!0,D.updateFeatures(),qD.render(D.render),X.current&&D.animationState&&D.animationState.animateChanges())}),_e.useEffect(()=>{D&&(!X.current&&D.animationState&&D.animationState.animateChanges(),X.current&&(queueMicrotask(()=>{var se;(se=window.MotionHandoffMarkAsComplete)==null||se.call(window,Y)}),X.current=!1))}),D}function Xoe(s,i,a,c){const{layoutId:p,layout:_,drag:y,dragConstraints:T,layoutScroll:C,layoutRoot:I}=i;s.projection=new a(s.latestValues,i["data-framer-portal-id"]?void 0:mz(s.parent)),s.projection.setOptions({layoutId:p,layout:_,alwaysMeasureLayout:!!y||T&&Ig(T),visualElement:s,animationType:typeof _=="string"?_:"both",initialPromotionConfig:c,layoutScroll:C,layoutRoot:I})}function mz(s){if(s)return s.options.allowProjection!==!1?s.projection:mz(s.parent)}function Joe({preloadedFeatures:s,createVisualElement:i,useRender:a,useVisualState:c,Component:p}){s&&Voe(s);function _(T,C){let I;const D={..._e.useContext(ez),...T,layoutId:$oe(T)},{isStatic:L}=D,j=zoe(T),Y=c(T,L);if(!L&&UD){Qoe();const X=Zoe(D);I=X.MeasureLayout,j.visualElement=Yoe(p,Y,D,i,X.ProjectionNode)}return H.jsxs(yb.Provider,{value:j,children:[I&&j.visualElement?H.jsx(I,{visualElement:j.visualElement,...D}):null,a(p,T,Koe(Y,j.visualElement,C),Y,L,j.visualElement)]})}_.displayName=`motion.${typeof p=="string"?p:`create(${p.displayName??p.name??""})`}`;const y=_e.forwardRef(_);return y[Hoe]=p,y}function $oe({layoutId:s}){const i=_e.useContext(ZW).id;return i&&s!==void 0?i+"-"+s:s}function Qoe(s,i){_e.useContext(uz).strict}function Zoe(s){const{drag:i,layout:a}=Kg;if(!i&&!a)return{};const c={...i,...a};return{MeasureLayout:i!=null&&i.isEnabled(s)||a!=null&&a.isEnabled(s)?c.MeasureLayout:void 0,ProjectionNode:c.ProjectionNode}}const gz=s=>i=>typeof i=="string"&&i.startsWith(s),QD=gz("--"),eae=gz("var(--"),ZD=s=>eae(s)?tae.test(s.split("/*")[0].trim()):!1,tae=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Cv={};function nae(s){for(const i in s)Cv[i]=s[i],QD(i)&&(Cv[i].isCSSVariable=!0)}const s_=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],zp=new Set(s_);function _z(s,{layout:i,layoutId:a}){return zp.has(s)||s.startsWith("origin")||(i||a!==void 0)&&(!!Cv[s]||s==="opacity")}const as=s=>!!(s&&s.getVelocity),Ez=(s,i)=>i&&typeof s=="number"?i.transform(s):s,iu=(s,i,a)=>a>i?i:a<s?s:a,o_={test:s=>typeof s=="number",parse:parseFloat,transform:s=>s},bv={...o_,transform:s=>iu(0,1,s)},uC={...o_,default:1},Mv=s=>({test:i=>typeof i=="string"&&i.endsWith(s)&&i.split(" ").length===1,parse:parseFloat,transform:i=>`${i}${s}`}),md=Mv("deg"),qc=Mv("%"),It=Mv("px"),iae=Mv("vh"),rae=Mv("vw"),E5={...qc,parse:s=>qc.parse(s)/100,transform:s=>qc.transform(s*100)},sae={borderWidth:It,borderTopWidth:It,borderRightWidth:It,borderBottomWidth:It,borderLeftWidth:It,borderRadius:It,radius:It,borderTopLeftRadius:It,borderTopRightRadius:It,borderBottomRightRadius:It,borderBottomLeftRadius:It,width:It,maxWidth:It,height:It,maxHeight:It,top:It,right:It,bottom:It,left:It,padding:It,paddingTop:It,paddingRight:It,paddingBottom:It,paddingLeft:It,margin:It,marginTop:It,marginRight:It,marginBottom:It,marginLeft:It,backgroundPositionX:It,backgroundPositionY:It},oae={rotate:md,rotateX:md,rotateY:md,rotateZ:md,scale:uC,scaleX:uC,scaleY:uC,scaleZ:uC,skew:md,skewX:md,skewY:md,distance:It,translateX:It,translateY:It,translateZ:It,x:It,y:It,z:It,perspective:It,transformPerspective:It,opacity:bv,originX:E5,originY:E5,originZ:It},y5={...o_,transform:Math.round},ek={...sae,...oae,zIndex:y5,size:It,fillOpacity:bv,strokeOpacity:bv,numOctaves:y5},aae={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},cae=s_.length;function lae(s,i,a){let c="",p=!0;for(let _=0;_<cae;_++){const y=s_[_],T=s[y];if(T===void 0)continue;let C=!0;if(typeof T=="number"?C=T===(y.startsWith("scale")?1:0):C=parseFloat(T)===0,!C||a){const I=Ez(T,ek[y]);if(!C){p=!1;const D=aae[y]||y;c+=`${D}(${I}) `}a&&(i[y]=I)}}return c=c.trim(),a?c=a(i,p?"":c):p&&(c="none"),c}function tk(s,i,a){const{style:c,vars:p,transformOrigin:_}=s;let y=!1,T=!1;for(const C in i){const I=i[C];if(zp.has(C)){y=!0;continue}else if(QD(C)){p[C]=I;continue}else{const D=Ez(I,ek[C]);C.startsWith("origin")?(T=!0,_[C]=D):c[C]=D}}if(i.transform||(y||a?c.transform=lae(i,s.transform,a):c.transform&&(c.transform="none")),T){const{originX:C="50%",originY:I="50%",originZ:D=0}=_;c.transformOrigin=`${C} ${I} ${D}`}}const nk=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function yz(s,i,a){for(const c in i)!as(i[c])&&!_z(c,a)&&(s[c]=i[c])}function uae({transformTemplate:s},i){return _e.useMemo(()=>{const a=nk();return tk(a,i,s),Object.assign({},a.vars,a.style)},[i])}function dae(s,i){const a=s.style||{},c={};return yz(c,a,s),Object.assign(c,uae(s,i)),c}function hae(s,i){const a={},c=dae(s,i);return s.drag&&s.dragListener!==!1&&(a.draggable=!1,c.userSelect=c.WebkitUserSelect=c.WebkitTouchCallout="none",c.touchAction=s.drag===!0?"none":`pan-${s.drag==="x"?"y":"x"}`),s.tabIndex===void 0&&(s.onTap||s.onTapStart||s.whileTap)&&(a.tabIndex=0),a.style=c,a}const pae=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function ik(s){return typeof s!="string"||s.includes("-")?!1:!!(pae.indexOf(s)>-1||/[A-Z]/u.test(s))}const fae={offset:"stroke-dashoffset",array:"stroke-dasharray"},mae={offset:"strokeDashoffset",array:"strokeDasharray"};function gae(s,i,a=1,c=0,p=!0){s.pathLength=1;const _=p?fae:mae;s[_.offset]=It.transform(-c);const y=It.transform(i),T=It.transform(a);s[_.array]=`${y} ${T}`}function v5(s,i,a){return typeof s=="string"?s:It.transform(i+a*s)}function _ae(s,i,a){const c=v5(i,s.x,s.width),p=v5(a,s.y,s.height);return`${c} ${p}`}function rk(s,{attrX:i,attrY:a,attrScale:c,originX:p,originY:_,pathLength:y,pathSpacing:T=1,pathOffset:C=0,...I},D,L){if(tk(s,I,L),D){s.style.viewBox&&(s.attrs.viewBox=s.style.viewBox);return}s.attrs=s.style,s.style={};const{attrs:j,style:Y,dimensions:X}=s;j.transform&&(X&&(Y.transform=j.transform),delete j.transform),X&&(p!==void 0||_!==void 0||Y.transform)&&(Y.transformOrigin=_ae(X,p!==void 0?p:.5,_!==void 0?_:.5)),i!==void 0&&(j.x=i),a!==void 0&&(j.y=a),c!==void 0&&(j.scale=c),y!==void 0&&gae(j,y,T,C,!1)}const vz=()=>({...nk(),attrs:{}}),sk=s=>typeof s=="string"&&s.toLowerCase()==="svg";function Eae(s,i,a,c){const p=_e.useMemo(()=>{const _=vz();return rk(_,i,sk(c),s.transformTemplate),{..._.attrs,style:{..._.style}}},[i]);if(s.style){const _={};yz(_,s.style,s),p.style={..._,...p.style}}return p}function yae(s=!1){return(a,c,p,{latestValues:_},y)=>{const C=(ik(a)?Eae:hae)(c,_,y,a),I=joe(c,typeof a=="string",s),D=a!==_e.Fragment?{...I,...C,ref:p}:{},{children:L}=c,j=_e.useMemo(()=>as(L)?L.get():L,[L]);return _e.createElement(a,{...D,children:j})}}function S5(s){const i=[{},{}];return s==null||s.values.forEach((a,c)=>{i[0][c]=a.get(),i[1][c]=a.getVelocity()}),i}function ok(s,i,a,c){if(typeof i=="function"){const[p,_]=S5(c);i=i(a!==void 0?a:s.custom,p,_)}if(typeof i=="string"&&(i=s.variants&&s.variants[i]),typeof i=="function"){const[p,_]=S5(c);i=i(a!==void 0?a:s.custom,p,_)}return i}const zP=s=>Array.isArray(s),vae=s=>!!(s&&typeof s=="object"&&s.mix&&s.toValue),Sae=s=>zP(s)?s[s.length-1]||0:s;function PC(s){const i=as(s)?s.get():s;return vae(i)?i.toValue():i}function Tae({scrapeMotionValuesFromProps:s,createRenderState:i,onUpdate:a},c,p,_){const y={latestValues:Rae(c,p,_,s),renderState:i()};return a&&(y.onMount=T=>a({props:c,current:T,...y}),y.onUpdate=T=>a(T)),y}const Sz=s=>(i,a)=>{const c=_e.useContext(yb),p=_e.useContext(VD),_=()=>Tae(s,i,c,p);return a?_():goe(_)};function Rae(s,i,a,c){const p={},_=c(s,{});for(const j in _)p[j]=PC(_[j]);let{initial:y,animate:T}=s;const C=Sb(s),I=hz(s);i&&I&&!C&&s.inherit!==!1&&(y===void 0&&(y=i.initial),T===void 0&&(T=i.animate));let D=a?a.initial===!1:!1;D=D||y===!1;const L=D?T:y;if(L&&typeof L!="boolean"&&!vb(L)){const j=Array.isArray(L)?L:[L];for(let Y=0;Y<j.length;Y++){const X=ok(s,j[Y]);if(X){const{transitionEnd:ee,transition:Q,...se}=X;for(const fe in se){let me=se[fe];if(Array.isArray(me)){const Oe=D?me.length-1:0;me=me[Oe]}me!==null&&(p[fe]=me)}for(const fe in ee)p[fe]=ee[fe]}}}return p}function ak(s,i,a){var _;const{style:c}=s,p={};for(const y in c)(as(c[y])||i.style&&as(i.style[y])||_z(y,s)||((_=a==null?void 0:a.getValue(y))==null?void 0:_.liveStyle)!==void 0)&&(p[y]=c[y]);return p}const wae={useVisualState:Sz({scrapeMotionValuesFromProps:ak,createRenderState:nk})};function Tz(s,i){try{i.dimensions=typeof s.getBBox=="function"?s.getBBox():s.getBoundingClientRect()}catch{i.dimensions={x:0,y:0,width:0,height:0}}}function Rz(s,{style:i,vars:a},c,p){Object.assign(s.style,i,p&&p.getProjectionStyles(c));for(const _ in a)s.style.setProperty(_,a[_])}const wz=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Cz(s,i,a,c){Rz(s,i,void 0,c);for(const p in i.attrs)s.setAttribute(wz.has(p)?p:$D(p),i.attrs[p])}function bz(s,i,a){const c=ak(s,i,a);for(const p in s)if(as(s[p])||as(i[p])){const _=s_.indexOf(p)!==-1?"attr"+p.charAt(0).toUpperCase()+p.substring(1):p;c[_]=s[p]}return c}const T5=["x","y","width","height","cx","cy","r"],Cae={useVisualState:Sz({scrapeMotionValuesFromProps:bz,createRenderState:vz,onUpdate:({props:s,prevProps:i,current:a,renderState:c,latestValues:p})=>{if(!a)return;let _=!!s.drag;if(!_){for(const T in p)if(zp.has(T)){_=!0;break}}if(!_)return;let y=!i;if(i)for(let T=0;T<T5.length;T++){const C=T5[T];s[C]!==i[C]&&(y=!0)}y&&ni.read(()=>{Tz(a,c),ni.render(()=>{rk(c,p,sk(a.tagName),s.transformTemplate),Cz(a,c)})})}})};function bae(s,i){return function(c,{forwardMotionProps:p}={forwardMotionProps:!1}){const y={...ik(c)?Cae:wae,preloadedFeatures:s,useRender:yae(p),createVisualElement:i,Component:c};return Joe(y)}}function Av(s,i,a){const c=s.getProps();return ok(c,i,a!==void 0?a:c.custom,s)}const Az=new Set(["width","height","top","left","right","bottom",...s_]);function Aae(s,i,a){s.hasValue(i)?s.getValue(i).set(a):s.addValue(i,Rv(a))}function Iae(s,i){const a=Av(s,i);let{transitionEnd:c={},transition:p={},..._}=a||{};_={..._,...c};for(const y in _){const T=Sae(_[y]);Aae(s,y,T)}}function Oae(s){return!!(as(s)&&s.add)}function HP(s,i){const a=s.getValue("willChange");if(Oae(a))return a.add(i);if(!a&&GP.WillChange){const c=new GP.WillChange("auto");s.addValue("willChange",c),c.add(i)}}function Iz(s){return s.props[pz]}const Oz=(s,i,a)=>(((1-3*a+3*i)*s+(3*a-6*i))*s+3*i)*s,Nae=1e-7,Pae=12;function Dae(s,i,a,c,p){let _,y,T=0;do y=i+(a-i)/2,_=Oz(y,c,p)-s,_>0?a=y:i=y;while(Math.abs(_)>Nae&&++T<Pae);return y}function Uv(s,i,a,c){if(s===i&&a===c)return oa;const p=_=>Dae(_,0,1,s,a);return _=>_===0||_===1?_:Oz(p(_),i,c)}const Nz=s=>i=>i<=.5?s(2*i)/2:(2-s(2*(1-i)))/2,Pz=s=>i=>1-s(1-i),Dz=Uv(.33,1.53,.69,.99),ck=Pz(Dz),kz=Nz(ck),Lz=s=>(s*=2)<1?.5*ck(s):.5*(2-Math.pow(2,-10*(s-1))),lk=s=>1-Math.sin(Math.acos(s)),xz=Pz(lk),Mz=Nz(lk),Uz=s=>/^0[^.\s]+$/u.test(s);function kae(s){return typeof s=="number"?s===0:s!==null?s==="none"||s==="0"||Uz(s):!0}const uv=s=>Math.round(s*1e5)/1e5,uk=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function Lae(s){return s==null}const xae=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,dk=(s,i)=>a=>!!(typeof a=="string"&&xae.test(a)&&a.startsWith(s)||i&&!Lae(a)&&Object.prototype.hasOwnProperty.call(a,i)),Vz=(s,i,a)=>c=>{if(typeof c!="string")return c;const[p,_,y,T]=c.match(uk);return{[s]:parseFloat(p),[i]:parseFloat(_),[a]:parseFloat(y),alpha:T!==void 0?parseFloat(T):1}},Mae=s=>iu(0,255,s),GN={...o_,transform:s=>Math.round(Mae(s))},Pp={test:dk("rgb","red"),parse:Vz("red","green","blue"),transform:({red:s,green:i,blue:a,alpha:c=1})=>"rgba("+GN.transform(s)+", "+GN.transform(i)+", "+GN.transform(a)+", "+uv(bv.transform(c))+")"};function Uae(s){let i="",a="",c="",p="";return s.length>5?(i=s.substring(1,3),a=s.substring(3,5),c=s.substring(5,7),p=s.substring(7,9)):(i=s.substring(1,2),a=s.substring(2,3),c=s.substring(3,4),p=s.substring(4,5),i+=i,a+=a,c+=c,p+=p),{red:parseInt(i,16),green:parseInt(a,16),blue:parseInt(c,16),alpha:p?parseInt(p,16)/255:1}}const KP={test:dk("#"),parse:Uae,transform:Pp.transform},Og={test:dk("hsl","hue"),parse:Vz("hue","saturation","lightness"),transform:({hue:s,saturation:i,lightness:a,alpha:c=1})=>"hsla("+Math.round(s)+", "+qc.transform(uv(i))+", "+qc.transform(uv(a))+", "+uv(bv.transform(c))+")"},rs={test:s=>Pp.test(s)||KP.test(s)||Og.test(s),parse:s=>Pp.test(s)?Pp.parse(s):Og.test(s)?Og.parse(s):KP.parse(s),transform:s=>typeof s=="string"?s:s.hasOwnProperty("red")?Pp.transform(s):Og.transform(s)},Vae=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Fae(s){var i,a;return isNaN(s)&&typeof s=="string"&&(((i=s.match(uk))==null?void 0:i.length)||0)+(((a=s.match(Vae))==null?void 0:a.length)||0)>0}const Fz="number",Bz="color",Bae="var",jae="var(",R5="${}",Gae=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Iv(s){const i=s.toString(),a=[],c={color:[],number:[],var:[]},p=[];let _=0;const T=i.replace(Gae,C=>(rs.test(C)?(c.color.push(_),p.push(Bz),a.push(rs.parse(C))):C.startsWith(jae)?(c.var.push(_),p.push(Bae),a.push(C)):(c.number.push(_),p.push(Fz),a.push(parseFloat(C))),++_,R5)).split(R5);return{values:a,split:T,indexes:c,types:p}}function jz(s){return Iv(s).values}function Gz(s){const{split:i,types:a}=Iv(s),c=i.length;return p=>{let _="";for(let y=0;y<c;y++)if(_+=i[y],p[y]!==void 0){const T=a[y];T===Fz?_+=uv(p[y]):T===Bz?_+=rs.transform(p[y]):_+=p[y]}return _}}const Wae=s=>typeof s=="number"?0:s;function zae(s){const i=jz(s);return Gz(s)(i.map(Wae))}const bd={test:Fae,parse:jz,createTransformer:Gz,getAnimatableNone:zae},Hae=new Set(["brightness","contrast","saturate","opacity"]);function Kae(s){const[i,a]=s.slice(0,-1).split("(");if(i==="drop-shadow")return s;const[c]=a.match(uk)||[];if(!c)return s;const p=a.replace(c,"");let _=Hae.has(i)?1:0;return c!==a&&(_*=100),i+"("+_+p+")"}const qae=/\b([a-z-]*)\(.*?\)/gu,qP={...bd,getAnimatableNone:s=>{const i=s.match(qae);return i?i.map(Kae).join(" "):s}},Yae={...ek,color:rs,backgroundColor:rs,outlineColor:rs,fill:rs,stroke:rs,borderColor:rs,borderTopColor:rs,borderRightColor:rs,borderBottomColor:rs,borderLeftColor:rs,filter:qP,WebkitFilter:qP},Wz=s=>Yae[s];function zz(s,i){let a=Wz(s);return a!==qP&&(a=bd),a.getAnimatableNone?a.getAnimatableNone(i):void 0}const Xae=new Set(["auto","none","0"]);function Jae(s,i,a){let c=0,p;for(;c<s.length&&!p;){const _=s[c];typeof _=="string"&&!Xae.has(_)&&Iv(_).values.length&&(p=s[c]),c++}if(p&&a)for(const _ of i)s[_]=zz(a,p)}const Dp=s=>s*180/Math.PI,YP=s=>{const i=Dp(Math.atan2(s[1],s[0]));return XP(i)},$ae={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:s=>(Math.abs(s[0])+Math.abs(s[3]))/2,rotate:YP,rotateZ:YP,skewX:s=>Dp(Math.atan(s[1])),skewY:s=>Dp(Math.atan(s[2])),skew:s=>(Math.abs(s[1])+Math.abs(s[2]))/2},XP=s=>(s=s%360,s<0&&(s+=360),s),w5=YP,C5=s=>Math.sqrt(s[0]*s[0]+s[1]*s[1]),b5=s=>Math.sqrt(s[4]*s[4]+s[5]*s[5]),Qae={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:C5,scaleY:b5,scale:s=>(C5(s)+b5(s))/2,rotateX:s=>XP(Dp(Math.atan2(s[6],s[5]))),rotateY:s=>XP(Dp(Math.atan2(-s[2],s[0]))),rotateZ:w5,rotate:w5,skewX:s=>Dp(Math.atan(s[4])),skewY:s=>Dp(Math.atan(s[1])),skew:s=>(Math.abs(s[1])+Math.abs(s[4]))/2};function A5(s){return s.includes("scale")?1:0}function JP(s,i){if(!s||s==="none")return A5(i);const a=s.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let c,p;if(a)c=Qae,p=a;else{const T=s.match(/^matrix\(([-\d.e\s,]+)\)$/u);c=$ae,p=T}if(!p)return A5(i);const _=c[i],y=p[1].split(",").map(ece);return typeof _=="function"?_(y):y[_]}const Zae=(s,i)=>{const{transform:a="none"}=getComputedStyle(s);return JP(a,i)};function ece(s){return parseFloat(s.trim())}const I5=s=>s===o_||s===It,tce=new Set(["x","y","z"]),nce=s_.filter(s=>!tce.has(s));function ice(s){const i=[];return nce.forEach(a=>{const c=s.getValue(a);c!==void 0&&(i.push([a,c.get()]),c.set(a.startsWith("scale")?1:0))}),i}const qg={width:({x:s},{paddingLeft:i="0",paddingRight:a="0"})=>s.max-s.min-parseFloat(i)-parseFloat(a),height:({y:s},{paddingTop:i="0",paddingBottom:a="0"})=>s.max-s.min-parseFloat(i)-parseFloat(a),top:(s,{top:i})=>parseFloat(i),left:(s,{left:i})=>parseFloat(i),bottom:({y:s},{top:i})=>parseFloat(i)+(s.max-s.min),right:({x:s},{left:i})=>parseFloat(i)+(s.max-s.min),x:(s,{transform:i})=>JP(i,"x"),y:(s,{transform:i})=>JP(i,"y")};qg.translateX=qg.x;qg.translateY=qg.y;const Up=new Set;let $P=!1,QP=!1;function Hz(){if(QP){const s=Array.from(Up).filter(c=>c.needsMeasurement),i=new Set(s.map(c=>c.element)),a=new Map;i.forEach(c=>{const p=ice(c);p.length&&(a.set(c,p),c.render())}),s.forEach(c=>c.measureInitialState()),i.forEach(c=>{c.render();const p=a.get(c);p&&p.forEach(([_,y])=>{var T;(T=c.getValue(_))==null||T.set(y)})}),s.forEach(c=>c.measureEndState()),s.forEach(c=>{c.suspendedScrollY!==void 0&&window.scrollTo(0,c.suspendedScrollY)})}QP=!1,$P=!1,Up.forEach(s=>s.complete()),Up.clear()}function Kz(){Up.forEach(s=>{s.readKeyframes(),s.needsMeasurement&&(QP=!0)})}function rce(){Kz(),Hz()}class hk{constructor(i,a,c,p,_,y=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...i],this.onComplete=a,this.name=c,this.motionValue=p,this.element=_,this.isAsync=y}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Up.add(this),$P||($P=!0,ni.read(Kz),ni.resolveKeyframes(Hz))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:i,name:a,element:c,motionValue:p}=this;for(let _=0;_<i.length;_++)if(i[_]===null)if(_===0){const y=p==null?void 0:p.get(),T=i[i.length-1];if(y!==void 0)i[0]=y;else if(c&&a){const C=c.readValue(a,T);C!=null&&(i[0]=C)}i[0]===void 0&&(i[0]=T),p&&y===void 0&&p.set(i[0])}else i[_]=i[_-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Up.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Up.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const qz=s=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(s),sce=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function oce(s){const i=sce.exec(s);if(!i)return[,];const[,a,c,p]=i;return[`--${a??c}`,p]}function Yz(s,i,a=1){const[c,p]=oce(s);if(!c)return;const _=window.getComputedStyle(i).getPropertyValue(c);if(_){const y=_.trim();return qz(y)?parseFloat(y):y}return ZD(p)?Yz(p,i,a+1):p}const Xz=s=>i=>i.test(s),ace={test:s=>s==="auto",parse:s=>s},Jz=[o_,It,qc,md,rae,iae,ace],O5=s=>Jz.find(Xz(s));class $z extends hk{constructor(i,a,c,p,_){super(i,a,c,p,_,!0)}readKeyframes(){const{unresolvedKeyframes:i,element:a,name:c}=this;if(!a||!a.current)return;super.readKeyframes();for(let C=0;C<i.length;C++){let I=i[C];if(typeof I=="string"&&(I=I.trim(),ZD(I))){const D=Yz(I,a.current);D!==void 0&&(i[C]=D),C===i.length-1&&(this.finalKeyframe=I)}}if(this.resolveNoneKeyframes(),!Az.has(c)||i.length!==2)return;const[p,_]=i,y=O5(p),T=O5(_);if(y!==T)if(I5(y)&&I5(T))for(let C=0;C<i.length;C++){const I=i[C];typeof I=="string"&&(i[C]=parseFloat(I))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:i,name:a}=this,c=[];for(let p=0;p<i.length;p++)kae(i[p])&&c.push(p);c.length&&Jae(i,c,a)}measureInitialState(){const{element:i,unresolvedKeyframes:a,name:c}=this;if(!i||!i.current)return;c==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=qg[c](i.measureViewportBox(),window.getComputedStyle(i.current)),a[0]=this.measuredOrigin;const p=a[a.length-1];p!==void 0&&i.getValue(c,p).jump(p,!1)}measureEndState(){var T;const{element:i,name:a,unresolvedKeyframes:c}=this;if(!i||!i.current)return;const p=i.getValue(a);p&&p.jump(this.measuredOrigin,!1);const _=c.length-1,y=c[_];c[_]=qg[a](i.measureViewportBox(),window.getComputedStyle(i.current)),y!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=y),(T=this.removedTransforms)!=null&&T.length&&this.removedTransforms.forEach(([C,I])=>{i.getValue(C).set(I)}),this.resolveNoneKeyframes()}}const N5=(s,i)=>i==="zIndex"?!1:!!(typeof s=="number"||Array.isArray(s)||typeof s=="string"&&(bd.test(s)||s==="0")&&!s.startsWith("url("));function cce(s){const i=s[0];if(s.length===1)return!0;for(let a=0;a<s.length;a++)if(s[a]!==i)return!0}function lce(s,i,a,c){const p=s[0];if(p===null)return!1;if(i==="display"||i==="visibility")return!0;const _=s[s.length-1],y=N5(p,i),T=N5(_,i);return!y||!T?!1:cce(s)||(a==="spring"||zD(a))&&c}const uce=s=>s!==null;function Tb(s,{repeat:i,repeatType:a="loop"},c){const p=s.filter(uce),_=i&&a!=="loop"&&i%2===1?0:p.length-1;return!_||c===void 0?p[_]:c}const dce=40;class Qz{constructor({autoplay:i=!0,delay:a=0,type:c="keyframes",repeat:p=0,repeatDelay:_=0,repeatType:y="loop",...T}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Kc.now(),this.options={autoplay:i,delay:a,type:c,repeat:p,repeatDelay:_,repeatType:y,...T},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>dce?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&rce(),this._resolved}onKeyframesResolved(i,a){this.resolvedAt=Kc.now(),this.hasAttemptedResolve=!0;const{name:c,type:p,velocity:_,delay:y,onComplete:T,onUpdate:C,isGenerator:I}=this.options;if(!I&&!lce(i,c,p,_))if(y)this.options.duration=0;else{C&&C(Tb(i,this.options,a)),T&&T(),this.resolveFinishedPromise();return}const D=this.initPlayback(i,a);D!==!1&&(this._resolved={keyframes:i,finalKeyframe:a,...D},this.onPostResolved())}onPostResolved(){}then(i,a){return this.currentFinishedPromise.then(i,a)}flatten(){this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear")}updateFinishedPromise(){this.currentFinishedPromise=new Promise(i=>{this.resolveFinishedPromise=i})}}const Ci=(s,i,a)=>s+(i-s)*a;function WN(s,i,a){return a<0&&(a+=1),a>1&&(a-=1),a<1/6?s+(i-s)*6*a:a<1/2?i:a<2/3?s+(i-s)*(2/3-a)*6:s}function hce({hue:s,saturation:i,lightness:a,alpha:c}){s/=360,i/=100,a/=100;let p=0,_=0,y=0;if(!i)p=_=y=a;else{const T=a<.5?a*(1+i):a+i-a*i,C=2*a-T;p=WN(C,T,s+1/3),_=WN(C,T,s),y=WN(C,T,s-1/3)}return{red:Math.round(p*255),green:Math.round(_*255),blue:Math.round(y*255),alpha:c}}function qC(s,i){return a=>a>0?i:s}const zN=(s,i,a)=>{const c=s*s,p=a*(i*i-c)+c;return p<0?0:Math.sqrt(p)},pce=[KP,Pp,Og],fce=s=>pce.find(i=>i.test(s));function P5(s){const i=fce(s);if(!i)return!1;let a=i.parse(s);return i===Og&&(a=hce(a)),a}const D5=(s,i)=>{const a=P5(s),c=P5(i);if(!a||!c)return qC(s,i);const p={...a};return _=>(p.red=zN(a.red,c.red,_),p.green=zN(a.green,c.green,_),p.blue=zN(a.blue,c.blue,_),p.alpha=Ci(a.alpha,c.alpha,_),Pp.transform(p))},mce=(s,i)=>a=>i(s(a)),Vv=(...s)=>s.reduce(mce),ZP=new Set(["none","hidden"]);function gce(s,i){return ZP.has(s)?a=>a<=0?s:i:a=>a>=1?i:s}function _ce(s,i){return a=>Ci(s,i,a)}function pk(s){return typeof s=="number"?_ce:typeof s=="string"?ZD(s)?qC:rs.test(s)?D5:vce:Array.isArray(s)?Zz:typeof s=="object"?rs.test(s)?D5:Ece:qC}function Zz(s,i){const a=[...s],c=a.length,p=s.map((_,y)=>pk(_)(_,i[y]));return _=>{for(let y=0;y<c;y++)a[y]=p[y](_);return a}}function Ece(s,i){const a={...s,...i},c={};for(const p in a)s[p]!==void 0&&i[p]!==void 0&&(c[p]=pk(s[p])(s[p],i[p]));return p=>{for(const _ in c)a[_]=c[_](p);return a}}function yce(s,i){const a=[],c={color:0,var:0,number:0};for(let p=0;p<i.values.length;p++){const _=i.types[p],y=s.indexes[_][c[_]],T=s.values[y]??0;a[p]=T,c[_]++}return a}const vce=(s,i)=>{const a=bd.createTransformer(i),c=Iv(s),p=Iv(i);return c.indexes.var.length===p.indexes.var.length&&c.indexes.color.length===p.indexes.color.length&&c.indexes.number.length>=p.indexes.number.length?ZP.has(s)&&!p.values.length||ZP.has(i)&&!c.values.length?gce(s,i):Vv(Zz(yce(c,p),p.values),a):qC(s,i)};function e8(s,i,a){return typeof s=="number"&&typeof i=="number"&&typeof a=="number"?Ci(s,i,a):pk(s)(s,i)}const Sce=5;function t8(s,i,a){const c=Math.max(i-Sce,0);return nz(a-s(c),i-c)}const Fi={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},k5=.001;function Tce({duration:s=Fi.duration,bounce:i=Fi.bounce,velocity:a=Fi.velocity,mass:c=Fi.mass}){let p,_,y=1-i;y=iu(Fi.minDamping,Fi.maxDamping,y),s=iu(Fi.minDuration,Fi.maxDuration,Hc(s)),y<1?(p=I=>{const D=I*y,L=D*s,j=D-a,Y=eD(I,y),X=Math.exp(-L);return k5-j/Y*X},_=I=>{const L=I*y*s,j=L*a+a,Y=Math.pow(y,2)*Math.pow(I,2)*s,X=Math.exp(-L),ee=eD(Math.pow(I,2),y);return(-p(I)+k5>0?-1:1)*((j-Y)*X)/ee}):(p=I=>{const D=Math.exp(-I*s),L=(I-a)*s+1;return-.001+D*L},_=I=>{const D=Math.exp(-I*s),L=(a-I)*(s*s);return D*L});const T=5/s,C=wce(p,_,T);if(s=zc(s),isNaN(C))return{stiffness:Fi.stiffness,damping:Fi.damping,duration:s};{const I=Math.pow(C,2)*c;return{stiffness:I,damping:y*2*Math.sqrt(c*I),duration:s}}}const Rce=12;function wce(s,i,a){let c=a;for(let p=1;p<Rce;p++)c=c-s(c)/i(c);return c}function eD(s,i){return s*Math.sqrt(1-i*i)}const Cce=["duration","bounce"],bce=["stiffness","damping","mass"];function L5(s,i){return i.some(a=>s[a]!==void 0)}function Ace(s){let i={velocity:Fi.velocity,stiffness:Fi.stiffness,damping:Fi.damping,mass:Fi.mass,isResolvedFromDuration:!1,...s};if(!L5(s,bce)&&L5(s,Cce))if(s.visualDuration){const a=s.visualDuration,c=2*Math.PI/(a*1.2),p=c*c,_=2*iu(.05,1,1-(s.bounce||0))*Math.sqrt(p);i={...i,mass:Fi.mass,stiffness:p,damping:_}}else{const a=Tce(s);i={...i,...a,mass:Fi.mass},i.isResolvedFromDuration=!0}return i}function YC(s=Fi.visualDuration,i=Fi.bounce){const a=typeof s!="object"?{visualDuration:s,keyframes:[0,1],bounce:i}:s;let{restSpeed:c,restDelta:p}=a;const _=a.keyframes[0],y=a.keyframes[a.keyframes.length-1],T={done:!1,value:_},{stiffness:C,damping:I,mass:D,duration:L,velocity:j,isResolvedFromDuration:Y}=Ace({...a,velocity:-Hc(a.velocity||0)}),X=j||0,ee=I/(2*Math.sqrt(C*D)),Q=y-_,se=Hc(Math.sqrt(C/D)),fe=Math.abs(Q)<5;c||(c=fe?Fi.restSpeed.granular:Fi.restSpeed.default),p||(p=fe?Fi.restDelta.granular:Fi.restDelta.default);let me;if(ee<1){const Ve=eD(se,ee);me=Ze=>{const ut=Math.exp(-ee*se*Ze);return y-ut*((X+ee*se*Q)/Ve*Math.sin(Ve*Ze)+Q*Math.cos(Ve*Ze))}}else if(ee===1)me=Ve=>y-Math.exp(-se*Ve)*(Q+(X+se*Q)*Ve);else{const Ve=se*Math.sqrt(ee*ee-1);me=Ze=>{const ut=Math.exp(-ee*se*Ze),rt=Math.min(Ve*Ze,300);return y-ut*((X+ee*se*Q)*Math.sinh(rt)+Ve*Q*Math.cosh(rt))/Ve}}const Oe={calculatedDuration:Y&&L||null,next:Ve=>{const Ze=me(Ve);if(Y)T.done=Ve>=L;else{let ut=0;ee<1&&(ut=Ve===0?zc(X):t8(me,Ve,Ze));const rt=Math.abs(ut)<=c,dn=Math.abs(y-Ze)<=p;T.done=rt&&dn}return T.value=T.done?y:Ze,T},toString:()=>{const Ve=Math.min(KD(Oe),HC),Ze=iz(ut=>Oe.next(Ve*ut).value,Ve,30);return Ve+"ms "+Ze},toTransition:()=>{}};return Oe}YC.applyToOptions=s=>{const i=Coe(s,100,YC);return s.ease=Tv()?i.ease:"easeOut",s.duration=zc(i.duration),s.type="keyframes",s};function x5({keyframes:s,velocity:i=0,power:a=.8,timeConstant:c=325,bounceDamping:p=10,bounceStiffness:_=500,modifyTarget:y,min:T,max:C,restDelta:I=.5,restSpeed:D}){const L=s[0],j={done:!1,value:L},Y=rt=>T!==void 0&&rt<T||C!==void 0&&rt>C,X=rt=>T===void 0?C:C===void 0||Math.abs(T-rt)<Math.abs(C-rt)?T:C;let ee=a*i;const Q=L+ee,se=y===void 0?Q:y(Q);se!==Q&&(ee=se-L);const fe=rt=>-ee*Math.exp(-rt/c),me=rt=>se+fe(rt),Oe=rt=>{const dn=fe(rt),tn=me(rt);j.done=Math.abs(dn)<=I,j.value=j.done?se:tn};let Ve,Ze;const ut=rt=>{Y(j.value)&&(Ve=rt,Ze=YC({keyframes:[j.value,X(j.value)],velocity:t8(me,rt,j.value),damping:p,stiffness:_,restDelta:I,restSpeed:D}))};return ut(0),{calculatedDuration:null,next:rt=>{let dn=!1;return!Ze&&Ve===void 0&&(dn=!0,Oe(rt),ut(rt)),Ve!==void 0&&rt>=Ve?Ze.next(rt-Ve):(!dn&&Oe(rt),j)}}}const Ice=Uv(.42,0,1,1),Oce=Uv(0,0,.58,1),n8=Uv(.42,0,.58,1),Nce=s=>Array.isArray(s)&&typeof s[0]!="number",Pce={linear:oa,easeIn:Ice,easeInOut:n8,easeOut:Oce,circIn:lk,circInOut:Mz,circOut:xz,backIn:ck,backInOut:kz,backOut:Dz,anticipate:Lz},M5=s=>{if(WD(s)){tz(s.length===4);const[i,a,c,p]=s;return Uv(i,a,c,p)}else if(typeof s=="string")return Pce[s];return s};function Dce(s,i,a){const c=[],p=a||e8,_=s.length-1;for(let y=0;y<_;y++){let T=p(s[y],s[y+1]);if(i){const C=Array.isArray(i)?i[y]||oa:i;T=Vv(C,T)}c.push(T)}return c}function kce(s,i,{clamp:a=!0,ease:c,mixer:p}={}){const _=s.length;if(tz(_===i.length),_===1)return()=>i[0];if(_===2&&i[0]===i[1])return()=>i[1];const y=s[0]===s[1];s[0]>s[_-1]&&(s=[...s].reverse(),i=[...i].reverse());const T=Dce(i,c,p),C=T.length,I=D=>{if(y&&D<s[0])return i[0];let L=0;if(C>1)for(;L<s.length-2&&!(D<s[L+1]);L++);const j=Sv(s[L],s[L+1],D);return T[L](j)};return a?D=>I(iu(s[0],s[_-1],D)):I}function Lce(s,i){const a=s[s.length-1];for(let c=1;c<=i;c++){const p=Sv(0,i,c);s.push(Ci(a,1,p))}}function xce(s){const i=[0];return Lce(i,s.length-1),i}function Mce(s,i){return s.map(a=>a*i)}function Uce(s,i){return s.map(()=>i||n8).splice(0,s.length-1)}function XC({duration:s=300,keyframes:i,times:a,ease:c="easeInOut"}){const p=Nce(c)?c.map(M5):M5(c),_={done:!1,value:i[0]},y=Mce(a&&a.length===i.length?a:xce(i),s),T=kce(y,i,{ease:Array.isArray(p)?p:Uce(i,p)});return{calculatedDuration:s,next:C=>(_.value=T(C),_.done=C>=s,_)}}const Vce=s=>{const i=({timestamp:a})=>s(a);return{start:()=>ni.update(i,!0),stop:()=>nu(i),now:()=>Fr.isProcessing?Fr.timestamp:Kc.now()}},Fce={decay:x5,inertia:x5,tween:XC,keyframes:XC,spring:YC},Bce=s=>s/100;class fk extends Qz{constructor(i){super(i),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:C}=this.options;C&&C()};const{name:a,motionValue:c,element:p,keyframes:_}=this.options,y=(p==null?void 0:p.KeyframeResolver)||hk,T=(C,I)=>this.onKeyframesResolved(C,I);this.resolver=new y(_,T,a,c,p),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(i){const{type:a="keyframes",repeat:c=0,repeatDelay:p=0,repeatType:_,velocity:y=0}=this.options,T=zD(a)?a:Fce[a]||XC;let C,I;T!==XC&&typeof i[0]!="number"&&(C=Vv(Bce,e8(i[0],i[1])),i=[0,100]);const D=T({...this.options,keyframes:i});_==="mirror"&&(I=T({...this.options,keyframes:[...i].reverse(),velocity:-y})),D.calculatedDuration===null&&(D.calculatedDuration=KD(D));const{calculatedDuration:L}=D,j=L+p,Y=j*(c+1)-p;return{generator:D,mirroredGenerator:I,mapPercentToKeyframes:C,calculatedDuration:L,resolvedDuration:j,totalDuration:Y}}onPostResolved(){const{autoplay:i=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!i?this.pause():this.state=this.pendingPlayState}tick(i,a=!1){const{resolved:c}=this;if(!c){const{keyframes:rt}=this.options;return{done:!0,value:rt[rt.length-1]}}const{finalKeyframe:p,generator:_,mirroredGenerator:y,mapPercentToKeyframes:T,keyframes:C,calculatedDuration:I,totalDuration:D,resolvedDuration:L}=c;if(this.startTime===null)return _.next(0);const{delay:j,repeat:Y,repeatType:X,repeatDelay:ee,onUpdate:Q}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,i):this.speed<0&&(this.startTime=Math.min(i-D/this.speed,this.startTime)),a?this.currentTime=i:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(i-this.startTime)*this.speed;const se=this.currentTime-j*(this.speed>=0?1:-1),fe=this.speed>=0?se<0:se>D;this.currentTime=Math.max(se,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=D);let me=this.currentTime,Oe=_;if(Y){const rt=Math.min(this.currentTime,D)/L;let dn=Math.floor(rt),tn=rt%1;!tn&&rt>=1&&(tn=1),tn===1&&dn--,dn=Math.min(dn,Y+1),!!(dn%2)&&(X==="reverse"?(tn=1-tn,ee&&(tn-=ee/L)):X==="mirror"&&(Oe=y)),me=iu(0,1,tn)*L}const Ve=fe?{done:!1,value:C[0]}:Oe.next(me);T&&(Ve.value=T(Ve.value));let{done:Ze}=Ve;!fe&&I!==null&&(Ze=this.speed>=0?this.currentTime>=D:this.currentTime<=0);const ut=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&Ze);return ut&&p!==void 0&&(Ve.value=Tb(C,this.options,p)),Q&&Q(Ve.value),ut&&this.finish(),Ve}get duration(){const{resolved:i}=this;return i?Hc(i.calculatedDuration):0}get time(){return Hc(this.currentTime)}set time(i){i=zc(i),this.currentTime=i,this.holdTime!==null||this.speed===0?this.holdTime=i:this.driver&&(this.startTime=this.driver.now()-i/this.speed)}get speed(){return this.playbackSpeed}set speed(i){const a=this.playbackSpeed!==i;this.playbackSpeed=i,a&&(this.time=Hc(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:i=Vce,onPlay:a,startTime:c}=this.options;this.driver||(this.driver=i(_=>this.tick(_))),a&&a();const p=this.driver.now();this.holdTime!==null?this.startTime=p-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=p):this.startTime=c??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=this.currentTime??0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:i}=this.options;i&&i()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(i){return this.startTime=0,this.tick(i,!0)}get finished(){return this.currentFinishedPromise}}const jce=new Set(["opacity","clipPath","filter","transform"]),Gce=jD(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),JC=10,Wce=2e4;function zce(s){return zD(s.type)||s.type==="spring"||!sz(s.ease)}function Hce(s,i){const a=new fk({...i,keyframes:s,repeat:0,delay:0,isGenerator:!0});let c={done:!1,value:s[0]};const p=[];let _=0;for(;!c.done&&_<Wce;)c=a.sample(_),p.push(c.value),_+=JC;return{times:void 0,keyframes:p,duration:_-JC,ease:"linear"}}const i8={anticipate:Lz,backInOut:kz,circInOut:Mz};function Kce(s){return s in i8}class U5 extends Qz{constructor(i){super(i);const{name:a,motionValue:c,element:p,keyframes:_}=this.options;this.resolver=new $z(_,(y,T)=>this.onKeyframesResolved(y,T),a,c,p),this.resolver.scheduleResolve()}initPlayback(i,a){let{duration:c=300,times:p,ease:_,type:y,motionValue:T,name:C,startTime:I}=this.options;if(!T.owner||!T.owner.current)return!1;if(typeof _=="string"&&Tv()&&Kce(_)&&(_=i8[_]),zce(this.options)){const{onComplete:L,onUpdate:j,motionValue:Y,element:X,...ee}=this.options,Q=Hce(i,ee);i=Q.keyframes,i.length===1&&(i[1]=i[0]),c=Q.duration,p=Q.times,_=Q.ease,y="keyframes"}const D=woe(T.owner.current,C,i,{...this.options,duration:c,times:p,ease:_});return D.startTime=I??this.calcStartTime(),this.pendingTimeline?(d5(D,this.pendingTimeline),this.pendingTimeline=void 0):D.onfinish=()=>{const{onComplete:L}=this.options;T.set(Tb(i,this.options,a)),L&&L(),this.cancel(),this.resolveFinishedPromise()},{animation:D,duration:c,times:p,type:y,ease:_,keyframes:i}}get duration(){const{resolved:i}=this;if(!i)return 0;const{duration:a}=i;return Hc(a)}get time(){const{resolved:i}=this;if(!i)return 0;const{animation:a}=i;return Hc(a.currentTime||0)}set time(i){const{resolved:a}=this;if(!a)return;const{animation:c}=a;c.currentTime=zc(i)}get speed(){const{resolved:i}=this;if(!i)return 1;const{animation:a}=i;return a.playbackRate}get finished(){return this.resolved.animation.finished}set speed(i){const{resolved:a}=this;if(!a)return;const{animation:c}=a;c.playbackRate=i}get state(){const{resolved:i}=this;if(!i)return"idle";const{animation:a}=i;return a.playState}get startTime(){const{resolved:i}=this;if(!i)return null;const{animation:a}=i;return a.startTime}attachTimeline(i){if(!this._resolved)this.pendingTimeline=i;else{const{resolved:a}=this;if(!a)return oa;const{animation:c}=a;d5(c,i)}return oa}play(){if(this.isStopped)return;const{resolved:i}=this;if(!i)return;const{animation:a}=i;a.playState==="finished"&&this.updateFinishedPromise(),a.play()}pause(){const{resolved:i}=this;if(!i)return;const{animation:a}=i;a.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:i}=this;if(!i)return;const{animation:a,keyframes:c,duration:p,type:_,ease:y,times:T}=i;if(a.playState==="idle"||a.playState==="finished")return;if(this.time){const{motionValue:I,onUpdate:D,onComplete:L,element:j,...Y}=this.options,X=new fk({...Y,keyframes:c,duration:p,type:_,ease:y,times:T,isGenerator:!0}),ee=zc(this.time);I.setWithVelocity(X.sample(ee-JC).value,X.sample(ee).value,JC)}const{onStop:C}=this.options;C&&C(),this.cancel()}complete(){const{resolved:i}=this;i&&i.animation.finish()}cancel(){const{resolved:i}=this;i&&i.animation.cancel()}static supports(i){const{motionValue:a,name:c,repeatDelay:p,repeatType:_,damping:y,type:T}=i;if(!a||!a.owner||!(a.owner.current instanceof HTMLElement))return!1;const{onUpdate:C,transformTemplate:I}=a.owner.getProps();return Gce()&&c&&jce.has(c)&&(c!=="transform"||!I)&&!C&&!p&&_!=="mirror"&&y!==0&&T!=="inertia"}}const qce={type:"spring",stiffness:500,damping:25,restSpeed:10},Yce=s=>({type:"spring",stiffness:550,damping:s===0?2*Math.sqrt(550):30,restSpeed:10}),Xce={type:"keyframes",duration:.8},Jce={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},$ce=(s,{keyframes:i})=>i.length>2?Xce:zp.has(s)?s.startsWith("scale")?Yce(i[1]):qce:Jce;function Qce({when:s,delay:i,delayChildren:a,staggerChildren:c,staggerDirection:p,repeat:_,repeatType:y,repeatDelay:T,from:C,elapsed:I,...D}){return!!Object.keys(D).length}const mk=(s,i,a,c={},p,_)=>y=>{const T=HD(c,s)||{},C=T.delay||c.delay||0;let{elapsed:I=0}=c;I=I-zc(C);let D={keyframes:Array.isArray(a)?a:[null,a],ease:"easeOut",velocity:i.getVelocity(),...T,delay:-I,onUpdate:j=>{i.set(j),T.onUpdate&&T.onUpdate(j)},onComplete:()=>{y(),T.onComplete&&T.onComplete()},name:s,motionValue:i,element:_?void 0:p};Qce(T)||(D={...D,...$ce(s,D)}),D.duration&&(D.duration=zc(D.duration)),D.repeatDelay&&(D.repeatDelay=zc(D.repeatDelay)),D.from!==void 0&&(D.keyframes[0]=D.from);let L=!1;if((D.type===!1||D.duration===0&&!D.repeatDelay)&&(D.duration=0,D.delay===0&&(L=!0)),D.allowFlatten=!T.type&&!T.ease,L&&!_&&i.get()!==void 0){const j=Tb(D.keyframes,T);if(j!==void 0)return ni.update(()=>{D.onUpdate(j),D.onComplete()}),new Soe([])}return!_&&U5.supports(D)?new U5(D):new fk(D)};function Zce({protectedKeys:s,needsAnimating:i},a){const c=s.hasOwnProperty(a)&&i[a]!==!0;return i[a]=!1,c}function r8(s,i,{delay:a=0,transitionOverride:c,type:p}={}){let{transition:_=s.getDefaultTransition(),transitionEnd:y,...T}=i;c&&(_=c);const C=[],I=p&&s.animationState&&s.animationState.getState()[p];for(const D in T){const L=s.getValue(D,s.latestValues[D]??null),j=T[D];if(j===void 0||I&&Zce(I,D))continue;const Y={delay:a,...HD(_||{},D)};let X=!1;if(window.MotionHandoffAnimation){const Q=Iz(s);if(Q){const se=window.MotionHandoffAnimation(Q,D,ni);se!==null&&(Y.startTime=se,X=!0)}}HP(s,D),L.start(mk(D,L,j,s.shouldReduceMotion&&Az.has(D)?{type:!1}:Y,s,X));const ee=L.animation;ee&&C.push(ee)}return y&&Promise.all(C).then(()=>{ni.update(()=>{y&&Iae(s,y)})}),C}function tD(s,i,a={}){var C;const c=Av(s,i,a.type==="exit"?(C=s.presenceContext)==null?void 0:C.custom:void 0);let{transition:p=s.getDefaultTransition()||{}}=c||{};a.transitionOverride&&(p=a.transitionOverride);const _=c?()=>Promise.all(r8(s,c,a)):()=>Promise.resolve(),y=s.variantChildren&&s.variantChildren.size?(I=0)=>{const{delayChildren:D=0,staggerChildren:L,staggerDirection:j}=p;return ele(s,i,D+I,L,j,a)}:()=>Promise.resolve(),{when:T}=p;if(T){const[I,D]=T==="beforeChildren"?[_,y]:[y,_];return I().then(()=>D())}else return Promise.all([_(),y(a.delay)])}function ele(s,i,a=0,c=0,p=1,_){const y=[],T=(s.variantChildren.size-1)*c,C=p===1?(I=0)=>I*c:(I=0)=>T-I*c;return Array.from(s.variantChildren).sort(tle).forEach((I,D)=>{I.notify("AnimationStart",i),y.push(tD(I,i,{..._,delay:a+C(D)}).then(()=>I.notify("AnimationComplete",i)))}),Promise.all(y)}function tle(s,i){return s.sortNodePosition(i)}function nle(s,i,a={}){s.notify("AnimationStart",i);let c;if(Array.isArray(i)){const p=i.map(_=>tD(s,_,a));c=Promise.all(p)}else if(typeof i=="string")c=tD(s,i,a);else{const p=typeof i=="function"?Av(s,i,a.custom):i;c=Promise.all(r8(s,p,a))}return c.then(()=>{s.notify("AnimationComplete",i)})}function s8(s,i){if(!Array.isArray(i))return!1;const a=i.length;if(a!==s.length)return!1;for(let c=0;c<a;c++)if(i[c]!==s[c])return!1;return!0}const ile=JD.length;function o8(s){if(!s)return;if(!s.isControllingVariants){const a=s.parent?o8(s.parent)||{}:{};return s.props.initial!==void 0&&(a.initial=s.props.initial),a}const i={};for(let a=0;a<ile;a++){const c=JD[a],p=s.props[c];(wv(p)||p===!1)&&(i[c]=p)}return i}const rle=[...XD].reverse(),sle=XD.length;function ole(s){return i=>Promise.all(i.map(({animation:a,options:c})=>nle(s,a,c)))}function ale(s){let i=ole(s),a=V5(),c=!0;const p=C=>(I,D)=>{var j;const L=Av(s,D,C==="exit"?(j=s.presenceContext)==null?void 0:j.custom:void 0);if(L){const{transition:Y,transitionEnd:X,...ee}=L;I={...I,...ee,...X}}return I};function _(C){i=C(s)}function y(C){const{props:I}=s,D=o8(s.parent)||{},L=[],j=new Set;let Y={},X=1/0;for(let Q=0;Q<sle;Q++){const se=rle[Q],fe=a[se],me=I[se]!==void 0?I[se]:D[se],Oe=wv(me),Ve=se===C?fe.isActive:null;Ve===!1&&(X=Q);let Ze=me===D[se]&&me!==I[se]&&Oe;if(Ze&&c&&s.manuallyAnimateOnMount&&(Ze=!1),fe.protectedKeys={...Y},!fe.isActive&&Ve===null||!me&&!fe.prevProp||vb(me)||typeof me=="boolean")continue;const ut=cle(fe.prevProp,me);let rt=ut||se===C&&fe.isActive&&!Ze&&Oe||Q>X&&Oe,dn=!1;const tn=Array.isArray(me)?me:[me];let bi=tn.reduce(p(se),{});Ve===!1&&(bi={});const{prevResolvedValues:Ai={}}=fe,Qi={...Ai,...bi},qt=Yt=>{rt=!0,j.has(Yt)&&(dn=!0,j.delete(Yt)),fe.needsAnimating[Yt]=!0;const ze=s.getValue(Yt);ze&&(ze.liveStyle=!1)};for(const Yt in Qi){const ze=bi[Yt],Xe=Ai[Yt];if(Y.hasOwnProperty(Yt))continue;let $e=!1;zP(ze)&&zP(Xe)?$e=!s8(ze,Xe):$e=ze!==Xe,$e?ze!=null?qt(Yt):j.add(Yt):ze!==void 0&&j.has(Yt)?qt(Yt):fe.protectedKeys[Yt]=!0}fe.prevProp=me,fe.prevResolvedValues=bi,fe.isActive&&(Y={...Y,...bi}),c&&s.blockInitialAnimation&&(rt=!1),rt&&(!(Ze&&ut)||dn)&&L.push(...tn.map(Yt=>({animation:Yt,options:{type:se}})))}if(j.size){const Q={};if(typeof I.initial!="boolean"){const se=Av(s,Array.isArray(I.initial)?I.initial[0]:I.initial);se&&se.transition&&(Q.transition=se.transition)}j.forEach(se=>{const fe=s.getBaseTarget(se),me=s.getValue(se);me&&(me.liveStyle=!0),Q[se]=fe??null}),L.push({animation:Q})}let ee=!!L.length;return c&&(I.initial===!1||I.initial===I.animate)&&!s.manuallyAnimateOnMount&&(ee=!1),c=!1,ee?i(L):Promise.resolve()}function T(C,I){var L;if(a[C].isActive===I)return Promise.resolve();(L=s.variantChildren)==null||L.forEach(j=>{var Y;return(Y=j.animationState)==null?void 0:Y.setActive(C,I)}),a[C].isActive=I;const D=y(C);for(const j in a)a[j].protectedKeys={};return D}return{animateChanges:y,setActive:T,setAnimateFunction:_,getState:()=>a,reset:()=>{a=V5(),c=!0}}}function cle(s,i){return typeof i=="string"?i!==s:Array.isArray(i)?!s8(i,s):!1}function _p(s=!1){return{isActive:s,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function V5(){return{animate:_p(!0),whileInView:_p(),whileHover:_p(),whileTap:_p(),whileDrag:_p(),whileFocus:_p(),exit:_p()}}class Ld{constructor(i){this.isMounted=!1,this.node=i}update(){}}class lle extends Ld{constructor(i){super(i),i.animationState||(i.animationState=ale(i))}updateAnimationControlsSubscription(){const{animate:i}=this.node.getProps();vb(i)&&(this.unmountControls=i.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:i}=this.node.getProps(),{animate:a}=this.node.prevProps||{};i!==a&&this.updateAnimationControlsSubscription()}unmount(){var i;this.node.animationState.reset(),(i=this.unmountControls)==null||i.call(this)}}let ule=0;class dle extends Ld{constructor(){super(...arguments),this.id=ule++}update(){if(!this.node.presenceContext)return;const{isPresent:i,onExitComplete:a}=this.node.presenceContext,{isPresent:c}=this.node.prevPresenceContext||{};if(!this.node.animationState||i===c)return;const p=this.node.animationState.setActive("exit",!i);a&&!i&&p.then(()=>{a(this.id)})}mount(){const{register:i,onExitComplete:a}=this.node.presenceContext||{};a&&a(this.id),i&&(this.unmount=i(this.id))}unmount(){}}const hle={animation:{Feature:lle},exit:{Feature:dle}};function Ov(s,i,a,c={passive:!0}){return s.addEventListener(i,a,c),()=>s.removeEventListener(i,a)}function Fv(s){return{point:{x:s.pageX,y:s.pageY}}}const ple=s=>i=>YD(i)&&s(i,Fv(i));function dv(s,i,a,c){return Ov(s,i,ple(a),c)}function a8({top:s,left:i,right:a,bottom:c}){return{x:{min:i,max:a},y:{min:s,max:c}}}function fle({x:s,y:i}){return{top:i.min,right:s.max,bottom:i.max,left:s.min}}function mle(s,i){if(!i)return s;const a=i({x:s.left,y:s.top}),c=i({x:s.right,y:s.bottom});return{top:a.y,left:a.x,bottom:c.y,right:c.x}}const c8=1e-4,gle=1-c8,_le=1+c8,l8=.01,Ele=0-l8,yle=0+l8;function As(s){return s.max-s.min}function vle(s,i,a){return Math.abs(s-i)<=a}function F5(s,i,a,c=.5){s.origin=c,s.originPoint=Ci(i.min,i.max,s.origin),s.scale=As(a)/As(i),s.translate=Ci(a.min,a.max,s.origin)-s.originPoint,(s.scale>=gle&&s.scale<=_le||isNaN(s.scale))&&(s.scale=1),(s.translate>=Ele&&s.translate<=yle||isNaN(s.translate))&&(s.translate=0)}function hv(s,i,a,c){F5(s.x,i.x,a.x,c?c.originX:void 0),F5(s.y,i.y,a.y,c?c.originY:void 0)}function B5(s,i,a){s.min=a.min+i.min,s.max=s.min+As(i)}function Sle(s,i,a){B5(s.x,i.x,a.x),B5(s.y,i.y,a.y)}function j5(s,i,a){s.min=i.min-a.min,s.max=s.min+As(i)}function pv(s,i,a){j5(s.x,i.x,a.x),j5(s.y,i.y,a.y)}const G5=()=>({translate:0,scale:1,origin:0,originPoint:0}),Ng=()=>({x:G5(),y:G5()}),W5=()=>({min:0,max:0}),Ki=()=>({x:W5(),y:W5()});function na(s){return[s("x"),s("y")]}function HN(s){return s===void 0||s===1}function nD({scale:s,scaleX:i,scaleY:a}){return!HN(s)||!HN(i)||!HN(a)}function wp(s){return nD(s)||u8(s)||s.z||s.rotate||s.rotateX||s.rotateY||s.skewX||s.skewY}function u8(s){return z5(s.x)||z5(s.y)}function z5(s){return s&&s!=="0%"}function $C(s,i,a){const c=s-a,p=i*c;return a+p}function H5(s,i,a,c,p){return p!==void 0&&(s=$C(s,p,c)),$C(s,a,c)+i}function iD(s,i=0,a=1,c,p){s.min=H5(s.min,i,a,c,p),s.max=H5(s.max,i,a,c,p)}function d8(s,{x:i,y:a}){iD(s.x,i.translate,i.scale,i.originPoint),iD(s.y,a.translate,a.scale,a.originPoint)}const K5=.999999999999,q5=1.0000000000001;function Tle(s,i,a,c=!1){const p=a.length;if(!p)return;i.x=i.y=1;let _,y;for(let T=0;T<p;T++){_=a[T],y=_.projectionDelta;const{visualElement:C}=_.options;C&&C.props.style&&C.props.style.display==="contents"||(c&&_.options.layoutScroll&&_.scroll&&_!==_.root&&Dg(s,{x:-_.scroll.offset.x,y:-_.scroll.offset.y}),y&&(i.x*=y.x.scale,i.y*=y.y.scale,d8(s,y)),c&&wp(_.latestValues)&&Dg(s,_.latestValues))}i.x<q5&&i.x>K5&&(i.x=1),i.y<q5&&i.y>K5&&(i.y=1)}function Pg(s,i){s.min=s.min+i,s.max=s.max+i}function Y5(s,i,a,c,p=.5){const _=Ci(s.min,s.max,p);iD(s,i,a,_,c)}function Dg(s,i){Y5(s.x,i.x,i.scaleX,i.scale,i.originX),Y5(s.y,i.y,i.scaleY,i.scale,i.originY)}function h8(s,i){return a8(mle(s.getBoundingClientRect(),i))}function Rle(s,i,a){const c=h8(s,a),{scroll:p}=i;return p&&(Pg(c.x,p.offset.x),Pg(c.y,p.offset.y)),c}const p8=({current:s})=>s?s.ownerDocument.defaultView:null,X5=(s,i)=>Math.abs(s-i);function wle(s,i){const a=X5(s.x,i.x),c=X5(s.y,i.y);return Math.sqrt(a**2+c**2)}class f8{constructor(i,a,{transformPagePoint:c,contextWindow:p,dragSnapToOrigin:_=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const L=qN(this.lastMoveEventInfo,this.history),j=this.startEvent!==null,Y=wle(L.offset,{x:0,y:0})>=3;if(!j&&!Y)return;const{point:X}=L,{timestamp:ee}=Fr;this.history.push({...X,timestamp:ee});const{onStart:Q,onMove:se}=this.handlers;j||(Q&&Q(this.lastMoveEvent,L),this.startEvent=this.lastMoveEvent),se&&se(this.lastMoveEvent,L)},this.handlePointerMove=(L,j)=>{this.lastMoveEvent=L,this.lastMoveEventInfo=KN(j,this.transformPagePoint),ni.update(this.updatePoint,!0)},this.handlePointerUp=(L,j)=>{this.end();const{onEnd:Y,onSessionEnd:X,resumeAnimation:ee}=this.handlers;if(this.dragSnapToOrigin&&ee&&ee(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const Q=qN(L.type==="pointercancel"?this.lastMoveEventInfo:KN(j,this.transformPagePoint),this.history);this.startEvent&&Y&&Y(L,Q),X&&X(L,Q)},!YD(i))return;this.dragSnapToOrigin=_,this.handlers=a,this.transformPagePoint=c,this.contextWindow=p||window;const y=Fv(i),T=KN(y,this.transformPagePoint),{point:C}=T,{timestamp:I}=Fr;this.history=[{...C,timestamp:I}];const{onSessionStart:D}=a;D&&D(i,qN(T,this.history)),this.removeListeners=Vv(dv(this.contextWindow,"pointermove",this.handlePointerMove),dv(this.contextWindow,"pointerup",this.handlePointerUp),dv(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(i){this.handlers=i}end(){this.removeListeners&&this.removeListeners(),nu(this.updatePoint)}}function KN(s,i){return i?{point:i(s.point)}:s}function J5(s,i){return{x:s.x-i.x,y:s.y-i.y}}function qN({point:s},i){return{point:s,delta:J5(s,m8(i)),offset:J5(s,Cle(i)),velocity:ble(i,.1)}}function Cle(s){return s[0]}function m8(s){return s[s.length-1]}function ble(s,i){if(s.length<2)return{x:0,y:0};let a=s.length-1,c=null;const p=m8(s);for(;a>=0&&(c=s[a],!(p.timestamp-c.timestamp>zc(i)));)a--;if(!c)return{x:0,y:0};const _=Hc(p.timestamp-c.timestamp);if(_===0)return{x:0,y:0};const y={x:(p.x-c.x)/_,y:(p.y-c.y)/_};return y.x===1/0&&(y.x=0),y.y===1/0&&(y.y=0),y}function Ale(s,{min:i,max:a},c){return i!==void 0&&s<i?s=c?Ci(i,s,c.min):Math.max(s,i):a!==void 0&&s>a&&(s=c?Ci(a,s,c.max):Math.min(s,a)),s}function $5(s,i,a){return{min:i!==void 0?s.min+i:void 0,max:a!==void 0?s.max+a-(s.max-s.min):void 0}}function Ile(s,{top:i,left:a,bottom:c,right:p}){return{x:$5(s.x,a,p),y:$5(s.y,i,c)}}function Q5(s,i){let a=i.min-s.min,c=i.max-s.max;return i.max-i.min<s.max-s.min&&([a,c]=[c,a]),{min:a,max:c}}function Ole(s,i){return{x:Q5(s.x,i.x),y:Q5(s.y,i.y)}}function Nle(s,i){let a=.5;const c=As(s),p=As(i);return p>c?a=Sv(i.min,i.max-c,s.min):c>p&&(a=Sv(s.min,s.max-p,i.min)),iu(0,1,a)}function Ple(s,i){const a={};return i.min!==void 0&&(a.min=i.min-s.min),i.max!==void 0&&(a.max=i.max-s.min),a}const rD=.35;function Dle(s=rD){return s===!1?s=0:s===!0&&(s=rD),{x:Z5(s,"left","right"),y:Z5(s,"top","bottom")}}function Z5(s,i,a){return{min:e6(s,i),max:e6(s,a)}}function e6(s,i){return typeof s=="number"?s:s[i]||0}const kle=new WeakMap;class Lle{constructor(i){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ki(),this.visualElement=i}start(i,{snapToCursor:a=!1}={}){const{presenceContext:c}=this.visualElement;if(c&&c.isPresent===!1)return;const p=D=>{const{dragSnapToOrigin:L}=this.getProps();L?this.pauseAnimation():this.stopAnimation(),a&&this.snapToCursor(Fv(D).point)},_=(D,L)=>{const{drag:j,dragPropagation:Y,onDragStart:X}=this.getProps();if(j&&!Y&&(this.openDragLock&&this.openDragLock(),this.openDragLock=Ooe(j),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),na(Q=>{let se=this.getAxisMotionValue(Q).get()||0;if(qc.test(se)){const{projection:fe}=this.visualElement;if(fe&&fe.layout){const me=fe.layout.layoutBox[Q];me&&(se=As(me)*(parseFloat(se)/100))}}this.originPoint[Q]=se}),X&&ni.postRender(()=>X(D,L)),HP(this.visualElement,"transform");const{animationState:ee}=this.visualElement;ee&&ee.setActive("whileDrag",!0)},y=(D,L)=>{const{dragPropagation:j,dragDirectionLock:Y,onDirectionLock:X,onDrag:ee}=this.getProps();if(!j&&!this.openDragLock)return;const{offset:Q}=L;if(Y&&this.currentDirection===null){this.currentDirection=xle(Q),this.currentDirection!==null&&X&&X(this.currentDirection);return}this.updateAxis("x",L.point,Q),this.updateAxis("y",L.point,Q),this.visualElement.render(),ee&&ee(D,L)},T=(D,L)=>this.stop(D,L),C=()=>na(D=>{var L;return this.getAnimationState(D)==="paused"&&((L=this.getAxisMotionValue(D).animation)==null?void 0:L.play())}),{dragSnapToOrigin:I}=this.getProps();this.panSession=new f8(i,{onSessionStart:p,onStart:_,onMove:y,onSessionEnd:T,resumeAnimation:C},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:I,contextWindow:p8(this.visualElement)})}stop(i,a){const c=this.isDragging;if(this.cancel(),!c)return;const{velocity:p}=a;this.startAnimation(p);const{onDragEnd:_}=this.getProps();_&&ni.postRender(()=>_(i,a))}cancel(){this.isDragging=!1;const{projection:i,animationState:a}=this.visualElement;i&&(i.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:c}=this.getProps();!c&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),a&&a.setActive("whileDrag",!1)}updateAxis(i,a,c){const{drag:p}=this.getProps();if(!c||!dC(i,p,this.currentDirection))return;const _=this.getAxisMotionValue(i);let y=this.originPoint[i]+c[i];this.constraints&&this.constraints[i]&&(y=Ale(y,this.constraints[i],this.elastic[i])),_.set(y)}resolveConstraints(){var _;const{dragConstraints:i,dragElastic:a}=this.getProps(),c=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(_=this.visualElement.projection)==null?void 0:_.layout,p=this.constraints;i&&Ig(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&c?this.constraints=Ile(c.layoutBox,i):this.constraints=!1,this.elastic=Dle(a),p!==this.constraints&&c&&this.constraints&&!this.hasMutatedConstraints&&na(y=>{this.constraints!==!1&&this.getAxisMotionValue(y)&&(this.constraints[y]=Ple(c.layoutBox[y],this.constraints[y]))})}resolveRefConstraints(){const{dragConstraints:i,onMeasureDragConstraints:a}=this.getProps();if(!i||!Ig(i))return!1;const c=i.current,{projection:p}=this.visualElement;if(!p||!p.layout)return!1;const _=Rle(c,p.root,this.visualElement.getTransformPagePoint());let y=Ole(p.layout.layoutBox,_);if(a){const T=a(fle(y));this.hasMutatedConstraints=!!T,T&&(y=a8(T))}return y}startAnimation(i){const{drag:a,dragMomentum:c,dragElastic:p,dragTransition:_,dragSnapToOrigin:y,onDragTransitionEnd:T}=this.getProps(),C=this.constraints||{},I=na(D=>{if(!dC(D,a,this.currentDirection))return;let L=C&&C[D]||{};y&&(L={min:0,max:0});const j=p?200:1e6,Y=p?40:1e7,X={type:"inertia",velocity:c?i[D]:0,bounceStiffness:j,bounceDamping:Y,timeConstant:750,restDelta:1,restSpeed:10,..._,...L};return this.startAxisValueAnimation(D,X)});return Promise.all(I).then(T)}startAxisValueAnimation(i,a){const c=this.getAxisMotionValue(i);return HP(this.visualElement,i),c.start(mk(i,c,0,a,this.visualElement,!1))}stopAnimation(){na(i=>this.getAxisMotionValue(i).stop())}pauseAnimation(){na(i=>{var a;return(a=this.getAxisMotionValue(i).animation)==null?void 0:a.pause()})}getAnimationState(i){var a;return(a=this.getAxisMotionValue(i).animation)==null?void 0:a.state}getAxisMotionValue(i){const a=`_drag${i.toUpperCase()}`,c=this.visualElement.getProps(),p=c[a];return p||this.visualElement.getValue(i,(c.initial?c.initial[i]:void 0)||0)}snapToCursor(i){na(a=>{const{drag:c}=this.getProps();if(!dC(a,c,this.currentDirection))return;const{projection:p}=this.visualElement,_=this.getAxisMotionValue(a);if(p&&p.layout){const{min:y,max:T}=p.layout.layoutBox[a];_.set(i[a]-Ci(y,T,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:i,dragConstraints:a}=this.getProps(),{projection:c}=this.visualElement;if(!Ig(a)||!c||!this.constraints)return;this.stopAnimation();const p={x:0,y:0};na(y=>{const T=this.getAxisMotionValue(y);if(T&&this.constraints!==!1){const C=T.get();p[y]=Nle({min:C,max:C},this.constraints[y])}});const{transformTemplate:_}=this.visualElement.getProps();this.visualElement.current.style.transform=_?_({},""):"none",c.root&&c.root.updateScroll(),c.updateLayout(),this.resolveConstraints(),na(y=>{if(!dC(y,i,null))return;const T=this.getAxisMotionValue(y),{min:C,max:I}=this.constraints[y];T.set(Ci(C,I,p[y]))})}addListeners(){if(!this.visualElement.current)return;kle.set(this.visualElement,this);const i=this.visualElement.current,a=dv(i,"pointerdown",C=>{const{drag:I,dragListener:D=!0}=this.getProps();I&&D&&this.start(C)}),c=()=>{const{dragConstraints:C}=this.getProps();Ig(C)&&C.current&&(this.constraints=this.resolveRefConstraints())},{projection:p}=this.visualElement,_=p.addEventListener("measure",c);p&&!p.layout&&(p.root&&p.root.updateScroll(),p.updateLayout()),ni.read(c);const y=Ov(window,"resize",()=>this.scalePositionWithinConstraints()),T=p.addEventListener("didUpdate",({delta:C,hasLayoutChanged:I})=>{this.isDragging&&I&&(na(D=>{const L=this.getAxisMotionValue(D);L&&(this.originPoint[D]+=C[D].translate,L.set(L.get()+C[D].translate))}),this.visualElement.render())});return()=>{y(),a(),_(),T&&T()}}getProps(){const i=this.visualElement.getProps(),{drag:a=!1,dragDirectionLock:c=!1,dragPropagation:p=!1,dragConstraints:_=!1,dragElastic:y=rD,dragMomentum:T=!0}=i;return{...i,drag:a,dragDirectionLock:c,dragPropagation:p,dragConstraints:_,dragElastic:y,dragMomentum:T}}}function dC(s,i,a){return(i===!0||i===s)&&(a===null||a===s)}function xle(s,i=10){let a=null;return Math.abs(s.y)>i?a="y":Math.abs(s.x)>i&&(a="x"),a}class Mle extends Ld{constructor(i){super(i),this.removeGroupControls=oa,this.removeListeners=oa,this.controls=new Lle(i)}mount(){const{dragControls:i}=this.node.getProps();i&&(this.removeGroupControls=i.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||oa}unmount(){this.removeGroupControls(),this.removeListeners()}}const t6=s=>(i,a)=>{s&&ni.postRender(()=>s(i,a))};class Ule extends Ld{constructor(){super(...arguments),this.removePointerDownListener=oa}onPointerDown(i){this.session=new f8(i,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:p8(this.node)})}createPanHandlers(){const{onPanSessionStart:i,onPanStart:a,onPan:c,onPanEnd:p}=this.node.getProps();return{onSessionStart:t6(i),onStart:t6(a),onMove:c,onEnd:(_,y)=>{delete this.session,p&&ni.postRender(()=>p(_,y))}}}mount(){this.removePointerDownListener=dv(this.node.current,"pointerdown",i=>this.onPointerDown(i))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const DC={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function n6(s,i){return i.max===i.min?0:s/(i.max-i.min)*100}const Zy={correct:(s,i)=>{if(!i.target)return s;if(typeof s=="string")if(It.test(s))s=parseFloat(s);else return s;const a=n6(s,i.target.x),c=n6(s,i.target.y);return`${a}% ${c}%`}},Vle={correct:(s,{treeScale:i,projectionDelta:a})=>{const c=s,p=bd.parse(s);if(p.length>5)return c;const _=bd.createTransformer(s),y=typeof p[0]!="number"?1:0,T=a.x.scale*i.x,C=a.y.scale*i.y;p[0+y]/=T,p[1+y]/=C;const I=Ci(T,C,.5);return typeof p[2+y]=="number"&&(p[2+y]/=I),typeof p[3+y]=="number"&&(p[3+y]/=I),_(p)}};class Fle extends _e.Component{componentDidMount(){const{visualElement:i,layoutGroup:a,switchLayoutGroup:c,layoutId:p}=this.props,{projection:_}=i;nae(Ble),_&&(a.group&&a.group.add(_),c&&c.register&&p&&c.register(_),_.root.didUpdate(),_.addEventListener("animationComplete",()=>{this.safeToRemove()}),_.setOptions({..._.options,onExitComplete:()=>this.safeToRemove()})),DC.hasEverUpdated=!0}getSnapshotBeforeUpdate(i){const{layoutDependency:a,visualElement:c,drag:p,isPresent:_}=this.props,y=c.projection;return y&&(y.isPresent=_,p||i.layoutDependency!==a||a===void 0||i.isPresent!==_?y.willUpdate():this.safeToRemove(),i.isPresent!==_&&(_?y.promote():y.relegate()||ni.postRender(()=>{const T=y.getStack();(!T||!T.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:i}=this.props.visualElement;i&&(i.root.didUpdate(),qD.postRender(()=>{!i.currentAnimation&&i.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:i,layoutGroup:a,switchLayoutGroup:c}=this.props,{projection:p}=i;p&&(p.scheduleCheckAfterUnmount(),a&&a.group&&a.group.remove(p),c&&c.deregister&&c.deregister(p))}safeToRemove(){const{safeToRemove:i}=this.props;i&&i()}render(){return null}}function g8(s){const[i,a]=Eoe(),c=_e.useContext(ZW);return H.jsx(Fle,{...s,layoutGroup:c,switchLayoutGroup:_e.useContext(fz),isPresent:i,safeToRemove:a})}const Ble={borderRadius:{...Zy,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Zy,borderTopRightRadius:Zy,borderBottomLeftRadius:Zy,borderBottomRightRadius:Zy,boxShadow:Vle};function jle(s,i,a){const c=as(s)?s:Rv(s);return c.start(mk("",c,i,a)),c.animation}function Gle(s){return s instanceof SVGElement&&s.tagName!=="svg"}const Wle=(s,i)=>s.depth-i.depth;class zle{constructor(){this.children=[],this.isDirty=!1}add(i){FD(this.children,i),this.isDirty=!0}remove(i){BD(this.children,i),this.isDirty=!0}forEach(i){this.isDirty&&this.children.sort(Wle),this.isDirty=!1,this.children.forEach(i)}}function Hle(s,i){const a=Kc.now(),c=({timestamp:p})=>{const _=p-a;_>=i&&(nu(c),s(_-i))};return ni.read(c,!0),()=>nu(c)}const _8=["TopLeft","TopRight","BottomLeft","BottomRight"],Kle=_8.length,i6=s=>typeof s=="string"?parseFloat(s):s,r6=s=>typeof s=="number"||It.test(s);function qle(s,i,a,c,p,_){p?(s.opacity=Ci(0,a.opacity!==void 0?a.opacity:1,Yle(c)),s.opacityExit=Ci(i.opacity!==void 0?i.opacity:1,0,Xle(c))):_&&(s.opacity=Ci(i.opacity!==void 0?i.opacity:1,a.opacity!==void 0?a.opacity:1,c));for(let y=0;y<Kle;y++){const T=`border${_8[y]}Radius`;let C=s6(i,T),I=s6(a,T);if(C===void 0&&I===void 0)continue;C||(C=0),I||(I=0),C===0||I===0||r6(C)===r6(I)?(s[T]=Math.max(Ci(i6(C),i6(I),c),0),(qc.test(I)||qc.test(C))&&(s[T]+="%")):s[T]=I}(i.rotate||a.rotate)&&(s.rotate=Ci(i.rotate||0,a.rotate||0,c))}function s6(s,i){return s[i]!==void 0?s[i]:s.borderRadius}const Yle=E8(0,.5,xz),Xle=E8(.5,.95,oa);function E8(s,i,a){return c=>c<s?0:c>i?1:a(Sv(s,i,c))}function o6(s,i){s.min=i.min,s.max=i.max}function ea(s,i){o6(s.x,i.x),o6(s.y,i.y)}function a6(s,i){s.translate=i.translate,s.scale=i.scale,s.originPoint=i.originPoint,s.origin=i.origin}function c6(s,i,a,c,p){return s-=i,s=$C(s,1/a,c),p!==void 0&&(s=$C(s,1/p,c)),s}function Jle(s,i=0,a=1,c=.5,p,_=s,y=s){if(qc.test(i)&&(i=parseFloat(i),i=Ci(y.min,y.max,i/100)-y.min),typeof i!="number")return;let T=Ci(_.min,_.max,c);s===_&&(T-=i),s.min=c6(s.min,i,a,T,p),s.max=c6(s.max,i,a,T,p)}function l6(s,i,[a,c,p],_,y){Jle(s,i[a],i[c],i[p],i.scale,_,y)}const $le=["x","scaleX","originX"],Qle=["y","scaleY","originY"];function u6(s,i,a,c){l6(s.x,i,$le,a?a.x:void 0,c?c.x:void 0),l6(s.y,i,Qle,a?a.y:void 0,c?c.y:void 0)}function d6(s){return s.translate===0&&s.scale===1}function y8(s){return d6(s.x)&&d6(s.y)}function h6(s,i){return s.min===i.min&&s.max===i.max}function Zle(s,i){return h6(s.x,i.x)&&h6(s.y,i.y)}function p6(s,i){return Math.round(s.min)===Math.round(i.min)&&Math.round(s.max)===Math.round(i.max)}function v8(s,i){return p6(s.x,i.x)&&p6(s.y,i.y)}function f6(s){return As(s.x)/As(s.y)}function m6(s,i){return s.translate===i.translate&&s.scale===i.scale&&s.originPoint===i.originPoint}class eue{constructor(){this.members=[]}add(i){FD(this.members,i),i.scheduleRender()}remove(i){if(BD(this.members,i),i===this.prevLead&&(this.prevLead=void 0),i===this.lead){const a=this.members[this.members.length-1];a&&this.promote(a)}}relegate(i){const a=this.members.findIndex(p=>i===p);if(a===0)return!1;let c;for(let p=a;p>=0;p--){const _=this.members[p];if(_.isPresent!==!1){c=_;break}}return c?(this.promote(c),!0):!1}promote(i,a){const c=this.lead;if(i!==c&&(this.prevLead=c,this.lead=i,i.show(),c)){c.instance&&c.scheduleRender(),i.scheduleRender(),i.resumeFrom=c,a&&(i.resumeFrom.preserveOpacity=!0),c.snapshot&&(i.snapshot=c.snapshot,i.snapshot.latestValues=c.animationValues||c.latestValues),i.root&&i.root.isUpdating&&(i.isLayoutDirty=!0);const{crossfade:p}=i.options;p===!1&&c.hide()}}exitAnimationComplete(){this.members.forEach(i=>{const{options:a,resumingFrom:c}=i;a.onExitComplete&&a.onExitComplete(),c&&c.options.onExitComplete&&c.options.onExitComplete()})}scheduleRender(){this.members.forEach(i=>{i.instance&&i.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function tue(s,i,a){let c="";const p=s.x.translate/i.x,_=s.y.translate/i.y,y=(a==null?void 0:a.z)||0;if((p||_||y)&&(c=`translate3d(${p}px, ${_}px, ${y}px) `),(i.x!==1||i.y!==1)&&(c+=`scale(${1/i.x}, ${1/i.y}) `),a){const{transformPerspective:I,rotate:D,rotateX:L,rotateY:j,skewX:Y,skewY:X}=a;I&&(c=`perspective(${I}px) ${c}`),D&&(c+=`rotate(${D}deg) `),L&&(c+=`rotateX(${L}deg) `),j&&(c+=`rotateY(${j}deg) `),Y&&(c+=`skewX(${Y}deg) `),X&&(c+=`skewY(${X}deg) `)}const T=s.x.scale*i.x,C=s.y.scale*i.y;return(T!==1||C!==1)&&(c+=`scale(${T}, ${C})`),c||"none"}const YN=["","X","Y","Z"],nue={visibility:"hidden"},g6=1e3;let iue=0;function XN(s,i,a,c){const{latestValues:p}=i;p[s]&&(a[s]=p[s],i.setStaticValue(s,0),c&&(c[s]=0))}function S8(s){if(s.hasCheckedOptimisedAppear=!0,s.root===s)return;const{visualElement:i}=s.options;if(!i)return;const a=Iz(i);if(window.MotionHasOptimisedAnimation(a,"transform")){const{layout:p,layoutId:_}=s.options;window.MotionCancelOptimisedAnimation(a,"transform",ni,!(p||_))}const{parent:c}=s;c&&!c.hasCheckedOptimisedAppear&&S8(c)}function T8({attachResizeListener:s,defaultParent:i,measureScroll:a,checkIsScrollRoot:c,resetTransform:p}){return class{constructor(y={},T=i==null?void 0:i()){this.id=iue++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(oue),this.nodes.forEach(due),this.nodes.forEach(hue),this.nodes.forEach(aue)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=y,this.root=T?T.root||T:this,this.path=T?[...T.path,T]:[],this.parent=T,this.depth=T?T.depth+1:0;for(let C=0;C<this.path.length;C++)this.path[C].shouldResetTransform=!0;this.root===this&&(this.nodes=new zle)}addEventListener(y,T){return this.eventHandlers.has(y)||this.eventHandlers.set(y,new GD),this.eventHandlers.get(y).add(T)}notifyListeners(y,...T){const C=this.eventHandlers.get(y);C&&C.notify(...T)}hasListeners(y){return this.eventHandlers.has(y)}mount(y,T=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=Gle(y),this.instance=y;const{layoutId:C,layout:I,visualElement:D}=this.options;if(D&&!D.current&&D.mount(y),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),T&&(I||C)&&(this.isLayoutDirty=!0),s){let L;const j=()=>this.root.updateBlockedByResize=!1;s(y,()=>{this.root.updateBlockedByResize=!0,L&&L(),L=Hle(j,250),DC.hasAnimatedSinceResize&&(DC.hasAnimatedSinceResize=!1,this.nodes.forEach(E6))})}C&&this.root.registerSharedNode(C,this),this.options.animate!==!1&&D&&(C||I)&&this.addEventListener("didUpdate",({delta:L,hasLayoutChanged:j,hasRelativeLayoutChanged:Y,layout:X})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const ee=this.options.transition||D.getDefaultTransition()||_ue,{onLayoutAnimationStart:Q,onLayoutAnimationComplete:se}=D.getProps(),fe=!this.targetLayout||!v8(this.targetLayout,X),me=!j&&Y;if(this.options.layoutRoot||this.resumeFrom||me||j&&(fe||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(L,me);const Oe={...HD(ee,"layout"),onPlay:Q,onComplete:se};(D.shouldReduceMotion||this.options.layoutRoot)&&(Oe.delay=0,Oe.type=!1),this.startAnimation(Oe)}else j||E6(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=X})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const y=this.getStack();y&&y.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,nu(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(pue),this.animationId++)}getTransformTemplate(){const{visualElement:y}=this.options;return y&&y.getProps().transformTemplate}willUpdate(y=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&S8(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let D=0;D<this.path.length;D++){const L=this.path[D];L.shouldResetTransform=!0,L.updateScroll("snapshot"),L.options.layoutRoot&&L.willUpdate(!1)}const{layoutId:T,layout:C}=this.options;if(T===void 0&&!C)return;const I=this.getTransformTemplate();this.prevTransformTemplateValue=I?I(this.latestValues,""):void 0,this.updateSnapshot(),y&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(_6);return}this.isUpdating||this.nodes.forEach(lue),this.isUpdating=!1,this.nodes.forEach(uue),this.nodes.forEach(rue),this.nodes.forEach(sue),this.clearAllSnapshots();const T=Kc.now();Fr.delta=iu(0,1e3/60,T-Fr.timestamp),Fr.timestamp=T,Fr.isProcessing=!0,BN.update.process(Fr),BN.preRender.process(Fr),BN.render.process(Fr),Fr.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,qD.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(cue),this.sharedNodes.forEach(fue)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,ni.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){ni.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!As(this.snapshot.measuredBox.x)&&!As(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let C=0;C<this.path.length;C++)this.path[C].updateScroll();const y=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Ki(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:T}=this.options;T&&T.notify("LayoutMeasure",this.layout.layoutBox,y?y.layoutBox:void 0)}updateScroll(y="measure"){let T=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===y&&(T=!1),T){const C=c(this.instance);this.scroll={animationId:this.root.animationId,phase:y,isRoot:C,offset:a(this.instance),wasRoot:this.scroll?this.scroll.isRoot:C}}}resetTransform(){if(!p)return;const y=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,T=this.projectionDelta&&!y8(this.projectionDelta),C=this.getTransformTemplate(),I=C?C(this.latestValues,""):void 0,D=I!==this.prevTransformTemplateValue;y&&(T||wp(this.latestValues)||D)&&(p(this.instance,I),this.shouldResetTransform=!1,this.scheduleRender())}measure(y=!0){const T=this.measurePageBox();let C=this.removeElementScroll(T);return y&&(C=this.removeTransform(C)),Eue(C),{animationId:this.root.animationId,measuredBox:T,layoutBox:C,latestValues:{},source:this.id}}measurePageBox(){var I;const{visualElement:y}=this.options;if(!y)return Ki();const T=y.measureViewportBox();if(!(((I=this.scroll)==null?void 0:I.wasRoot)||this.path.some(yue))){const{scroll:D}=this.root;D&&(Pg(T.x,D.offset.x),Pg(T.y,D.offset.y))}return T}removeElementScroll(y){var C;const T=Ki();if(ea(T,y),(C=this.scroll)!=null&&C.wasRoot)return T;for(let I=0;I<this.path.length;I++){const D=this.path[I],{scroll:L,options:j}=D;D!==this.root&&L&&j.layoutScroll&&(L.wasRoot&&ea(T,y),Pg(T.x,L.offset.x),Pg(T.y,L.offset.y))}return T}applyTransform(y,T=!1){const C=Ki();ea(C,y);for(let I=0;I<this.path.length;I++){const D=this.path[I];!T&&D.options.layoutScroll&&D.scroll&&D!==D.root&&Dg(C,{x:-D.scroll.offset.x,y:-D.scroll.offset.y}),wp(D.latestValues)&&Dg(C,D.latestValues)}return wp(this.latestValues)&&Dg(C,this.latestValues),C}removeTransform(y){const T=Ki();ea(T,y);for(let C=0;C<this.path.length;C++){const I=this.path[C];if(!I.instance||!wp(I.latestValues))continue;nD(I.latestValues)&&I.updateSnapshot();const D=Ki(),L=I.measurePageBox();ea(D,L),u6(T,I.latestValues,I.snapshot?I.snapshot.layoutBox:void 0,D)}return wp(this.latestValues)&&u6(T,this.latestValues),T}setTargetDelta(y){this.targetDelta=y,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(y){this.options={...this.options,...y,crossfade:y.crossfade!==void 0?y.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Fr.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(y=!1){var j;const T=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=T.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=T.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=T.isSharedProjectionDirty);const C=!!this.resumingFrom||this!==T;if(!(y||C&&this.isSharedProjectionDirty||this.isProjectionDirty||(j=this.parent)!=null&&j.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:D,layoutId:L}=this.options;if(!(!this.layout||!(D||L))){if(this.resolvedRelativeTargetAt=Fr.timestamp,!this.targetDelta&&!this.relativeTarget){const Y=this.getClosestProjectingParent();Y&&Y.layout&&this.animationProgress!==1?(this.relativeParent=Y,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ki(),this.relativeTargetOrigin=Ki(),pv(this.relativeTargetOrigin,this.layout.layoutBox,Y.layout.layoutBox),ea(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Ki(),this.targetWithTransforms=Ki()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Sle(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):ea(this.target,this.layout.layoutBox),d8(this.target,this.targetDelta)):ea(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const Y=this.getClosestProjectingParent();Y&&!!Y.resumingFrom==!!this.resumingFrom&&!Y.options.layoutScroll&&Y.target&&this.animationProgress!==1?(this.relativeParent=Y,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ki(),this.relativeTargetOrigin=Ki(),pv(this.relativeTargetOrigin,this.target,Y.target),ea(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||nD(this.parent.latestValues)||u8(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var X;const y=this.getLead(),T=!!this.resumingFrom||this!==y;let C=!0;if((this.isProjectionDirty||(X=this.parent)!=null&&X.isProjectionDirty)&&(C=!1),T&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(C=!1),this.resolvedRelativeTargetAt===Fr.timestamp&&(C=!1),C)return;const{layout:I,layoutId:D}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(I||D))return;ea(this.layoutCorrected,this.layout.layoutBox);const L=this.treeScale.x,j=this.treeScale.y;Tle(this.layoutCorrected,this.treeScale,this.path,T),y.layout&&!y.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(y.target=y.layout.layoutBox,y.targetWithTransforms=Ki());const{target:Y}=y;if(!Y){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(a6(this.prevProjectionDelta.x,this.projectionDelta.x),a6(this.prevProjectionDelta.y,this.projectionDelta.y)),hv(this.projectionDelta,this.layoutCorrected,Y,this.latestValues),(this.treeScale.x!==L||this.treeScale.y!==j||!m6(this.projectionDelta.x,this.prevProjectionDelta.x)||!m6(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",Y))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(y=!0){var T;if((T=this.options.visualElement)==null||T.scheduleRender(),y){const C=this.getStack();C&&C.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Ng(),this.projectionDelta=Ng(),this.projectionDeltaWithTransform=Ng()}setAnimationOrigin(y,T=!1){const C=this.snapshot,I=C?C.latestValues:{},D={...this.latestValues},L=Ng();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!T;const j=Ki(),Y=C?C.source:void 0,X=this.layout?this.layout.source:void 0,ee=Y!==X,Q=this.getStack(),se=!Q||Q.members.length<=1,fe=!!(ee&&!se&&this.options.crossfade===!0&&!this.path.some(gue));this.animationProgress=0;let me;this.mixTargetDelta=Oe=>{const Ve=Oe/1e3;y6(L.x,y.x,Ve),y6(L.y,y.y,Ve),this.setTargetDelta(L),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(pv(j,this.layout.layoutBox,this.relativeParent.layout.layoutBox),mue(this.relativeTarget,this.relativeTargetOrigin,j,Ve),me&&Zle(this.relativeTarget,me)&&(this.isProjectionDirty=!1),me||(me=Ki()),ea(me,this.relativeTarget)),ee&&(this.animationValues=D,qle(D,I,this.latestValues,Ve,fe,se)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=Ve},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(y){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(nu(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=ni.update(()=>{DC.hasAnimatedSinceResize=!0,this.currentAnimation=jle(0,g6,{...y,onUpdate:T=>{this.mixTargetDelta(T),y.onUpdate&&y.onUpdate(T)},onStop:()=>{},onComplete:()=>{y.onComplete&&y.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const y=this.getStack();y&&y.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(g6),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const y=this.getLead();let{targetWithTransforms:T,target:C,layout:I,latestValues:D}=y;if(!(!T||!C||!I)){if(this!==y&&this.layout&&I&&R8(this.options.animationType,this.layout.layoutBox,I.layoutBox)){C=this.target||Ki();const L=As(this.layout.layoutBox.x);C.x.min=y.target.x.min,C.x.max=C.x.min+L;const j=As(this.layout.layoutBox.y);C.y.min=y.target.y.min,C.y.max=C.y.min+j}ea(T,C),Dg(T,D),hv(this.projectionDeltaWithTransform,this.layoutCorrected,T,D)}}registerSharedNode(y,T){this.sharedNodes.has(y)||this.sharedNodes.set(y,new eue),this.sharedNodes.get(y).add(T);const I=T.options.initialPromotionConfig;T.promote({transition:I?I.transition:void 0,preserveFollowOpacity:I&&I.shouldPreserveFollowOpacity?I.shouldPreserveFollowOpacity(T):void 0})}isLead(){const y=this.getStack();return y?y.lead===this:!0}getLead(){var T;const{layoutId:y}=this.options;return y?((T=this.getStack())==null?void 0:T.lead)||this:this}getPrevLead(){var T;const{layoutId:y}=this.options;return y?(T=this.getStack())==null?void 0:T.prevLead:void 0}getStack(){const{layoutId:y}=this.options;if(y)return this.root.sharedNodes.get(y)}promote({needsReset:y,transition:T,preserveFollowOpacity:C}={}){const I=this.getStack();I&&I.promote(this,C),y&&(this.projectionDelta=void 0,this.needsReset=!0),T&&this.setOptions({transition:T})}relegate(){const y=this.getStack();return y?y.relegate(this):!1}resetSkewAndRotation(){const{visualElement:y}=this.options;if(!y)return;let T=!1;const{latestValues:C}=y;if((C.z||C.rotate||C.rotateX||C.rotateY||C.rotateZ||C.skewX||C.skewY)&&(T=!0),!T)return;const I={};C.z&&XN("z",y,I,this.animationValues);for(let D=0;D<YN.length;D++)XN(`rotate${YN[D]}`,y,I,this.animationValues),XN(`skew${YN[D]}`,y,I,this.animationValues);y.render();for(const D in I)y.setStaticValue(D,I[D]),this.animationValues&&(this.animationValues[D]=I[D]);y.scheduleRender()}getProjectionStyles(y){if(!this.instance||this.isSVG)return;if(!this.isVisible)return nue;const T={visibility:""},C=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,T.opacity="",T.pointerEvents=PC(y==null?void 0:y.pointerEvents)||"",T.transform=C?C(this.latestValues,""):"none",T;const I=this.getLead();if(!this.projectionDelta||!this.layout||!I.target){const Y={};return this.options.layoutId&&(Y.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,Y.pointerEvents=PC(y==null?void 0:y.pointerEvents)||""),this.hasProjected&&!wp(this.latestValues)&&(Y.transform=C?C({},""):"none",this.hasProjected=!1),Y}const D=I.animationValues||I.latestValues;this.applyTransformsToTarget(),T.transform=tue(this.projectionDeltaWithTransform,this.treeScale,D),C&&(T.transform=C(D,T.transform));const{x:L,y:j}=this.projectionDelta;T.transformOrigin=`${L.origin*100}% ${j.origin*100}% 0`,I.animationValues?T.opacity=I===this?D.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:D.opacityExit:T.opacity=I===this?D.opacity!==void 0?D.opacity:"":D.opacityExit!==void 0?D.opacityExit:0;for(const Y in Cv){if(D[Y]===void 0)continue;const{correct:X,applyTo:ee,isCSSVariable:Q}=Cv[Y],se=T.transform==="none"?D[Y]:X(D[Y],I);if(ee){const fe=ee.length;for(let me=0;me<fe;me++)T[ee[me]]=se}else Q?this.options.visualElement.renderState.vars[Y]=se:T[Y]=se}return this.options.layoutId&&(T.pointerEvents=I===this?PC(y==null?void 0:y.pointerEvents)||"":"none"),T}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(y=>{var T;return(T=y.currentAnimation)==null?void 0:T.stop()}),this.root.nodes.forEach(_6),this.root.sharedNodes.clear()}}}function rue(s){s.updateLayout()}function sue(s){var a;const i=((a=s.resumeFrom)==null?void 0:a.snapshot)||s.snapshot;if(s.isLead()&&s.layout&&i&&s.hasListeners("didUpdate")){const{layoutBox:c,measuredBox:p}=s.layout,{animationType:_}=s.options,y=i.source!==s.layout.source;_==="size"?na(L=>{const j=y?i.measuredBox[L]:i.layoutBox[L],Y=As(j);j.min=c[L].min,j.max=j.min+Y}):R8(_,i.layoutBox,c)&&na(L=>{const j=y?i.measuredBox[L]:i.layoutBox[L],Y=As(c[L]);j.max=j.min+Y,s.relativeTarget&&!s.currentAnimation&&(s.isProjectionDirty=!0,s.relativeTarget[L].max=s.relativeTarget[L].min+Y)});const T=Ng();hv(T,c,i.layoutBox);const C=Ng();y?hv(C,s.applyTransform(p,!0),i.measuredBox):hv(C,c,i.layoutBox);const I=!y8(T);let D=!1;if(!s.resumeFrom){const L=s.getClosestProjectingParent();if(L&&!L.resumeFrom){const{snapshot:j,layout:Y}=L;if(j&&Y){const X=Ki();pv(X,i.layoutBox,j.layoutBox);const ee=Ki();pv(ee,c,Y.layoutBox),v8(X,ee)||(D=!0),L.options.layoutRoot&&(s.relativeTarget=ee,s.relativeTargetOrigin=X,s.relativeParent=L)}}}s.notifyListeners("didUpdate",{layout:c,snapshot:i,delta:C,layoutDelta:T,hasLayoutChanged:I,hasRelativeLayoutChanged:D})}else if(s.isLead()){const{onExitComplete:c}=s.options;c&&c()}s.options.transition=void 0}function oue(s){s.parent&&(s.isProjecting()||(s.isProjectionDirty=s.parent.isProjectionDirty),s.isSharedProjectionDirty||(s.isSharedProjectionDirty=!!(s.isProjectionDirty||s.parent.isProjectionDirty||s.parent.isSharedProjectionDirty)),s.isTransformDirty||(s.isTransformDirty=s.parent.isTransformDirty))}function aue(s){s.isProjectionDirty=s.isSharedProjectionDirty=s.isTransformDirty=!1}function cue(s){s.clearSnapshot()}function _6(s){s.clearMeasurements()}function lue(s){s.isLayoutDirty=!1}function uue(s){const{visualElement:i}=s.options;i&&i.getProps().onBeforeLayoutMeasure&&i.notify("BeforeLayoutMeasure"),s.resetTransform()}function E6(s){s.finishAnimation(),s.targetDelta=s.relativeTarget=s.target=void 0,s.isProjectionDirty=!0}function due(s){s.resolveTargetDelta()}function hue(s){s.calcProjection()}function pue(s){s.resetSkewAndRotation()}function fue(s){s.removeLeadSnapshot()}function y6(s,i,a){s.translate=Ci(i.translate,0,a),s.scale=Ci(i.scale,1,a),s.origin=i.origin,s.originPoint=i.originPoint}function v6(s,i,a,c){s.min=Ci(i.min,a.min,c),s.max=Ci(i.max,a.max,c)}function mue(s,i,a,c){v6(s.x,i.x,a.x,c),v6(s.y,i.y,a.y,c)}function gue(s){return s.animationValues&&s.animationValues.opacityExit!==void 0}const _ue={duration:.45,ease:[.4,0,.1,1]},S6=s=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(s),T6=S6("applewebkit/")&&!S6("chrome/")?Math.round:oa;function R6(s){s.min=T6(s.min),s.max=T6(s.max)}function Eue(s){R6(s.x),R6(s.y)}function R8(s,i,a){return s==="position"||s==="preserve-aspect"&&!vle(f6(i),f6(a),.2)}function yue(s){var i;return s!==s.root&&((i=s.scroll)==null?void 0:i.wasRoot)}const vue=T8({attachResizeListener:(s,i)=>Ov(s,"resize",i),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),JN={current:void 0},w8=T8({measureScroll:s=>({x:s.scrollLeft,y:s.scrollTop}),defaultParent:()=>{if(!JN.current){const s=new vue({});s.mount(window),s.setOptions({layoutScroll:!0}),JN.current=s}return JN.current},resetTransform:(s,i)=>{s.style.transform=i!==void 0?i:"none"},checkIsScrollRoot:s=>window.getComputedStyle(s).position==="fixed"}),Sue={pan:{Feature:Ule},drag:{Feature:Mle,ProjectionNode:w8,MeasureLayout:g8}};function w6(s,i,a){const{props:c}=s;s.animationState&&c.whileHover&&s.animationState.setActive("whileHover",a==="Start");const p="onHover"+a,_=c[p];_&&ni.postRender(()=>_(i,Fv(i)))}class Tue extends Ld{mount(){const{current:i}=this.node;i&&(this.unmount=Poe(i,(a,c)=>(w6(this.node,c,"Start"),p=>w6(this.node,p,"End"))))}unmount(){}}class Rue extends Ld{constructor(){super(...arguments),this.isActive=!1}onFocus(){let i=!1;try{i=this.node.current.matches(":focus-visible")}catch{i=!0}!i||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Vv(Ov(this.node.current,"focus",()=>this.onFocus()),Ov(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function C6(s,i,a){const{props:c}=s;if(s.current instanceof HTMLButtonElement&&s.current.disabled)return;s.animationState&&c.whileTap&&s.animationState.setActive("whileTap",a==="Start");const p="onTap"+(a==="End"?"":a),_=c[p];_&&ni.postRender(()=>_(i,Fv(i)))}class wue extends Ld{mount(){const{current:i}=this.node;i&&(this.unmount=xoe(i,(a,c)=>(C6(this.node,c,"Start"),(p,{success:_})=>C6(this.node,p,_?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const sD=new WeakMap,$N=new WeakMap,Cue=s=>{const i=sD.get(s.target);i&&i(s)},bue=s=>{s.forEach(Cue)};function Aue({root:s,...i}){const a=s||document;$N.has(a)||$N.set(a,{});const c=$N.get(a),p=JSON.stringify(i);return c[p]||(c[p]=new IntersectionObserver(bue,{root:s,...i})),c[p]}function Iue(s,i,a){const c=Aue(i);return sD.set(s,a),c.observe(s),()=>{sD.delete(s),c.unobserve(s)}}const Oue={some:0,all:1};class Nue extends Ld{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:i={}}=this.node.getProps(),{root:a,margin:c,amount:p="some",once:_}=i,y={root:a?a.current:void 0,rootMargin:c,threshold:typeof p=="number"?p:Oue[p]},T=C=>{const{isIntersecting:I}=C;if(this.isInView===I||(this.isInView=I,_&&!I&&this.hasEnteredView))return;I&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",I);const{onViewportEnter:D,onViewportLeave:L}=this.node.getProps(),j=I?D:L;j&&j(C)};return Iue(this.node.current,y,T)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:i,prevProps:a}=this.node;["amount","margin","root"].some(Pue(i,a))&&this.startObserver()}unmount(){}}function Pue({viewport:s={}},{viewport:i={}}={}){return a=>s[a]!==i[a]}const Due={inView:{Feature:Nue},tap:{Feature:wue},focus:{Feature:Rue},hover:{Feature:Tue}},kue={layout:{ProjectionNode:w8,MeasureLayout:g8}},oD={current:null},C8={current:!1};function Lue(){if(C8.current=!0,!!UD)if(window.matchMedia){const s=window.matchMedia("(prefers-reduced-motion)"),i=()=>oD.current=s.matches;s.addListener(i),i()}else oD.current=!1}const xue=[...Jz,rs,bd],Mue=s=>xue.find(Xz(s)),Uue=new WeakMap;function Vue(s,i,a){for(const c in i){const p=i[c],_=a[c];if(as(p))s.addValue(c,p);else if(as(_))s.addValue(c,Rv(p,{owner:s}));else if(_!==p)if(s.hasValue(c)){const y=s.getValue(c);y.liveStyle===!0?y.jump(p):y.hasAnimated||y.set(p)}else{const y=s.getStaticValue(c);s.addValue(c,Rv(y!==void 0?y:p,{owner:s}))}}for(const c in a)i[c]===void 0&&s.removeValue(c);return i}const b6=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Fue{scrapeMotionValuesFromProps(i,a,c){return{}}constructor({parent:i,props:a,presenceContext:c,reducedMotionConfig:p,blockInitialAnimation:_,visualState:y},T={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=hk,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const Y=Kc.now();this.renderScheduledAt<Y&&(this.renderScheduledAt=Y,ni.render(this.render,!1,!0))};const{latestValues:C,renderState:I,onUpdate:D}=y;this.onUpdate=D,this.latestValues=C,this.baseTarget={...C},this.initialValues=a.initial?{...C}:{},this.renderState=I,this.parent=i,this.props=a,this.presenceContext=c,this.depth=i?i.depth+1:0,this.reducedMotionConfig=p,this.options=T,this.blockInitialAnimation=!!_,this.isControllingVariants=Sb(a),this.isVariantNode=hz(a),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(i&&i.current);const{willChange:L,...j}=this.scrapeMotionValuesFromProps(a,{},this);for(const Y in j){const X=j[Y];C[Y]!==void 0&&as(X)&&X.set(C[Y],!1)}}mount(i){this.current=i,Uue.set(i,this),this.projection&&!this.projection.instance&&this.projection.mount(i),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((a,c)=>this.bindToMotionValue(c,a)),C8.current||Lue(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:oD.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),nu(this.notifyUpdate),nu(this.render),this.valueSubscriptions.forEach(i=>i()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const i in this.events)this.events[i].clear();for(const i in this.features){const a=this.features[i];a&&(a.unmount(),a.isMounted=!1)}this.current=null}bindToMotionValue(i,a){this.valueSubscriptions.has(i)&&this.valueSubscriptions.get(i)();const c=zp.has(i);c&&this.onBindTransform&&this.onBindTransform();const p=a.on("change",T=>{this.latestValues[i]=T,this.props.onUpdate&&ni.preRender(this.notifyUpdate),c&&this.projection&&(this.projection.isTransformDirty=!0)}),_=a.on("renderRequest",this.scheduleRender);let y;window.MotionCheckAppearSync&&(y=window.MotionCheckAppearSync(this,i,a)),this.valueSubscriptions.set(i,()=>{p(),_(),y&&y(),a.owner&&a.stop()})}sortNodePosition(i){return!this.current||!this.sortInstanceNodePosition||this.type!==i.type?0:this.sortInstanceNodePosition(this.current,i.current)}updateFeatures(){let i="animation";for(i in Kg){const a=Kg[i];if(!a)continue;const{isEnabled:c,Feature:p}=a;if(!this.features[i]&&p&&c(this.props)&&(this.features[i]=new p(this)),this.features[i]){const _=this.features[i];_.isMounted?_.update():(_.mount(),_.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ki()}getStaticValue(i){return this.latestValues[i]}setStaticValue(i,a){this.latestValues[i]=a}update(i,a){(i.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=i,this.prevPresenceContext=this.presenceContext,this.presenceContext=a;for(let c=0;c<b6.length;c++){const p=b6[c];this.propEventSubscriptions[p]&&(this.propEventSubscriptions[p](),delete this.propEventSubscriptions[p]);const _="on"+p,y=i[_];y&&(this.propEventSubscriptions[p]=this.on(p,y))}this.prevMotionValues=Vue(this,this.scrapeMotionValuesFromProps(i,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(i){return this.props.variants?this.props.variants[i]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(i){const a=this.getClosestVariantNode();if(a)return a.variantChildren&&a.variantChildren.add(i),()=>a.variantChildren.delete(i)}addValue(i,a){const c=this.values.get(i);a!==c&&(c&&this.removeValue(i),this.bindToMotionValue(i,a),this.values.set(i,a),this.latestValues[i]=a.get())}removeValue(i){this.values.delete(i);const a=this.valueSubscriptions.get(i);a&&(a(),this.valueSubscriptions.delete(i)),delete this.latestValues[i],this.removeValueFromRenderState(i,this.renderState)}hasValue(i){return this.values.has(i)}getValue(i,a){if(this.props.values&&this.props.values[i])return this.props.values[i];let c=this.values.get(i);return c===void 0&&a!==void 0&&(c=Rv(a===null?void 0:a,{owner:this}),this.addValue(i,c)),c}readValue(i,a){let c=this.latestValues[i]!==void 0||!this.current?this.latestValues[i]:this.getBaseTargetFromProps(this.props,i)??this.readValueFromInstance(this.current,i,this.options);return c!=null&&(typeof c=="string"&&(qz(c)||Uz(c))?c=parseFloat(c):!Mue(c)&&bd.test(a)&&(c=zz(i,a)),this.setBaseTarget(i,as(c)?c.get():c)),as(c)?c.get():c}setBaseTarget(i,a){this.baseTarget[i]=a}getBaseTarget(i){var _;const{initial:a}=this.props;let c;if(typeof a=="string"||typeof a=="object"){const y=ok(this.props,a,(_=this.presenceContext)==null?void 0:_.custom);y&&(c=y[i])}if(a&&c!==void 0)return c;const p=this.getBaseTargetFromProps(this.props,i);return p!==void 0&&!as(p)?p:this.initialValues[i]!==void 0&&c===void 0?void 0:this.baseTarget[i]}on(i,a){return this.events[i]||(this.events[i]=new GD),this.events[i].add(a)}notify(i,...a){this.events[i]&&this.events[i].notify(...a)}}class b8 extends Fue{constructor(){super(...arguments),this.KeyframeResolver=$z}sortInstanceNodePosition(i,a){return i.compareDocumentPosition(a)&2?1:-1}getBaseTargetFromProps(i,a){return i.style?i.style[a]:void 0}removeValueFromRenderState(i,{vars:a,style:c}){delete a[i],delete c[i]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:i}=this.props;as(i)&&(this.childSubscription=i.on("change",a=>{this.current&&(this.current.textContent=`${a}`)}))}}function Bue(s){return window.getComputedStyle(s)}class jue extends b8{constructor(){super(...arguments),this.type="html",this.renderInstance=Rz}readValueFromInstance(i,a){if(zp.has(a))return Zae(i,a);{const c=Bue(i),p=(QD(a)?c.getPropertyValue(a):c[a])||0;return typeof p=="string"?p.trim():p}}measureInstanceViewportBox(i,{transformPagePoint:a}){return h8(i,a)}build(i,a,c){tk(i,a,c.transformTemplate)}scrapeMotionValuesFromProps(i,a,c){return ak(i,a,c)}}class Gue extends b8{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Ki,this.updateDimensions=()=>{this.current&&!this.renderState.dimensions&&Tz(this.current,this.renderState)}}getBaseTargetFromProps(i,a){return i[a]}readValueFromInstance(i,a){if(zp.has(a)){const c=Wz(a);return c&&c.default||0}return a=wz.has(a)?a:$D(a),i.getAttribute(a)}scrapeMotionValuesFromProps(i,a,c){return bz(i,a,c)}onBindTransform(){this.current&&!this.renderState.dimensions&&ni.postRender(this.updateDimensions)}build(i,a,c){rk(i,a,this.isSVGTag,c.transformTemplate)}renderInstance(i,a,c,p){Cz(i,a,c,p)}mount(i){this.isSVGTag=sk(i.tagName),super.mount(i)}}const Wue=(s,i)=>ik(s)?new Gue(i):new jue(i,{allowProjection:s!==_e.Fragment}),zue=bae({...hle,...Due,...Sue,...kue},Wue),A8=Goe(zue),fv="generated",Hue="pointerdown",Kue="pointerup",A6="pointerleave",que="pointerout",I6="pointermove",Yue="touchstart",O6="touchend",Xue="touchmove",Jue="touchcancel",$ue="resize",Que="visibilitychange",Bp="tsParticles - Error";let aD=class Bc{constructor(i,a,c){if(this._updateFromAngle=(p,_)=>{this.x=Math.cos(p)*_,this.y=Math.sin(p)*_},!za(i)&&i){this.x=i.x,this.y=i.y;const p=i;this.z=p.z?p.z:0}else if(i!==void 0&&a!==void 0)this.x=i,this.y=a,this.z=c??0;else throw new Error(`${Bp} Vector3d not initialized correctly`)}static get origin(){return Bc.create(0,0,0)}get angle(){return Math.atan2(this.y,this.x)}set angle(i){this._updateFromAngle(i,this.length)}get length(){return Math.sqrt(this.getLengthSq())}set length(i){this._updateFromAngle(this.angle,i)}static clone(i){return Bc.create(i.x,i.y,i.z)}static create(i,a,c){return new Bc(i,a,c)}add(i){return Bc.create(this.x+i.x,this.y+i.y,this.z+i.z)}addTo(i){this.x+=i.x,this.y+=i.y,this.z+=i.z}copy(){return Bc.clone(this)}distanceTo(i){return this.sub(i).length}distanceToSq(i){return this.sub(i).getLengthSq()}div(i){return Bc.create(this.x/i,this.y/i,this.z/i)}divTo(i){this.x/=i,this.y/=i,this.z/=i}getLengthSq(){return this.x**2+this.y**2}mult(i){return Bc.create(this.x*i,this.y*i,this.z*i)}multTo(i){this.x*=i,this.y*=i,this.z*=i}normalize(){const i=this.length;i!=0&&this.multTo(1/i)}rotate(i){return Bc.create(this.x*Math.cos(i)-this.y*Math.sin(i),this.x*Math.sin(i)+this.y*Math.cos(i),0)}setTo(i){this.x=i.x,this.y=i.y;const a=i;this.z=a.z?a.z:0}sub(i){return Bc.create(this.x-i.x,this.y-i.y,this.z-i.z)}subFrom(i){this.x-=i.x,this.y-=i.y,this.z-=i.z}},I8=class kC extends aD{constructor(i,a){super(i,a,0)}static get origin(){return kC.create(0,0)}static clone(i){return kC.create(i.x,i.y)}static create(i,a){return new kC(i,a)}},Zue=Math.random;function ru(){return O8(Zue(),0,1-1e-16)}function O8(s,i,a){return Math.min(Math.max(s,i),a)}function Fg(s){const i=_k(s);let a=gk(s);return i===a&&(a=0),ru()*(i-a)+a}function ti(s){return za(s)?s:Fg(s)}function gk(s){return za(s)?s:s.min}function _k(s){return za(s)?s:s.max}function In(s,i){if(s===i||i===void 0&&za(s))return s;const a=gk(s),c=_k(s);return i!==void 0?{min:Math.min(a,i),max:Math.max(c,i)}:In(a,c)}function ede(s){const i=s.random,{enable:a,minimumValue:c}=wd(i)?{enable:i,minimumValue:0}:i;return ti(a?In(s.value,c):s.value)}function tde(s,i){const a=s.x-i.x,c=s.y-i.y;return{dx:a,dy:c,distance:Math.sqrt(a**2+c**2)}}function Ek(s,i){return tde(s,i).distance}function nde(s,i,a){if(za(s))return s*Math.PI/180;switch(s){case"top":return-Math.PI/2;case"top-right":return-Math.PI/4;case"right":return 0;case"bottom-right":return Math.PI/4;case"bottom":return Math.PI/2;case"bottom-left":return 3*Math.PI/4;case"left":return Math.PI;case"top-left":return-3*Math.PI/4;case"inside":return Math.atan2(a.y-i.y,a.x-i.x);case"outside":return Math.atan2(i.y-a.y,i.x-a.x);default:return ru()*Math.PI*2}}function ide(s){const i=I8.origin;return i.length=1,i.angle=s,i}function rde(s){var i,a;return{x:((i=s.position)==null?void 0:i.x)??ru()*s.size.width,y:((a=s.position)==null?void 0:a.y)??ru()*s.size.height}}function N8(s){return s?s.endsWith("%")?parseFloat(s)/100:parseFloat(s):1}const sde={debug:console.debug,error:console.error,info:console.info,log:console.log,verbose:console.log,warning:console.warn};function Nv(){return sde}function Rb(){return typeof window>"u"||!window||typeof window.document>"u"||!window.document}function ode(){return!Rb()&&typeof matchMedia<"u"}function P8(s){if(ode())return matchMedia(s)}function ade(s){if(!(Rb()||typeof MutationObserver>"u"))return new MutationObserver(s)}function cde(s,i){return s===i||Xc(i)&&i.indexOf(s)>-1}function lde(s){return Math.floor(ru()*s.length)}function yk(s,i,a=!0){return s[i!==void 0&&a?i%s.length:lde(s)]}function ls(s,...i){for(const a of i){if(a==null)continue;if(!ov(a)){s=a;continue}const c=Array.isArray(a);c&&(ov(s)||!s||!Array.isArray(s))?s=[]:!c&&(ov(s)||!s||Array.isArray(s))&&(s={});for(const p in a){if(p==="__proto__")continue;const _=a,y=_[p],T=s;T[p]=ov(y)&&Array.isArray(y)?y.map(C=>ls(T[p],C)):ls(T[p],y)}}return s}function jp(s,i){return Xc(s)?s.map((a,c)=>i(a,c)):i(s,0)}function mv(s,i,a){return Xc(s)?yk(s,i,a):s}function ude(s,i){const a=s.value,c=s.animation,p={delayTime:ti(c.delay)*1e3,enable:c.enable,value:ti(s.value)*i,max:_k(a)*i,min:gk(a)*i,loops:0,maxLoops:ti(c.count),time:0};if(c.enable){switch(p.decay=1-ti(c.decay),c.mode){case"increase":p.status="increasing";break;case"decrease":p.status="decreasing";break;case"random":p.status=ru()>=.5?"increasing":"decreasing";break}const _=c.mode==="auto";switch(c.startValue){case"min":p.value=p.min,_&&(p.status="increasing");break;case"max":p.value=p.max,_&&(p.status="decreasing");break;case"random":default:p.value=Fg(p),_&&(p.status=ru()>=.5?"increasing":"decreasing");break}}return p.initialValue=p.value,p}function dde(s,i){if(!(s.mode==="percent")){const{mode:p,..._}=s;return _}return"x"in s?{x:s.x/100*i.width,y:s.y/100*i.height}:{width:s.width/100*i.width,height:s.height/100*i.height}}function D8(s,i){return dde(s,i)}function wd(s){return typeof s=="boolean"}function Yc(s){return typeof s=="string"}function za(s){return typeof s=="number"}function k8(s){return typeof s=="function"}function ov(s){return typeof s=="object"&&s!==null}function Xc(s){return Array.isArray(s)}const hde="random",wb=new Map;function N6(s){wb.set(s.key,s)}function QN(s,i,a){return a<0&&(a+=1),a>1&&(a-=1),a<1/6?s+(i-s)*6*a:a<1/2?i:a<2/3?s+(i-s)*(2/3-a)*6:s}function pde(s){for(const[,_]of wb)if(s.startsWith(_.stringPrefix))return _.parseString(s);const i=/^#?([a-f\d])([a-f\d])([a-f\d])([a-f\d])?$/i,a=s.replace(i,(_,y,T,C,I)=>y+y+T+T+C+C+(I!==void 0?I+I:"")),c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i,p=c.exec(a);return p?{a:p[4]!==void 0?parseInt(p[4],16)/255:1,b:parseInt(p[3],16),g:parseInt(p[2],16),r:parseInt(p[1],16)}:void 0}function Bg(s,i,a=!0){if(!s)return;const c=Yc(s)?{value:s}:s;if(Yc(c.value))return L8(c.value,i,a);if(Xc(c.value))return Bg({value:yk(c.value,i,a)});for(const[,p]of wb){const _=p.handleRangeColor(c);if(_)return _}}function L8(s,i,a=!0){if(!s)return;const c=Yc(s)?{value:s}:s;if(Yc(c.value))return c.value===hde?_de():mde(c.value);if(Xc(c.value))return L8({value:yk(c.value,i,a)});for(const[,p]of wb){const _=p.handleColor(c);if(_)return _}}function P6(s,i,a=!0){const c=Bg(s,i,a);return c?fde(c):void 0}function fde(s){const i=s.r/255,a=s.g/255,c=s.b/255,p=Math.max(i,a,c),_=Math.min(i,a,c),y={h:0,l:(p+_)/2,s:0};return p!==_&&(y.s=y.l<.5?(p-_)/(p+_):(p-_)/(2-p-_),y.h=i===p?(a-c)/(p-_):y.h=a===p?2+(c-i)/(p-_):4+(i-a)/(p-_)),y.l*=100,y.s*=100,y.h*=60,y.h<0&&(y.h+=360),y.h>=360&&(y.h-=360),y}function mde(s){return pde(s)}function cD(s){const i={b:0,g:0,r:0},a={h:s.h/360,l:s.l/100,s:s.s/100};if(!a.s)i.r=i.g=i.b=a.l;else{const c=a.l<.5?a.l*(1+a.s):a.l+a.s-a.l*a.s,p=2*a.l-c;i.r=QN(p,c,a.h+1/3),i.g=QN(p,c,a.h),i.b=QN(p,c,a.h-1/3)}return i.r=Math.floor(i.r*255),i.g=Math.floor(i.g*255),i.b=Math.floor(i.b*255),i}function gde(s){const i=cD(s);return{a:s.a,b:i.b,g:i.g,r:i.r}}function _de(s){return{b:Math.floor(Fg(In(0,256))),g:Math.floor(Fg(In(0,256))),r:Math.floor(Fg(In(0,256)))}}function LC(s,i){return`rgba(${s.r}, ${s.g}, ${s.b}, ${i??1})`}function D6(s,i){return`hsla(${s.h}, ${s.s}%, ${s.l}%, ${i??1})`}function k6(s){return s!==void 0?{h:s.h.value,s:s.s.value,l:s.l.value}:void 0}function Ede(s,i,a){s.fillStyle=a??"rgba(0,0,0,0)",s.fillRect(0,0,i.width,i.height)}function yde(s,i,a,c){a&&(s.globalAlpha=c,s.drawImage(a,0,0,i.width,i.height),s.globalAlpha=1)}function ZN(s,i){s.clearRect(0,0,i.width,i.height)}function vde(s){const{container:i,context:a,particle:c,delta:p,colorStyles:_,backgroundMask:y,composite:T,radius:C,opacity:I,shadow:D,transform:L}=s,j=c.getPosition(),Y=c.rotation+(c.pathRotation?c.velocity.angle:0),X={sin:Math.sin(Y),cos:Math.cos(Y)},ee={a:X.cos*(L.a??1),b:X.sin*(L.b??1),c:-X.sin*(L.c??1),d:X.cos*(L.d??1)};a.setTransform(ee.a,ee.b,ee.c,ee.d,j.x,j.y),a.beginPath(),y&&(a.globalCompositeOperation=T);const Q=c.shadowColor;D.enable&&Q&&(a.shadowBlur=D.blur,a.shadowColor=LC(Q),a.shadowOffsetX=D.offset.x,a.shadowOffsetY=D.offset.y),_.fill&&(a.fillStyle=_.fill);const se=c.strokeWidth??0;a.lineWidth=se,_.stroke&&(a.strokeStyle=_.stroke),Sde(i,a,c,C,I,p),se>0&&a.stroke(),c.close&&a.closePath(),c.fill&&a.fill(),Tde(i,a,c,C,I,p),a.globalCompositeOperation="source-over",a.setTransform(1,0,0,1,0,0)}function Sde(s,i,a,c,p,_){if(!a.shape)return;const y=s.drawers.get(a.shape);y&&y.draw(i,a,c,p,_,s.retina.pixelRatio)}function Tde(s,i,a,c,p,_){if(!a.shape)return;const y=s.drawers.get(a.shape);!y||!y.afterEffect||y.afterEffect(i,a,c,p,_,s.retina.pixelRatio)}function Rde(s,i,a){i.draw&&i.draw(s,a)}function wde(s,i,a,c){i.drawParticle&&i.drawParticle(s,a,c)}function Cde(s,i,a){return{h:s.h,s:s.s,l:s.l+(i==="darken"?-1:1)*a}}function bde(s,i,a){const c=i[a];c!==void 0&&(s[a]=(s[a]??1)*c)}class Ade{constructor(i){this.container=i,this._applyPostDrawUpdaters=a=>{for(const c of this._postDrawUpdaters)c.afterDraw&&c.afterDraw(a)},this._applyPreDrawUpdaters=(a,c,p,_,y,T)=>{for(const C of this._preDrawUpdaters){if(C.getColorStyles){const{fill:I,stroke:D}=C.getColorStyles(c,a,p,_);I&&(y.fill=I),D&&(y.stroke=D)}if(C.getTransformValues){const I=C.getTransformValues(c);for(const D in I)bde(T,I,D)}C.beforeDraw&&C.beforeDraw(c)}},this._applyResizePlugins=()=>{for(const a of this._resizePlugins)a.resize&&a.resize()},this._getPluginParticleColors=a=>{let c,p;for(const _ of this._colorPlugins)if(!c&&_.particleFillColor&&(c=P6(_.particleFillColor(a))),!p&&_.particleStrokeColor&&(p=P6(_.particleStrokeColor(a))),c&&p)break;return[c,p]},this._initCover=()=>{const a=this.container.actualOptions,c=a.backgroundMask.cover,p=c.color,_=Bg(p);if(_){const y={..._,a:c.opacity};this._coverColorStyle=LC(y,y.a)}},this._initStyle=()=>{const a=this.element,c=this.container.actualOptions;if(a){this._fullScreen?(this._originalStyle=ls({},a.style),this._setFullScreenStyle()):this._resetOriginalStyle();for(const p in c.style){if(!p||!c.style)continue;const _=c.style[p];_&&a.style.setProperty(p,_,"important")}}},this._initTrail=async()=>{const a=this.container.actualOptions,c=a.particles.move.trail,p=c.fill;if(c.enable)if(p.color){const _=Bg(p.color);if(!_)return;const y=a.particles.move.trail;this._trailFill={color:{..._},opacity:1/y.length}}else await new Promise((_,y)=>{if(!p.image)return;const T=document.createElement("img");T.addEventListener("load",()=>{this._trailFill={image:T,opacity:1/c.length},_()}),T.addEventListener("error",C=>{y(C.error)}),T.src=p.image})},this._paintBase=a=>{this.draw(c=>Ede(c,this.size,a))},this._paintImage=(a,c)=>{this.draw(p=>yde(p,this.size,a,c))},this._repairStyle=()=>{const a=this.element;a&&(this._safeMutationObserver(c=>c.disconnect()),this._initStyle(),this.initBackground(),this._safeMutationObserver(c=>c.observe(a,{attributes:!0})))},this._resetOriginalStyle=()=>{const a=this.element,c=this._originalStyle;if(!(a&&c))return;const p=a.style;p.position=c.position,p.zIndex=c.zIndex,p.top=c.top,p.left=c.left,p.width=c.width,p.height=c.height},this._safeMutationObserver=a=>{this._mutationObserver&&a(this._mutationObserver)},this._setFullScreenStyle=()=>{const a=this.element;if(!a)return;const c="important",p=a.style;p.setProperty("position","fixed",c),p.setProperty("z-index",this.container.actualOptions.fullScreen.zIndex.toString(10),c),p.setProperty("top","0",c),p.setProperty("left","0",c),p.setProperty("width","100%",c),p.setProperty("height","100%",c)},this.size={height:0,width:0},this._context=null,this._generated=!1,this._preDrawUpdaters=[],this._postDrawUpdaters=[],this._resizePlugins=[],this._colorPlugins=[]}get _fullScreen(){return this.container.actualOptions.fullScreen.enable}clear(){const i=this.container.actualOptions,a=i.particles.move.trail,c=this._trailFill;i.backgroundMask.enable?this.paint():a.enable&&a.length>0&&c?c.color?this._paintBase(LC(c.color,c.opacity)):c.image&&this._paintImage(c.image,c.opacity):this.draw(p=>{ZN(p,this.size)})}destroy(){if(this.stop(),this._generated){const i=this.element;i&&i.remove()}else this._resetOriginalStyle();this._preDrawUpdaters=[],this._postDrawUpdaters=[],this._resizePlugins=[],this._colorPlugins=[]}draw(i){const a=this._context;if(a)return i(a)}drawParticle(i,a){if(i.spawning||i.destroyed)return;const c=i.getRadius();if(c<=0)return;const p=i.getFillColor(),_=i.getStrokeColor()??p;let[y,T]=this._getPluginParticleColors(i);y||(y=p),T||(T=_),!(!y&&!T)&&this.draw(C=>{var me;const I=this.container,D=I.actualOptions,L=i.options.zIndex,j=(1-i.zIndexFactor)**L.opacityRate,Y=i.bubble.opacity??((me=i.opacity)==null?void 0:me.value)??1,X=i.strokeOpacity??Y,ee=Y*j,Q=X*j,se={},fe={fill:y?D6(y,ee):void 0};fe.stroke=T?D6(T,Q):fe.fill,this._applyPreDrawUpdaters(C,i,c,ee,fe,se),vde({container:I,context:C,particle:i,delta:a,colorStyles:fe,backgroundMask:D.backgroundMask.enable,composite:D.backgroundMask.composite,radius:c*(1-i.zIndexFactor)**L.sizeRate,opacity:ee,shadow:i.options.shadow,transform:se}),this._applyPostDrawUpdaters(i)})}drawParticlePlugin(i,a,c){this.draw(p=>wde(p,i,a,c))}drawPlugin(i,a){this.draw(c=>Rde(c,i,a))}async init(){this._safeMutationObserver(i=>i.disconnect()),this._mutationObserver=ade(i=>{for(const a of i)a.type==="attributes"&&a.attributeName==="style"&&this._repairStyle()}),this.resize(),this._initStyle(),this._initCover();try{await this._initTrail()}catch(i){Nv().error(i)}this.initBackground(),this._safeMutationObserver(i=>{this.element&&i.observe(this.element,{attributes:!0})}),this.initUpdaters(),this.initPlugins(),this.paint()}initBackground(){const i=this.container.actualOptions,a=i.background,c=this.element;if(!c)return;const p=c.style;if(p){if(a.color){const _=Bg(a.color);p.backgroundColor=_?LC(_,a.opacity):""}else p.backgroundColor="";p.backgroundImage=a.image||"",p.backgroundPosition=a.position||"",p.backgroundRepeat=a.repeat||"",p.backgroundSize=a.size||""}}initPlugins(){this._resizePlugins=[];for(const[,i]of this.container.plugins)i.resize&&this._resizePlugins.push(i),(i.particleFillColor||i.particleStrokeColor)&&this._colorPlugins.push(i)}initUpdaters(){this._preDrawUpdaters=[],this._postDrawUpdaters=[];for(const i of this.container.particles.updaters)i.afterDraw&&this._postDrawUpdaters.push(i),(i.getColorStyles||i.getTransformValues||i.beforeDraw)&&this._preDrawUpdaters.push(i)}loadCanvas(i){this._generated&&this.element&&this.element.remove(),this._generated=i.dataset&&fv in i.dataset?i.dataset[fv]==="true":this._generated,this.element=i,this.element.ariaHidden="true",this._originalStyle=ls({},this.element.style),this.size.height=i.offsetHeight,this.size.width=i.offsetWidth,this._context=this.element.getContext("2d"),this._safeMutationObserver(a=>{this.element&&a.observe(this.element,{attributes:!0})}),this.container.retina.init(),this.initBackground()}paint(){const i=this.container.actualOptions;this.draw(a=>{i.backgroundMask.enable&&i.backgroundMask.cover?(ZN(a,this.size),this._paintBase(this._coverColorStyle)):this._paintBase()})}resize(){if(!this.element)return!1;const i=this.container,a=i.retina.pixelRatio,c=i.canvas.size,p={width:this.element.offsetWidth*a,height:this.element.offsetHeight*a};if(p.height===c.height&&p.width===c.width&&p.height===this.element.height&&p.width===this.element.width)return!1;const _={...c};return this.element.width=c.width=this.element.offsetWidth*a,this.element.height=c.height=this.element.offsetHeight*a,this.container.started&&(this.resizeFactor={width:c.width/_.width,height:c.height/_.height}),!0}stop(){this._safeMutationObserver(i=>i.disconnect()),this._mutationObserver=void 0,this.draw(i=>ZN(i,this.size))}async windowResize(){if(!this.element||!this.resize())return;const i=this.container,a=i.updateActualOptions();i.particles.setDensity(),this._applyResizePlugins(),a&&await i.refresh()}}function ta(s,i,a,c,p){if(c){let _={passive:!0};wd(p)?_.capture=p:p!==void 0&&(_=p),s.addEventListener(i,a,_)}else{const _=p;s.removeEventListener(i,a,_)}}class Ide{constructor(i){this.container=i,this._doMouseTouchClick=a=>{const c=this.container,p=c.actualOptions;if(this._canPush){const _=c.interactivity.mouse,y=_.position;if(!y)return;_.clickPosition={...y},_.clickTime=new Date().getTime();const T=p.interactivity.events.onClick;jp(T.mode,C=>this.container.handleClickMode(C))}a.type==="touchend"&&setTimeout(()=>this._mouseTouchFinish(),500)},this._handleThemeChange=a=>{const c=a,p=this.container,_=p.options,y=_.defaultThemes,T=c.matches?y.dark:y.light,C=_.themes.find(I=>I.name===T);C&&C.default.auto&&p.loadTheme(T)},this._handleVisibilityChange=()=>{const a=this.container,c=a.actualOptions;this._mouseTouchFinish(),c.pauseOnBlur&&(document&&document.hidden?(a.pageHidden=!0,a.pause()):(a.pageHidden=!1,a.getAnimationStatus()?a.play(!0):a.draw(!0)))},this._handleWindowResize=async()=>{this._resizeTimeout&&(clearTimeout(this._resizeTimeout),delete this._resizeTimeout),this._resizeTimeout=setTimeout(async()=>{const a=this.container.canvas;a&&await a.windowResize()},this.container.actualOptions.interactivity.events.resize.delay*1e3)},this._manageInteractivityListeners=(a,c)=>{const p=this._handlers,_=this.container,y=_.actualOptions,T=_.interactivity.element;if(!T)return;const C=T,I=_.canvas.element;I&&(I.style.pointerEvents=C===I?"initial":"none"),(y.interactivity.events.onHover.enable||y.interactivity.events.onClick.enable)&&(ta(T,I6,p.mouseMove,c),ta(T,Yue,p.touchStart,c),ta(T,Xue,p.touchMove,c),y.interactivity.events.onClick.enable?(ta(T,O6,p.touchEndClick,c),ta(T,Kue,p.mouseUp,c),ta(T,Hue,p.mouseDown,c)):ta(T,O6,p.touchEnd,c),ta(T,a,p.mouseLeave,c),ta(T,Jue,p.touchCancel,c))},this._manageListeners=a=>{const c=this._handlers,p=this.container,_=p.actualOptions,y=_.interactivity.detectsOn,T=p.canvas.element;let C=A6;y==="window"?(p.interactivity.element=window,C=que):y==="parent"&&T?p.interactivity.element=T.parentElement??T.parentNode:p.interactivity.element=T,this._manageMediaMatch(a),this._manageResize(a),this._manageInteractivityListeners(C,a),document&&ta(document,Que,c.visibilityChange,a,!1)},this._manageMediaMatch=a=>{const c=this._handlers,p=P8("(prefers-color-scheme: dark)");if(p){if(p.addEventListener!==void 0){ta(p,"change",c.themeChange,a);return}p.addListener!==void 0&&(a?p.addListener(c.oldThemeChange):p.removeListener(c.oldThemeChange))}},this._manageResize=a=>{const c=this._handlers,p=this.container;if(!p.actualOptions.interactivity.events.resize)return;if(typeof ResizeObserver>"u"){ta(window,$ue,c.resize,a);return}const y=p.canvas.element;this._resizeObserver&&!a?(y&&this._resizeObserver.unobserve(y),this._resizeObserver.disconnect(),delete this._resizeObserver):!this._resizeObserver&&a&&y&&(this._resizeObserver=new ResizeObserver(async T=>{T.find(I=>I.target===y)&&await this._handleWindowResize()}),this._resizeObserver.observe(y))},this._mouseDown=()=>{const{interactivity:a}=this.container;if(!a)return;const{mouse:c}=a;c.clicking=!0,c.downPosition=c.position},this._mouseTouchClick=a=>{const c=this.container,p=c.actualOptions,{mouse:_}=c.interactivity;_.inside=!0;let y=!1;const T=_.position;if(!(!T||!p.interactivity.events.onClick.enable)){for(const[,C]of c.plugins)if(C.clickPositionValid&&(y=C.clickPositionValid(T),y))break;y||this._doMouseTouchClick(a),_.clicking=!1}},this._mouseTouchFinish=()=>{const a=this.container.interactivity;if(!a)return;const c=a.mouse;delete c.position,delete c.clickPosition,delete c.downPosition,a.status=A6,c.inside=!1,c.clicking=!1},this._mouseTouchMove=a=>{const c=this.container,p=c.actualOptions,_=c.interactivity,y=c.canvas.element;if(!_||!_.element)return;_.mouse.inside=!0;let T;if(a.type.startsWith("pointer")){this._canPush=!0;const I=a;if(_.element===window){if(y){const D=y.getBoundingClientRect();T={x:I.clientX-D.left,y:I.clientY-D.top}}}else if(p.interactivity.detectsOn==="parent"){const D=I.target,L=I.currentTarget;if(D&&L&&y){const j=D.getBoundingClientRect(),Y=L.getBoundingClientRect(),X=y.getBoundingClientRect();T={x:I.offsetX+2*j.left-(Y.left+X.left),y:I.offsetY+2*j.top-(Y.top+X.top)}}else T={x:I.offsetX??I.clientX,y:I.offsetY??I.clientY}}else I.target===y&&(T={x:I.offsetX??I.clientX,y:I.offsetY??I.clientY})}else if(this._canPush=a.type!=="touchmove",y){const I=a,D=I.touches[I.touches.length-1],L=y.getBoundingClientRect();T={x:D.clientX-(L.left??0),y:D.clientY-(L.top??0)}}const C=c.retina.pixelRatio;T&&(T.x*=C,T.y*=C),_.mouse.position=T,_.status=I6},this._touchEnd=a=>{const c=a,p=Array.from(c.changedTouches);for(const _ of p)this._touches.delete(_.identifier);this._mouseTouchFinish()},this._touchEndClick=a=>{const c=a,p=Array.from(c.changedTouches);for(const _ of p)this._touches.delete(_.identifier);this._mouseTouchClick(a)},this._touchStart=a=>{const c=a,p=Array.from(c.changedTouches);for(const _ of p)this._touches.set(_.identifier,performance.now());this._mouseTouchMove(a)},this._canPush=!0,this._touches=new Map,this._handlers={mouseDown:()=>this._mouseDown(),mouseLeave:()=>this._mouseTouchFinish(),mouseMove:a=>this._mouseTouchMove(a),mouseUp:a=>this._mouseTouchClick(a),touchStart:a=>this._touchStart(a),touchMove:a=>this._mouseTouchMove(a),touchEnd:a=>this._touchEnd(a),touchCancel:a=>this._touchEnd(a),touchEndClick:a=>this._touchEndClick(a),visibilityChange:()=>this._handleVisibilityChange(),themeChange:a=>this._handleThemeChange(a),oldThemeChange:a=>this._handleThemeChange(a),resize:()=>{this._handleWindowResize()}}}addListeners(){this._manageListeners(!0)}removeListeners(){this._manageListeners(!1)}}let Ad=class x8{constructor(){this.value=""}static create(i,a){const c=new x8;return c.load(i),a!==void 0&&(Yc(a)||Xc(a)?c.load({value:a}):c.load(a)),c}load(i){(i==null?void 0:i.value)!==void 0&&(this.value=i.value)}};class Ode{constructor(){this.color=new Ad,this.color.value="",this.image="",this.position="",this.repeat="",this.size="",this.opacity=1}load(i){i&&(i.color!==void 0&&(this.color=Ad.create(this.color,i.color)),i.image!==void 0&&(this.image=i.image),i.position!==void 0&&(this.position=i.position),i.repeat!==void 0&&(this.repeat=i.repeat),i.size!==void 0&&(this.size=i.size),i.opacity!==void 0&&(this.opacity=i.opacity))}}class Nde{constructor(){this.color=new Ad,this.color.value="#fff",this.opacity=1}load(i){i&&(i.color!==void 0&&(this.color=Ad.create(this.color,i.color)),i.opacity!==void 0&&(this.opacity=i.opacity))}}class Pde{constructor(){this.composite="destination-out",this.cover=new Nde,this.enable=!1}load(i){if(i){if(i.composite!==void 0&&(this.composite=i.composite),i.cover!==void 0){const a=i.cover,c=Yc(i.cover)?{color:i.cover}:i.cover;this.cover.load(a.color!==void 0?a:{color:c})}i.enable!==void 0&&(this.enable=i.enable)}}}class Dde{constructor(){this.enable=!0,this.zIndex=0}load(i){i&&(i.enable!==void 0&&(this.enable=i.enable),i.zIndex!==void 0&&(this.zIndex=i.zIndex))}}class kde{constructor(){this.enable=!1,this.mode=[]}load(i){i&&(i.enable!==void 0&&(this.enable=i.enable),i.mode!==void 0&&(this.mode=i.mode))}}class L6{constructor(){this.selectors=[],this.enable=!1,this.mode=[],this.type="circle"}get el(){return this.elementId}set el(i){this.elementId=i}get elementId(){return this.ids}set elementId(i){this.ids=i}get ids(){return jp(this.selectors,i=>i.replace("#",""))}set ids(i){this.selectors=jp(i,a=>`#${a}`)}load(i){if(!i)return;const a=i.ids??i.elementId??i.el;a!==void 0&&(this.ids=a),i.selectors!==void 0&&(this.selectors=i.selectors),i.enable!==void 0&&(this.enable=i.enable),i.mode!==void 0&&(this.mode=i.mode),i.type!==void 0&&(this.type=i.type)}}class Lde{constructor(){this.enable=!1,this.force=2,this.smooth=10}load(i){i&&(i.enable!==void 0&&(this.enable=i.enable),i.force!==void 0&&(this.force=i.force),i.smooth!==void 0&&(this.smooth=i.smooth))}}class xde{constructor(){this.enable=!1,this.mode=[],this.parallax=new Lde}load(i){i&&(i.enable!==void 0&&(this.enable=i.enable),i.mode!==void 0&&(this.mode=i.mode),this.parallax.load(i.parallax))}}class Mde{constructor(){this.delay=.5,this.enable=!0}load(i){i!==void 0&&(i.delay!==void 0&&(this.delay=i.delay),i.enable!==void 0&&(this.enable=i.enable))}}class Ude{constructor(){this.onClick=new kde,this.onDiv=new L6,this.onHover=new xde,this.resize=new Mde}get onclick(){return this.onClick}set onclick(i){this.onClick=i}get ondiv(){return this.onDiv}set ondiv(i){this.onDiv=i}get onhover(){return this.onHover}set onhover(i){this.onHover=i}load(i){if(!i)return;this.onClick.load(i.onClick??i.onclick);const a=i.onDiv??i.ondiv;a!==void 0&&(this.onDiv=jp(a,c=>{const p=new L6;return p.load(c),p})),this.onHover.load(i.onHover??i.onhover),wd(i.resize)?this.resize.enable=i.resize:this.resize.load(i.resize)}}class Vde{constructor(i,a){this._engine=i,this._container=a}load(i){if(!i||!this._container)return;const a=this._engine.plugins.interactors.get(this._container);if(a)for(const c of a)c.loadModeOptions&&c.loadModeOptions(this,i)}}class M8{constructor(i,a){this.detectsOn="window",this.events=new Ude,this.modes=new Vde(i,a)}get detect_on(){return this.detectsOn}set detect_on(i){this.detectsOn=i}load(i){if(!i)return;const a=i.detectsOn??i.detect_on;a!==void 0&&(this.detectsOn=a),this.events.load(i.events),this.modes.load(i.modes)}}class Fde{load(i){i&&(i.position&&(this.position={x:i.position.x??50,y:i.position.y??50,mode:i.position.mode??"percent"}),i.options&&(this.options=ls({},i.options)))}}class Bde{constructor(){this.maxWidth=1/0,this.options={},this.mode="canvas"}load(i){i&&(i.maxWidth!==void 0&&(this.maxWidth=i.maxWidth),i.mode!==void 0&&(i.mode==="screen"?this.mode="screen":this.mode="canvas"),i.options!==void 0&&(this.options=ls({},i.options)))}}class jde{constructor(){this.auto=!1,this.mode="any",this.value=!1}load(i){i&&(i.auto!==void 0&&(this.auto=i.auto),i.mode!==void 0&&(this.mode=i.mode),i.value!==void 0&&(this.value=i.value))}}class Gde{constructor(){this.name="",this.default=new jde}load(i){i&&(i.name!==void 0&&(this.name=i.name),this.default.load(i.default),i.options!==void 0&&(this.options=ls({},i.options)))}}let eP=class{constructor(){this.count=0,this.enable=!1,this.offset=0,this.speed=1,this.delay=0,this.decay=0,this.sync=!0}load(i){i&&(i.count!==void 0&&(this.count=In(i.count)),i.enable!==void 0&&(this.enable=i.enable),i.offset!==void 0&&(this.offset=In(i.offset)),i.speed!==void 0&&(this.speed=In(i.speed)),i.decay!==void 0&&(this.decay=In(i.decay)),i.delay!==void 0&&(this.delay=In(i.delay)),i.sync!==void 0&&(this.sync=i.sync))}},Wde=class{constructor(){this.h=new eP,this.s=new eP,this.l=new eP}load(i){i&&(this.h.load(i.h),this.s.load(i.s),this.l.load(i.l))}},lD=class U8 extends Ad{constructor(){super(),this.animation=new Wde}static create(i,a){const c=new U8;return c.load(i),a!==void 0&&(Yc(a)||Xc(a)?c.load({value:a}):c.load(a)),c}load(i){if(super.load(i),!i)return;const a=i.animation;a!==void 0&&(a.enable!==void 0?this.animation.h.load(a):this.animation.load(i.animation))}},zde=class{constructor(){this.speed=2}load(i){i&&i.speed!==void 0&&(this.speed=i.speed)}},Hde=class{constructor(){this.enable=!0,this.retries=0}load(i){i&&(i.enable!==void 0&&(this.enable=i.enable),i.retries!==void 0&&(this.retries=i.retries))}},Kde=class{constructor(){this.count=0,this.enable=!1,this.speed=1,this.decay=0,this.delay=0,this.sync=!1}load(i){i&&(i.count!==void 0&&(this.count=In(i.count)),i.enable!==void 0&&(this.enable=i.enable),i.speed!==void 0&&(this.speed=In(i.speed)),i.decay!==void 0&&(this.decay=In(i.decay)),i.delay!==void 0&&(this.delay=In(i.delay)),i.sync!==void 0&&(this.sync=i.sync))}},V8=class extends Kde{constructor(){super(),this.mode="auto",this.startValue="random"}load(i){super.load(i),i&&(i.minimumValue!==void 0&&(this.minimumValue=i.minimumValue),i.mode!==void 0&&(this.mode=i.mode),i.startValue!==void 0&&(this.startValue=i.startValue))}};class qde{constructor(){this.enable=!1,this.minimumValue=0}load(i){i&&(i.enable!==void 0&&(this.enable=i.enable),i.minimumValue!==void 0&&(this.minimumValue=i.minimumValue))}}let Bv=class{constructor(){this.random=new qde,this.value=0}load(i){i&&(wd(i.random)?this.random.enable=i.random:this.random.load(i.random),i.value!==void 0&&(this.value=In(i.value,this.random.enable?this.random.minimumValue:void 0)))}},x6=class extends Bv{constructor(){super(),this.random.minimumValue=.1,this.value=1}},F8=class{constructor(){this.horizontal=new x6,this.vertical=new x6}load(i){i&&(this.horizontal.load(i.horizontal),this.vertical.load(i.vertical))}},Yde=class{constructor(){this.absorb=new zde,this.bounce=new F8,this.enable=!1,this.maxSpeed=50,this.mode="bounce",this.overlap=new Hde}load(i){i&&(this.absorb.load(i.absorb),this.bounce.load(i.bounce),i.enable!==void 0&&(this.enable=i.enable),i.maxSpeed!==void 0&&(this.maxSpeed=In(i.maxSpeed)),i.mode!==void 0&&(this.mode=i.mode),this.overlap.load(i.overlap))}},Xde=class{constructor(){this.offset=0,this.value=90}load(i){i&&(i.offset!==void 0&&(this.offset=In(i.offset)),i.value!==void 0&&(this.value=In(i.value)))}},Jde=class{constructor(){this.distance=200,this.enable=!1,this.rotate={x:3e3,y:3e3}}get rotateX(){return this.rotate.x}set rotateX(i){this.rotate.x=i}get rotateY(){return this.rotate.y}set rotateY(i){this.rotate.y=i}load(i){var p,_;if(!i)return;i.distance!==void 0&&(this.distance=In(i.distance)),i.enable!==void 0&&(this.enable=i.enable);const a=((p=i.rotate)==null?void 0:p.x)??i.rotateX;a!==void 0&&(this.rotate.x=a);const c=((_=i.rotate)==null?void 0:_.y)??i.rotateY;c!==void 0&&(this.rotate.y=c)}},$de=class{constructor(){this.x=50,this.y=50,this.mode="percent",this.radius=0}load(i){i&&(i.x!==void 0&&(this.x=i.x),i.y!==void 0&&(this.y=i.y),i.mode!==void 0&&(this.mode=i.mode),i.radius!==void 0&&(this.radius=i.radius))}},Qde=class{constructor(){this.acceleration=9.81,this.enable=!1,this.inverse=!1,this.maxSpeed=50}load(i){i&&(i.acceleration!==void 0&&(this.acceleration=In(i.acceleration)),i.enable!==void 0&&(this.enable=i.enable),i.inverse!==void 0&&(this.inverse=i.inverse),i.maxSpeed!==void 0&&(this.maxSpeed=In(i.maxSpeed)))}},Zde=class{constructor(){this.clamp=!0,this.delay=new Bv,this.enable=!1,this.options={}}load(i){i&&(i.clamp!==void 0&&(this.clamp=i.clamp),this.delay.load(i.delay),i.enable!==void 0&&(this.enable=i.enable),this.generator=i.generator,i.options&&(this.options=ls(this.options,i.options)))}},ehe=class{load(i){i&&(i.color!==void 0&&(this.color=Ad.create(this.color,i.color)),i.image!==void 0&&(this.image=i.image))}},the=class{constructor(){this.enable=!1,this.length=10,this.fill=new ehe}get fillColor(){return this.fill.color}set fillColor(i){this.fill.load({color:i})}load(i){i&&(i.enable!==void 0&&(this.enable=i.enable),(i.fill!==void 0||i.fillColor!==void 0)&&this.fill.load(i.fill||{color:i.fillColor}),i.length!==void 0&&(this.length=i.length))}},nhe=class{constructor(){this.default="out"}load(i){i&&(i.default!==void 0&&(this.default=i.default),this.bottom=i.bottom??i.default,this.left=i.left??i.default,this.right=i.right??i.default,this.top=i.top??i.default)}},ihe=class{constructor(){this.acceleration=0,this.enable=!1}load(i){i&&(i.acceleration!==void 0&&(this.acceleration=In(i.acceleration)),i.enable!==void 0&&(this.enable=i.enable),i.position&&(this.position=ls({},i.position)))}},rhe=class{constructor(){this.angle=new Xde,this.attract=new Jde,this.center=new $de,this.decay=0,this.distance={},this.direction="none",this.drift=0,this.enable=!1,this.gravity=new Qde,this.path=new Zde,this.outModes=new nhe,this.random=!1,this.size=!1,this.speed=2,this.spin=new ihe,this.straight=!1,this.trail=new the,this.vibrate=!1,this.warp=!1}get bounce(){return this.collisions}set bounce(i){this.collisions=i}get collisions(){return!1}set collisions(i){}get noise(){return this.path}set noise(i){this.path=i}get outMode(){return this.outModes.default}set outMode(i){this.outModes.default=i}get out_mode(){return this.outMode}set out_mode(i){this.outMode=i}load(i){if(!i)return;this.angle.load(za(i.angle)?{value:i.angle}:i.angle),this.attract.load(i.attract),this.center.load(i.center),i.decay!==void 0&&(this.decay=In(i.decay)),i.direction!==void 0&&(this.direction=i.direction),i.distance!==void 0&&(this.distance=za(i.distance)?{horizontal:i.distance,vertical:i.distance}:{...i.distance}),i.drift!==void 0&&(this.drift=In(i.drift)),i.enable!==void 0&&(this.enable=i.enable),this.gravity.load(i.gravity);const a=i.outModes??i.outMode??i.out_mode;a!==void 0&&(ov(a)?this.outModes.load(a):this.outModes.load({default:a})),this.path.load(i.path??i.noise),i.random!==void 0&&(this.random=i.random),i.size!==void 0&&(this.size=i.size),i.speed!==void 0&&(this.speed=In(i.speed)),this.spin.load(i.spin),i.straight!==void 0&&(this.straight=i.straight),this.trail.load(i.trail),i.vibrate!==void 0&&(this.vibrate=i.vibrate),i.warp!==void 0&&(this.warp=i.warp)}},she=class extends V8{constructor(){super(),this.destroy="none",this.speed=2}get opacity_min(){return this.minimumValue}set opacity_min(i){this.minimumValue=i}load(i){(i==null?void 0:i.opacity_min)!==void 0&&i.minimumValue===void 0&&(i.minimumValue=i.opacity_min),super.load(i),i&&i.destroy!==void 0&&(this.destroy=i.destroy)}},ohe=class extends Bv{constructor(){super(),this.animation=new she,this.random.minimumValue=.1,this.value=1}get anim(){return this.animation}set anim(i){this.animation=i}load(i){if(!i)return;super.load(i);const a=i.animation??i.anim;a!==void 0&&(this.animation.load(a),this.value=In(this.value,this.animation.enable?this.animation.minimumValue:void 0))}},ahe=class{constructor(){this.enable=!1,this.width=1920,this.height=1080}get area(){return this.width}set area(i){this.width=i}get factor(){return this.height}set factor(i){this.height=i}get value_area(){return this.area}set value_area(i){this.area=i}load(i){if(!i)return;i.enable!==void 0&&(this.enable=i.enable);const a=i.width??i.area??i.value_area;a!==void 0&&(this.width=a);const c=i.height??i.factor;c!==void 0&&(this.height=c)}},che=class{constructor(){this.density=new ahe,this.limit=0,this.value=0}get max(){return this.limit}set max(i){this.limit=i}load(i){if(!i)return;this.density.load(i.density);const a=i.limit??i.max;a!==void 0&&(this.limit=a),i.value!==void 0&&(this.value=i.value)}},lhe=class{constructor(){this.blur=0,this.color=new Ad,this.enable=!1,this.offset={x:0,y:0},this.color.value="#000"}load(i){i&&(i.blur!==void 0&&(this.blur=i.blur),this.color=Ad.create(this.color,i.color),i.enable!==void 0&&(this.enable=i.enable),i.offset!==void 0&&(i.offset.x!==void 0&&(this.offset.x=i.offset.x),i.offset.y!==void 0&&(this.offset.y=i.offset.y)))}};const tP="character",nP="char",iP="image",rP="images",sP="polygon",oP="star";let uhe=class{constructor(){this.loadShape=(i,a,c,p)=>{if(!i)return;const _=Xc(i),y=_?[]:{},T=_!==Xc(this.options[a]),C=_!==Xc(this.options[c]);T&&(this.options[a]=y),C&&p&&(this.options[c]=y),this.options[a]=ls(this.options[a]??y,i),(!this.options[c]||p)&&(this.options[c]=ls(this.options[c]??y,i))},this.close=!0,this.fill=!0,this.options={},this.type="circle"}get character(){return this.options[tP]??this.options[nP]}set character(i){this.options[nP]=this.options[tP]=i}get custom(){return this.options}set custom(i){this.options=i}get image(){return this.options[iP]??this.options[rP]}set image(i){this.options[rP]=this.options[iP]=i}get images(){return this.image}set images(i){this.image=i}get polygon(){return this.options[sP]??this.options[oP]}set polygon(i){this.options[oP]=this.options[sP]=i}get stroke(){return[]}set stroke(i){}load(i){if(!i)return;const a=i.options??i.custom;if(a!==void 0)for(const c in a){const p=a[c];p&&(this.options[c]=ls(this.options[c]??{},p))}this.loadShape(i.character,tP,nP,!0),this.loadShape(i.polygon,sP,oP,!1),this.loadShape(i.image??i.images,iP,rP,!0),i.close!==void 0&&(this.close=i.close),i.fill!==void 0&&(this.fill=i.fill),i.type!==void 0&&(this.type=i.type)}},dhe=class extends V8{constructor(){super(),this.destroy="none",this.speed=5}get size_min(){return this.minimumValue}set size_min(i){this.minimumValue=i}load(i){(i==null?void 0:i.size_min)!==void 0&&i.minimumValue===void 0&&(i.minimumValue=i.size_min),super.load(i),i&&i.destroy!==void 0&&(this.destroy=i.destroy)}},hhe=class extends Bv{constructor(){super(),this.animation=new dhe,this.random.minimumValue=1,this.value=3}get anim(){return this.animation}set anim(i){this.animation=i}load(i){if(super.load(i),!i)return;const a=i.animation??i.anim;a!==void 0&&(this.animation.load(a),this.value=In(this.value,this.animation.enable?this.animation.minimumValue:void 0))}},M6=class{constructor(){this.width=0}load(i){i&&(i.color!==void 0&&(this.color=lD.create(this.color,i.color)),i.width!==void 0&&(this.width=In(i.width)),i.opacity!==void 0&&(this.opacity=In(i.opacity)))}},phe=class extends Bv{constructor(){super(),this.opacityRate=1,this.sizeRate=1,this.velocityRate=1}load(i){super.load(i),i&&(i.opacityRate!==void 0&&(this.opacityRate=i.opacityRate),i.sizeRate!==void 0&&(this.sizeRate=i.sizeRate),i.velocityRate!==void 0&&(this.velocityRate=i.velocityRate))}},fhe=class{constructor(i,a){this._engine=i,this._container=a,this.bounce=new F8,this.collisions=new Yde,this.color=new lD,this.color.value="#fff",this.groups={},this.move=new rhe,this.number=new che,this.opacity=new ohe,this.reduceDuplicates=!1,this.shadow=new lhe,this.shape=new uhe,this.size=new hhe,this.stroke=new M6,this.zIndex=new phe}load(i){var p,_,y;if(!i)return;if(this.bounce.load(i.bounce),this.color.load(lD.create(this.color,i.color)),i.groups!==void 0)for(const T in i.groups){const C=i.groups[T];C!==void 0&&(this.groups[T]=ls(this.groups[T]??{},C))}this.move.load(i.move),this.number.load(i.number),this.opacity.load(i.opacity),i.reduceDuplicates!==void 0&&(this.reduceDuplicates=i.reduceDuplicates),this.shape.load(i.shape),this.size.load(i.size),this.shadow.load(i.shadow),this.zIndex.load(i.zIndex);const a=((p=i.move)==null?void 0:p.collisions)??((_=i.move)==null?void 0:_.bounce);a!==void 0&&(this.collisions.enable=a),this.collisions.load(i.collisions),i.interactivity!==void 0&&(this.interactivity=ls({},i.interactivity));const c=i.stroke??((y=i.shape)==null?void 0:y.stroke);if(c&&(this.stroke=jp(c,T=>{const C=new M6;return C.load(T),C})),this._container){const T=this._engine.plugins.updaters.get(this._container);if(T)for(const I of T)I.loadOptions&&I.loadOptions(this,i);const C=this._engine.plugins.interactors.get(this._container);if(C)for(const I of C)I.loadParticlesOptions&&I.loadParticlesOptions(this,i)}}};function B8(s,...i){for(const a of i)s.load(a)}function j8(s,i,...a){const c=new fhe(s,i);return B8(c,...a),c}class mhe{constructor(i,a){this._findDefaultTheme=c=>this.themes.find(p=>p.default.value&&p.default.mode===c)??this.themes.find(p=>p.default.value&&p.default.mode==="any"),this._importPreset=c=>{this.load(this._engine.plugins.getPreset(c))},this._engine=i,this._container=a,this.autoPlay=!0,this.background=new Ode,this.backgroundMask=new Pde,this.defaultThemes={},this.delay=0,this.fullScreen=new Dde,this.detectRetina=!0,this.duration=0,this.fpsLimit=120,this.interactivity=new M8(i,a),this.manualParticles=[],this.particles=j8(this._engine,this._container),this.pauseOnBlur=!0,this.pauseOnOutsideViewport=!0,this.responsive=[],this.smooth=!1,this.style={},this.themes=[],this.zLayers=100}get backgroundMode(){return this.fullScreen}set backgroundMode(i){this.fullScreen.load(i)}get fps_limit(){return this.fpsLimit}set fps_limit(i){this.fpsLimit=i}get retina_detect(){return this.detectRetina}set retina_detect(i){this.detectRetina=i}load(i){var y,T;if(!i)return;i.preset!==void 0&&jp(i.preset,C=>this._importPreset(C)),i.autoPlay!==void 0&&(this.autoPlay=i.autoPlay),i.delay!==void 0&&(this.delay=In(i.delay));const a=i.detectRetina??i.retina_detect;a!==void 0&&(this.detectRetina=a),i.duration!==void 0&&(this.duration=In(i.duration));const c=i.fpsLimit??i.fps_limit;c!==void 0&&(this.fpsLimit=c),i.pauseOnBlur!==void 0&&(this.pauseOnBlur=i.pauseOnBlur),i.pauseOnOutsideViewport!==void 0&&(this.pauseOnOutsideViewport=i.pauseOnOutsideViewport),i.zLayers!==void 0&&(this.zLayers=i.zLayers),this.background.load(i.background);const p=i.fullScreen??i.backgroundMode;wd(p)?this.fullScreen.enable=p:this.fullScreen.load(p),this.backgroundMask.load(i.backgroundMask),this.interactivity.load(i.interactivity),i.manualParticles&&(this.manualParticles=i.manualParticles.map(C=>{const I=new Fde;return I.load(C),I})),this.particles.load(i.particles),this.style=ls(this.style,i.style),this._engine.plugins.loadOptions(this,i),i.smooth!==void 0&&(this.smooth=i.smooth);const _=this._engine.plugins.interactors.get(this._container);if(_)for(const C of _)C.loadOptions&&C.loadOptions(this,i);if(i.responsive!==void 0)for(const C of i.responsive){const I=new Bde;I.load(C),this.responsive.push(I)}if(this.responsive.sort((C,I)=>C.maxWidth-I.maxWidth),i.themes!==void 0)for(const C of i.themes){const I=this.themes.find(D=>D.name===C.name);if(I)I.load(C);else{const D=new Gde;D.load(C),this.themes.push(D)}}this.defaultThemes.dark=(y=this._findDefaultTheme("dark"))==null?void 0:y.name,this.defaultThemes.light=(T=this._findDefaultTheme("light"))==null?void 0:T.name}setResponsive(i,a,c){this.load(c);const p=this.responsive.find(_=>_.mode==="screen"&&screen?_.maxWidth>screen.availWidth:_.maxWidth*a>i);return this.load(p==null?void 0:p.options),p==null?void 0:p.maxWidth}setTheme(i){if(i){const a=this.themes.find(c=>c.name===i);a&&this.load(a.options)}else{const a=P8("(prefers-color-scheme: dark)"),c=a&&a.matches,p=this._findDefaultTheme(c?"dark":"light");p&&this.load(p.options)}}}class ghe{constructor(i,a){this.container=a,this._engine=i,this._interactors=i.plugins.getInteractors(this.container,!0),this._externalInteractors=[],this._particleInteractors=[]}async externalInteract(i){for(const a of this._externalInteractors)a.isEnabled()&&await a.interact(i)}handleClickMode(i){for(const a of this._externalInteractors)a.handleClickMode&&a.handleClickMode(i)}init(){this._externalInteractors=[],this._particleInteractors=[];for(const i of this._interactors){switch(i.type){case"external":this._externalInteractors.push(i);break;case"particles":this._particleInteractors.push(i);break}i.init()}}async particlesInteract(i,a){for(const c of this._externalInteractors)c.clear(i,a);for(const c of this._particleInteractors)c.isEnabled(i)&&await c.interact(i,a)}async reset(i){for(const a of this._externalInteractors)a.isEnabled()&&a.reset(i);for(const a of this._particleInteractors)a.isEnabled(i)&&a.reset(i)}}const U6=s=>{if(!cde(s.outMode,s.checkModes))return;const i=s.radius*2;s.coord>s.maxCoord-i?s.setCb(-s.radius):s.coord<i&&s.setCb(s.radius)};class _he{constructor(i,a,c,p,_,y){this.container=c,this._calcPosition=(T,C,I,D=0)=>{for(const[,fe]of T.plugins){const me=fe.particlePosition!==void 0?fe.particlePosition(C,this):void 0;if(me)return aD.create(me.x,me.y,I)}const L=T.canvas.size,j=rde({size:L,position:C}),Y=aD.create(j.x,j.y,I),X=this.getRadius(),ee=this.options.move.outModes,Q=fe=>{U6({outMode:fe,checkModes:["bounce","bounce-horizontal"],coord:Y.x,maxCoord:T.canvas.size.width,setCb:me=>Y.x+=me,radius:X})},se=fe=>{U6({outMode:fe,checkModes:["bounce","bounce-vertical"],coord:Y.y,maxCoord:T.canvas.size.height,setCb:me=>Y.y+=me,radius:X})};return Q(ee.left??ee.default),Q(ee.right??ee.default),se(ee.top??ee.default),se(ee.bottom??ee.default),this._checkOverlap(Y,D)?this._calcPosition(T,void 0,I,D+1):Y},this._calculateVelocity=()=>{const T=ide(this.direction),C=T.copy(),I=this.options.move;if(I.direction==="inside"||I.direction==="outside")return C;const D=Math.PI/180*ti(I.angle.value),L=Math.PI/180*ti(I.angle.offset),j={left:L-D/2,right:L+D/2};return I.straight||(C.angle+=Fg(In(j.left,j.right))),I.random&&typeof I.speed=="number"&&(C.length*=ru()),C},this._checkOverlap=(T,C=0)=>{const I=this.options.collisions,D=this.getRadius();if(!I.enable)return!1;const L=I.overlap;if(L.enable)return!1;const j=L.retries;if(j>=0&&C>j)throw new Error(`${Bp} particle is overlapping and can't be placed`);return!!this.container.particles.find(Y=>Ek(T,Y.position)<D+Y.getRadius())},this._getRollColor=T=>{if(!T||!this.roll||!this.backColor&&!this.roll.alter)return T;const C=this.roll.horizontal&&this.roll.vertical?2:1,I=this.roll.horizontal?Math.PI/2:0;return Math.floor(((this.roll.angle??0)+I)/(Math.PI/C))%2?this.backColor?this.backColor:this.roll.alter?Cde(T,this.roll.alter.type,this.roll.alter.value):T:T},this._initPosition=T=>{const C=this.container,I=ti(this.options.zIndex.value);this.position=this._calcPosition(C,T,O8(I,0,C.zLayers)),this.initialPosition=this.position.copy();const D=C.canvas.size;switch(this.moveCenter={...D8(this.options.move.center,D),radius:this.options.move.center.radius??0,mode:this.options.move.center.mode??"percent"},this.direction=nde(this.options.move.direction,this.position,this.moveCenter),this.options.move.direction){case"inside":this.outType="inside";break;case"outside":this.outType="outside";break}this.offset=I8.origin},this._loadShapeData=(T,C)=>{const I=T.options[this.shape];if(I)return ls({close:T.close,fill:T.fill},mv(I,this.id,C))},this._engine=i,this.init(a,p,_,y)}destroy(i){if(this.unbreakable||this.destroyed)return;this.destroyed=!0,this.bubble.inRange=!1,this.slow.inRange=!1;const a=this.container,c=this.pathGenerator;for(const[,p]of a.plugins)p.particleDestroyed&&p.particleDestroyed(this,i);for(const p of a.particles.updaters)p.particleDestroyed&&p.particleDestroyed(this,i);c&&c.reset(this)}draw(i){const a=this.container;for(const[,c]of a.plugins)a.canvas.drawParticlePlugin(c,this,i);a.canvas.drawParticle(this,i)}getFillColor(){return this._getRollColor(this.bubble.color??k6(this.color))}getMass(){return this.getRadius()**2*Math.PI/2}getPosition(){return{x:this.position.x+this.offset.x,y:this.position.y+this.offset.y,z:this.position.z}}getRadius(){return this.bubble.radius??this.size.value}getStrokeColor(){return this._getRollColor(this.bubble.color??k6(this.strokeColor))}init(i,a,c,p){const _=this.container,y=this._engine;this.id=i,this.group=p,this.fill=!0,this.pathRotation=!1,this.close=!0,this.lastPathTime=0,this.destroyed=!1,this.unbreakable=!1,this.rotation=0,this.misplaced=!1,this.retina={maxDistance:{}},this.outType="normal",this.ignoresResizeRatio=!0;const T=_.retina.pixelRatio,C=_.actualOptions,I=j8(this._engine,_,C.particles),D=I.shape.type,{reduceDuplicates:L}=I;this.shape=mv(D,this.id,L);const j=I.shape;if(c&&c.shape&&c.shape.type){const me=c.shape.type,Oe=mv(me,this.id,L);Oe&&(this.shape=Oe,j.load(c.shape))}this.shapeData=this._loadShapeData(j,L),I.load(c);const Y=this.shapeData;Y&&I.load(Y.particles);const X=new M8(y,_);X.load(_.actualOptions.interactivity),X.load(I.interactivity),this.interactivity=X,this.fill=(Y==null?void 0:Y.fill)??I.shape.fill,this.close=(Y==null?void 0:Y.close)??I.shape.close,this.options=I;const ee=this.options.move.path;this.pathDelay=ede(ee.delay)*1e3,ee.generator&&(this.pathGenerator=this._engine.plugins.getPathGenerator(ee.generator),this.pathGenerator&&_.addPath(ee.generator,this.pathGenerator)&&this.pathGenerator.init(_)),_.retina.initParticle(this),this.size=ude(this.options.size,T),this.bubble={inRange:!1},this.slow={inRange:!1,factor:1},this._initPosition(a),this.initialVelocity=this._calculateVelocity(),this.velocity=this.initialVelocity.copy(),this.moveDecay=1-ti(this.options.move.decay);const Q=_.particles;Q.needsSort=Q.needsSort||Q.lastZIndex<this.position.z,Q.lastZIndex=this.position.z,this.zIndexFactor=this.position.z/_.zLayers,this.sides=24;let se=_.drawers.get(this.shape);se||(se=this._engine.plugins.getShapeDrawer(this.shape),se&&_.drawers.set(this.shape,se)),se&&se.loadShape&&se.loadShape(this);const fe=se==null?void 0:se.getSidesCount;fe&&(this.sides=fe(this)),this.spawning=!1,this.shadowColor=Bg(this.options.shadow.color);for(const me of _.particles.updaters)me.init(this);for(const me of _.particles.movers)me.init&&me.init(this);se&&se.particleInit&&se.particleInit(_,this);for(const[,me]of _.plugins)me.particleCreated&&me.particleCreated(this)}isInsideCanvas(){const i=this.getRadius(),a=this.container.canvas.size,c=this.position;return c.x>=-i&&c.y>=-i&&c.y<=a.height+i&&c.x<=a.width+i}isVisible(){return!this.destroyed&&!this.spawning&&this.isInsideCanvas()}reset(){for(const i of this.container.particles.updaters)i.reset&&i.reset(this)}}class Ehe{constructor(i,a){this.position=i,this.particle=a}}class G8{constructor(i,a){this.position={x:i,y:a}}}let QC=class W8 extends G8{constructor(i,a,c,p){super(i,a),this.size={height:p,width:c}}contains(i){const a=this.size.width,c=this.size.height,p=this.position;return i.x>=p.x&&i.x<=p.x+a&&i.y>=p.y&&i.y<=p.y+c}intersects(i){i instanceof z8&&i.intersects(this);const a=this.size.width,c=this.size.height,p=this.position,_=i.position,y=i instanceof W8?i.size:{width:0,height:0},T=y.width,C=y.height;return _.x<p.x+a&&_.x+T>p.x&&_.y<p.y+c&&_.y+C>p.y}},z8=class H8 extends G8{constructor(i,a,c){super(i,a),this.radius=c}contains(i){return Ek(i,this.position)<=this.radius}intersects(i){const a=this.position,c=i.position,p={x:Math.abs(c.x-a.x),y:Math.abs(c.y-a.y)},_=this.radius;if(i instanceof H8){const y=_+i.radius,T=Math.sqrt(p.x**2+p.y**2);return y>T}else if(i instanceof QC){const{width:y,height:T}=i.size;return Math.pow(p.x-y,2)+Math.pow(p.y-T,2)<=_**2||p.x<=_+y&&p.y<=_+T||p.x<=y||p.y<=T}return!1}};class ZC{constructor(i,a){this.rectangle=i,this.capacity=a,this._subdivide=()=>{const{x:c,y:p}=this.rectangle.position,{width:_,height:y}=this.rectangle.size,{capacity:T}=this;for(let C=0;C<4;C++)this._subs.push(new ZC(new QC(c+_/2*(C%2),p+y/2*(Math.round(C/2)-C%2),_/2,y/2),T));this._divided=!0},this._points=[],this._divided=!1,this._subs=[]}insert(i){return this.rectangle.contains(i.position)?this._points.length<this.capacity?(this._points.push(i),!0):(this._divided||this._subdivide(),this._subs.some(a=>a.insert(i))):!1}query(i,a,c){const p=c||[];if(!i.intersects(this.rectangle))return[];for(const _ of this._points)!i.contains(_.position)&&Ek(i.position,_.position)>_.particle.getRadius()&&(!a||a(_.particle))||p.push(_.particle);if(this._divided)for(const _ of this._subs)_.query(i,a,p);return p}queryCircle(i,a,c){return this.query(new z8(i.x,i.y,a),c)}queryRectangle(i,a,c){return this.query(new QC(i.x,i.y,a.width,a.height),c)}}const V6=4,F6=s=>new QC(-s.width/4,-s.height/4,s.width*3/2,s.height*3/2);let yhe=class{constructor(i,a){this._applyDensity=(p,_,y)=>{var Y;if(!((Y=p.number.density)!=null&&Y.enable))return;const T=p.number,C=this._initDensityFactor(T.density),I=T.value,D=T.limit>0?T.limit:I,L=Math.min(I,D)*C+_,j=Math.min(this.count,this.filter(X=>X.group===y).length);this.limit=T.limit*C,j<L?this.push(Math.abs(L-j),void 0,p,y):j>L&&this.removeQuantity(j-L,y)},this._initDensityFactor=p=>{const _=this._container;if(!_.canvas.element||!p.enable)return 1;const y=_.canvas.element,T=_.retina.pixelRatio;return y.width*y.height/(p.factor*T**2*p.area)},this._pushParticle=(p,_,y,T)=>{try{let C=this.pool.pop();C?C.init(this._nextId,p,_,y):C=new _he(this._engine,this._nextId,this._container,p,_,y);let I=!0;return T&&(I=T(C)),I?(this._array.push(C),this._zArray.push(C),this._nextId++,this._engine.dispatchEvent("particleAdded",{container:this._container,data:{particle:C}}),C):void 0}catch(C){Nv().warning(`${Bp} adding particle: ${C}`);return}},this._removeParticle=(p,_,y)=>{const T=this._array[p];if(!T||T.group!==_)return!1;T.destroy(y);const C=this._zArray.indexOf(T);return this._array.splice(p,1),this._zArray.splice(C,1),this.pool.push(T),this._engine.dispatchEvent("particleRemoved",{container:this._container,data:{particle:T}}),!0},this._engine=i,this._container=a,this._nextId=0,this._array=[],this._zArray=[],this.pool=[],this.limit=0,this.needsSort=!1,this.lastZIndex=0,this._interactionManager=new ghe(i,a);const c=a.canvas.size;this.quadTree=new ZC(F6(c),V6),this.movers=this._engine.plugins.getMovers(a,!0),this.updaters=this._engine.plugins.getUpdaters(a,!0)}get count(){return this._array.length}addManualParticles(){const i=this._container,a=i.actualOptions;for(const c of a.manualParticles)this.addParticle(c.position?D8(c.position,i.canvas.size):void 0,c.options)}addParticle(i,a,c,p){const _=this._container,y=_.actualOptions,T=y.particles.number.limit;if(T>0){const C=this.count+1-T;C>0&&this.removeQuantity(C)}return this._pushParticle(i,a,c,p)}clear(){this._array=[],this._zArray=[]}destroy(){this._array=[],this._zArray=[],this.movers=[],this.updaters=[]}async draw(i){const a=this._container;a.canvas.clear(),await this.update(i);for(const[,c]of a.plugins)a.canvas.drawPlugin(c,i);for(const c of this._zArray)c.draw(i)}filter(i){return this._array.filter(i)}find(i){return this._array.find(i)}handleClickMode(i){this._interactionManager.handleClickMode(i)}init(){var p;const i=this._container,a=i.actualOptions;this.lastZIndex=0,this.needsSort=!1;let c=!1;this.updaters=this._engine.plugins.getUpdaters(i,!0),this._interactionManager.init();for(const[,_]of i.plugins)if(_.particlesInitialization!==void 0&&(c=_.particlesInitialization()),c)break;this._interactionManager.init();for(const[,_]of i.pathGenerators)_.init(i);if(this.addManualParticles(),!c){for(const _ in a.particles.groups){const y=a.particles.groups[_];for(let T=this.count,C=0;C<((p=y.number)==null?void 0:p.value)&&T<a.particles.number.value;T++,C++)this.addParticle(void 0,y,_)}for(let _=this.count;_<a.particles.number.value;_++)this.addParticle()}}push(i,a,c,p){this.pushing=!0;for(let _=0;_<i;_++)this.addParticle(a==null?void 0:a.position,c,p);this.pushing=!1}async redraw(){this.clear(),this.init(),await this.draw({value:0,factor:0})}remove(i,a,c){this.removeAt(this._array.indexOf(i),void 0,a,c)}removeAt(i,a=1,c,p){if(i<0||i>this.count)return;let _=0;for(let y=i;_<a&&y<this.count;y++)this._removeParticle(y--,c,p)&&_++}removeQuantity(i,a){this.removeAt(0,i,a)}setDensity(){const i=this._container.actualOptions,a=i.particles.groups;for(const c in a)this._applyDensity(a[c],0,c);this._applyDensity(i.particles,i.manualParticles.length)}async update(i){const a=this._container,c=new Set;this.quadTree=new ZC(F6(a.canvas.size),V6);for(const[,p]of a.pathGenerators)p.update();for(const[,p]of a.plugins)p.update&&p.update(i);for(const p of this._array){const _=a.canvas.resizeFactor;_&&!p.ignoresResizeRatio&&(p.position.x*=_.width,p.position.y*=_.height,p.initialPosition.x*=_.width,p.initialPosition.y*=_.height),p.ignoresResizeRatio=!1,await this._interactionManager.reset(p);for(const[,y]of this._container.plugins){if(p.destroyed)break;y.particleUpdate&&y.particleUpdate(p,i)}for(const y of this.movers)y.isEnabled(p)&&y.move(p,i);if(p.destroyed){c.add(p);continue}this.quadTree.insert(new Ehe(p.getPosition(),p))}if(c.size){const p=_=>!c.has(_);this._array=this.filter(p),this._zArray=this._zArray.filter(p),this.pool.push(...c)}await this._interactionManager.externalInteract(i);for(const p of this._array){for(const _ of this.updaters)_.update(p,i);!p.destroyed&&!p.spawning&&await this._interactionManager.particlesInteract(p,i)}if(delete a.canvas.resizeFactor,this.needsSort){const p=this._zArray;p.sort((_,y)=>y.position.z-_.position.z||_.id-y.id),this.lastZIndex=p[p.length-1].position.z,this.needsSort=!1}}};class vhe{constructor(i){this.container=i,this.pixelRatio=1,this.reduceFactor=1}init(){const i=this.container,a=i.actualOptions;this.pixelRatio=!a.detectRetina||Rb()?1:window.devicePixelRatio,this.reduceFactor=1;const c=this.pixelRatio;if(i.canvas.element){const y=i.canvas.element;i.canvas.size.width=y.offsetWidth*c,i.canvas.size.height=y.offsetHeight*c}const p=a.particles,_=p.move;this.attractDistance=ti(_.attract.distance)*c,this.maxSpeed=ti(_.gravity.maxSpeed)*c,this.sizeAnimationSpeed=ti(p.size.animation.speed)*c}initParticle(i){const a=i.options,c=this.pixelRatio,p=a.move,_=p.distance,y=i.retina;y.attractDistance=ti(p.attract.distance)*c,y.moveDrift=ti(p.drift)*c,y.moveSpeed=ti(p.speed)*c,y.sizeAnimationSpeed=ti(a.size.animation.speed)*c;const T=y.maxDistance;T.horizontal=_.horizontal!==void 0?_.horizontal*c:void 0,T.vertical=_.vertical!==void 0?_.vertical*c:void 0,y.maxSpeed=ti(p.gravity.maxSpeed)*c}}function wi(s){return s&&!s.destroyed}function She(s,i=60,a=!1){return{value:s,factor:a?60/i:60*s/1e3}}function Rg(s,i,...a){const c=new mhe(s,i);return B8(c,...a),c}const The="default",B6={generate:s=>s.velocity,init:()=>{},update:()=>{},reset:()=>{}};class Rhe{constructor(i,a,c){this.id=a,this._intersectionManager=p=>{if(!(!wi(this)||!this.actualOptions.pauseOnOutsideViewport))for(const _ of p)_.target===this.interactivity.element&&(_.isIntersecting?this.play:this.pause)()},this._nextFrame=async p=>{try{if(!this.smooth&&this.lastFrameTime!==void 0&&p<this.lastFrameTime+1e3/this.fpsLimit){this.draw(!1);return}this.lastFrameTime??(this.lastFrameTime=p);const _=She(p-this.lastFrameTime,this.fpsLimit,this.smooth);if(this.addLifeTime(_.value),this.lastFrameTime=p,_.value>1e3){this.draw(!1);return}if(await this.particles.draw(_),!this.alive()){this.destroy();return}this.getAnimationStatus()&&this.draw(!1)}catch(_){Nv().error(`${Bp} in animation loop`,_)}},this._engine=i,this.fpsLimit=120,this.smooth=!1,this._delay=0,this._duration=0,this._lifeTime=0,this._firstStart=!0,this.started=!1,this.destroyed=!1,this._paused=!0,this.lastFrameTime=0,this.zLayers=100,this.pageHidden=!1,this._sourceOptions=c,this._initialSourceOptions=c,this.retina=new vhe(this),this.canvas=new Ade(this),this.particles=new yhe(this._engine,this),this.pathGenerators=new Map,this.interactivity={mouse:{clicking:!1,inside:!1}},this.plugins=new Map,this.drawers=new Map,this._options=Rg(this._engine,this),this.actualOptions=Rg(this._engine,this),this._eventListeners=new Ide(this),typeof IntersectionObserver<"u"&&IntersectionObserver&&(this._intersectionObserver=new IntersectionObserver(p=>this._intersectionManager(p))),this._engine.dispatchEvent("containerBuilt",{container:this})}get options(){return this._options}get sourceOptions(){return this._sourceOptions}addClickHandler(i){if(!wi(this))return;const a=this.interactivity.element;if(!a)return;const c=(L,j,Y)=>{if(!wi(this))return;const X=this.retina.pixelRatio,ee={x:j.x*X,y:j.y*X},Q=this.particles.quadTree.queryCircle(ee,Y*X);i(L,Q)},p=L=>{if(!wi(this))return;const j=L,Y={x:j.offsetX||j.clientX,y:j.offsetY||j.clientY};c(L,Y,1)},_=()=>{wi(this)&&(I=!0,D=!1)},y=()=>{wi(this)&&(D=!0)},T=L=>{if(wi(this)){if(I&&!D){const j=L;let Y=j.touches[j.touches.length-1];if(!Y&&(Y=j.changedTouches[j.changedTouches.length-1],!Y))return;const X=this.canvas.element,ee=X?X.getBoundingClientRect():void 0,Q={x:Y.clientX-(ee?ee.left:0),y:Y.clientY-(ee?ee.top:0)};c(L,Q,Math.max(Y.radiusX,Y.radiusY))}I=!1,D=!1}},C=()=>{wi(this)&&(I=!1,D=!1)};let I=!1,D=!1;a.addEventListener("click",p),a.addEventListener("touchstart",_),a.addEventListener("touchmove",y),a.addEventListener("touchend",T),a.addEventListener("touchcancel",C)}addLifeTime(i){this._lifeTime+=i}addPath(i,a,c=!1){return!wi(this)||!c&&this.pathGenerators.has(i)?!1:(this.pathGenerators.set(i,a??B6),!0)}alive(){return!this._duration||this._lifeTime<=this._duration}destroy(){if(!wi(this))return;this.stop(),this.particles.destroy(),this.canvas.destroy();for(const[,c]of this.drawers)c.destroy&&c.destroy(this);for(const c of this.drawers.keys())this.drawers.delete(c);this._engine.plugins.destroy(this),this.destroyed=!0;const i=this._engine.dom(),a=i.findIndex(c=>c===this);a>=0&&i.splice(a,1),this._engine.dispatchEvent("containerDestroyed",{container:this})}draw(i){if(!wi(this))return;let a=i;this._drawAnimationFrame=requestAnimationFrame(async c=>{a&&(this.lastFrameTime=void 0,a=!1),await this._nextFrame(c)})}async export(i,a={}){for(const[,c]of this.plugins){if(!c.export)continue;const p=await c.export(i,a);if(p.supported)return p.blob}Nv().error(`${Bp} - Export plugin with type ${i} not found`)}getAnimationStatus(){return!this._paused&&!this.pageHidden&&wi(this)}handleClickMode(i){if(wi(this)){this.particles.handleClickMode(i);for(const[,a]of this.plugins)a.handleClickMode&&a.handleClickMode(i)}}async init(){if(!wi(this))return;const i=this._engine.plugins.getSupportedShapes();for(const c of i){const p=this._engine.plugins.getShapeDrawer(c);p&&this.drawers.set(c,p)}this._options=Rg(this._engine,this,this._initialSourceOptions,this.sourceOptions),this.actualOptions=Rg(this._engine,this,this._options);const a=this._engine.plugins.getAvailablePlugins(this);for(const[c,p]of a)this.plugins.set(c,p);this.retina.init(),await this.canvas.init(),this.updateActualOptions(),this.canvas.initBackground(),this.canvas.resize(),this.zLayers=this.actualOptions.zLayers,this._duration=ti(this.actualOptions.duration)*1e3,this._delay=ti(this.actualOptions.delay)*1e3,this._lifeTime=0,this.fpsLimit=this.actualOptions.fpsLimit>0?this.actualOptions.fpsLimit:120,this.smooth=this.actualOptions.smooth;for(const[,c]of this.drawers)c.init&&await c.init(this);for(const[,c]of this.plugins)c.init&&await c.init();this._engine.dispatchEvent("containerInit",{container:this}),this.particles.init(),this.particles.setDensity();for(const[,c]of this.plugins)c.particlesSetup&&c.particlesSetup();this._engine.dispatchEvent("particlesSetup",{container:this})}async loadTheme(i){wi(this)&&(this._currentTheme=i,await this.refresh())}pause(){if(wi(this)&&(this._drawAnimationFrame!==void 0&&(cancelAnimationFrame(this._drawAnimationFrame),delete this._drawAnimationFrame),!this._paused)){for(const[,i]of this.plugins)i.pause&&i.pause();this.pageHidden||(this._paused=!0),this._engine.dispatchEvent("containerPaused",{container:this})}}play(i){if(!wi(this))return;const a=this._paused||i;if(this._firstStart&&!this.actualOptions.autoPlay){this._firstStart=!1;return}if(this._paused&&(this._paused=!1),a)for(const[,c]of this.plugins)c.play&&c.play();this._engine.dispatchEvent("containerPlay",{container:this}),this.draw(a||!1)}async refresh(){if(wi(this))return this.stop(),this.start()}async reset(){if(wi(this))return this._initialSourceOptions=void 0,this._options=Rg(this._engine,this),this.actualOptions=Rg(this._engine,this,this._options),this.refresh()}setNoise(i,a,c){wi(this)&&this.setPath(i,a,c)}setPath(i,a,c){if(!i||!wi(this))return;const p={...B6};if(k8(i))p.generate=i,a&&(p.init=a),c&&(p.update=c);else{const _=p;p.generate=i.generate||_.generate,p.init=i.init||_.init,p.update=i.update||_.update}this.addPath(The,p,!0)}async start(){!wi(this)||this.started||(await this.init(),this.started=!0,await new Promise(i=>{this._delayTimeout=setTimeout(async()=>{this._eventListeners.addListeners(),this.interactivity.element instanceof HTMLElement&&this._intersectionObserver&&this._intersectionObserver.observe(this.interactivity.element);for(const[,a]of this.plugins)a.start&&await a.start();this._engine.dispatchEvent("containerStarted",{container:this}),this.play(),i()},this._delay)}))}stop(){if(!(!wi(this)||!this.started)){this._delayTimeout&&(clearTimeout(this._delayTimeout),delete this._delayTimeout),this._firstStart=!0,this.started=!1,this._eventListeners.removeListeners(),this.pause(),this.particles.clear(),this.canvas.stop(),this.interactivity.element instanceof HTMLElement&&this._intersectionObserver&&this._intersectionObserver.unobserve(this.interactivity.element);for(const[,i]of this.plugins)i.stop&&i.stop();for(const i of this.plugins.keys())this.plugins.delete(i);this._sourceOptions=this._options,this._engine.dispatchEvent("containerStopped",{container:this})}}updateActualOptions(){this.actualOptions.responsive=[];const i=this.actualOptions.setResponsive(this.canvas.size.width,this.retina.pixelRatio,this._options);return this.actualOptions.setTheme(this._currentTheme),this.responsiveMaxWidth===i?!1:(this.responsiveMaxWidth=i,!0)}}class whe{constructor(){this._listeners=new Map}addEventListener(i,a){this.removeEventListener(i,a);let c=this._listeners.get(i);c||(c=[],this._listeners.set(i,c)),c.push(a)}dispatchEvent(i,a){const c=this._listeners.get(i);c&&c.forEach(p=>p(a))}hasEventListener(i){return!!this._listeners.get(i)}removeAllEventListeners(i){i?this._listeners.delete(i):this._listeners=new Map}removeEventListener(i,a){const c=this._listeners.get(i);if(!c)return;const p=c.length,_=c.indexOf(a);_<0||(p===1?this._listeners.delete(i):c.splice(_,1))}}function aP(s,i,a,c=!1){let p=i.get(s);return(!p||c)&&(p=[...a.values()].map(_=>_(s)),i.set(s,p)),p}class Che{constructor(i){this._engine=i,this.plugins=[],this._initializers={interactors:new Map,movers:new Map,updaters:new Map},this.interactors=new Map,this.movers=new Map,this.updaters=new Map,this.presets=new Map,this.drawers=new Map,this.pathGenerators=new Map}addInteractor(i,a){this._initializers.interactors.set(i,a)}addParticleMover(i,a){this._initializers.movers.set(i,a)}addParticleUpdater(i,a){this._initializers.updaters.set(i,a)}addPathGenerator(i,a){!this.getPathGenerator(i)&&this.pathGenerators.set(i,a)}addPlugin(i){!this.getPlugin(i.id)&&this.plugins.push(i)}addPreset(i,a,c=!1){(c||!this.getPreset(i))&&this.presets.set(i,a)}addShapeDrawer(i,a){jp(i,c=>{!this.getShapeDrawer(c)&&this.drawers.set(c,a)})}destroy(i){this.updaters.delete(i),this.movers.delete(i),this.interactors.delete(i)}getAvailablePlugins(i){const a=new Map;for(const c of this.plugins)c.needsPlugin(i.actualOptions)&&a.set(c.id,c.getPlugin(i));return a}getInteractors(i,a=!1){return aP(i,this.interactors,this._initializers.interactors,a)}getMovers(i,a=!1){return aP(i,this.movers,this._initializers.movers,a)}getPathGenerator(i){return this.pathGenerators.get(i)}getPlugin(i){return this.plugins.find(a=>a.id===i)}getPreset(i){return this.presets.get(i)}getShapeDrawer(i){return this.drawers.get(i)}getSupportedShapes(){return this.drawers.keys()}getUpdaters(i,a=!1){return aP(i,this.updaters,this._initializers.updaters,a)}loadOptions(i,a){for(const c of this.plugins)c.loadOptions(i,a)}loadParticlesOptions(i,a,...c){const p=this.updaters.get(i);if(p)for(const _ of p)_.loadOptions&&_.loadOptions(a,...c)}}async function bhe(s){const i=mv(s.url,s.index);if(!i)return s.fallback;const a=await fetch(i);return a.ok?a.json():(Nv().error(`${Bp} ${a.status} while retrieving config file`),s.fallback)}function Ahe(s){return!s.id&&!s.element&&!s.url&&!s.options}function Ihe(s){return!Ahe(s)}class Ohe{constructor(){this._configs=new Map,this._domArray=[],this._eventDispatcher=new whe,this._initialized=!1,this.plugins=new Che(this)}get configs(){const i={};for(const[a,c]of this._configs)i[a]=c;return i}get version(){return"2.12.0"}addConfig(i,a){Yc(i)?a&&(a.name=i,this._configs.set(i,a)):this._configs.set(i.name??"default",i)}addEventListener(i,a){this._eventDispatcher.addEventListener(i,a)}async addInteractor(i,a,c=!0){this.plugins.addInteractor(i,a),await this.refresh(c)}async addMover(i,a,c=!0){this.plugins.addParticleMover(i,a),await this.refresh(c)}async addParticleUpdater(i,a,c=!0){this.plugins.addParticleUpdater(i,a),await this.refresh(c)}async addPathGenerator(i,a,c=!0){this.plugins.addPathGenerator(i,a),await this.refresh(c)}async addPlugin(i,a=!0){this.plugins.addPlugin(i),await this.refresh(a)}async addPreset(i,a,c=!1,p=!0){this.plugins.addPreset(i,a,c),await this.refresh(p)}async addShape(i,a,c,p,_,y=!0){let T,C=y,I,D,L;wd(c)?(C=c,I=void 0):I=c,wd(p)?(C=p,D=void 0):D=p,wd(_)?(C=_,L=void 0):L=_,k8(a)?T={afterEffect:D,destroy:L,draw:a,init:I}:T=a,this.plugins.addShapeDrawer(i,T),await this.refresh(C)}dispatchEvent(i,a){this._eventDispatcher.dispatchEvent(i,a)}dom(){return this._domArray}domItem(i){const a=this.dom(),c=a[i];if(!c||c.destroyed){a.splice(i,1);return}return c}init(){this._initialized||(this._initialized=!0)}async load(i,a){return this.loadFromArray(i,a)}async loadFromArray(i,a,c){let p;return Ihe(i)?p=i:(p={},Yc(i)?p.id=i:p.options=i,za(a)?p.index=a:p.options=a??p.options,p.index=c??p.index),this._loadParams(p)}async loadJSON(i,a,c){let p,_;return za(a)||a===void 0?p=i:(_=i,p=a),this._loadParams({id:_,url:p,index:c})}async refresh(i=!0){i&&this.dom().forEach(a=>a.refresh())}removeEventListener(i,a){this._eventDispatcher.removeEventListener(i,a)}async set(i,a,c,p){const _={index:p};return Yc(i)?_.id=i:_.element=i,a instanceof HTMLElement?_.element=a:_.options=a,za(c)?_.index=c:_.options=c??_.options,this._loadParams(_)}async setJSON(i,a,c,p){const _={};return i instanceof HTMLElement?(_.element=i,_.url=a,_.index=c):(_.id=i,_.element=a,_.url=c,_.index=p),this._loadParams(_)}setOnClickHandler(i){const a=this.dom();if(!a.length)throw new Error(`${Bp} can only set click handlers after calling tsParticles.load()`);for(const c of a)c.addClickHandler(i)}async _loadParams(i){const a=i.id??`tsparticles${Math.floor(ru()*1e4)}`,{index:c,url:p}=i,_=p?await bhe({fallback:i.options,url:p,index:c}):i.options;let y=i.element??document.getElementById(a);y||(y=document.createElement("div"),y.id=a,document.body.append(y));const T=mv(_,c),C=this.dom(),I=C.findIndex(j=>j.id===a);if(I>=0){const j=this.domItem(I);j&&!j.destroyed&&(j.destroy(),C.splice(I,1))}let D;if(y.tagName.toLowerCase()==="canvas")D=y,D.dataset[fv]="false";else{const j=y.getElementsByTagName("canvas");j.length?(D=j[0],D.dataset[fv]="false"):(D=document.createElement("canvas"),D.dataset[fv]="true",y.appendChild(D))}D.style.width||(D.style.width="100%"),D.style.height||(D.style.height="100%");const L=new Rhe(this,a,T);return I>=0?C.splice(I,0,L):C.push(L),L.canvas.loadCanvas(D),await L.start(),L}}let Nhe=class{constructor(){this.key="hsl",this.stringPrefix="hsl"}handleColor(i){const a=i.value,c=a.hsl??i.value;if(c.h!==void 0&&c.s!==void 0&&c.l!==void 0)return cD(c)}handleRangeColor(i){const a=i.value,c=a.hsl??i.value;if(c.h!==void 0&&c.l!==void 0)return cD({h:ti(c.h),l:ti(c.l),s:ti(c.s)})}parseString(i){if(!i.startsWith("hsl"))return;const a=/hsla?\(\s*(\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([\d.%]+)\s*)?\)/i,c=a.exec(i);return c?gde({a:c.length>4?N8(c[5]):1,h:parseInt(c[1],10),l:parseInt(c[3],10),s:parseInt(c[2],10)}):void 0}},Phe=class{constructor(){this.key="rgb",this.stringPrefix="rgb"}handleColor(i){const a=i.value,c=a.rgb??i.value;if(c.r!==void 0)return c}handleRangeColor(i){const a=i.value,c=a.rgb??i.value;if(c.r!==void 0)return{r:ti(c.r),g:ti(c.g),b:ti(c.b)}}parseString(i){if(!i.startsWith(this.stringPrefix))return;const a=/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([\d.%]+)\s*)?\)/i,c=a.exec(i);return c?{a:c.length>4?N8(c[5]):1,b:parseInt(c[3],10),g:parseInt(c[2],10),r:parseInt(c[1],10)}:void 0}};function Dhe(){const s=new Phe,i=new Nhe;N6(s),N6(i);const a=new Ohe;return a.init(),a}const uD=Dhe();Rb()||(window.tsParticles=uD);const kg=s=>typeof s=="object"&&s!==null;function eb(s,i,a=()=>!1){if(!kg(s)||!kg(i))return s===i;const c=Object.keys(s).filter(_=>!a(_)),p=Object.keys(i).filter(_=>!a(_));if(c.length!==p.length)return!1;for(const _ of c){const y=s[_],T=i[_];if(kg(y)&&kg(T)){if(y===i&&T===s)continue;if(!eb(y,T,a))return!1}else if(Array.isArray(y)&&Array.isArray(T)){if(!K8(y,T,a))return!1}else if(y!==T)return!1}return!0}function K8(s,i,a){if(s.length!==i.length)return!1;for(let c=0;c<s.length;c++){const p=s[c],_=i[c];if(Array.isArray(p)&&Array.isArray(_)){if(!K8(p,_,a))return!1}else if(kg(p)&&kg(_)){if(!eb(p,_,a))return!1}else if(p!==_)return!1}return!0}const q8="tsparticles";class Cb extends _e.Component{constructor(i){super(i),this.state={init:!1,library:void 0}}destroy(){this.state.library&&(this.state.library.destroy(),this.setState({library:void 0}))}shouldComponentUpdate(i){const a=i.options??i.params,c=this.props.options??this.props.params;return i.url!==this.props.url||i.id!==this.props.id||i.canvasClassName!==this.props.canvasClassName||i.className!==this.props.className||i.height!==this.props.height||i.width!==this.props.width||!eb(i.style,this.props.style)||i.init!==this.props.init||i.loaded!==this.props.loaded||!eb(a,c,p=>p.startsWith("_"))}componentDidUpdate(){this.refresh()}forceUpdate(){this.refresh().then(()=>{super.forceUpdate()})}componentDidMount(){(async()=>(this.props.init&&await this.props.init(uD),this.setState({init:!0},async()=>{await this.loadParticles()})))()}componentWillUnmount(){this.destroy()}render(){const{width:i,height:a,className:c,canvasClassName:p,id:_}=this.props;return sa.createElement("div",{className:c,id:_},sa.createElement("canvas",{className:p,style:{...this.props.style,width:i,height:a}}))}async refresh(){this.destroy(),await this.loadParticles()}async loadParticles(){if(!this.state.init)return;const i=this.props.id??Cb.defaultProps.id??q8,a=await uD.load({url:this.props.url,id:i,options:this.props.options??this.props.params});this.props.container&&(this.props.container.current=a),this.setState({library:a}),this.props.loaded&&await this.props.loaded(a)}}Cb.defaultProps={width:"100%",height:"100%",options:{},style:{},url:void 0,id:q8};const khe="pointerleave",jv="pointermove",Yg="tsParticles - Error",jr=100,ro=.5,os=1e3,ia={x:0,y:0,z:0},tb="random",xC="mid",Gc=2,bp=2,Lhe=1,MC=255,kp=360,dD=100,hD=100,j6=0,pD=0,xhe=60,G6=0,Y8=1,Mhe=0,Uhe=1,Vhe=1,Fhe=0,Ep=255,cP=3,lP=6,Bhe=1,jhe=1,Ghe=0,Whe=0,zhe=0,Hhe=0;var fD;(function(s){s.bottom="bottom",s.bottomLeft="bottom-left",s.bottomRight="bottom-right",s.left="left",s.none="none",s.right="right",s.top="top",s.topLeft="top-left",s.topRight="top-right",s.outside="outside",s.inside="inside"})(fD||(fD={}));function Gp(s){return typeof s=="string"}function aa(s){return typeof s=="number"}function Lg(s){return typeof s=="object"&&s!==null}function us(s){return Array.isArray(s)}function Ke(s){return s==null}class ja{constructor(i,a,c){if(this._updateFromAngle=(p,_)=>{this.x=Math.cos(p)*_,this.y=Math.sin(p)*_},!aa(i)&&i){this.x=i.x,this.y=i.y;const p=i;this.z=p.z?p.z:ia.z}else if(i!==void 0&&a!==void 0)this.x=i,this.y=a,this.z=c??ia.z;else throw new Error(`${Yg} Vector3d not initialized correctly`)}static get origin(){return ja.create(ia.x,ia.y,ia.z)}get angle(){return Math.atan2(this.y,this.x)}set angle(i){this._updateFromAngle(i,this.length)}get length(){return Math.sqrt(this.getLengthSq())}set length(i){this._updateFromAngle(this.angle,i)}static clone(i){return ja.create(i.x,i.y,i.z)}static create(i,a,c){return new ja(i,a,c)}add(i){return ja.create(this.x+i.x,this.y+i.y,this.z+i.z)}addTo(i){this.x+=i.x,this.y+=i.y,this.z+=i.z}copy(){return ja.clone(this)}distanceTo(i){return this.sub(i).length}distanceToSq(i){return this.sub(i).getLengthSq()}div(i){return ja.create(this.x/i,this.y/i,this.z/i)}divTo(i){this.x/=i,this.y/=i,this.z/=i}getLengthSq(){return this.x**bp+this.y**bp}mult(i){return ja.create(this.x*i,this.y*i,this.z*i)}multTo(i){this.x*=i,this.y*=i,this.z*=i}normalize(){const i=this.length;i!=Mhe&&this.multTo(Lhe/i)}rotate(i){return ja.create(this.x*Math.cos(i)-this.y*Math.sin(i),this.x*Math.sin(i)+this.y*Math.cos(i),ia.z)}setTo(i){this.x=i.x,this.y=i.y;const a=i;this.z=a.z?a.z:ia.z}sub(i){return ja.create(this.x-i.x,this.y-i.y,this.z-i.z)}subFrom(i){this.x-=i.x,this.y-=i.y,this.z-=i.z}}class _i extends ja{constructor(i,a){super(i,a,ia.z)}static get origin(){return _i.create(ia.x,ia.y)}static clone(i){return _i.create(i.x,i.y)}static create(i,a){return new _i(i,a)}}let Khe=Math.random;function en(){return Ha(Khe(),0,1-Number.EPSILON)}function Ha(s,i,a){return Math.min(Math.max(s,i),a)}function uP(s,i,a,c){return Math.floor((s*a+i*c)/(a+c))}function cs(s){const i=Wc(s),a=0;let c=bb(s);return i===c&&(c=a),en()*(i-c)+c}function nt(s){return aa(s)?s:cs(s)}function bb(s){return aa(s)?s:s.min}function Wc(s){return aa(s)?s:s.max}function At(s,i){if(s===i||i===void 0&&aa(s))return s;const a=bb(s),c=Wc(s);return i!==void 0?{min:Math.min(a,i),max:Math.max(c,i)}:At(a,c)}function ds(s,i){const a=s.x-i.x,c=s.y-i.y,p=2;return{dx:a,dy:c,distance:Math.sqrt(a**p+c**p)}}function Co(s,i){return ds(s,i).distance}function jg(s){return s*Math.PI/180}function W6(s,i,a,c){return _i.create(s.x*(a-c)/(a+c)+i.x*Gc*c/(a+c),s.y)}function X8(s){var i,a;return{x:(((i=s.position)==null?void 0:i.x)??en()*jr)*s.size.width/jr,y:(((a=s.position)==null?void 0:a.y)??en()*jr)*s.size.height/jr}}function J8(s){var a,c;const i={x:((a=s.position)==null?void 0:a.x)!==void 0?nt(s.position.x):void 0,y:((c=s.position)==null?void 0:c.y)!==void 0?nt(s.position.y):void 0};return X8({size:s.size,position:i})}function $8(s){return s?s.endsWith("%")?parseFloat(s)/jr:parseFloat(s):1}var Lp;(function(s){s.auto="auto",s.increase="increase",s.decrease="decrease",s.random="random"})(Lp||(Lp={}));var Bi;(function(s){s.increasing="increasing",s.decreasing="decreasing"})(Bi||(Bi={}));var Id;(function(s){s.none="none",s.max="max",s.min="min"})(Id||(Id={}));var un;(function(s){s.bottom="bottom",s.left="left",s.right="right",s.top="top"})(un||(un={}));var Od;(function(s){s.precise="precise",s.percent="percent"})(Od||(Od={}));var Gg;(function(s){s.max="max",s.min="min",s.random="random"})(Gg||(Gg={}));const qhe={debug:console.debug,error:console.error,info:console.info,log:console.log,verbose:console.log,warning:console.warn};function Q8(){return qhe}function z6(s){const i={bounced:!1},{pSide:a,pOtherSide:c,rectSide:p,rectOtherSide:_,velocity:y,factor:T}=s;return c.min<_.min||c.min>_.max||c.max<_.min||c.max>_.max||(a.max>=p.min&&a.max<=(p.max+p.min)*ro&&y>G6||a.min<=p.max&&a.min>(p.max+p.min)*ro&&y<G6)&&(i.velocity=y*-T,i.bounced=!0),i}function Yhe(s,i){const a=hs(i,c=>s.matches(c));return us(a)?a.some(c=>c):a}function H6(){return typeof window>"u"||!window||typeof window.document>"u"||!window.document}function di(s,i){return s===i||us(i)&&i.indexOf(s)>-1}async function mD(s,i){try{await document.fonts.load(`${i??"400"} 36px '${s??"Verdana"}'`)}catch{}}function Z8(s){return Math.floor(en()*s.length)}function Gv(s,i,a=!0){return s[i!==void 0&&a?i%s.length:Z8(s)]}function Wv(s,i,a,c,p){return Xhe(zv(s,c??0),i,a,p)}function Xhe(s,i,a,c){let p=!0;return(!c||c===un.bottom)&&(p=s.top<i.height+a.x),p&&(!c||c===un.left)&&(p=s.right>a.x),p&&(!c||c===un.right)&&(p=s.left<i.width+a.y),p&&(!c||c===un.top)&&(p=s.bottom>a.y),p}function zv(s,i){return{bottom:s.y+i,left:s.x-i,right:s.x+i,top:s.y-i}}function so(s,...i){for(const a of i){if(a==null)continue;if(!Lg(a)){s=a;continue}const c=Array.isArray(a);c&&(Lg(s)||!s||!Array.isArray(s))?s=[]:!c&&(Lg(s)||!s||Array.isArray(s))&&(s={});for(const p in a){if(p==="__proto__")continue;const _=a,y=_[p],T=s;T[p]=Lg(y)&&Array.isArray(y)?y.map(C=>so(T[p],C)):so(T[p],y)}}return s}function vk(s,i){return!!nH(i,a=>a.enable&&di(s,a.mode))}function Sk(s,i,a){hs(i,c=>{const p=c.mode;c.enable&&di(s,p)&&Jhe(c,a)})}function Jhe(s,i){const a=s.selectors;hs(a,c=>{i(c,s)})}function eH(s,i){if(!(!i||!s))return nH(s,a=>Yhe(i,a.selectors))}function gD(s){return{position:s.getPosition(),radius:s.getRadius(),mass:s.getMass(),velocity:s.velocity,factor:_i.create(nt(s.options.bounce.horizontal.value),nt(s.options.bounce.vertical.value))}}function tH(s,i){const{x:a,y:c}=s.velocity.sub(i.velocity),[p,_]=[s.position,i.position],{dx:y,dy:T}=ds(_,p);if(a*y+c*T<0)return;const I=-Math.atan2(T,y),D=s.mass,L=i.mass,j=s.velocity.rotate(I),Y=i.velocity.rotate(I),X=W6(j,Y,D,L),ee=W6(Y,j,D,L),Q=X.rotate(-I),se=ee.rotate(-I);s.velocity.x=Q.x*s.factor.x,s.velocity.y=Q.y*s.factor.y,i.velocity.x=se.x*i.factor.x,i.velocity.y=se.y*i.factor.y}function $he(s,i){const a=s.getPosition(),c=s.getRadius(),p=zv(a,c),_=s.options.bounce,y=z6({pSide:{min:p.left,max:p.right},pOtherSide:{min:p.top,max:p.bottom},rectSide:{min:i.left,max:i.right},rectOtherSide:{min:i.top,max:i.bottom},velocity:s.velocity.x,factor:nt(_.horizontal.value)});y.bounced&&(y.velocity!==void 0&&(s.velocity.x=y.velocity),y.position!==void 0&&(s.position.x=y.position));const T=z6({pSide:{min:p.top,max:p.bottom},pOtherSide:{min:p.left,max:p.right},rectSide:{min:i.top,max:i.bottom},rectOtherSide:{min:i.left,max:i.right},velocity:s.velocity.y,factor:nt(_.vertical.value)});T.bounced&&(T.velocity!==void 0&&(s.velocity.y=T.velocity),T.position!==void 0&&(s.position.y=T.position))}function hs(s,i){return us(s)?s.map((c,p)=>i(c,p)):i(s,0)}function su(s,i,a){return us(s)?Gv(s,i,a):s}function nH(s,i){return us(s)?s.find((c,p)=>i(c,p)):i(s,0)?s:void 0}function Qhe(s,i){const a=s.value,c=s.animation,p={delayTime:nt(c.delay)*os,enable:c.enable,value:nt(s.value)*i,max:Wc(a)*i,min:bb(a)*i,loops:0,maxLoops:nt(c.count),time:0},_=1;if(c.enable){switch(p.decay=_-nt(c.decay),c.mode){case Lp.increase:p.status=Bi.increasing;break;case Lp.decrease:p.status=Bi.decreasing;break;case Lp.random:p.status=en()>=ro?Bi.increasing:Bi.decreasing;break}const y=c.mode===Lp.auto;switch(c.startValue){case Gg.min:p.value=p.min,y&&(p.status=Bi.increasing);break;case Gg.max:p.value=p.max,y&&(p.status=Bi.decreasing);break;case Gg.random:default:p.value=cs(p),y&&(p.status=en()>=ro?Bi.increasing:Bi.decreasing);break}}return p.initialValue=p.value,p}function Zhe(s,i){if(!(s.mode===Od.percent)){const{mode:p,..._}=s;return _}return"x"in s?{x:s.x/jr*i.width,y:s.y/jr*i.height}:{width:s.width/jr*i.width,height:s.height/jr*i.height}}function K6(s,i){return Zhe(s,i)}function epe(s,i,a,c,p){switch(i){case Id.max:a>=p&&s.destroy();break;case Id.min:a<=c&&s.destroy();break}}function Ab(s,i,a,c,p){if(s.destroyed||!i||!i.enable||(i.maxLoops??0)>0&&(i.loops??0)>(i.maxLoops??0))return;const D=(i.velocity??0)*p.factor,L=i.min,j=i.max,Y=i.decay??1;if(i.time||(i.time=0),(i.delayTime??0)>0&&i.time<(i.delayTime??0)&&(i.time+=p.value),!((i.delayTime??0)>0&&i.time<(i.delayTime??0))){switch(i.status){case Bi.increasing:i.value>=j?(a?i.status=Bi.decreasing:i.value-=j,i.loops||(i.loops=0),i.loops++):i.value+=D;break;case Bi.decreasing:i.value<=L?(a?i.status=Bi.increasing:i.value+=j,i.loops||(i.loops=0),i.loops++):i.value-=D}i.velocity&&Y!==1&&(i.velocity*=Y),epe(s,c,i.value,L,j),s.destroyed||(i.value=Ha(i.value,L,j))}}var Ap;(function(s){s.darken="darken",s.enlighten="enlighten"})(Ap||(Ap={}));function tpe(s,i){if(i){for(const a of s.colorManagers.values())if(i.startsWith(a.stringPrefix))return a.parseString(i)}}function Nd(s,i,a,c=!0){if(!i)return;const p=Gp(i)?{value:i}:i;if(Gp(p.value))return iH(s,p.value,a,c);if(us(p.value))return Nd(s,{value:Gv(p.value,a,c)});for(const _ of s.colorManagers.values()){const y=_.handleRangeColor(p);if(y)return y}}function iH(s,i,a,c=!0){if(!i)return;const p=Gp(i)?{value:i}:i;if(Gp(p.value))return p.value===tb?sH():npe(s,p.value);if(us(p.value))return iH(s,{value:Gv(p.value,a,c)});for(const _ of s.colorManagers.values()){const y=_.handleColor(p);if(y)return y}}function a_(s,i,a,c=!0){const p=Nd(s,i,a,c);return p?rH(p):void 0}function rH(s){const i=s.r/MC,a=s.g/MC,c=s.b/MC,p=Math.max(i,a,c),_=Math.min(i,a,c),y={h:j6,l:(p+_)*ro,s:pD};return p!==_&&(y.s=y.l<ro?(p-_)/(p+_):(p-_)/(Gc-p-_),y.h=i===p?(a-c)/(p-_):y.h=a===p?Gc+(c-i)/(p-_):Gc*Gc+(i-a)/(p-_)),y.l*=hD,y.s*=dD,y.h*=xhe,y.h<j6&&(y.h+=kp),y.h>=kp&&(y.h-=kp),y}function npe(s,i){return tpe(s,i)}function Xg(s){const i=(s.h%kp+kp)%kp,a=Math.max(pD,Math.min(dD,s.s)),c=Math.max(Fhe,Math.min(hD,s.l)),p=i/kp,_=a/dD,y=c/hD;if(a===pD){const X=Math.round(y*Ep);return{r:X,g:X,b:X}}const T=(X,ee,Q)=>{if(Q<0&&Q++,Q>1&&Q--,Q*lP<1)return X+(ee-X)*lP*Q;if(Q*Gc<1)return ee;if(Q*cP<1*Gc){const me=Gc/cP;return X+(ee-X)*(me-Q)*lP}return X},C=y<ro?y*(Bhe+_):y+_-y*_,I=Gc*y-C,D=jhe/cP,L=Math.min(Ep,Ep*T(I,C,p+D)),j=Math.min(Ep,Ep*T(I,C,p)),Y=Math.min(Ep,Ep*T(I,C,p-D));return{r:Math.round(L),g:Math.round(j),b:Math.round(Y)}}function ipe(s){const i=Xg(s);return{a:s.a,b:i.b,g:i.g,r:i.r}}function sH(s){const i=Ghe,a=MC+Vhe;return{b:Math.floor(cs(At(i,a))),g:Math.floor(cs(At(i,a))),r:Math.floor(cs(At(i,a)))}}function Jg(s,i){return`rgba(${s.r}, ${s.g}, ${s.b}, ${i??Y8})`}function nb(s,i){return`hsla(${s.h}, ${s.s}%, ${s.l}%, ${i??Y8})`}function Tk(s,i,a,c){let p=s,_=i;return p.r===void 0&&(p=Xg(s)),_.r===void 0&&(_=Xg(i)),{b:uP(p.b,_.b,a,c),g:uP(p.g,_.g,a,c),r:uP(p.r,_.r,a,c)}}function _D(s,i,a){if(a===tb)return sH();if(a===xC){const c=s.getFillColor()??s.getStrokeColor(),p=(i==null?void 0:i.getFillColor())??(i==null?void 0:i.getStrokeColor());if(c&&p&&i)return Tk(c,p,s.getRadius(),i.getRadius());{const _=c??p;if(_)return Xg(_)}}else return a}function oH(s,i,a,c){const p=Gp(i)?i:i.value;return p===tb?c?Nd(s,{value:p}):a?tb:xC:p===xC?xC:Nd(s,{value:p})}function aH(s,i,a){const c={h:{enable:!1,value:s.h},s:{enable:!1,value:s.s},l:{enable:!1,value:s.l}};return i&&(dP(c.h,i.h,a),dP(c.s,i.s,a),dP(c.l,i.l,a)),c}function dP(s,i,a){s.enable=i.enable,s.enable?(s.velocity=nt(i.speed)/jr*a,s.decay=Uhe-nt(i.decay),s.status=Bi.increasing,s.loops=zhe,s.maxLoops=nt(i.count),s.time=Hhe,s.delayTime=nt(i.delay)*os,i.sync||(s.velocity*=en(),s.value*=en()),s.initialValue=s.value,s.offset=At(i.offset)):s.velocity=Whe}function hP(s,i,a,c){if(!s||!s.enable||(s.maxLoops??0)>0&&(s.loops??0)>(s.maxLoops??0)||(s.time||(s.time=0),(s.delayTime??0)>0&&s.time<(s.delayTime??0)&&(s.time+=c.value),(s.delayTime??0)>0&&s.time<(s.delayTime??0)))return;const D=s.offset?cs(s.offset):0,L=(s.velocity??0)*c.factor+D*3.6,j=s.decay??1,Y=Wc(i),X=bb(i);!a||s.status===Bi.increasing?(s.value+=L,s.value>Y&&(s.loops||(s.loops=0),s.loops++,a?s.status=Bi.decreasing:s.value-=Y)):(s.value-=L,s.value<0&&(s.loops||(s.loops=0),s.loops++,s.status=Bi.increasing)),s.velocity&&j!==1&&(s.velocity*=j),s.value=Ha(s.value,X,Y)}function cH(s,i){if(!s)return;const{h:a,s:c,l:p}=s,_={h:{min:0,max:360},s:{min:0,max:100},l:{min:0,max:100}};a&&hP(a,_.h,!1,i),c&&hP(c,_.s,!0,i),p&&hP(p,_.l,!0,i)}function gv(s,i,a){s.beginPath(),s.moveTo(i.x,i.y),s.lineTo(a.x,a.y),s.closePath()}class Sr{constructor(){this.value=""}static create(i,a){const c=new Sr;return c.load(i),a!==void 0&&(Gp(a)||us(a)?c.load({value:a}):c.load(a)),c}load(i){Ke(i)||Ke(i.value)||(this.value=i.value)}}var Pv;(function(s){s.circle="circle",s.rectangle="rectangle"})(Pv||(Pv={}));class Rk{constructor(){this.count=0,this.enable=!1,this.speed=1,this.decay=0,this.delay=0,this.sync=!1}load(i){Ke(i)||(i.count!==void 0&&(this.count=At(i.count)),i.enable!==void 0&&(this.enable=i.enable),i.speed!==void 0&&(this.speed=At(i.speed)),i.decay!==void 0&&(this.decay=At(i.decay)),i.delay!==void 0&&(this.delay=At(i.delay)),i.sync!==void 0&&(this.sync=i.sync))}}class wk extends Rk{constructor(){super(),this.mode=Lp.auto,this.startValue=Gg.random}load(i){super.load(i),!Ke(i)&&(i.mode!==void 0&&(this.mode=i.mode),i.startValue!==void 0&&(this.startValue=i.startValue))}}class pP extends Rk{constructor(){super(),this.offset=0,this.sync=!0}load(i){super.load(i),!Ke(i)&&i.offset!==void 0&&(this.offset=At(i.offset))}}class rpe{constructor(){this.h=new pP,this.s=new pP,this.l=new pP}load(i){Ke(i)||(this.h.load(i.h),this.s.load(i.s),this.l.load(i.l))}}class $g extends Sr{constructor(){super(),this.animation=new rpe}static create(i,a){const c=new $g;return c.load(i),a!==void 0&&(Gp(a)||us(a)?c.load({value:a}):c.load(a)),c}load(i){if(super.load(i),Ke(i))return;const a=i.animation;a!==void 0&&(a.enable!==void 0?this.animation.h.load(a):this.animation.load(i.animation))}}var Wg;(function(s){s.absorb="absorb",s.bounce="bounce",s.destroy="destroy"})(Wg||(Wg={}));class spe{constructor(){this.speed=2}load(i){Ke(i)||i.speed!==void 0&&(this.speed=i.speed)}}class ope{constructor(){this.enable=!0,this.retries=0}load(i){Ke(i)||(i.enable!==void 0&&(this.enable=i.enable),i.retries!==void 0&&(this.retries=i.retries))}}class qa{constructor(){this.value=0}load(i){Ke(i)||Ke(i.value)||(this.value=At(i.value))}}class ape extends qa{constructor(){super(),this.animation=new Rk}load(i){if(super.load(i),Ke(i))return;const a=i.animation;a!==void 0&&this.animation.load(a)}}class lH extends ape{constructor(){super(),this.animation=new wk}load(i){super.load(i)}}class q6 extends qa{constructor(){super(),this.value=1}}class uH{constructor(){this.horizontal=new q6,this.vertical=new q6}load(i){Ke(i)||(this.horizontal.load(i.horizontal),this.vertical.load(i.vertical))}}class cpe{constructor(){this.absorb=new spe,this.bounce=new uH,this.enable=!1,this.maxSpeed=50,this.mode=Wg.bounce,this.overlap=new ope}load(i){Ke(i)||(this.absorb.load(i.absorb),this.bounce.load(i.bounce),i.enable!==void 0&&(this.enable=i.enable),i.maxSpeed!==void 0&&(this.maxSpeed=At(i.maxSpeed)),i.mode!==void 0&&(this.mode=i.mode),this.overlap.load(i.overlap))}}class lpe{constructor(){this.close=!0,this.fill=!0,this.options={},this.type=[]}load(i){if(Ke(i))return;const a=i.options;if(a!==void 0)for(const c in a){const p=a[c];p&&(this.options[c]=so(this.options[c]??{},p))}i.close!==void 0&&(this.close=i.close),i.fill!==void 0&&(this.fill=i.fill),i.type!==void 0&&(this.type=i.type)}}class upe{constructor(){this.offset=0,this.value=90}load(i){Ke(i)||(i.offset!==void 0&&(this.offset=At(i.offset)),i.value!==void 0&&(this.value=At(i.value)))}}class dpe{constructor(){this.distance=200,this.enable=!1,this.rotate={x:3e3,y:3e3}}load(i){if(!Ke(i)&&(i.distance!==void 0&&(this.distance=At(i.distance)),i.enable!==void 0&&(this.enable=i.enable),i.rotate)){const a=i.rotate.x;a!==void 0&&(this.rotate.x=a);const c=i.rotate.y;c!==void 0&&(this.rotate.y=c)}}}class hpe{constructor(){this.x=50,this.y=50,this.mode=Od.percent,this.radius=0}load(i){Ke(i)||(i.x!==void 0&&(this.x=i.x),i.y!==void 0&&(this.y=i.y),i.mode!==void 0&&(this.mode=i.mode),i.radius!==void 0&&(this.radius=i.radius))}}class ppe{constructor(){this.acceleration=9.81,this.enable=!1,this.inverse=!1,this.maxSpeed=50}load(i){Ke(i)||(i.acceleration!==void 0&&(this.acceleration=At(i.acceleration)),i.enable!==void 0&&(this.enable=i.enable),i.inverse!==void 0&&(this.inverse=i.inverse),i.maxSpeed!==void 0&&(this.maxSpeed=At(i.maxSpeed)))}}class fpe{constructor(){this.clamp=!0,this.delay=new qa,this.enable=!1,this.options={}}load(i){Ke(i)||(i.clamp!==void 0&&(this.clamp=i.clamp),this.delay.load(i.delay),i.enable!==void 0&&(this.enable=i.enable),this.generator=i.generator,i.options&&(this.options=so(this.options,i.options)))}}class mpe{load(i){Ke(i)||(i.color!==void 0&&(this.color=Sr.create(this.color,i.color)),i.image!==void 0&&(this.image=i.image))}}class gpe{constructor(){this.enable=!1,this.length=10,this.fill=new mpe}load(i){Ke(i)||(i.enable!==void 0&&(this.enable=i.enable),i.fill!==void 0&&this.fill.load(i.fill),i.length!==void 0&&(this.length=i.length))}}var vr;(function(s){s.bounce="bounce",s.none="none",s.out="out",s.destroy="destroy",s.split="split"})(vr||(vr={}));class _pe{constructor(){this.default=vr.out}load(i){Ke(i)||(i.default!==void 0&&(this.default=i.default),this.bottom=i.bottom??i.default,this.left=i.left??i.default,this.right=i.right??i.default,this.top=i.top??i.default)}}class Epe{constructor(){this.acceleration=0,this.enable=!1}load(i){Ke(i)||(i.acceleration!==void 0&&(this.acceleration=At(i.acceleration)),i.enable!==void 0&&(this.enable=i.enable),i.position&&(this.position=so({},i.position)))}}class ype{constructor(){this.angle=new upe,this.attract=new dpe,this.center=new hpe,this.decay=0,this.distance={},this.direction=fD.none,this.drift=0,this.enable=!1,this.gravity=new ppe,this.path=new fpe,this.outModes=new _pe,this.random=!1,this.size=!1,this.speed=2,this.spin=new Epe,this.straight=!1,this.trail=new gpe,this.vibrate=!1,this.warp=!1}load(i){if(Ke(i))return;this.angle.load(aa(i.angle)?{value:i.angle}:i.angle),this.attract.load(i.attract),this.center.load(i.center),i.decay!==void 0&&(this.decay=At(i.decay)),i.direction!==void 0&&(this.direction=i.direction),i.distance!==void 0&&(this.distance=aa(i.distance)?{horizontal:i.distance,vertical:i.distance}:{...i.distance}),i.drift!==void 0&&(this.drift=At(i.drift)),i.enable!==void 0&&(this.enable=i.enable),this.gravity.load(i.gravity);const a=i.outModes;a!==void 0&&(Lg(a)?this.outModes.load(a):this.outModes.load({default:a})),this.path.load(i.path),i.random!==void 0&&(this.random=i.random),i.size!==void 0&&(this.size=i.size),i.speed!==void 0&&(this.speed=At(i.speed)),this.spin.load(i.spin),i.straight!==void 0&&(this.straight=i.straight),this.trail.load(i.trail),i.vibrate!==void 0&&(this.vibrate=i.vibrate),i.warp!==void 0&&(this.warp=i.warp)}}class vpe extends wk{constructor(){super(),this.destroy=Id.none,this.speed=2}load(i){super.load(i),!Ke(i)&&i.destroy!==void 0&&(this.destroy=i.destroy)}}class Spe extends lH{constructor(){super(),this.animation=new vpe,this.value=1}load(i){if(Ke(i))return;super.load(i);const a=i.animation;a!==void 0&&this.animation.load(a)}}class Tpe{constructor(){this.enable=!1,this.width=1920,this.height=1080}load(i){if(Ke(i))return;i.enable!==void 0&&(this.enable=i.enable);const a=i.width;a!==void 0&&(this.width=a);const c=i.height;c!==void 0&&(this.height=c)}}var ED;(function(s){s.delete="delete",s.wait="wait"})(ED||(ED={}));class Rpe{constructor(){this.mode=ED.delete,this.value=0}load(i){Ke(i)||(i.mode!==void 0&&(this.mode=i.mode),i.value!==void 0&&(this.value=i.value))}}class wpe{constructor(){this.density=new Tpe,this.limit=new Rpe,this.value=0}load(i){Ke(i)||(this.density.load(i.density),this.limit.load(i.limit),i.value!==void 0&&(this.value=i.value))}}class Cpe{constructor(){this.blur=0,this.color=new Sr,this.enable=!1,this.offset={x:0,y:0},this.color.value="#000"}load(i){Ke(i)||(i.blur!==void 0&&(this.blur=i.blur),this.color=Sr.create(this.color,i.color),i.enable!==void 0&&(this.enable=i.enable),i.offset!==void 0&&(i.offset.x!==void 0&&(this.offset.x=i.offset.x),i.offset.y!==void 0&&(this.offset.y=i.offset.y)))}}class bpe{constructor(){this.close=!0,this.fill=!0,this.options={},this.type="circle"}load(i){if(Ke(i))return;const a=i.options;if(a!==void 0)for(const c in a){const p=a[c];p&&(this.options[c]=so(this.options[c]??{},p))}i.close!==void 0&&(this.close=i.close),i.fill!==void 0&&(this.fill=i.fill),i.type!==void 0&&(this.type=i.type)}}class Ape extends wk{constructor(){super(),this.destroy=Id.none,this.speed=5}load(i){super.load(i),!Ke(i)&&i.destroy!==void 0&&(this.destroy=i.destroy)}}class Ipe extends lH{constructor(){super(),this.animation=new Ape,this.value=3}load(i){if(super.load(i),Ke(i))return;const a=i.animation;a!==void 0&&this.animation.load(a)}}class Y6{constructor(){this.width=0}load(i){Ke(i)||(i.color!==void 0&&(this.color=$g.create(this.color,i.color)),i.width!==void 0&&(this.width=At(i.width)),i.opacity!==void 0&&(this.opacity=At(i.opacity)))}}class Ope extends qa{constructor(){super(),this.opacityRate=1,this.sizeRate=1,this.velocityRate=1}load(i){super.load(i),!Ke(i)&&(i.opacityRate!==void 0&&(this.opacityRate=i.opacityRate),i.sizeRate!==void 0&&(this.sizeRate=i.sizeRate),i.velocityRate!==void 0&&(this.velocityRate=i.velocityRate))}}class Npe{constructor(i,a){this._engine=i,this._container=a,this.bounce=new uH,this.collisions=new cpe,this.color=new $g,this.color.value="#fff",this.effect=new lpe,this.groups={},this.move=new ype,this.number=new wpe,this.opacity=new Spe,this.reduceDuplicates=!1,this.shadow=new Cpe,this.shape=new bpe,this.size=new Ipe,this.stroke=new Y6,this.zIndex=new Ope}load(i){if(Ke(i))return;if(i.groups!==void 0)for(const c of Object.keys(i.groups)){if(!Object.hasOwn(i.groups,c))continue;const p=i.groups[c];p!==void 0&&(this.groups[c]=so(this.groups[c]??{},p))}i.reduceDuplicates!==void 0&&(this.reduceDuplicates=i.reduceDuplicates),this.bounce.load(i.bounce),this.color.load($g.create(this.color,i.color)),this.effect.load(i.effect),this.move.load(i.move),this.number.load(i.number),this.opacity.load(i.opacity),this.shape.load(i.shape),this.size.load(i.size),this.shadow.load(i.shadow),this.zIndex.load(i.zIndex),this.collisions.load(i.collisions),i.interactivity!==void 0&&(this.interactivity=so({},i.interactivity));const a=i.stroke;if(a&&(this.stroke=hs(a,c=>{const p=new Y6;return p.load(c),p})),this._container){const c=this._engine.updaters.get(this._container);if(c)for(const _ of c)_.loadOptions&&_.loadOptions(this,i);const p=this._engine.interactors.get(this._container);if(p)for(const _ of p)_.loadParticlesOptions&&_.loadParticlesOptions(this,i)}}}function Ppe(s,...i){for(const a of i)s.load(a)}function Dpe(s,i,...a){const c=new Npe(s,i);return Ppe(c,...a),c}var ib;(function(s){s.external="external",s.particles="particles"})(ib||(ib={}));var Cd;(function(s){s.normal="normal",s.inside="inside",s.outside="outside"})(Cd||(Cd={}));var zg;(function(s){s.circle="circle",s.rectangle="rectangle"})(zg||(zg={}));class dH{constructor(i,a,c){this.position={x:i,y:a},this.type=c}}class Is extends dH{constructor(i,a,c){super(i,a,zg.circle),this.radius=c}contains(i){return Co(i,this.position)<=this.radius}intersects(i){const a=this.position,c=i.position,p={x:Math.abs(c.x-a.x),y:Math.abs(c.y-a.y)},_=this.radius;if(i instanceof Is||i.type===zg.circle){const y=i,T=_+y.radius,C=Math.sqrt(p.x**bp+p.y**bp);return T>C}else if(i instanceof xd||i.type===zg.rectangle){const y=i,{width:T,height:C}=y.size;return Math.pow(p.x-T,bp)+Math.pow(p.y-C,bp)<=_**bp||p.x<=_+T&&p.y<=_+C||p.x<=T||p.y<=C}return!1}}class xd extends dH{constructor(i,a,c,p){super(i,a,zg.rectangle),this.size={height:p,width:c}}contains(i){const a=this.size.width,c=this.size.height,p=this.position;return i.x>=p.x&&i.x<=p.x+a&&i.y>=p.y&&i.y<=p.y+c}intersects(i){if(i instanceof Is)return i.intersects(this);const a=this.size.width,c=this.size.height,p=this.position,_=i.position,y=i instanceof xd?i.size:{width:0,height:0},T=y.width,C=y.height;return _.x<p.x+a&&_.x+T>p.x&&_.y<p.y+c&&_.y+C>p.y}}class Ya{constructor(i){this.type=ib.external,this.container=i}}class Ck{constructor(i){this.type=ib.particles,this.container=i}}var bs;(function(s){s.clockwise="clockwise",s.counterClockwise="counter-clockwise",s.random="random"})(bs||(bs={}));var Vp;(function(s){s.easeInBack="ease-in-back",s.easeInCirc="ease-in-circ",s.easeInCubic="ease-in-cubic",s.easeInLinear="ease-in-linear",s.easeInQuad="ease-in-quad",s.easeInQuart="ease-in-quart",s.easeInQuint="ease-in-quint",s.easeInExpo="ease-in-expo",s.easeInSine="ease-in-sine",s.easeOutBack="ease-out-back",s.easeOutCirc="ease-out-circ",s.easeOutCubic="ease-out-cubic",s.easeOutLinear="ease-out-linear",s.easeOutQuad="ease-out-quad",s.easeOutQuart="ease-out-quart",s.easeOutQuint="ease-out-quint",s.easeOutExpo="ease-out-expo",s.easeOutSine="ease-out-sine",s.easeInOutBack="ease-in-out-back",s.easeInOutCirc="ease-in-out-circ",s.easeInOutCubic="ease-in-out-cubic",s.easeInOutLinear="ease-in-out-linear",s.easeInOutQuad="ease-in-out-quad",s.easeInOutQuart="ease-in-out-quart",s.easeInOutQuint="ease-in-out-quint",s.easeInOutExpo="ease-in-out-expo",s.easeInOutSine="ease-in-out-sine"})(Vp||(Vp={}));class kpe{constructor(){this.radius=0,this.mass=0}load(i){Ke(i)||(i.mass!==void 0&&(this.mass=i.mass),i.radius!==void 0&&(this.radius=i.radius))}}class Lpe extends qa{constructor(){super(),this.density=5,this.value=50,this.limit=new kpe}load(i){Ke(i)||(super.load(i),i.density!==void 0&&(this.density=i.density),aa(i.limit)?this.limit.radius=i.limit:this.limit.load(i.limit))}}class rb{constructor(){this.color=new Sr,this.color.value="#000000",this.draggable=!1,this.opacity=1,this.destroy=!0,this.orbits=!1,this.size=new Lpe}load(i){Ke(i)||(i.color!==void 0&&(this.color=Sr.create(this.color,i.color)),i.draggable!==void 0&&(this.draggable=i.draggable),this.name=i.name,i.opacity!==void 0&&(this.opacity=i.opacity),i.position!==void 0&&(this.position={},i.position.x!==void 0&&(this.position.x=At(i.position.x)),i.position.y!==void 0&&(this.position.y=At(i.position.y))),i.size!==void 0&&this.size.load(i.size),i.destroy!==void 0&&(this.destroy=i.destroy),i.orbits!==void 0&&(this.orbits=i.orbits))}}var sb;(function(s){s.absorber="absorber"})(sb||(sb={}));const xpe=2,Mpe=.033,Upe=0,Vpe=0,Fpe=0,Bpe=0,jpe=2,X6=Math.PI*jpe,J6=0;class Gpe{constructor(i,a,c,p,_){var T;this._calcPosition=()=>{const C=J8({size:this._container.canvas.size,position:this.options.position});return _i.create(C.x,C.y)},this._updateParticlePosition=(C,I)=>{if(C.destroyed)return;const D=this._container,L=D.canvas.size;if(C.needsNewPosition){const j=X8({size:L});C.position.setTo(j),C.velocity.setTo(C.initialVelocity),C.absorberOrbit=void 0,C.needsNewPosition=!1}if(this.options.orbits){if(C.absorberOrbit===void 0&&(C.absorberOrbit=_i.origin,C.absorberOrbit.length=Co(C.getPosition(),this.position),C.absorberOrbit.angle=en()*X6),C.absorberOrbit.length<=this.size&&!this.options.destroy){const Q=Math.min(L.width,L.height),se=1,fe=.1,me=.2;C.absorberOrbit.length=Q*(se+(en()*me-fe))}C.absorberOrbitDirection===void 0&&(C.absorberOrbitDirection=C.velocity.x>=J6?bs.clockwise:bs.counterClockwise);const j=C.absorberOrbit.length,Y=C.absorberOrbit.angle,X=C.absorberOrbitDirection;C.velocity.setTo(_i.origin);const ee={x:X===bs.clockwise?Math.cos:Math.sin,y:X===bs.clockwise?Math.sin:Math.cos};C.position.x=this.position.x+j*ee.x(Y),C.position.y=this.position.y+j*ee.y(Y),C.absorberOrbit.length-=I.length,C.absorberOrbit.angle+=(C.retina.moveSpeed??J6)*D.retina.pixelRatio/jr*D.retina.reduceFactor}else{const j=_i.origin;j.length=I.length,j.angle=I.angle,C.velocity.addTo(j)}},this._absorbers=i,this._container=a,this._engine=c,this.initialPosition=_?_i.create(_.x,_.y):void 0,p instanceof rb?this.options=p:(this.options=new rb,this.options.load(p)),this.dragging=!1,this.name=this.options.name,this.opacity=this.options.opacity,this.size=nt(this.options.size.value)*a.retina.pixelRatio,this.mass=this.size*this.options.size.density*a.retina.reduceFactor;const y=this.options.size.limit;this.limit={radius:y.radius*a.retina.pixelRatio*a.retina.reduceFactor,mass:y.mass},this.color=Nd(this._engine,this.options.color)??{b:0,g:0,r:0},this.position=((T=this.initialPosition)==null?void 0:T.copy())??this._calcPosition()}attract(i){const a=this._container,c=this.options;if(c.draggable){const I=a.interactivity.mouse;I.clicking&&I.downPosition?Co(this.position,I.downPosition)<=this.size&&(this.dragging=!0):this.dragging=!1,this.dragging&&I.position&&(this.position.x=I.position.x,this.position.y=I.position.y)}const p=i.getPosition(),{dx:_,dy:y,distance:T}=ds(this.position,p),C=_i.create(_,y);if(C.length=this.mass/Math.pow(T,xpe)*a.retina.reduceFactor,T<this.size+i.getRadius()){const I=i.getRadius()*Mpe*a.retina.pixelRatio;this.size>i.getRadius()&&T<this.size-i.getRadius()||i.absorberOrbit!==void 0&&i.absorberOrbit.length<Upe?c.destroy?i.destroy():(i.needsNewPosition=!0,this._updateParticlePosition(i,C)):(c.destroy&&(i.size.value-=I),this._updateParticlePosition(i,C)),(this.limit.radius<=Vpe||this.size<this.limit.radius)&&(this.size+=I),(this.limit.mass<=Fpe||this.mass<this.limit.mass)&&(this.mass+=I*this.options.size.density*a.retina.reduceFactor)}else this._updateParticlePosition(i,C)}draw(i){i.translate(this.position.x,this.position.y),i.beginPath(),i.arc(ia.x,ia.y,this.size,Bpe,X6,!1),i.closePath(),i.fillStyle=Jg(this.color,this.opacity),i.fill()}resize(){const i=this.initialPosition;this.position=i&&Wv(i,this._container.canvas.size,_i.origin)?i:this._calcPosition()}}const $6=0;class Wpe{constructor(i,a){this._container=i,this._engine=a,this.array=[],this.absorbers=[],this.interactivityAbsorbers=[],i.getAbsorber=c=>c===void 0||aa(c)?this.array[c??$6]:this.array.find(p=>p.name===c),i.addAbsorber=async(c,p)=>this.addAbsorber(c,p)}async addAbsorber(i,a){const c=new Gpe(this,this._container,this._engine,i,a);return this.array.push(c),Promise.resolve(c)}draw(i){for(const a of this.array)a.draw(i)}handleClickMode(i){const a=this.absorbers,c=this.interactivityAbsorbers;if(i===sb.absorber){const p=su(c),_=p??su(a),y=this._container.interactivity.mouse.clickPosition;this.addAbsorber(_,y)}}async init(){this.absorbers=this._container.actualOptions.absorbers,this.interactivityAbsorbers=this._container.actualOptions.interactivity.modes.absorbers;const i=hs(this.absorbers,async a=>{await this.addAbsorber(a)});i instanceof Array?await Promise.all(i):await i}particleUpdate(i){for(const a of this.array)if(a.attract(i),i.destroyed)break}removeAbsorber(i){const a=this.array.indexOf(i);a>=$6&&this.array.splice(a,1)}resize(){for(const i of this.array)i.resize()}stop(){this.array=[]}}class zpe{constructor(i){this.id="absorbers",this._engine=i}async getPlugin(i){return Promise.resolve(new Wpe(i,this._engine))}loadOptions(i,a){var c,p;!this.needsPlugin(i)&&!this.needsPlugin(a)||(a!=null&&a.absorbers&&(i.absorbers=hs(a.absorbers,_=>{const y=new rb;return y.load(_),y})),i.interactivity.modes.absorbers=hs((p=(c=a==null?void 0:a.interactivity)==null?void 0:c.modes)==null?void 0:p.absorbers,_=>{const y=new rb;return y.load(_),y}))}needsPlugin(i){var c,p,_;if(!i)return!1;const a=i.absorbers;return us(a)?!!a.length:a?!0:!!((_=(p=(c=i.interactivity)==null?void 0:c.events)==null?void 0:p.onClick)!=null&&_.mode&&di(sb.absorber,i.interactivity.events.onClick.mode))}}async function Hpe(s,i=!0){s.checkVersion("3.8.1"),await s.addPlugin(new zpe(s),i)}class Kpe{load(i){Ke(i)||(i.bottom!==void 0&&(this.bottom=At(i.bottom)),i.left!==void 0&&(this.left=At(i.left)),i.right!==void 0&&(this.right=At(i.right)),i.top!==void 0&&(this.top=At(i.top)))}}var ob;(function(s){s.none="none",s.split="split"})(ob||(ob={}));class qpe extends qa{constructor(){super(),this.value=3}}class Ype extends qa{constructor(){super(),this.value={min:4,max:9}}}class Xpe{constructor(){this.count=1,this.factor=new qpe,this.rate=new Ype,this.sizeOffset=!0}load(i){Ke(i)||(i.color!==void 0&&(this.color=Sr.create(this.color,i.color)),i.count!==void 0&&(this.count=i.count),this.factor.load(i.factor),this.rate.load(i.rate),this.particles=hs(i.particles,a=>so({},a)),i.sizeOffset!==void 0&&(this.sizeOffset=i.sizeOffset),i.colorOffset&&(this.colorOffset=this.colorOffset??{},i.colorOffset.h!==void 0&&(this.colorOffset.h=i.colorOffset.h),i.colorOffset.s!==void 0&&(this.colorOffset.s=i.colorOffset.s),i.colorOffset.l!==void 0&&(this.colorOffset.l=i.colorOffset.l)))}}class Jpe{constructor(){this.bounds=new Kpe,this.mode=ob.none,this.split=new Xpe}load(i){Ke(i)||(i.mode&&(this.mode=i.mode),i.bounds&&this.bounds.load(i.bounds),this.split.load(i.split))}}const hC=0,$pe=.5,Qpe=0,Zpe=1,efe=500,tfe=0;function nfe(s,i,a,c){const p=a.options.destroy;if(!p)return;const _=p.split,y=Dpe(s,i,a.options),T=nt(_.factor.value),C=a.getFillColor();_.color?y.color.load(_.color):_.colorOffset&&C?y.color.load({value:{hsl:{h:C.h+nt(_.colorOffset.h??hC),s:C.s+nt(_.colorOffset.s??hC),l:C.l+nt(_.colorOffset.l??hC)}}}):y.color.load({value:{hsl:a.getFillColor()}}),y.move.load({center:{x:a.position.x,y:a.position.y,mode:Od.precise}}),aa(y.size.value)?y.size.value/=T:(y.size.value.min/=T,y.size.value.max/=T),y.load(c);const I=_.sizeOffset?At(-a.size.value,a.size.value):hC,D={x:a.position.x+cs(I),y:a.position.y+cs(I)};return i.particles.addParticle(D,y,a.group,L=>L.size.value<$pe?!1:(L.velocity.length=cs(At(a.velocity.length,L.velocity.length)),L.splitCount=(a.splitCount??Qpe)+Zpe,L.unbreakable=!0,setTimeout(()=>{L.unbreakable=!1},efe),!0))}function ife(s,i,a){const c=a.options.destroy;if(!c)return;const p=c.split;if(p.count>=tfe&&(a.splitCount===void 0||a.splitCount++>p.count))return;const _=nt(p.rate.value),y=su(p.particles);for(let T=0;T<_;T++)nfe(s,i,a,y)}class rfe{constructor(i,a){this.container=a,this.engine=i}init(i){const a=this.container,c=i.options,p=c.destroy;if(!p)return;i.splitCount=0;const _=p.bounds;i.destroyBounds||(i.destroyBounds={});const{bottom:y,left:T,right:C,top:I}=_,{destroyBounds:D}=i,L=a.canvas.size;y&&(D.bottom=nt(y)*L.height/jr),T&&(D.left=nt(T)*L.width/jr),C&&(D.right=nt(C)*L.width/jr),I&&(D.top=nt(I)*L.height/jr)}isEnabled(i){return!i.destroyed}loadOptions(i,...a){i.destroy||(i.destroy=new Jpe);for(const c of a)i.destroy.load(c==null?void 0:c.destroy)}particleDestroyed(i,a){if(a)return;const c=i.options.destroy;c&&c.mode===ob.split&&ife(this.engine,this.container,i)}update(i){if(!this.isEnabled(i))return;const a=i.getPosition(),c=i.destroyBounds;c&&(c.bottom!==void 0&&a.y>=c.bottom||c.left!==void 0&&a.x<=c.left||c.right!==void 0&&a.x>=c.right||c.top!==void 0&&a.y<=c.top)&&i.destroy()}}async function sfe(s,i=!0){s.checkVersion("3.8.1"),await s.addParticleUpdater("destroy",a=>Promise.resolve(new rfe(s,a)),i)}class ofe{constructor(){this.wait=!1}load(i){Ke(i)||(i.count!==void 0&&(this.count=i.count),i.delay!==void 0&&(this.delay=At(i.delay)),i.duration!==void 0&&(this.duration=At(i.duration)),i.wait!==void 0&&(this.wait=i.wait))}}class afe{constructor(){this.quantity=1,this.delay=.1}load(i){Ke(i)||(i.quantity!==void 0&&(this.quantity=At(i.quantity)),i.delay!==void 0&&(this.delay=At(i.delay)))}}class cfe{constructor(){this.color=!1,this.opacity=!1}load(i){Ke(i)||(i.color!==void 0&&(this.color=i.color),i.opacity!==void 0&&(this.opacity=i.opacity))}}class lfe{constructor(){this.options={},this.replace=new cfe,this.type="square"}load(i){Ke(i)||(i.options!==void 0&&(this.options=so({},i.options??{})),this.replace.load(i.replace),i.type!==void 0&&(this.type=i.type))}}class hH{constructor(){this.mode=Od.percent,this.height=0,this.width=0}load(i){Ke(i)||(i.mode!==void 0&&(this.mode=i.mode),i.height!==void 0&&(this.height=i.height),i.width!==void 0&&(this.width=i.width))}}class Ed{constructor(){this.autoPlay=!0,this.fill=!0,this.life=new ofe,this.rate=new afe,this.shape=new lfe,this.startCount=0}load(i){Ke(i)||(i.autoPlay!==void 0&&(this.autoPlay=i.autoPlay),i.size!==void 0&&(this.size||(this.size=new hH),this.size.load(i.size)),i.direction!==void 0&&(this.direction=i.direction),this.domId=i.domId,i.fill!==void 0&&(this.fill=i.fill),this.life.load(i.life),this.name=i.name,this.particles=hs(i.particles,a=>so({},a)),this.rate.load(i.rate),this.shape.load(i.shape),i.position!==void 0&&(this.position={},i.position.x!==void 0&&(this.position.x=At(i.position.x)),i.position.y!==void 0&&(this.position.y=At(i.position.y))),i.spawnColor!==void 0&&(this.spawnColor===void 0&&(this.spawnColor=new $g),this.spawnColor.load(i.spawnColor)),i.startCount!==void 0&&(this.startCount=i.startCount))}}var ab;(function(s){s.emitter="emitter"})(ab||(ab={}));const Q6=.5,Z6=0,pC=0,eG=0,ufe=0,dfe=-1,hfe=1;function tG(s,i){s.color?s.color.value=i:s.color={value:i}}class pfe{constructor(i,a,c,p,_){var I,D;this.emitters=a,this.container=c,this._destroy=()=>{var L,j;(L=this._mutationObserver)==null||L.disconnect(),this._mutationObserver=void 0,(j=this._resizeObserver)==null||j.disconnect(),this._resizeObserver=void 0,this.emitters.removeEmitter(this),this._engine.dispatchEvent("emitterDestroyed",{container:this.container,data:{emitter:this}})},this._prepareToDie=()=>{var X;if(this._paused)return;const L=((X=this.options.life)==null?void 0:X.duration)!==void 0?nt(this.options.life.duration):void 0;this.container.retina.reduceFactor&&(this._lifeCount>0||this._immortal)&&L!==void 0&&L>0&&(this._duration=L*os)},this._setColorAnimation=(L,j,Y,X=hfe)=>{const ee=this.container;if(!L.enable)return j;const Q=cs(L.offset),se=nt(this.options.rate.delay),fe=se*os/ee.retina.reduceFactor,me=0,Oe=nt(L.speed??me);return(j+Oe*ee.fpsLimit/fe+Q*X)%Y},this._engine=i,this._currentDuration=0,this._currentEmitDelay=0,this._currentSpawnDelay=0,this._initialPosition=_,p instanceof Ed?this.options=p:(this.options=new Ed,this.options.load(p)),this._spawnDelay=nt(this.options.life.delay??Z6)*os/this.container.retina.reduceFactor,this.position=this._initialPosition??this._calcPosition(),this.name=this.options.name,this.fill=this.options.fill,this._firstSpawn=!this.options.life.wait,this._startParticlesAdded=!1;let y=so({},this.options.particles);if(y??(y={}),y.move??(y.move={}),(I=y.move).direction??(I.direction=this.options.direction),this.options.spawnColor&&(this.spawnColor=a_(this._engine,this.options.spawnColor)),this._paused=!this.options.autoPlay,this._particlesOptions=y,this._size=this._calcSize(),this.size=K6(this._size,this.container.canvas.size),this._lifeCount=this.options.life.count??dfe,this._immortal=this._lifeCount<=pC,this.options.domId){const L=document.getElementById(this.options.domId);L&&(this._mutationObserver=new MutationObserver(()=>{this.resize()}),this._resizeObserver=new ResizeObserver(()=>{this.resize()}),this._mutationObserver.observe(L,{attributes:!0,attributeFilter:["style","width","height"]}),this._resizeObserver.observe(L))}const T=this.options.shape,C=(D=this._engine.emitterShapeManager)==null?void 0:D.getShapeGenerator(T.type);C&&(this._shape=C.generate(this.position,this.size,this.fill,T.options)),this._engine.dispatchEvent("emitterCreated",{container:c,data:{emitter:this}}),this.play()}externalPause(){this._paused=!0,this.pause()}externalPlay(){this._paused=!1,this.play()}async init(){var i;await((i=this._shape)==null?void 0:i.init())}pause(){this._paused||delete this._emitDelay}play(){if(!this._paused&&this.container.retina.reduceFactor&&(this._lifeCount>pC||this._immortal||!this.options.life.count)&&(this._firstSpawn||this._currentSpawnDelay>=(this._spawnDelay??eG))){if(this._emitDelay===void 0){const i=nt(this.options.rate.delay);this._emitDelay=i*os/this.container.retina.reduceFactor}(this._lifeCount>pC||this._immortal)&&this._prepareToDie()}}resize(){var a;const i=this._initialPosition;this.position=i&&Wv(i,this.container.canvas.size,_i.origin)?i:this._calcPosition(),this._size=this._calcSize(),this.size=K6(this._size,this.container.canvas.size),(a=this._shape)==null||a.resize(this.position,this.size)}update(i){var a;this._paused||(this._firstSpawn&&(this._firstSpawn=!1,this._currentSpawnDelay=this._spawnDelay??eG,this._currentEmitDelay=this._emitDelay??ufe),this._startParticlesAdded||(this._startParticlesAdded=!0,this._emitParticles(this.options.startCount)),this._duration!==void 0&&(this._currentDuration+=i.value,this._currentDuration>=this._duration&&(this.pause(),this._spawnDelay!==void 0&&delete this._spawnDelay,this._immortal||this._lifeCount--,this._lifeCount>pC||this._immortal?(this.position=this._calcPosition(),(a=this._shape)==null||a.resize(this.position,this.size),this._spawnDelay=nt(this.options.life.delay??Z6)*os/this.container.retina.reduceFactor):this._destroy(),this._currentDuration-=this._duration,delete this._duration)),this._spawnDelay!==void 0&&(this._currentSpawnDelay+=i.value,this._currentSpawnDelay>=this._spawnDelay&&(this._engine.dispatchEvent("emitterPlay",{container:this.container}),this.play(),this._currentSpawnDelay-=this._currentSpawnDelay,delete this._spawnDelay)),this._emitDelay!==void 0&&(this._currentEmitDelay+=i.value,this._currentEmitDelay>=this._emitDelay&&(this._emit(),this._currentEmitDelay-=this._emitDelay)))}_calcPosition(){if(this.options.domId){const i=document.getElementById(this.options.domId);if(i){const a=i.getBoundingClientRect(),c=this.container.retina.pixelRatio;return{x:(a.x+a.width*Q6)*c,y:(a.y+a.height*Q6)*c}}}return J8({size:this.container.canvas.size,position:this.options.position})}_calcSize(){const i=this.container;if(this.options.domId){const a=document.getElementById(this.options.domId);if(a){const c=a.getBoundingClientRect();return{width:c.width*i.retina.pixelRatio,height:c.height*i.retina.pixelRatio,mode:Od.precise}}}return this.options.size??(()=>{const a=new hH;return a.load({height:0,mode:Od.percent,width:0}),a})()}_emit(){if(this._paused)return;const i=nt(this.options.rate.quantity);this._emitParticles(i)}_emitParticles(i){var c;const a=su(this._particlesOptions);for(let p=0;p<i;p++){const _=so({},a);if(this.spawnColor){const C=(c=this.options.spawnColor)==null?void 0:c.animation;if(C){const I={h:360,s:100,l:100},D=3.6;this.spawnColor.h=this._setColorAnimation(C.h,this.spawnColor.h,I.h,D),this.spawnColor.s=this._setColorAnimation(C.s,this.spawnColor.s,I.s),this.spawnColor.l=this._setColorAnimation(C.l,this.spawnColor.l,I.l)}tG(_,this.spawnColor)}const y=this.options.shape;let T=this.position;if(this._shape){const C=this._shape.randomPosition();if(C){T=C.position;const I=y.replace;I.color&&C.color&&tG(_,C.color),I.opacity&&(_.opacity?_.opacity.value=C.opacity:_.opacity={value:C.opacity})}else T=null}T&&this.container.particles.addParticle(T,_)}}}class ffe{constructor(i,a){this.container=a,this._engine=i,this.array=[],this.emitters=[],this.interactivityEmitters={random:{count:1,enable:!1},value:[]};const c=0;a.getEmitter=p=>p===void 0||aa(p)?this.array[p??c]:this.array.find(_=>_.name===p),a.addEmitter=async(p,_)=>this.addEmitter(p,_),a.removeEmitter=p=>{const _=a.getEmitter(p);_&&this.removeEmitter(_)},a.playEmitter=p=>{const _=a.getEmitter(p);_&&_.externalPlay()},a.pauseEmitter=p=>{const _=a.getEmitter(p);_&&_.externalPause()}}async addEmitter(i,a){const c=new Ed;c.load(i);const p=new pfe(this._engine,this,this.container,c,a);return await p.init(),this.array.push(p),p}handleClickMode(i){const a=this.emitters,c=this.interactivityEmitters;if(i!==ab.emitter)return;let p;if(c&&us(c.value))if(c.value.length>0&&c.random.enable){p=[];const C=[];for(let I=0;I<c.random.count;I++){const D=Z8(c.value);if(C.includes(D)&&C.length<c.value.length){I--;continue}C.push(D),p.push(Gv(c.value,D))}}else p=c.value;else p=c==null?void 0:c.value;const _=p??a,y=this.container.interactivity.mouse.clickPosition;hs(_,async T=>{await this.addEmitter(T,y)})}async init(){if(this.emitters=this.container.actualOptions.emitters,this.interactivityEmitters=this.container.actualOptions.interactivity.modes.emitters,!!this.emitters)if(us(this.emitters))for(const i of this.emitters)await this.addEmitter(i);else await this.addEmitter(this.emitters)}pause(){for(const i of this.array)i.pause()}play(){for(const i of this.array)i.play()}removeEmitter(i){const a=this.array.indexOf(i);a>=0&&this.array.splice(a,1)}resize(){for(const i of this.array)i.resize()}stop(){this.array=[]}update(i){for(const a of this.array)a.update(i)}}class mfe{constructor(i){this._engine=i,this.id="emitters"}getPlugin(i){return Promise.resolve(new ffe(this._engine,i))}loadOptions(i,a){var p,_;if(!this.needsPlugin(i)&&!this.needsPlugin(a))return;a!=null&&a.emitters&&(i.emitters=hs(a.emitters,y=>{const T=new Ed;return T.load(y),T}));const c=(_=(p=a==null?void 0:a.interactivity)==null?void 0:p.modes)==null?void 0:_.emitters;if(c)if(us(c))i.interactivity.modes.emitters={random:{count:1,enable:!0},value:c.map(y=>{const T=new Ed;return T.load(y),T})};else{const y=c;if(y.value!==void 0)if(us(y.value))i.interactivity.modes.emitters={random:{count:y.random.count??1,enable:y.random.enable??!1},value:y.value.map(C=>{const I=new Ed;return I.load(C),I})};else{const C=new Ed;C.load(y.value),i.interactivity.modes.emitters={random:{count:y.random.count??1,enable:y.random.enable??!1},value:C}}else(i.interactivity.modes.emitters={random:{count:1,enable:!1},value:new Ed}).value.load(c)}}needsPlugin(i){var c,p,_;if(!i)return!1;const a=i.emitters;return us(a)&&!!a.length||a!==void 0||!!((_=(p=(c=i.interactivity)==null?void 0:c.events)==null?void 0:p.onClick)!=null&&_.mode)&&di(ab.emitter,i.interactivity.events.onClick.mode)}}const fP=new Map;class gfe{constructor(i){this._engine=i}addShapeGenerator(i,a){this.getShapeGenerator(i)||fP.set(i,a)}getShapeGenerator(i){return fP.get(i)}getSupportedShapeGenerators(){return fP.keys()}}class pH{constructor(i,a,c,p){this.position=i,this.size=a,this.fill=c,this.options=p}resize(i,a){this.position=i,this.size=a}}async function _fe(s,i=!0){s.checkVersion("3.8.1"),s.emitterShapeManager||(s.emitterShapeManager=new gfe(s)),s.addEmitterShapeGenerator||(s.addEmitterShapeGenerator=(c,p)=>{var _;(_=s.emitterShapeManager)==null||_.addShapeGenerator(c,p)});const a=new mfe(s);await s.addPlugin(a,i)}const ev=.25,yD=2,Efe=Math.PI*yD,nG=2,iG=.5;class yfe extends pH{constructor(i,a,c,p){super(i,a,c,p)}async init(){}randomPosition(){const i=this.size,a=this.fill,c=this.position,p=(L,j)=>{const Y=en()*ev,X=Math.atan(j/L*Math.tan(Efe*Y)),ee=en();return ee<ev?X:ee<yD*ev?Math.PI-X:ee<yD*ev+ev?Math.PI+X:-X},_=(L,j,Y)=>L*j/Math.sqrt((j*Math.cos(Y))**nG+(L*Math.sin(Y))**nG),[y,T]=[i.width*iG,i.height*iG],C=p(y,T),I=_(y,T,C),D=a?I*Math.sqrt(en()):I;return{position:{x:c.x+D*Math.cos(C),y:c.y+D*Math.sin(C)}}}}class vfe{generate(i,a,c,p){return new yfe(i,a,c,p)}}async function Sfe(s,i=!0){var c;const a=s;a.checkVersion("3.8.1"),(c=a.addEmitterShapeGenerator)==null||c.call(a,"circle",new vfe),await a.refresh(i)}const Tfe=4;var xg;(function(s){s[s.TopLeft=0]="TopLeft",s[s.TopRight=1]="TopRight",s[s.BottomRight=2]="BottomRight",s[s.BottomLeft=3]="BottomLeft"})(xg||(xg={}));function rG(s,i){return s+i*(en()-ro)}class Rfe extends pH{constructor(i,a,c,p){super(i,a,c,p)}async init(){}randomPosition(){const i=this.fill,a=this.position,c=this.size;if(i)return{position:{x:rG(a.x,c.width),y:rG(a.y,c.height)}};{const p=c.width*ro,_=c.height*ro,y=Math.floor(en()*Tfe),T=(en()-ro)*Gc;switch(y){case xg.TopLeft:return{position:{x:a.x+T*p,y:a.y-_}};case xg.TopRight:return{position:{x:a.x-p,y:a.y+T*_}};case xg.BottomRight:return{position:{x:a.x+T*p,y:a.y+_}};case xg.BottomLeft:default:return{position:{x:a.x+p,y:a.y+T*_}}}}}}class wfe{generate(i,a,c,p){return new Rfe(i,a,c,p)}}async function Cfe(s,i=!0){var c;const a=s;a.checkVersion("3.8.1"),(c=a.addEmitterShapeGenerator)==null||c.call(a,"square",new wfe),await a.refresh(i)}class bfe{constructor(){this.delay=1,this.pauseOnStop=!1,this.quantity=1}load(i){Ke(i)||(i.delay!==void 0&&(this.delay=i.delay),i.quantity!==void 0&&(this.quantity=i.quantity),i.particles!==void 0&&(this.particles=so({},i.particles)),i.pauseOnStop!==void 0&&(this.pauseOnStop=i.pauseOnStop))}}const sG="trail";class Afe extends Ya{constructor(i){super(i),this._delay=0}clear(){}init(){}interact(i){var I,D,L,j;const a=this.container,{interactivity:c}=a;if(!a.retina.reduceFactor)return;const p=a.actualOptions,_=p.interactivity.modes.trail;if(!_)return;const y=_.delay*os/this.container.retina.reduceFactor;if(this._delay<y&&(this._delay+=i.value),this._delay<y)return;const T=!(_.pauseOnStop&&(c.mouse.position===this._lastPosition||((I=c.mouse.position)==null?void 0:I.x)===((D=this._lastPosition)==null?void 0:D.x)&&((L=c.mouse.position)==null?void 0:L.y)===((j=this._lastPosition)==null?void 0:j.y))),C=a.interactivity.mouse.position;C?this._lastPosition={...C}:delete this._lastPosition,T&&a.particles.push(_.quantity,a.interactivity.mouse,_.particles),this._delay-=y}isEnabled(i){const a=this.container,c=a.actualOptions,p=a.interactivity.mouse,_=((i==null?void 0:i.interactivity)??c.interactivity).events;return p.clicking&&p.inside&&!!p.position&&di(sG,_.onClick.mode)||p.inside&&!!p.position&&di(sG,_.onHover.mode)}loadModeOptions(i,...a){i.trail||(i.trail=new bfe);for(const c of a)i.trail.load(c==null?void 0:c.trail)}reset(){}}async function Ife(s,i=!0){s.checkVersion("3.8.1"),await s.addInteractor("externalTrail",a=>Promise.resolve(new Afe(a)),i)}var xp;(function(s){s.both="both",s.horizontal="horizontal",s.vertical="vertical"})(xp||(xp={}));const Ofe=2,fH=Math.PI*Ofe,Nfe=360;function Pfe(s,i){const a=i.options.roll;if(!(a!=null&&a.enable)){i.roll={enable:!1,horizontal:!1,vertical:!1,angle:0,speed:0};return}if(i.roll={enable:a.enable,horizontal:a.mode===xp.horizontal||a.mode===xp.both,vertical:a.mode===xp.vertical||a.mode===xp.both,angle:en()*fH,speed:nt(a.speed)/Nfe},a.backColor)i.backColor=a_(s,a.backColor);else if(a.darken.enable&&a.enlighten.enable){const c=en()>=ro?Ap.darken:Ap.enlighten;i.roll.alter={type:c,value:nt(c===Ap.darken?a.darken.value:a.enlighten.value)}}else a.darken.enable?i.roll.alter={type:Ap.darken,value:nt(a.darken.value)}:a.enlighten.enable&&(i.roll.alter={type:Ap.enlighten,value:nt(a.enlighten.value)})}function Dfe(s,i){const a=s.options.roll,c=s.roll;if(!c||!(a!=null&&a.enable))return;const p=c.speed*i.factor,_=fH;c.angle+=p,c.angle>_&&(c.angle-=_)}class oG{constructor(){this.enable=!1,this.value=0}load(i){Ke(i)||(i.enable!==void 0&&(this.enable=i.enable),i.value!==void 0&&(this.value=At(i.value)))}}class kfe{constructor(){this.darken=new oG,this.enable=!1,this.enlighten=new oG,this.mode=xp.vertical,this.speed=25}load(i){Ke(i)||(i.backColor!==void 0&&(this.backColor=Sr.create(this.backColor,i.backColor)),this.darken.load(i.darken),i.enable!==void 0&&(this.enable=i.enable),this.enlighten.load(i.enlighten),i.mode!==void 0&&(this.mode=i.mode),i.speed!==void 0&&(this.speed=At(i.speed)))}}class Lfe{constructor(i){this._engine=i}getTransformValues(i){var _;const a=((_=i.roll)==null?void 0:_.enable)&&i.roll,c=a&&a.horizontal,p=a&&a.vertical;return{a:c?Math.cos(a.angle):void 0,d:p?Math.sin(a.angle):void 0}}init(i){Pfe(this._engine,i)}isEnabled(i){const a=i.options.roll;return!i.destroyed&&!i.spawning&&!!(a!=null&&a.enable)}loadOptions(i,...a){i.roll||(i.roll=new kfe);for(const c of a)i.roll.load(c==null?void 0:c.roll)}update(i,a){this.isEnabled(i)&&Dfe(i,a)}}async function xfe(s,i=!0){s.checkVersion("3.8.1"),await s.addParticleUpdater("roll",()=>Promise.resolve(new Lfe(s)),i)}const vD=.5,Mfe=2,Sd=0,Qg=1,aG=60,cG=0,Ufe=.01,Vfe=Math.PI*Mfe;function Ffe(s){const i=s.initialPosition,{dx:a,dy:c}=ds(i,s.position),p=Math.abs(a),_=Math.abs(c),{maxDistance:y}=s.retina,T=y.horizontal,C=y.vertical;if(!T&&!C)return;const I=(T&&p>=T)??!1,D=(C&&_>=C)??!1;if((I||D)&&!s.misplaced)s.misplaced=!!T&&p>T||!!C&&_>C,T&&(s.velocity.x=s.velocity.y*vD-s.velocity.x),C&&(s.velocity.y=s.velocity.x*vD-s.velocity.y);else if((!T||p<T)&&(!C||_<C)&&s.misplaced)s.misplaced=!1;else if(s.misplaced){const L=s.position,j=s.velocity;T&&(L.x<i.x&&j.x<Sd||L.x>i.x&&j.x>Sd)&&(j.x*=-en()),C&&(L.y<i.y&&j.y<Sd||L.y>i.y&&j.y>Sd)&&(j.y*=-en())}}function Bfe(s,i,a,c,p,_){Gfe(s,_);const y=s.gravity,T=y!=null&&y.enable&&y.inverse?-1:Qg;p&&a&&(s.velocity.x+=p*_.factor/(aG*a)),y!=null&&y.enable&&a&&(s.velocity.y+=T*(y.acceleration*_.factor)/(aG*a));const C=s.moveDecay;s.velocity.multTo(C);const I=s.velocity.mult(a);y!=null&&y.enable&&c>Sd&&(!y.inverse&&I.y>=Sd&&I.y>=c||y.inverse&&I.y<=Sd&&I.y<=-c)&&(I.y=T*c,a&&(s.velocity.y=I.y/a));const D=s.options.zIndex,L=(Qg-s.zIndexFactor)**D.velocityRate;I.multTo(L);const{position:j}=s;j.addTo(I),i.vibrate&&(j.x+=Math.sin(j.x*Math.cos(j.y)),j.y+=Math.cos(j.y*Math.sin(j.x)))}function jfe(s,i){const a=s.container;if(!s.spin)return;const c=s.spin.direction===bs.clockwise,p={x:c?Math.cos:Math.sin,y:c?Math.sin:Math.cos};s.position.x=s.spin.center.x+s.spin.radius*p.x(s.spin.angle),s.position.y=s.spin.center.y+s.spin.radius*p.y(s.spin.angle),s.spin.radius+=s.spin.acceleration;const _=Math.max(a.canvas.size.width,a.canvas.size.height),y=_*vD;s.spin.radius>y?(s.spin.radius=y,s.spin.acceleration*=-1):s.spin.radius<cG&&(s.spin.radius=cG,s.spin.acceleration*=-1),s.spin.angle+=i*Ufe*(Qg-s.spin.radius/_)}function Gfe(s,i){var y;const a=s.options,c=a.move.path;if(!c.enable)return;if(s.lastPathTime<=s.pathDelay){s.lastPathTime+=i.value;return}const _=(y=s.pathGenerator)==null?void 0:y.generate(s,i);_&&s.velocity.addTo(_),c.clamp&&(s.velocity.x=Ha(s.velocity.x,-1,Qg),s.velocity.y=Ha(s.velocity.y,-1,Qg)),s.lastPathTime-=s.pathDelay}function Wfe(s){return s.slow.inRange?s.slow.factor:Qg}function zfe(s){const i=s.container,a=s.options,c=a.move.spin;if(!c.enable)return;const p=c.position??{x:50,y:50},_=.01,y={x:p.x*_*i.canvas.size.width,y:p.y*_*i.canvas.size.height},T=s.getPosition(),C=Co(T,y),I=nt(c.acceleration);s.retina.spinAcceleration=I*i.retina.pixelRatio,s.spin={center:y,direction:s.velocity.x>=Sd?bs.clockwise:bs.counterClockwise,angle:en()*Vfe,radius:C,acceleration:s.retina.spinAcceleration}}const Hfe=2,Kfe=1,qfe=1;class Yfe{init(i){const a=i.options,c=a.move.gravity;i.gravity={enable:c.enable,acceleration:nt(c.acceleration),inverse:c.inverse},zfe(i)}isEnabled(i){return!i.destroyed&&i.options.move.enable}move(i,a){var ee,Q;const c=i.options,p=c.move;if(!p.enable)return;const _=i.container,y=_.retina.pixelRatio;(ee=i.retina).moveSpeed??(ee.moveSpeed=nt(p.speed)*y),(Q=i.retina).moveDrift??(Q.moveDrift=nt(i.options.move.drift)*y);const T=Wfe(i),C=i.retina.moveSpeed*_.retina.reduceFactor,I=i.retina.moveDrift,D=Wc(c.size.value)*y,L=p.size?i.getRadius()/D:Kfe,j=a.factor||qfe,Y=C*L*T*j/Hfe,X=i.retina.maxSpeed??_.retina.maxSpeed;p.spin.enable?jfe(i,Y):Bfe(i,p,Y,X,I,a),Ffe(i)}}async function Xfe(s,i=!0){s.checkVersion("3.8.1"),await s.addMover("base",()=>Promise.resolve(new Yfe),i)}const Jfe=2,$fe=Math.PI*Jfe,Qfe=0,lG={x:0,y:0};function Zfe(s){const{context:i,particle:a,radius:c}=s;a.circleRange||(a.circleRange={min:Qfe,max:$fe});const p=a.circleRange;i.arc(lG.x,lG.y,c,p.min,p.max,!1)}const eme=12,tme=360,uG=0;class nme{constructor(){this.validTypes=["circle"]}draw(i){Zfe(i)}getSidesCount(){return eme}particleInit(i,a){const c=a.shapeData,p=(c==null?void 0:c.angle)??{max:tme,min:uG};a.circleRange=Lg(p)?{min:jg(p.min),max:jg(p.max)}:{min:uG,max:jg(p)}}}async function ime(s,i=!0){s.checkVersion("3.8.1"),await s.addShape(new nme,i)}class rme{constructor(i,a){this._container=i,this._engine=a}init(i){const a=a_(this._engine,i.options.color,i.id,i.options.reduceDuplicates);a&&(i.color=aH(a,i.options.color.animation,this._container.retina.reduceFactor))}isEnabled(i){const{h:a,s:c,l:p}=i.options.color.animation,{color:_}=i;return!i.destroyed&&!i.spawning&&((_==null?void 0:_.h.value)!==void 0&&a.enable||(_==null?void 0:_.s.value)!==void 0&&c.enable||(_==null?void 0:_.l.value)!==void 0&&p.enable)}update(i,a){cH(i.color,a)}}async function sme(s,i=!0){s.checkVersion("3.8.1"),await s.addParticleUpdater("color",a=>Promise.resolve(new rme(a,s)),i)}var Ip;(function(s){s[s.r=1]="r",s[s.g=2]="g",s[s.b=3]="b",s[s.a=4]="a"})(Ip||(Ip={}));const ome=/^#?([a-f\d])([a-f\d])([a-f\d])([a-f\d])?$/i,ame=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i,fC=16,cme=1,lme=255;class ume{constructor(){this.key="hex",this.stringPrefix="#"}handleColor(i){return this._parseString(i.value)}handleRangeColor(i){return this._parseString(i.value)}parseString(i){return this._parseString(i)}_parseString(i){if(typeof i!="string"||!(i!=null&&i.startsWith(this.stringPrefix)))return;const a=i.replace(ome,(p,_,y,T,C)=>_+_+y+y+T+T+(C!==void 0?C+C:"")),c=ame.exec(a);return c?{a:c[Ip.a]!==void 0?parseInt(c[Ip.a],fC)/lme:cme,b:parseInt(c[Ip.b],fC),g:parseInt(c[Ip.g],fC),r:parseInt(c[Ip.r],fC)}:void 0}}async function dme(s,i=!0){s.checkVersion("3.8.1"),await s.addColorManager(new ume,i)}var Mg;(function(s){s[s.h=1]="h",s[s.s=2]="s",s[s.l=3]="l",s[s.a=5]="a"})(Mg||(Mg={}));class hme{constructor(){this.key="hsl",this.stringPrefix="hsl"}handleColor(i){const a=i.value,c=a.hsl??i.value;if(c.h!==void 0&&c.s!==void 0&&c.l!==void 0)return Xg(c)}handleRangeColor(i){const a=i.value,c=a.hsl??i.value;if(c.h!==void 0&&c.l!==void 0)return Xg({h:nt(c.h),l:nt(c.l),s:nt(c.s)})}parseString(i){if(!i.startsWith("hsl"))return;const a=/hsla?\(\s*(\d+)\s*[\s,]\s*(\d+)%\s*[\s,]\s*(\d+)%\s*([\s,]\s*(0|1|0?\.\d+|(\d{1,3})%)\s*)?\)/i,c=a.exec(i),p=4,_=1,y=10;return c?ipe({a:c.length>p?$8(c[Mg.a]):_,h:parseInt(c[Mg.h],y),l:parseInt(c[Mg.l],y),s:parseInt(c[Mg.s],y)}):void 0}}async function pme(s,i=!0){s.checkVersion("3.8.1"),await s.addColorManager(new hme,i)}class fme{constructor(i){this.container=i}init(i){const a=i.options.opacity,c=1;i.opacity=Qhe(a,c);const p=a.animation;p.enable&&(i.opacity.velocity=nt(p.speed)/jr*this.container.retina.reduceFactor,p.sync||(i.opacity.velocity*=en()))}isEnabled(i){return!i.destroyed&&!i.spawning&&!!i.opacity&&i.opacity.enable&&((i.opacity.maxLoops??0)<=0||(i.opacity.maxLoops??0)>0&&(i.opacity.loops??0)<(i.opacity.maxLoops??0))}reset(i){i.opacity&&(i.opacity.time=0,i.opacity.loops=0)}update(i,a){!this.isEnabled(i)||!i.opacity||Ab(i,i.opacity,!0,i.options.opacity.animation.destroy,a)}}async function mme(s,i=!0){s.checkVersion("3.8.1"),await s.addParticleUpdater("opacity",a=>Promise.resolve(new fme(a)),i)}const cb=0,Hg=0;function gme(s){if(s.outMode!==vr.bounce&&s.outMode!==vr.split||s.direction!==un.left&&s.direction!==un.right)return;s.bounds.right<Hg&&s.direction===un.left?s.particle.position.x=s.size+s.offset.x:s.bounds.left>s.canvasSize.width&&s.direction===un.right&&(s.particle.position.x=s.canvasSize.width-s.size-s.offset.x);const i=s.particle.velocity.x;let a=!1;if(s.direction===un.right&&s.bounds.right>=s.canvasSize.width&&i>cb||s.direction===un.left&&s.bounds.left<=Hg&&i<cb){const p=nt(s.particle.options.bounce.horizontal.value);s.particle.velocity.x*=-p,a=!0}if(!a)return;const c=s.offset.x+s.size;s.bounds.right>=s.canvasSize.width&&s.direction===un.right?s.particle.position.x=s.canvasSize.width-c:s.bounds.left<=Hg&&s.direction===un.left&&(s.particle.position.x=c),s.outMode===vr.split&&s.particle.destroy()}function _me(s){if(s.outMode!==vr.bounce&&s.outMode!==vr.split||s.direction!==un.bottom&&s.direction!==un.top)return;s.bounds.bottom<Hg&&s.direction===un.top?s.particle.position.y=s.size+s.offset.y:s.bounds.top>s.canvasSize.height&&s.direction===un.bottom&&(s.particle.position.y=s.canvasSize.height-s.size-s.offset.y);const i=s.particle.velocity.y;let a=!1;if(s.direction===un.bottom&&s.bounds.bottom>=s.canvasSize.height&&i>cb||s.direction===un.top&&s.bounds.top<=Hg&&i<cb){const p=nt(s.particle.options.bounce.vertical.value);s.particle.velocity.y*=-p,a=!0}if(!a)return;const c=s.offset.y+s.size;s.bounds.bottom>=s.canvasSize.height&&s.direction===un.bottom?s.particle.position.y=s.canvasSize.height-c:s.bounds.top<=Hg&&s.direction===un.top&&(s.particle.position.y=c),s.outMode===vr.split&&s.particle.destroy()}class Eme{constructor(i){this.container=i,this.modes=[vr.bounce,vr.split]}update(i,a,c,p){if(!this.modes.includes(p))return;const _=this.container;let y=!1;for(const j of _.plugins.values())if(j.particleBounce!==void 0&&(y=j.particleBounce(i,c,a)),y)break;if(y)return;const T=i.getPosition(),C=i.offset,I=i.getRadius(),D=zv(T,I),L=_.canvas.size;gme({particle:i,outMode:p,direction:a,bounds:D,canvasSize:L,offset:C,size:I}),_me({particle:i,outMode:p,direction:a,bounds:D,canvasSize:L,offset:C,size:I})}}const mC=0;class yme{constructor(i){this.container=i,this.modes=[vr.destroy]}update(i,a,c,p){if(!this.modes.includes(p))return;const _=this.container;switch(i.outType){case Cd.normal:case Cd.outside:if(Wv(i.position,_.canvas.size,_i.origin,i.getRadius(),a))return;break;case Cd.inside:{const{dx:y,dy:T}=ds(i.position,i.moveCenter),{x:C,y:I}=i.velocity;if(C<mC&&y>i.moveCenter.radius||I<mC&&T>i.moveCenter.radius||C>=mC&&y<-i.moveCenter.radius||I>=mC&&T<-i.moveCenter.radius)return;break}}_.particles.remove(i,i.group,!0)}}const gC=0;class vme{constructor(i){this.container=i,this.modes=[vr.none]}update(i,a,c,p){if(!this.modes.includes(p)||((i.options.move.distance.horizontal&&(a===un.left||a===un.right))??(i.options.move.distance.vertical&&(a===un.top||a===un.bottom))))return;const _=i.options.move.gravity,y=this.container,T=y.canvas.size,C=i.getRadius();if(_.enable){const I=i.position;(!_.inverse&&I.y>T.height+C&&a===un.bottom||_.inverse&&I.y<-C&&a===un.top)&&y.particles.remove(i)}else{if(i.velocity.y>gC&&i.position.y<=T.height+C||i.velocity.y<gC&&i.position.y>=-C||i.velocity.x>gC&&i.position.x<=T.width+C||i.velocity.x<gC&&i.position.x>=-C)return;Wv(i.position,y.canvas.size,_i.origin,C,a)||y.particles.remove(i)}}}const _C=0,EC=0;class Sme{constructor(i){this.container=i,this.modes=[vr.out]}update(i,a,c,p){if(!this.modes.includes(p))return;const _=this.container;switch(i.outType){case Cd.inside:{const{x:y,y:T}=i.velocity,C=_i.origin;C.length=i.moveCenter.radius,C.angle=i.velocity.angle+Math.PI,C.addTo(_i.create(i.moveCenter));const{dx:I,dy:D}=ds(i.position,C);if(y<=_C&&I>=EC||T<=_C&&D>=EC||y>=_C&&I<=EC||T>=_C&&D<=EC)return;i.position.x=Math.floor(cs({min:0,max:_.canvas.size.width})),i.position.y=Math.floor(cs({min:0,max:_.canvas.size.height}));const{dx:L,dy:j}=ds(i.position,i.moveCenter);i.direction=Math.atan2(-j,-L),i.velocity.angle=i.direction;break}default:{if(Wv(i.position,_.canvas.size,_i.origin,i.getRadius(),a))return;switch(i.outType){case Cd.outside:{i.position.x=Math.floor(cs({min:-i.moveCenter.radius,max:i.moveCenter.radius}))+i.moveCenter.x,i.position.y=Math.floor(cs({min:-i.moveCenter.radius,max:i.moveCenter.radius}))+i.moveCenter.y;const{dx:y,dy:T}=ds(i.position,i.moveCenter);i.moveCenter.radius&&(i.direction=Math.atan2(T,y),i.velocity.angle=i.direction);break}case Cd.normal:{const y=i.options.move.warp,T=_.canvas.size,C={bottom:T.height+i.getRadius()+i.offset.y,left:-i.getRadius()-i.offset.x,right:T.width+i.getRadius()+i.offset.x,top:-i.getRadius()-i.offset.y},I=i.getRadius(),D=zv(i.position,I);a===un.right&&D.left>T.width+i.offset.x?(i.position.x=C.left,i.initialPosition.x=i.position.x,y||(i.position.y=en()*T.height,i.initialPosition.y=i.position.y)):a===un.left&&D.right<-i.offset.x&&(i.position.x=C.right,i.initialPosition.x=i.position.x,y||(i.position.y=en()*T.height,i.initialPosition.y=i.position.y)),a===un.bottom&&D.top>T.height+i.offset.y?(y||(i.position.x=en()*T.width,i.initialPosition.x=i.position.x),i.position.y=C.top,i.initialPosition.y=i.position.y):a===un.top&&D.bottom<-i.offset.y&&(y||(i.position.x=en()*T.width,i.initialPosition.x=i.position.x),i.position.y=C.bottom,i.initialPosition.y=i.position.y);break}}break}}}}const Tme=(s,i)=>s.default===i||s.bottom===i||s.left===i||s.right===i||s.top===i;class Rme{constructor(i){this._addUpdaterIfMissing=(a,c,p)=>{const _=a.options.move.outModes;!this.updaters.has(c)&&Tme(_,c)&&this.updaters.set(c,p(this.container))},this._updateOutMode=(a,c,p,_)=>{for(const y of this.updaters.values())y.update(a,_,c,p)},this.container=i,this.updaters=new Map}init(i){this._addUpdaterIfMissing(i,vr.bounce,a=>new Eme(a)),this._addUpdaterIfMissing(i,vr.out,a=>new Sme(a)),this._addUpdaterIfMissing(i,vr.destroy,a=>new yme(a)),this._addUpdaterIfMissing(i,vr.none,a=>new vme(a))}isEnabled(i){return!i.destroyed&&!i.spawning}update(i,a){const c=i.options.move.outModes;this._updateOutMode(i,a,c.bottom??c.default,un.bottom),this._updateOutMode(i,a,c.left??c.default,un.left),this._updateOutMode(i,a,c.right??c.default,un.right),this._updateOutMode(i,a,c.top??c.default,un.top)}}async function wme(s,i=!0){s.checkVersion("3.8.1"),await s.addParticleUpdater("outModes",a=>Promise.resolve(new Rme(a)),i)}var Ug;(function(s){s[s.r=1]="r",s[s.g=2]="g",s[s.b=3]="b",s[s.a=5]="a"})(Ug||(Ug={}));class Cme{constructor(){this.key="rgb",this.stringPrefix="rgb"}handleColor(i){const a=i.value,c=a.rgb??i.value;if(c.r!==void 0)return c}handleRangeColor(i){const a=i.value,c=a.rgb??i.value;if(c.r!==void 0)return{r:nt(c.r),g:nt(c.g),b:nt(c.b)}}parseString(i){if(!i.startsWith(this.stringPrefix))return;const a=/rgba?\(\s*(\d{1,3})\s*[\s,]\s*(\d{1,3})\s*[\s,]\s*(\d{1,3})\s*([\s,]\s*(0|1|0?\.\d+|(\d{1,3})%)\s*)?\)/i,c=a.exec(i),p=10;return c?{a:c.length>4?$8(c[Ug.a]):1,b:parseInt(c[Ug.b],p),g:parseInt(c[Ug.g],p),r:parseInt(c[Ug.r],p)}:void 0}}async function bme(s,i=!0){s.checkVersion("3.8.1"),await s.addColorManager(new Cme,i)}const yp=0;class Ame{init(i){const a=i.container,c=i.options.size,p=c.animation;p.enable&&(i.size.velocity=(i.retina.sizeAnimationSpeed??a.retina.sizeAnimationSpeed)/jr*a.retina.reduceFactor,p.sync||(i.size.velocity*=en()))}isEnabled(i){return!i.destroyed&&!i.spawning&&i.size.enable&&((i.size.maxLoops??yp)<=yp||(i.size.maxLoops??yp)>yp&&(i.size.loops??yp)<(i.size.maxLoops??yp))}reset(i){i.size.loops=yp}update(i,a){this.isEnabled(i)&&Ab(i,i.size,!0,i.options.size.animation.destroy,a)}}async function Ime(s,i=!0){s.checkVersion("3.8.1"),await s.addParticleUpdater("size",()=>Promise.resolve(new Ame),i)}async function Ome(s,i=!0){s.checkVersion("3.8.1"),await dme(s,!1),await pme(s,!1),await bme(s,!1),await Xfe(s,!1),await ime(s,!1),await sme(s,!1),await mme(s,!1),await wme(s,!1),await Ime(s,!1),await s.refresh(i)}async function Nme(s,i=!0){s.checkVersion("3.8.1"),await s.addEasing(Vp.easeInQuad,a=>a**2,!1),await s.addEasing(Vp.easeOutQuad,a=>1-(1-a)**2,!1),await s.addEasing(Vp.easeInOutQuad,a=>a<.5?2*a**2:1-(-2*a+2)**2/2,!1),await s.refresh(i)}function Pme(s,i){const{context:a,opacity:c}=s,p=.5,_=a.globalAlpha;if(!i)return;const y=i.width,T=y*p;a.globalAlpha=c,a.drawImage(i,-T,-T,y,y),a.globalAlpha=_}const mP='"Twemoji Mozilla", Apple Color Emoji, "Segoe UI Emoji", "Noto Color Emoji", "EmojiOne Color"',dG=0;class Dme{constructor(){this.validTypes=["emoji"],this._emojiShapeDict=new Map}destroy(){for(const[i,a]of this._emojiShapeDict)a instanceof ImageBitmap&&(a==null||a.close()),this._emojiShapeDict.delete(i)}draw(i){const a=i.particle.emojiDataKey;if(!a)return;const c=this._emojiShapeDict.get(a);c&&Pme(i,c)}async init(i){const a=i.actualOptions,{validTypes:c}=this;if(!c.find(y=>di(y,a.particles.shape.type)))return;const p=[mD(mP)],_=c.map(y=>a.particles.shape.options[y]).find(y=>!!y);_&&hs(_,y=>{y.font&&p.push(mD(y.font))}),await Promise.all(p)}particleDestroy(i){i.emojiDataKey=void 0}particleInit(i,a){const p=a.shapeData;if(!(p!=null&&p.value))return;const _=su(p.value,a.randomIndexData);if(!_)return;const y=typeof _=="string"?{font:p.font??mP,padding:p.padding??dG,value:_}:{font:mP,padding:dG,...p,..._},T=y.font,C=y.value,I=`${C}_${T}`;if(this._emojiShapeDict.has(I)){a.emojiDataKey=I;return}const D=y.padding*2,L=Wc(a.size.value),j=L+D,Y=j*2;let X;if(typeof OffscreenCanvas<"u"){const ee=new OffscreenCanvas(Y,Y),Q=ee.getContext("2d");if(!Q)return;Q.font=`400 ${L*2}px ${T}`,Q.textBaseline="middle",Q.textAlign="center",Q.fillText(C,j,j),X=ee.transferToImageBitmap()}else{const ee=document.createElement("canvas");ee.width=Y,ee.height=Y;const Q=ee.getContext("2d");if(!Q)return;Q.font=`400 ${L*2}px ${T}`,Q.textBaseline="middle",Q.textAlign="center",Q.fillText(C,j,j),X=ee}this._emojiShapeDict.set(I,X),a.emojiDataKey=I}}async function kme(s,i=!0){s.checkVersion("3.8.1"),await s.addShape(new Dme,i)}const Lme=1,xme=1,mH=0;function gH(s,i,a,c,p,_){const y=i.actualOptions.interactivity.modes.attract;if(!y)return;const T=i.particles.quadTree.query(p,_);for(const C of T){const{dx:I,dy:D,distance:L}=ds(C.position,a),j=y.speed*y.factor,Y=Ha(s.getEasing(y.easing)(xme-L/c)*j,Lme,y.maxSpeed),X=_i.create(L?I/L*Y:j,L?D/L*Y:j);C.position.subFrom(X)}}function Mme(s,i,a){i.attract||(i.attract={particles:[]});const{attract:c}=i;if(c.finish||(c.count||(c.count=0),c.count++,c.count===i.particles.count&&(c.finish=!0)),c.clicking){const p=i.interactivity.mouse.clickPosition,_=i.retina.attractModeDistance;if(!_||_<mH||!p)return;gH(s,i,p,_,new Is(p.x,p.y,_),y=>a(y))}else c.clicking===!1&&(c.particles=[])}function Ume(s,i,a){const c=i.interactivity.mouse.position,p=i.retina.attractModeDistance;!p||p<mH||!c||gH(s,i,c,p,new Is(c.x,c.y,p),_=>a(_))}class Vme{constructor(){this.distance=200,this.duration=.4,this.easing=Vp.easeOutQuad,this.factor=1,this.maxSpeed=50,this.speed=1}load(i){Ke(i)||(i.distance!==void 0&&(this.distance=i.distance),i.duration!==void 0&&(this.duration=i.duration),i.easing!==void 0&&(this.easing=i.easing),i.factor!==void 0&&(this.factor=i.factor),i.maxSpeed!==void 0&&(this.maxSpeed=i.maxSpeed),i.speed!==void 0&&(this.speed=i.speed))}}const tv="attract";let Fme=class extends Ya{constructor(i,a){super(a),this._engine=i,a.attract||(a.attract={particles:[]}),this.handleClickMode=c=>{const p=this.container.actualOptions,_=p.interactivity.modes.attract;if(!(!_||c!==tv)){a.attract||(a.attract={particles:[]}),a.attract.clicking=!0,a.attract.count=0;for(const y of a.attract.particles)this.isEnabled(y)&&y.velocity.setTo(y.initialVelocity);a.attract.particles=[],a.attract.finish=!1,setTimeout(()=>{a.destroyed||(a.attract||(a.attract={particles:[]}),a.attract.clicking=!1)},_.duration*os)}}}clear(){}init(){const i=this.container,a=i.actualOptions.interactivity.modes.attract;a&&(i.retina.attractModeDistance=a.distance*i.retina.pixelRatio)}interact(){const i=this.container,a=i.actualOptions,c=i.interactivity.status===jv,p=a.interactivity.events,{enable:_,mode:y}=p.onHover,{enable:T,mode:C}=p.onClick;c&&_&&di(tv,y)?Ume(this._engine,this.container,I=>this.isEnabled(I)):T&&di(tv,C)&&Mme(this._engine,this.container,I=>this.isEnabled(I))}isEnabled(i){const a=this.container,c=a.actualOptions,p=a.interactivity.mouse,_=((i==null?void 0:i.interactivity)??c.interactivity).events;if((!p.position||!_.onHover.enable)&&(!p.clickPosition||!_.onClick.enable))return!1;const y=_.onHover.mode,T=_.onClick.mode;return di(tv,y)||di(tv,T)}loadModeOptions(i,...a){i.attract||(i.attract=new Vme);for(const c of a)i.attract.load(c==null?void 0:c.attract)}reset(){}};async function Bme(s,i=!0){s.checkVersion("3.8.1"),await s.addInteractor("externalAttract",a=>Promise.resolve(new Fme(s,a)),i)}const jme=2,UC=.5,Gme=Math.PI*UC,hG=2,_H=10,Wme=0;function EH(s,i,a,c,p){const _=s.particles.quadTree.query(c,p);for(const y of _)c instanceof Is?tH(gD(y),{position:i,mass:a**jme*Gme,velocity:_i.origin,factor:_i.origin}):c instanceof xd&&$he(y,zv(i,a))}function zme(s,i,a,c){const p=document.querySelectorAll(i);p.length&&p.forEach(_=>{const y=_,T=s.retina.pixelRatio,C={x:(y.offsetLeft+y.offsetWidth*UC)*T,y:(y.offsetTop+y.offsetHeight*UC)*T},I=y.offsetWidth*UC*T,D=_H*T,L=a.type===Pv.circle?new Is(C.x,C.y,I+D):new xd(y.offsetLeft*T-D,y.offsetTop*T-D,y.offsetWidth*T+D*hG,y.offsetHeight*T+D*hG);c(C,I,L)})}function Hme(s,i,a,c){Sk(a,i,(p,_)=>zme(s,p,_,(y,T,C)=>EH(s,y,T,C,c)))}function Kme(s,i){const a=s.retina.pixelRatio,c=_H*a,p=s.interactivity.mouse.position,_=s.retina.bounceModeDistance;!_||_<Wme||!p||EH(s,p,_,new Is(p.x,p.y,_+c),i)}class qme{constructor(){this.distance=200}load(i){Ke(i)||i.distance!==void 0&&(this.distance=i.distance)}}const yC="bounce";class Yme extends Ya{constructor(i){super(i)}clear(){}init(){const i=this.container,a=i.actualOptions.interactivity.modes.bounce;a&&(i.retina.bounceModeDistance=a.distance*i.retina.pixelRatio)}interact(){const i=this.container,a=i.actualOptions,c=a.interactivity.events,p=i.interactivity.status===jv,_=c.onHover.enable,y=c.onHover.mode,T=c.onDiv;p&&_&&di(yC,y)?Kme(this.container,C=>this.isEnabled(C)):Hme(this.container,T,yC,C=>this.isEnabled(C))}isEnabled(i){const a=this.container,c=a.actualOptions,p=a.interactivity.mouse,_=((i==null?void 0:i.interactivity)??c.interactivity).events,y=_.onDiv;return!!p.position&&_.onHover.enable&&di(yC,_.onHover.mode)||vk(yC,y)}loadModeOptions(i,...a){i.bounce||(i.bounce=new qme);for(const c of a)i.bounce.load(c==null?void 0:c.bounce)}reset(){}}async function Xme(s,i=!0){s.checkVersion("3.8.1"),await s.addInteractor("externalBounce",a=>Promise.resolve(new Yme(a)),i)}class yH{constructor(){this.distance=200,this.duration=.4,this.mix=!1}load(i){if(!Ke(i)){if(i.distance!==void 0&&(this.distance=i.distance),i.duration!==void 0&&(this.duration=i.duration),i.mix!==void 0&&(this.mix=i.mix),i.opacity!==void 0&&(this.opacity=i.opacity),i.color!==void 0){const a=us(this.color)?void 0:this.color;this.color=hs(i.color,c=>Sr.create(a,c))}i.size!==void 0&&(this.size=i.size)}}}class Jme extends yH{constructor(){super(),this.selectors=[]}load(i){super.load(i),!Ke(i)&&i.selectors!==void 0&&(this.selectors=i.selectors)}}class $me extends yH{load(i){super.load(i),!Ke(i)&&(this.divs=hs(i.divs,a=>{const c=new Jme;return c.load(a),c}))}}var jc;(function(s){s.color="color",s.opacity="opacity",s.size="size"})(jc||(jc={}));function pG(s,i,a,c){if(i>=a){const p=s+(i-a)*c;return Ha(p,s,i)}else if(i<a){const p=s-(a-i)*c;return Ha(p,i,s)}}const vp="bubble",gP=0,Qme=0,Zme=2,fG=1,mG=1,ege=0,tge=0,_P=.5,EP=1;class nge extends Ya{constructor(i,a){super(i),this._clickBubble=()=>{var D;const c=this.container,p=c.actualOptions,_=c.interactivity.mouse.clickPosition,y=p.interactivity.modes.bubble;if(!y||!_)return;c.bubble||(c.bubble={});const T=c.retina.bubbleModeDistance;if(!T||T<gP)return;const C=c.particles.quadTree.queryCircle(_,T,L=>this.isEnabled(L)),{bubble:I}=c;for(const L of C){if(!I.clicking)continue;L.bubble.inRange=!I.durationEnd;const j=L.getPosition(),Y=Co(j,_),X=(new Date().getTime()-(c.interactivity.mouse.clickTime??Qme))/os;X>y.duration&&(I.durationEnd=!0),X>y.duration*Zme&&(I.clicking=!1,I.durationEnd=!1);const ee={bubbleObj:{optValue:c.retina.bubbleModeSize,value:L.bubble.radius},particlesObj:{optValue:Wc(L.options.size.value)*c.retina.pixelRatio,value:L.size.value},type:jc.size};this._process(L,Y,X,ee);const Q={bubbleObj:{optValue:y.opacity,value:L.bubble.opacity},particlesObj:{optValue:Wc(L.options.opacity.value),value:((D=L.opacity)==null?void 0:D.value)??fG},type:jc.opacity};this._process(L,Y,X,Q),!I.durationEnd&&Y<=T?this._hoverBubbleColor(L,Y):delete L.bubble.color}},this._hoverBubble=()=>{const c=this.container,p=c.interactivity.mouse.position,_=c.retina.bubbleModeDistance;if(!_||_<gP||!p)return;const y=c.particles.quadTree.queryCircle(p,_,T=>this.isEnabled(T));for(const T of y){T.bubble.inRange=!0;const C=T.getPosition(),I=Co(C,p),D=mG-I/_;I<=_?D>=tge&&c.interactivity.status===jv&&(this._hoverBubbleSize(T,D),this._hoverBubbleOpacity(T,D),this._hoverBubbleColor(T,D)):this.reset(T),c.interactivity.status===khe&&this.reset(T)}},this._hoverBubbleColor=(c,p,_)=>{const y=this.container.actualOptions,T=_??y.interactivity.modes.bubble;if(T){if(!c.bubble.finalColor){const C=T.color;if(!C)return;const I=su(C);c.bubble.finalColor=a_(this._engine,I)}if(c.bubble.finalColor)if(T.mix){c.bubble.color=void 0;const C=c.getFillColor();c.bubble.color=C?rH(Tk(C,c.bubble.finalColor,mG-p,p)):c.bubble.finalColor}else c.bubble.color=c.bubble.finalColor}},this._hoverBubbleOpacity=(c,p,_)=>{var j,Y;const y=this.container,T=y.actualOptions,C=(_==null?void 0:_.opacity)??((j=T.interactivity.modes.bubble)==null?void 0:j.opacity);if(!C)return;const I=c.options.opacity.value,D=((Y=c.opacity)==null?void 0:Y.value)??fG,L=pG(D,C,Wc(I),p);L!==void 0&&(c.bubble.opacity=L)},this._hoverBubbleSize=(c,p,_)=>{const y=this.container,T=_!=null&&_.size?_.size*y.retina.pixelRatio:y.retina.bubbleModeSize;if(T===void 0)return;const C=Wc(c.options.size.value)*y.retina.pixelRatio,I=c.size.value,D=pG(I,T,C,p);D!==void 0&&(c.bubble.radius=D)},this._process=(c,p,_,y)=>{const T=this.container,C=y.bubbleObj.optValue,I=T.actualOptions,D=I.interactivity.modes.bubble;if(!D||C===void 0)return;const L=D.duration,j=T.retina.bubbleModeDistance,Y=y.particlesObj.optValue,X=y.bubbleObj.value,ee=y.particlesObj.value??ege,Q=y.type;if(!(!j||j<gP||C===Y))if(T.bubble||(T.bubble={}),T.bubble.durationEnd)X&&(Q===jc.size&&delete c.bubble.radius,Q===jc.opacity&&delete c.bubble.opacity);else if(p<=j){if((X??ee)!==C){const fe=ee-_*(ee-C)/L;Q===jc.size&&(c.bubble.radius=fe),Q===jc.opacity&&(c.bubble.opacity=fe)}}else Q===jc.size&&delete c.bubble.radius,Q===jc.opacity&&delete c.bubble.opacity},this._singleSelectorHover=(c,p,_)=>{const y=this.container,T=document.querySelectorAll(p),C=y.actualOptions.interactivity.modes.bubble;!C||!T.length||T.forEach(I=>{const D=I,L=y.retina.pixelRatio,j={x:(D.offsetLeft+D.offsetWidth*_P)*L,y:(D.offsetTop+D.offsetHeight*_P)*L},Y=D.offsetWidth*_P*L,X=_.type===Pv.circle?new Is(j.x,j.y,Y):new xd(D.offsetLeft*L,D.offsetTop*L,D.offsetWidth*L,D.offsetHeight*L),ee=y.particles.quadTree.query(X,Q=>this.isEnabled(Q));for(const Q of ee){if(!X.contains(Q.getPosition()))continue;Q.bubble.inRange=!0;const se=C.divs,fe=eH(se,D);(!Q.bubble.div||Q.bubble.div!==D)&&(this.clear(Q,c,!0),Q.bubble.div=D),this._hoverBubbleSize(Q,EP,fe),this._hoverBubbleOpacity(Q,EP,fe),this._hoverBubbleColor(Q,EP,fe)}})},this._engine=a,i.bubble||(i.bubble={}),this.handleClickMode=c=>{c===vp&&(i.bubble||(i.bubble={}),i.bubble.clicking=!0)}}clear(i,a,c){i.bubble.inRange&&!c||(delete i.bubble.div,delete i.bubble.opacity,delete i.bubble.radius,delete i.bubble.color)}init(){const i=this.container,a=i.actualOptions.interactivity.modes.bubble;a&&(i.retina.bubbleModeDistance=a.distance*i.retina.pixelRatio,a.size!==void 0&&(i.retina.bubbleModeSize=a.size*i.retina.pixelRatio))}interact(i){const a=this.container.actualOptions,c=a.interactivity.events,p=c.onHover,_=c.onClick,y=p.enable,T=p.mode,C=_.enable,I=_.mode,D=c.onDiv;y&&di(vp,T)?this._hoverBubble():C&&di(vp,I)?this._clickBubble():Sk(vp,D,(L,j)=>this._singleSelectorHover(i,L,j))}isEnabled(i){const a=this.container,c=a.actualOptions,p=a.interactivity.mouse,_=((i==null?void 0:i.interactivity)??c.interactivity).events,{onClick:y,onDiv:T,onHover:C}=_,I=vk(vp,T);return I||C.enable&&p.position||y.enable&&p.clickPosition?di(vp,C.mode)||di(vp,y.mode)||I:!1}loadModeOptions(i,...a){i.bubble||(i.bubble=new $me);for(const c of a)i.bubble.load(c==null?void 0:c.bubble)}reset(i){i.bubble.inRange=!1}}async function ige(s,i=!0){s.checkVersion("3.8.1"),await s.addInteractor("externalBubble",a=>Promise.resolve(new nge(a,s)),i)}class rge{constructor(){this.opacity=.5}load(i){Ke(i)||i.opacity!==void 0&&(this.opacity=i.opacity)}}class sge{constructor(){this.distance=80,this.links=new rge,this.radius=60}load(i){Ke(i)||(i.distance!==void 0&&(this.distance=i.distance),this.links.load(i.links),i.radius!==void 0&&(this.radius=i.radius))}}const gG=0,_G=1,oge=0;function age(s,i,a,c){const p=Math.floor(a.getRadius()/i.getRadius()),_=i.getFillColor(),y=a.getFillColor();if(!_||!y)return;const T=i.getPosition(),C=a.getPosition(),I=Tk(_,y,i.getRadius(),a.getRadius()),D=s.createLinearGradient(T.x,T.y,C.x,C.y);return D.addColorStop(gG,nb(_,c)),D.addColorStop(Ha(p,gG,_G),Jg(I,c)),D.addColorStop(_G,nb(y,c)),D}function cge(s,i,a,c,p){gv(s,c,p),s.lineWidth=i,s.strokeStyle=a,s.stroke()}function lge(s,i,a,c){const p=s.actualOptions,_=p.interactivity.modes.connect;if(_)return age(i,a,c,_.links.opacity)}function uge(s,i,a){s.canvas.draw(c=>{const p=lge(s,c,i,a);if(!p)return;const _=i.getPosition(),y=a.getPosition();cge(c,i.retina.linksWidth??oge,p,_,y)})}const dge="connect",EG=0;class hge extends Ya{constructor(i){super(i)}clear(){}init(){const i=this.container,a=i.actualOptions.interactivity.modes.connect;a&&(i.retina.connectModeDistance=a.distance*i.retina.pixelRatio,i.retina.connectModeRadius=a.radius*i.retina.pixelRatio)}interact(){const i=this.container;if(i.actualOptions.interactivity.events.onHover.enable&&i.interactivity.status==="pointermove"){const c=i.interactivity.mouse.position,{connectModeDistance:p,connectModeRadius:_}=i.retina;if(!p||p<EG||!_||_<EG||!c)return;const y=Math.abs(_),T=i.particles.quadTree.queryCircle(c,y,C=>this.isEnabled(C));T.forEach((C,I)=>{const D=C.getPosition(),L=1;for(const j of T.slice(I+L)){const Y=j.getPosition(),X=Math.abs(p),ee=Math.abs(D.x-Y.x),Q=Math.abs(D.y-Y.y);ee<X&&Q<X&&uge(i,C,j)}})}}isEnabled(i){const a=this.container,c=a.interactivity.mouse,p=((i==null?void 0:i.interactivity)??a.actualOptions.interactivity).events;return p.onHover.enable&&c.position?di(dge,p.onHover.mode):!1}loadModeOptions(i,...a){i.connect||(i.connect=new sge);for(const c of a)i.connect.load(c==null?void 0:c.connect)}reset(){}}async function pge(s,i=!0){s.checkVersion("3.8.1"),await s.addInteractor("externalConnect",a=>Promise.resolve(new hge(a)),i)}class fge{constructor(){this.blink=!1,this.consent=!1,this.opacity=1}load(i){Ke(i)||(i.blink!==void 0&&(this.blink=i.blink),i.color!==void 0&&(this.color=Sr.create(this.color,i.color)),i.consent!==void 0&&(this.consent=i.consent),i.opacity!==void 0&&(this.opacity=i.opacity))}}class mge{constructor(){this.distance=100,this.links=new fge}load(i){Ke(i)||(i.distance!==void 0&&(this.distance=i.distance),this.links.load(i.links))}}const gge=0;function _ge(s,i,a,c,p,_){gv(s,a,c),s.strokeStyle=Jg(p,_),s.lineWidth=i,s.stroke()}function Ege(s,i,a,c,p){s.canvas.draw(_=>{const y=i.getPosition();_ge(_,i.retina.linksWidth??gge,y,p,a,c)})}const yge="grab",vge=0,Sge=0;class Tge extends Ya{constructor(i,a){super(i),this._engine=a}clear(){}init(){const i=this.container,a=i.actualOptions.interactivity.modes.grab;a&&(i.retina.grabModeDistance=a.distance*i.retina.pixelRatio)}interact(){var T;const i=this.container,a=i.actualOptions,c=a.interactivity;if(!c.modes.grab||!c.events.onHover.enable||i.interactivity.status!==jv)return;const p=i.interactivity.mouse.position;if(!p)return;const _=i.retina.grabModeDistance;if(!_||_<vge)return;const y=i.particles.quadTree.queryCircle(p,_,C=>this.isEnabled(C));for(const C of y){const I=C.getPosition(),D=Co(I,p);if(D>_)continue;const L=c.modes.grab.links,j=L.opacity,Y=j-D*j/_;if(Y<=Sge)continue;const X=L.color??((T=C.options.links)==null?void 0:T.color);if(!i.particles.grabLineColor&&X){const Q=c.modes.grab.links;i.particles.grabLineColor=oH(this._engine,X,Q.blink,Q.consent)}const ee=_D(C,void 0,i.particles.grabLineColor);ee&&Ege(i,C,ee,Y,p)}}isEnabled(i){const a=this.container,c=a.interactivity.mouse,p=((i==null?void 0:i.interactivity)??a.actualOptions.interactivity).events;return p.onHover.enable&&!!c.position&&di(yge,p.onHover.mode)}loadModeOptions(i,...a){i.grab||(i.grab=new mge);for(const c of a)i.grab.load(c==null?void 0:c.grab)}reset(){}}async function Rge(s,i=!0){s.checkVersion("3.8.1"),await s.addInteractor("externalGrab",a=>Promise.resolve(new Tge(a,s)),i)}const wge="pause";class Cge extends Ya{constructor(i){super(i),this.handleClickMode=a=>{if(a!==wge)return;const c=this.container;c.animationStatus?c.pause():c.play()}}clear(){}init(){}interact(){}isEnabled(){return!0}reset(){}}async function bge(s,i=!0){s.checkVersion("3.8.1"),await s.addInteractor("externalPause",a=>Promise.resolve(new Cge(a)),i)}class Age{constructor(){this.default=!0,this.groups=[],this.quantity=4}load(i){if(Ke(i))return;i.default!==void 0&&(this.default=i.default),i.groups!==void 0&&(this.groups=i.groups.map(c=>c)),this.groups.length||(this.default=!0);const a=i.quantity;a!==void 0&&(this.quantity=At(a))}}const Ige="push",Oge=0;class Nge extends Ya{constructor(i){super(i),this.handleClickMode=a=>{if(a!==Ige)return;const c=this.container,p=c.actualOptions,_=p.interactivity.modes.push;if(!_)return;const y=nt(_.quantity);if(y<=Oge)return;const T=Gv([void 0,..._.groups]),C=T!==void 0?c.actualOptions.particles.groups[T]:void 0;c.particles.push(y,c.interactivity.mouse,C,T)}}clear(){}init(){}interact(){}isEnabled(){return!0}loadModeOptions(i,...a){i.push||(i.push=new Age);for(const c of a)i.push.load(c==null?void 0:c.push)}reset(){}}async function Pge(s,i=!0){s.checkVersion("3.8.1"),await s.addInteractor("externalPush",a=>Promise.resolve(new Nge(a)),i)}class Dge{constructor(){this.quantity=2}load(i){if(Ke(i))return;const a=i.quantity;a!==void 0&&(this.quantity=At(a))}}const kge="remove";class Lge extends Ya{constructor(i){super(i),this.handleClickMode=a=>{const c=this.container,p=c.actualOptions;if(!p.interactivity.modes.remove||a!==kge)return;const _=nt(p.interactivity.modes.remove.quantity);c.particles.removeQuantity(_)}}clear(){}init(){}interact(){}isEnabled(){return!0}loadModeOptions(i,...a){i.remove||(i.remove=new Dge);for(const c of a)i.remove.load(c==null?void 0:c.remove)}reset(){}}async function xge(s,i=!0){s.checkVersion("3.8.1"),await s.addInteractor("externalRemove",a=>Promise.resolve(new Lge(a)),i)}class vH{constructor(){this.distance=200,this.duration=.4,this.factor=100,this.speed=1,this.maxSpeed=50,this.easing=Vp.easeOutQuad}load(i){Ke(i)||(i.distance!==void 0&&(this.distance=i.distance),i.duration!==void 0&&(this.duration=i.duration),i.easing!==void 0&&(this.easing=i.easing),i.factor!==void 0&&(this.factor=i.factor),i.speed!==void 0&&(this.speed=i.speed),i.maxSpeed!==void 0&&(this.maxSpeed=i.maxSpeed))}}class Mge extends vH{constructor(){super(),this.selectors=[]}load(i){super.load(i),!Ke(i)&&i.selectors!==void 0&&(this.selectors=i.selectors)}}class Uge extends vH{load(i){super.load(i),!Ke(i)&&(this.divs=hs(i.divs,a=>{const c=new Mge;return c.load(a),c}))}}const Sp="repulse",Vge=0,Fge=6,Bge=3,jge=2,Gge=0,Wge=0,zge=1,yP=.5;class Hge extends Ya{constructor(i,a){super(a),this._clickRepulse=()=>{const c=this.container,p=c.actualOptions.interactivity.modes.repulse;if(!p)return;const _=c.repulse??{particles:[]};if(_.finish||(_.count||(_.count=0),_.count++,_.count===c.particles.count&&(_.finish=!0)),_.clicking){const y=c.retina.repulseModeDistance;if(!y||y<Vge)return;const T=Math.pow(y/Fge,Bge),C=c.interactivity.mouse.clickPosition;if(C===void 0)return;const I=new Is(C.x,C.y,T),D=c.particles.quadTree.query(I,L=>this.isEnabled(L));for(const L of D){const{dx:j,dy:Y,distance:X}=ds(C,L.position),ee=X**jge,Q=p.speed,se=-T*Q/ee;if(ee<=T){_.particles.push(L);const fe=_i.create(j,Y);fe.length=se,L.velocity.setTo(fe)}}}else if(_.clicking===!1){for(const y of _.particles)y.velocity.setTo(y.initialVelocity);_.particles=[]}},this._hoverRepulse=()=>{const c=this.container,p=c.interactivity.mouse.position,_=c.retina.repulseModeDistance;!_||_<Gge||!p||this._processRepulse(p,_,new Is(p.x,p.y,_))},this._processRepulse=(c,p,_,y)=>{const T=this.container,C=T.particles.quadTree.query(_,Q=>this.isEnabled(Q)),I=T.actualOptions.interactivity.modes.repulse;if(!I)return;const{easing:D,speed:L,factor:j,maxSpeed:Y}=I,X=this._engine.getEasing(D),ee=((y==null?void 0:y.speed)??L)*j;for(const Q of C){const{dx:se,dy:fe,distance:me}=ds(Q.position,c),Oe=Ha(X(zge-me/p)*ee,Wge,Y),Ve=_i.create(me?se/me*Oe:ee,me?fe/me*Oe:ee);Q.position.addTo(Ve)}},this._singleSelectorRepulse=(c,p)=>{const _=this.container,y=_.actualOptions.interactivity.modes.repulse;if(!y)return;const T=document.querySelectorAll(c);T.length&&T.forEach(C=>{const I=C,D=_.retina.pixelRatio,L={x:(I.offsetLeft+I.offsetWidth*yP)*D,y:(I.offsetTop+I.offsetHeight*yP)*D},j=I.offsetWidth*yP*D,Y=p.type===Pv.circle?new Is(L.x,L.y,j):new xd(I.offsetLeft*D,I.offsetTop*D,I.offsetWidth*D,I.offsetHeight*D),X=y.divs,ee=eH(X,I);this._processRepulse(L,j,Y,ee)})},this._engine=i,a.repulse||(a.repulse={particles:[]}),this.handleClickMode=c=>{const p=this.container.actualOptions,_=p.interactivity.modes.repulse;if(!_||c!==Sp)return;a.repulse||(a.repulse={particles:[]});const y=a.repulse;y.clicking=!0,y.count=0;for(const T of a.repulse.particles)this.isEnabled(T)&&T.velocity.setTo(T.initialVelocity);y.particles=[],y.finish=!1,setTimeout(()=>{a.destroyed||(y.clicking=!1)},_.duration*os)}}clear(){}init(){const i=this.container,a=i.actualOptions.interactivity.modes.repulse;a&&(i.retina.repulseModeDistance=a.distance*i.retina.pixelRatio)}interact(){const i=this.container,a=i.actualOptions,c=i.interactivity.status===jv,p=a.interactivity.events,_=p.onHover,y=_.enable,T=_.mode,C=p.onClick,I=C.enable,D=C.mode,L=p.onDiv;c&&y&&di(Sp,T)?this._hoverRepulse():I&&di(Sp,D)?this._clickRepulse():Sk(Sp,L,(j,Y)=>this._singleSelectorRepulse(j,Y))}isEnabled(i){const a=this.container,c=a.actualOptions,p=a.interactivity.mouse,_=((i==null?void 0:i.interactivity)??c.interactivity).events,y=_.onDiv,T=_.onHover,C=_.onClick,I=vk(Sp,y);if(!(I||T.enable&&p.position||C.enable&&p.clickPosition))return!1;const D=T.mode,L=C.mode;return di(Sp,D)||di(Sp,L)||I}loadModeOptions(i,...a){i.repulse||(i.repulse=new Uge);for(const c of a)i.repulse.load(c==null?void 0:c.repulse)}reset(){}}async function Kge(s,i=!0){s.checkVersion("3.8.1"),await s.addInteractor("externalRepulse",a=>Promise.resolve(new Hge(s,a)),i)}class qge{constructor(){this.factor=3,this.radius=200}load(i){Ke(i)||(i.factor!==void 0&&(this.factor=i.factor),i.radius!==void 0&&(this.radius=i.radius))}}const Yge="slow",Xge=0;class Jge extends Ya{constructor(i){super(i)}clear(i,a,c){i.slow.inRange&&!c||(i.slow.factor=1)}init(){const i=this.container,a=i.actualOptions.interactivity.modes.slow;a&&(i.retina.slowModeRadius=a.radius*i.retina.pixelRatio)}interact(){}isEnabled(i){const a=this.container,c=a.interactivity.mouse,p=((i==null?void 0:i.interactivity)??a.actualOptions.interactivity).events;return p.onHover.enable&&!!c.position&&di(Yge,p.onHover.mode)}loadModeOptions(i,...a){i.slow||(i.slow=new qge);for(const c of a)i.slow.load(c==null?void 0:c.slow)}reset(i){i.slow.inRange=!1;const a=this.container,c=a.actualOptions,p=a.interactivity.mouse.position,_=a.retina.slowModeRadius,y=c.interactivity.modes.slow;if(!y||!_||_<Xge||!p)return;const T=i.getPosition(),C=Co(p,T),I=C/_,D=y.factor,{slow:L}=i;C>_||(L.inRange=!0,L.factor=I/D)}}async function $ge(s,i=!0){s.checkVersion("3.8.1"),await s.addInteractor("externalSlow",a=>Promise.resolve(new Jge(a)),i)}const Qge=0,Zge=1,e_e=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d.]+%?\))|currentcolor/gi;function t_e(s,i,a){const{svgData:c}=s;if(!c)return"";const p=nb(i,a);if(c.includes("fill"))return c.replace(e_e,()=>p);const _=c.indexOf(">");return`${c.substring(Qge,_)} fill="${p}"${c.substring(_)}`}async function Ib(s){return new Promise(i=>{s.loading=!0;const a=new Image;s.element=a,a.addEventListener("load",()=>{s.loading=!1,i()}),a.addEventListener("error",()=>{s.element=void 0,s.error=!0,s.loading=!1,Q8().error(`${Yg} loading image: ${s.source}`),i()}),a.src=s.source})}async function n_e(s){if(s.type!=="svg"){await Ib(s);return}s.loading=!0;const i=await fetch(s.source);i.ok?s.svgData=await i.text():(Q8().error(`${Yg} Image not found`),s.error=!0),s.loading=!1}function i_e(s,i,a,c){var y;const p=t_e(s,a,((y=c.opacity)==null?void 0:y.value)??Zge),_={color:a,gif:i.gif,data:{...s,svgData:p},loaded:!1,ratio:i.width/i.height,replaceColor:i.replaceColor,source:i.src};return new Promise(T=>{const C=new Blob([p],{type:"image/svg+xml"}),I=URL||window.URL||window.webkitURL||window,D=I.createObjectURL(C),L=new Image;L.addEventListener("load",()=>{_.loaded=!0,_.element=L,T(_),I.revokeObjectURL(D)});const j=async()=>{I.revokeObjectURL(D);const Y={...s,error:!1,loading:!0};await Ib(Y),_.loaded=!0,_.element=Y.element,T(_)};L.addEventListener("error",()=>void j()),L.src=D})}const vP=[0,4,2,1],yG=[8,8,4,2];class r_e{constructor(i){this.pos=0,this.data=new Uint8ClampedArray(i)}getString(i){const a=this.data.slice(this.pos,this.pos+i);return this.pos+=a.length,a.reduce((c,p)=>c+String.fromCharCode(p),"")}nextByte(){return this.data[this.pos++]}nextTwoBytes(){return this.pos+=2,this.data[this.pos-2]+(this.data[this.pos-1]<<8)}readSubBlocks(){let i="",a=0;const c=0,p=0;do{a=this.data[this.pos++];for(let _=a;--_>=c;i+=String.fromCharCode(this.data[this.pos++]));}while(a!==p);return i}readSubBlocksBin(){let i=this.data[this.pos],a=0;const c=0,p=1;for(let y=0;i!==c;y+=i+p,i=this.data[this.pos+y])a+=i;const _=new Uint8Array(a);i=this.data[this.pos++];for(let y=0;i!==c;i=this.data[this.pos++])for(let T=i;--T>=c;_[y++]=this.data[this.pos++]);return _}skipSubBlocks(){for(const i=1,a=0;this.data[this.pos]!==a;this.pos+=this.data[this.pos]+i);this.pos++}}var Ga;(function(s){s[s.Replace=0]="Replace",s[s.Combine=1]="Combine",s[s.RestoreBackground=2]="RestoreBackground",s[s.RestorePrevious=3]="RestorePrevious",s[s.UndefinedA=4]="UndefinedA",s[s.UndefinedB=5]="UndefinedB",s[s.UndefinedC=6]="UndefinedC",s[s.UndefinedD=7]="UndefinedD"})(Ga||(Ga={}));var eu;(function(s){s[s.Extension=33]="Extension",s[s.ApplicationExtension=255]="ApplicationExtension",s[s.GraphicsControlExtension=249]="GraphicsControlExtension",s[s.PlainTextExtension=1]="PlainTextExtension",s[s.CommentExtension=254]="CommentExtension",s[s.Image=44]="Image",s[s.EndOfFile=59]="EndOfFile"})(eu||(eu={}));const no={x:0,y:0},s_e=0,vG=.5,o_e=0,SG=0,SD=0;function SH(s,i){const a=[];for(let c=0;c<i;c++)a.push({r:s.data[s.pos],g:s.data[s.pos+1],b:s.data[s.pos+2]}),s.pos+=3;return a}function a_e(s,i,a,c){switch(s.nextByte()){case eu.GraphicsControlExtension:{const p=i.frames[a(!1)];s.pos++;const _=s.nextByte();p.GCreserved=(_&224)>>>5,p.disposalMethod=(_&28)>>>2,p.userInputDelayFlag=(_&2)===2;const y=(_&1)===1;p.delayTime=s.nextTwoBytes()*10;const T=s.nextByte();y&&c(T),s.pos++;break}case eu.ApplicationExtension:{s.pos++;const p={identifier:s.getString(8),authenticationCode:s.getString(3),data:s.readSubBlocksBin()};i.applicationExtensions.push(p);break}case eu.CommentExtension:{i.comments.push([a(!1),s.readSubBlocks()]);break}case eu.PlainTextExtension:{if(i.globalColorTable.length===0)throw new EvalError("plain text extension without global color table");s.pos++,i.frames[a(!1)].plainTextData={left:s.nextTwoBytes(),top:s.nextTwoBytes(),width:s.nextTwoBytes(),height:s.nextTwoBytes(),charSize:{width:s.nextTwoBytes(),height:s.nextTwoBytes()},foregroundColor:s.nextByte(),backgroundColor:s.nextByte(),text:s.readSubBlocks()};break}default:s.skipSubBlocks();break}}async function c_e(s,i,a,c,p,_){const y=i.frames[c(!0)];y.left=s.nextTwoBytes(),y.top=s.nextTwoBytes(),y.width=s.nextTwoBytes(),y.height=s.nextTwoBytes();const T=s.nextByte(),C=(T&128)===128,I=(T&64)===64;y.sortFlag=(T&32)===32,y.reserved=(T&24)>>>3;const D=1<<(T&7)+1;C&&(y.localColorTable=SH(s,D));const L=se=>{const{r:fe,g:me,b:Oe}=(C?y.localColorTable:i.globalColorTable)[se];return se!==p(null)?{r:fe,g:me,b:Oe,a:255}:{r:fe,g:me,b:Oe,a:a?~~((fe+me+Oe)/3):0}},j=(()=>{try{return new ImageData(y.width,y.height,{colorSpace:"srgb"})}catch(se){if(se instanceof DOMException&&se.name==="IndexSizeError")return null;throw se}})();if(j==null)throw new EvalError("GIF frame size is to large");const Y=s.nextByte(),X=s.readSubBlocksBin(),ee=1<<Y,Q=(se,fe)=>{const me=se>>>3,Oe=se&7;return(X[me]+(X[me+1]<<8)+(X[me+2]<<16)&(1<<fe)-1<<Oe)>>>Oe};if(I){for(let se=0,fe=Y+1,me=0,Oe=[[0]],Ve=0;Ve<4;Ve++)if(vP[Ve]<y.height){let Ze=0,ut=0,rt=!1;for(;!rt;){const dn=se;if(se=Q(me,fe),me+=fe+1,se===ee){fe=Y+1,Oe.length=ee+2;for(let tn=0;tn<Oe.length;tn++)Oe[tn]=tn<ee?[tn]:[]}else{se>=Oe.length?Oe.push(Oe[dn].concat(Oe[dn][0])):dn!==ee&&Oe.push(Oe[dn].concat(Oe[se][0]));for(const tn of Oe[se]){const{r:bi,g:Ai,b:Qi,a:qt}=L(tn);j.data.set([bi,Ai,Qi,qt],vP[Ve]*y.width+yG[Ve]*ut+Ze%(y.width*4)),Ze+=4}Oe.length===1<<fe&&fe<12&&fe++}Ze===y.width*4*(ut+1)&&(ut++,vP[Ve]+yG[Ve]*ut>=y.height&&(rt=!0))}}y.image=j,y.bitmap=await createImageBitmap(j)}else{let se=0,fe=Y+1,me=0,Oe=-4,Ve=!1;const Ze=[[0]];for(;!Ve;){const ut=se;if(se=Q(me,fe),me+=fe,se===ee){fe=Y+1,Ze.length=ee+2;for(let rt=0;rt<Ze.length;rt++)Ze[rt]=rt<ee?[rt]:[]}else{if(se===ee+1){Ve=!0;break}se>=Ze.length?Ze.push(Ze[ut].concat(Ze[ut][0])):ut!==ee&&Ze.push(Ze[ut].concat(Ze[se][0]));for(const rt of Ze[se]){const{r:dn,g:tn,b:bi,a:Ai}=L(rt);j.data.set([dn,tn,bi,Ai],Oe+=4)}Ze.length>=1<<fe&&fe<12&&fe++}}y.image=j,y.bitmap=await createImageBitmap(j)}}async function l_e(s,i,a,c,p,_){switch(s.nextByte()){case eu.EndOfFile:return!0;case eu.Image:await c_e(s,i,a,c,p);break;case eu.Extension:a_e(s,i,c,p);break;default:throw new EvalError("undefined block found")}return!1}function u_e(s){for(const i of s.applicationExtensions)if(i.identifier+i.authenticationCode==="NETSCAPE2.0")return i.data[1]+(i.data[2]<<8);return NaN}async function d_e(s,i,a){a||(a=!1);const c=await fetch(s);if(!c.ok&&c.status===404)throw new EvalError("file not found");const p=await c.arrayBuffer(),_={width:0,height:0,totalTime:0,colorRes:0,pixelAspectRatio:0,frames:[],sortFlag:!1,globalColorTable:[],backgroundImage:new ImageData(1,1,{colorSpace:"srgb"}),comments:[],applicationExtensions:[]},y=new r_e(new Uint8ClampedArray(p));if(y.getString(6)!=="GIF89a")throw new Error("not a supported GIF file");_.width=y.nextTwoBytes(),_.height=y.nextTwoBytes();const T=y.nextByte(),C=(T&128)===128;_.colorRes=(T&112)>>>4,_.sortFlag=(T&8)===8;const I=1<<(T&7)+1,D=y.nextByte();_.pixelAspectRatio=y.nextByte(),_.pixelAspectRatio!==0&&(_.pixelAspectRatio=(_.pixelAspectRatio+15)/64),C&&(_.globalColorTable=SH(y,I));const L=(()=>{try{return new ImageData(_.width,_.height,{colorSpace:"srgb"})}catch(Oe){if(Oe instanceof DOMException&&Oe.name==="IndexSizeError")return null;throw Oe}})();if(L==null)throw new Error("GIF frame size is to large");const{r:j,g:Y,b:X}=_.globalColorTable[D];L.data.set(C?[j,Y,X,255]:[0,0,0,0]);for(let Oe=4;Oe<L.data.length;Oe*=2)L.data.copyWithin(Oe,0,Oe);_.backgroundImage=L;let ee=-1,Q=!0,se=-1;const fe=Oe=>(Oe&&(Q=!0),ee),me=Oe=>(Oe!=null&&(se=Oe),se);try{do Q&&(_.frames.push({left:0,top:0,width:0,height:0,disposalMethod:Ga.Replace,image:new ImageData(1,1,{colorSpace:"srgb"}),plainTextData:null,userInputDelayFlag:!1,delayTime:0,sortFlag:!1,localColorTable:[],reserved:0,GCreserved:0}),ee++,se=-1,Q=!1);while(!await l_e(y,_,a,fe,me,i));_.frames.length--;for(const Oe of _.frames){if(Oe.userInputDelayFlag&&Oe.delayTime===0){_.totalTime=1/0;break}_.totalTime+=Oe.delayTime}return _}catch(Oe){throw Oe instanceof EvalError?new Error(`error while parsing frame ${ee} "${Oe.message}"`):Oe}}function h_e(s){const{context:i,radius:a,particle:c,delta:p}=s,_=c.image;if(!(_!=null&&_.gifData)||!_.gif)return;const y=new OffscreenCanvas(_.gifData.width,_.gifData.height),T=y.getContext("2d");if(!T)throw new Error("could not create offscreen canvas context");T.imageSmoothingQuality="low",T.imageSmoothingEnabled=!1,T.clearRect(no.x,no.y,y.width,y.height),c.gifLoopCount===void 0&&(c.gifLoopCount=_.gifLoopCount??SD);let C=c.gifFrame??s_e;const I={x:-_.gifData.width*vG,y:-_.gifData.height*vG},D=_.gifData.frames[C];if(c.gifTime===void 0&&(c.gifTime=o_e),!!D.bitmap){switch(i.scale(a/_.gifData.width,a/_.gifData.height),D.disposalMethod){case Ga.UndefinedA:case Ga.UndefinedB:case Ga.UndefinedC:case Ga.UndefinedD:case Ga.Replace:T.drawImage(D.bitmap,D.left,D.top),i.drawImage(y,I.x,I.y),T.clearRect(no.x,no.y,y.width,y.height);break;case Ga.Combine:T.drawImage(D.bitmap,D.left,D.top),i.drawImage(y,I.x,I.y);break;case Ga.RestoreBackground:T.drawImage(D.bitmap,D.left,D.top),i.drawImage(y,I.x,I.y),T.clearRect(no.x,no.y,y.width,y.height),_.gifData.globalColorTable.length?T.putImageData(_.gifData.backgroundImage,I.x,I.y):T.putImageData(_.gifData.frames[SG].image,I.x+D.left,I.y+D.top);break;case Ga.RestorePrevious:{const L=T.getImageData(no.x,no.y,y.width,y.height);T.drawImage(D.bitmap,D.left,D.top),i.drawImage(y,I.x,I.y),T.clearRect(no.x,no.y,y.width,y.height),T.putImageData(L,no.x,no.y)}break}if(c.gifTime+=p.value,c.gifTime>D.delayTime){if(c.gifTime-=D.delayTime,++C>=_.gifData.frames.length){if(--c.gifLoopCount<=SD)return;C=SG,T.clearRect(no.x,no.y,y.width,y.height)}c.gifFrame=C}i.scale(_.gifData.width/a,_.gifData.height/a)}}async function p_e(s){if(s.type!=="gif"){await Ib(s);return}s.loading=!0;try{s.gifData=await d_e(s.source),s.gifLoopCount=u_e(s.gifData)??SD,s.gifLoopCount||(s.gifLoopCount=1/0)}catch{s.error=!0}s.loading=!1}const f_e=2,m_e=1,g_e=12,__e=1;class E_e{constructor(i){this.validTypes=["image","images"],this.loadImageShape=async a=>{if(!this._engine.loadImage)throw new Error(`${Yg} image shape not initialized`);await this._engine.loadImage({gif:a.gif,name:a.name,replaceColor:a.replaceColor??!1,src:a.src})},this._engine=i}addImage(i){this._engine.images||(this._engine.images=[]),this._engine.images.push(i)}draw(i){const{context:a,radius:c,particle:p,opacity:_}=i,y=p.image,T=y==null?void 0:y.element;if(y){if(a.globalAlpha=_,y.gif&&y.gifData)h_e(i);else if(T){const C=y.ratio,I={x:-c,y:-c},D=c*f_e;a.drawImage(T,I.x,I.y,D,D/C)}a.globalAlpha=m_e}}getSidesCount(){return g_e}async init(i){const a=i.actualOptions;if(!(!a.preload||!this._engine.loadImage))for(const c of a.preload)await this._engine.loadImage(c)}loadShape(i){if(i.shape!=="image"&&i.shape!=="images")return;this._engine.images||(this._engine.images=[]);const a=i.shapeData;if(!a)return;this._engine.images.find(p=>p.name===a.name||p.source===a.src)||this.loadImageShape(a).then(()=>{this.loadShape(i)})}particleInit(i,a){if(a.shape!=="image"&&a.shape!=="images")return;this._engine.images||(this._engine.images=[]);const c=this._engine.images,p=a.shapeData;if(!p)return;const _=a.getFillColor(),y=c.find(C=>C.name===p.name||C.source===p.src);if(!y)return;const T=p.replaceColor??y.replaceColor;if(y.loading){setTimeout(()=>{this.particleInit(i,a)});return}(async()=>{let C;y.svgData&&_?C=await i_e(y,p,_,a):C={color:_,data:y,element:y.element,gif:y.gif,gifData:y.gifData,gifLoopCount:y.gifLoopCount,loaded:!0,ratio:p.width&&p.height?p.width/p.height:y.ratio??__e,replaceColor:T,source:p.src},C.ratio||(C.ratio=1);const I=p.fill??a.shapeFill,D=p.close??a.shapeClose,L={image:C,fill:I,close:D};a.image=L.image,a.shapeFill=L.fill,a.shapeClose=L.close})()}}class y_e{constructor(){this.src="",this.gif=!1}load(i){Ke(i)||(i.gif!==void 0&&(this.gif=i.gif),i.height!==void 0&&(this.height=i.height),i.name!==void 0&&(this.name=i.name),i.replaceColor!==void 0&&(this.replaceColor=i.replaceColor),i.src!==void 0&&(this.src=i.src),i.width!==void 0&&(this.width=i.width))}}class v_e{constructor(i){this.id="imagePreloader",this._engine=i}async getPlugin(){return await Promise.resolve(),{}}loadOptions(i,a){if(!(a!=null&&a.preload))return;i.preload||(i.preload=[]);const c=i.preload;for(const p of a.preload){const _=c.find(y=>y.name===p.name||y.src===p.src);if(_)_.load(p);else{const y=new y_e;y.load(p),c.push(y)}}}needsPlugin(){return!0}}const S_e=3;function T_e(s){s.loadImage||(s.loadImage=async i=>{if(!i.name&&!i.src)throw new Error(`${Yg} no image source provided`);if(s.images||(s.images=[]),!s.images.find(a=>a.name===i.name||a.source===i.src))try{const a={gif:i.gif??!1,name:i.name??i.src,source:i.src,type:i.src.substring(i.src.length-S_e),error:!1,loading:!0,replaceColor:i.replaceColor,ratio:i.width&&i.height?i.width/i.height:void 0};s.images.push(a);let c;i.gif?c=p_e:c=i.replaceColor?n_e:Ib,await c(a)}catch{throw new Error(`${Yg} ${i.name??i.src} not found`)}})}async function R_e(s,i=!0){s.checkVersion("3.8.1"),T_e(s);const a=new v_e(s);await s.addPlugin(a,i),await s.addShape(new E_e(s),i)}class w_e extends qa{constructor(){super(),this.sync=!1}load(i){Ke(i)||(super.load(i),i.sync!==void 0&&(this.sync=i.sync))}}class C_e extends qa{constructor(){super(),this.sync=!1}load(i){Ke(i)||(super.load(i),i.sync!==void 0&&(this.sync=i.sync))}}class b_e{constructor(){this.count=0,this.delay=new w_e,this.duration=new C_e}load(i){Ke(i)||(i.count!==void 0&&(this.count=i.count),this.delay.load(i.delay),this.duration.load(i.duration))}}const wg=0,A_e=-1,TG=0,RG=0;function I_e(s,i,a){if(!s.life)return;const c=s.life;let p=!1;if(s.spawning)if(c.delayTime+=i.value,c.delayTime>=s.life.delay)p=!0,s.spawning=!1,c.delayTime=wg,c.time=wg;else return;if(c.duration===A_e||s.spawning||(p?c.time=wg:c.time+=i.value,c.time<c.duration))return;if(c.time=wg,s.life.count>TG&&s.life.count--,s.life.count===TG){s.destroy();return}const _=At(RG,a.width),y=At(RG,a.width);s.position.x=cs(_),s.position.y=cs(y),s.spawning=!0,c.delayTime=wg,c.time=wg,s.reset();const T=s.options.life;T&&(c.delay=nt(T.delay.value)*os,c.duration=nt(T.duration.value)*os)}const Tp=0,wG=1,CG=-1;class O_e{constructor(i){this.container=i}init(i){const a=this.container,c=i.options,p=c.life;p&&(i.life={delay:a.retina.reduceFactor?nt(p.delay.value)*(p.delay.sync?wG:en())/a.retina.reduceFactor*os:Tp,delayTime:Tp,duration:a.retina.reduceFactor?nt(p.duration.value)*(p.duration.sync?wG:en())/a.retina.reduceFactor*os:Tp,time:Tp,count:p.count},i.life.duration<=Tp&&(i.life.duration=CG),i.life.count<=Tp&&(i.life.count=CG),i.life&&(i.spawning=i.life.delay>Tp))}isEnabled(i){return!i.destroyed}loadOptions(i,...a){i.life||(i.life=new b_e);for(const c of a)i.life.load(c==null?void 0:c.life)}update(i,a){!this.isEnabled(i)||!i.life||I_e(i,a,this.container.canvas.size)}}async function N_e(s,i=!0){s.checkVersion("3.8.1"),await s.addParticleUpdater("life",async a=>Promise.resolve(new O_e(a)),i)}function P_e(s){const{context:i,particle:a,radius:c}=s,p=a.shapeData,_=0;i.moveTo(-c,_),i.lineTo(c,_),i.lineCap=(p==null?void 0:p.cap)??"butt"}const D_e=1;class k_e{constructor(){this.validTypes=["line"]}draw(i){P_e(i)}getSidesCount(){return D_e}}async function L_e(s,i=!0){s.checkVersion("3.8.1"),await s.addShape(new k_e,i)}const bG=.5;class x_e{init(){}isEnabled(i){return!H6()&&!i.destroyed&&i.container.actualOptions.interactivity.events.onHover.parallax.enable}move(i){const a=i.container,c=a.actualOptions,p=c.interactivity.events.onHover.parallax;if(H6()||!p.enable)return;const _=p.force,y=a.interactivity.mouse.position;if(!y)return;const T=a.canvas.size,C={x:T.width*bG,y:T.height*bG},I=p.smooth,D=i.getRadius()/_,L={x:(y.x-C.x)*D,y:(y.y-C.y)*D},{offset:j}=i;j.x+=(L.x-j.x)/I,j.y+=(L.y-j.y)/I}}async function M_e(s,i=!0){s.checkVersion("3.8.1"),await s.addMover("parallax",()=>Promise.resolve(new x_e),i)}const AG=1e3,U_e=1;class V_e extends Ck{constructor(i){super(i)}clear(){}init(){}interact(i){const a=this.container;i.attractDistance===void 0&&(i.attractDistance=nt(i.options.move.attract.distance)*a.retina.pixelRatio);const c=i.attractDistance,p=i.getPosition(),_=a.particles.quadTree.queryCircle(p,c);for(const y of _){if(i===y||!y.options.move.attract.enable||y.destroyed||y.spawning)continue;const T=y.getPosition(),{dx:C,dy:I}=ds(p,T),D=i.options.move.attract.rotate,L=C/(D.x*AG),j=I/(D.y*AG),Y=y.size.value/i.size.value,X=U_e/Y;i.velocity.x-=L*Y,i.velocity.y-=j*Y,y.velocity.x+=L*X,y.velocity.y+=j*X}}isEnabled(i){return i.options.move.attract.enable}reset(){}}async function F_e(s,i=!0){s.checkVersion("3.8.1"),await s.addInteractor("particlesAttract",a=>Promise.resolve(new V_e(a)),i)}const B_e=.5,j_e=10,G_e=0;function IG(s,i,a,c,p,_){const y=Ha(s.options.collisions.absorb.speed*p.factor/j_e,G_e,c);s.size.value+=y*B_e,a.size.value-=y,c<=_&&(a.size.value=0,a.destroy())}function W_e(s,i,a,c){const p=s.getRadius(),_=i.getRadius();p===void 0&&_!==void 0?s.destroy():p!==void 0&&_===void 0?i.destroy():p!==void 0&&_!==void 0&&(p>=_?IG(s,p,i,_,a,c):IG(i,_,s,p,a,c))}const OG=s=>{s.collisionMaxSpeed===void 0&&(s.collisionMaxSpeed=nt(s.options.collisions.maxSpeed)),s.velocity.length>s.collisionMaxSpeed&&(s.velocity.length=s.collisionMaxSpeed)};function TH(s,i){tH(gD(s),gD(i)),OG(s),OG(i)}function z_e(s,i){!s.unbreakable&&!i.unbreakable&&TH(s,i),s.getRadius()===void 0&&i.getRadius()!==void 0?s.destroy():s.getRadius()!==void 0&&i.getRadius()===void 0?i.destroy():s.getRadius()!==void 0&&i.getRadius()!==void 0&&(s.getRadius()>=i.getRadius()?i:s).destroy()}function H_e(s,i,a,c){switch(s.options.collisions.mode){case Wg.absorb:{W_e(s,i,a,c);break}case Wg.bounce:{TH(s,i);break}case Wg.destroy:{z_e(s,i);break}}}const K_e=2;class q_e extends Ck{constructor(i){super(i)}clear(){}init(){}interact(i,a){if(i.destroyed||i.spawning)return;const c=this.container,p=i.getPosition(),_=i.getRadius(),y=c.particles.quadTree.queryCircle(p,_*K_e);for(const T of y){if(i===T||!T.options.collisions.enable||i.options.collisions.mode!==T.options.collisions.mode||T.destroyed||T.spawning)continue;const C=T.getPosition(),I=T.getRadius();if(Math.abs(Math.round(p.z)-Math.round(C.z))>_+I)continue;const D=Co(p,C),L=_+I;D>L||H_e(i,T,a,c.retina.pixelRatio)}}isEnabled(i){return i.options.collisions.enable}reset(){}}async function Y_e(s,i=!0){s.checkVersion("3.8.1"),await s.addInteractor("particlesCollisions",a=>Promise.resolve(new q_e(a)),i)}const SP=2;class X_e extends Is{constructor(i,a,c,p){super(i,a,c),this.canvasSize=p,this.canvasSize={...p}}contains(i){const{width:a,height:c}=this.canvasSize,{x:p,y:_}=i;return super.contains(i)||super.contains({x:p-a,y:_})||super.contains({x:p-a,y:_-c})||super.contains({x:p,y:_-c})}intersects(i){if(super.intersects(i))return!0;const a=i,c=i,p={x:i.position.x-this.canvasSize.width,y:i.position.y-this.canvasSize.height};if(c.radius!==void 0){const _=new Is(p.x,p.y,c.radius*SP);return super.intersects(_)}else if(a.size!==void 0){const _=new xd(p.x,p.y,a.size.width*SP,a.size.height*SP);return super.intersects(_)}return!1}}class J_e{constructor(){this.blur=5,this.color=new Sr,this.color.value="#000",this.enable=!1}load(i){Ke(i)||(i.blur!==void 0&&(this.blur=i.blur),this.color=Sr.create(this.color,i.color),i.enable!==void 0&&(this.enable=i.enable))}}class $_e{constructor(){this.enable=!1,this.frequency=1}load(i){Ke(i)||(i.color!==void 0&&(this.color=Sr.create(this.color,i.color)),i.enable!==void 0&&(this.enable=i.enable),i.frequency!==void 0&&(this.frequency=i.frequency),i.opacity!==void 0&&(this.opacity=i.opacity))}}class Q_e{constructor(){this.blink=!1,this.color=new Sr,this.color.value="#fff",this.consent=!1,this.distance=100,this.enable=!1,this.frequency=1,this.opacity=1,this.shadow=new J_e,this.triangles=new $_e,this.width=1,this.warp=!1}load(i){Ke(i)||(i.id!==void 0&&(this.id=i.id),i.blink!==void 0&&(this.blink=i.blink),this.color=Sr.create(this.color,i.color),i.consent!==void 0&&(this.consent=i.consent),i.distance!==void 0&&(this.distance=i.distance),i.enable!==void 0&&(this.enable=i.enable),i.frequency!==void 0&&(this.frequency=i.frequency),i.opacity!==void 0&&(this.opacity=i.opacity),this.shadow.load(i.shadow),this.triangles.load(i.triangles),i.width!==void 0&&(this.width=i.width),i.warp!==void 0&&(this.warp=i.warp))}}const NG=2,Z_e=1,vC={x:0,y:0},eEe=0;function tEe(s,i,a,c,p){const{dx:_,dy:y,distance:T}=ds(s,i);if(!p||T<=a)return T;const C={x:Math.abs(_),y:Math.abs(y)},I={x:Math.min(C.x,c.width-C.x),y:Math.min(C.y,c.height-C.y)};return Math.sqrt(I.x**NG+I.y**NG)}class nEe extends Ck{constructor(i,a){super(i),this._setColor=c=>{if(!c.options.links)return;const p=this._linkContainer,_=c.options.links;let y=_.id===void 0?p.particles.linksColor:p.particles.linksColors.get(_.id);if(y)return;const T=_.color;y=oH(this._engine,T,_.blink,_.consent),_.id===void 0?p.particles.linksColor=y:p.particles.linksColors.set(_.id,y)},this._linkContainer=i,this._engine=a}clear(){}init(){this._linkContainer.particles.linksColor=void 0,this._linkContainer.particles.linksColors=new Map}interact(i){if(!i.options.links)return;i.links=[];const a=i.getPosition(),c=this.container,p=c.canvas.size;if(a.x<vC.x||a.y<vC.y||a.x>p.width||a.y>p.height)return;const _=i.options.links,y=_.opacity,T=i.retina.linksDistance??eEe,C=_.warp;let I;C?I=new X_e(a.x,a.y,T,p):I=new Is(a.x,a.y,T);const D=c.particles.quadTree.query(I);for(const L of D){const j=L.options.links;if(i===L||!(j!=null&&j.enable)||_.id!==j.id||L.spawning||L.destroyed||!L.links||i.links.some(Q=>Q.destination===L)||L.links.some(Q=>Q.destination===i))continue;const Y=L.getPosition();if(Y.x<vC.x||Y.y<vC.y||Y.x>p.width||Y.y>p.height)continue;const X=tEe(a,Y,T,p,C&&j.warp);if(X>T)continue;const ee=(Z_e-X/T)*y;this._setColor(i),i.links.push({destination:L,opacity:ee})}}isEnabled(i){var a;return!!((a=i.options.links)!=null&&a.enable)}loadParticlesOptions(i,...a){i.links||(i.links=new Q_e);for(const c of a)i.links.load(c==null?void 0:c.links)}reset(){}}async function iEe(s,i=!0){await s.addInteractor("particlesLinks",async a=>Promise.resolve(new nEe(a,s)),i)}function rEe(s,i,a,c){s.beginPath(),s.moveTo(i.x,i.y),s.lineTo(a.x,a.y),s.lineTo(c.x,c.y),s.closePath()}function sEe(s){let i=!1;const{begin:a,end:c,engine:p,maxDistance:_,context:y,canvasSize:T,width:C,backgroundMask:I,colorLine:D,opacity:L,links:j}=s;if(Co(a,c)<=_)gv(y,a,c),i=!0;else if(j.warp){let X,ee;const Q={x:c.x-T.width,y:c.y},se=ds(a,Q);if(se.distance<=_){const fe=a.y-se.dy/se.dx*a.x;X={x:0,y:fe},ee={x:T.width,y:fe}}else{const fe={x:c.x,y:c.y-T.height},me=ds(a,fe);if(me.distance<=_){const Ve=-(a.y-me.dy/me.dx*a.x)/(me.dy/me.dx);X={x:Ve,y:0},ee={x:Ve,y:T.height}}else{const Oe={x:c.x-T.width,y:c.y-T.height},Ve=ds(a,Oe);if(Ve.distance<=_){const Ze=a.y-Ve.dy/Ve.dx*a.x;X={x:-Ze/(Ve.dy/Ve.dx),y:Ze},ee={x:X.x+T.width,y:X.y+T.height}}}}X&&ee&&(gv(y,a,X),gv(y,c,ee),i=!0)}if(!i)return;y.lineWidth=C,I.enable&&(y.globalCompositeOperation=I.composite),y.strokeStyle=Jg(D,L);const{shadow:Y}=j;if(Y.enable){const X=Nd(p,Y.color);X&&(y.shadowBlur=Y.blur,y.shadowColor=Jg(X))}y.stroke()}function oEe(s){const{context:i,pos1:a,pos2:c,pos3:p,backgroundMask:_,colorTriangle:y,opacityTriangle:T}=s;rEe(i,a,c,p),_.enable&&(i.globalCompositeOperation=_.composite),i.fillStyle=Jg(y,T),i.fill()}function aEe(s){return s.sort((i,a)=>i-a),s.join("_")}function PG(s,i){const a=aEe(s.map(p=>p.id));let c=i.get(a);return c===void 0&&(c=en(),i.set(a,c)),c}const DG=0,TP=0,kG=0,cEe=.5,lEe=1;class uEe{constructor(i,a){this._drawLinkLine=(c,p)=>{const _=c.options.links;if(!(_!=null&&_.enable))return;const y=this._container,T=y.actualOptions,C=p.destination,I=c.getPosition(),D=C.getPosition();let L=p.opacity;y.canvas.draw(j=>{var fe;let Y;const X=(fe=c.options.twinkle)==null?void 0:fe.lines;if(X!=null&&X.enable){const me=X.frequency,Oe=Nd(this._engine,X.color);en()<me&&Oe&&(Y=Oe,L=nt(X.opacity))}if(!Y){const me=_.id!==void 0?y.particles.linksColors.get(_.id):y.particles.linksColor;Y=_D(c,C,me)}if(!Y)return;const ee=c.retina.linksWidth??TP,Q=c.retina.linksDistance??kG,{backgroundMask:se}=T;sEe({context:j,width:ee,begin:I,end:D,engine:this._engine,maxDistance:Q,canvasSize:y.canvas.size,links:_,backgroundMask:se,colorLine:Y,opacity:L})})},this._drawLinkTriangle=(c,p,_)=>{const y=c.options.links;if(!(y!=null&&y.enable))return;const T=y.triangles;if(!T.enable)return;const C=this._container,I=C.actualOptions,D=p.destination,L=_.destination,j=T.opacity??(p.opacity+_.opacity)*cEe;j<=DG||C.canvas.draw(Y=>{const X=c.getPosition(),ee=D.getPosition(),Q=L.getPosition(),se=c.retina.linksDistance??kG;if(Co(X,ee)>se||Co(Q,ee)>se||Co(Q,X)>se)return;let fe=Nd(this._engine,T.color);if(!fe){const me=y.id!==void 0?C.particles.linksColors.get(y.id):C.particles.linksColor;fe=_D(c,D,me)}fe&&oEe({context:Y,pos1:X,pos2:ee,pos3:Q,backgroundMask:I.backgroundMask,colorTriangle:fe,opacityTriangle:j})})},this._drawTriangles=(c,p,_,y)=>{var I,D,L;const T=_.destination;if(!((I=c.links)!=null&&I.triangles.enable&&((D=T.options.links)!=null&&D.triangles.enable)))return;const C=(L=T.links)==null?void 0:L.filter(j=>{const Y=this._getLinkFrequency(T,j.destination);return T.options.links&&Y<=T.options.links.frequency&&y.findIndex(ee=>ee.destination===j.destination)>=0});if(C!=null&&C.length)for(const j of C){const Y=j.destination;this._getTriangleFrequency(p,T,Y)>c.links.triangles.frequency||this._drawLinkTriangle(p,_,j)}},this._getLinkFrequency=(c,p)=>PG([c,p],this._freqs.links),this._getTriangleFrequency=(c,p,_)=>PG([c,p,_],this._freqs.triangles),this._container=i,this._engine=a,this._freqs={links:new Map,triangles:new Map}}drawParticle(i,a){const{links:c,options:p}=a;if(!(c!=null&&c.length))return;const _=c.filter(y=>p.links&&(p.links.frequency>=lEe||this._getLinkFrequency(a,y.destination)<=p.links.frequency));for(const y of _)this._drawTriangles(p,a,y,_),y.opacity>DG&&(a.retina.linksWidth??TP)>TP&&this._drawLinkLine(a,y)}async init(){this._freqs.links=new Map,this._freqs.triangles=new Map,await Promise.resolve()}particleCreated(i){if(i.links=[],!i.options.links)return;const a=this._container.retina.pixelRatio,{retina:c}=i,{distance:p,width:_}=i.options.links;c.linksDistance=p*a,c.linksWidth=_*a}particleDestroyed(i){i.links=[]}}class dEe{constructor(i){this.id="links",this._engine=i}getPlugin(i){return Promise.resolve(new uEe(i,this._engine))}loadOptions(){}needsPlugin(){return!0}}async function hEe(s,i=!0){const a=new dEe(s);await s.addPlugin(a,i)}async function pEe(s,i=!0){s.checkVersion("3.8.1"),await iEe(s,i),await hEe(s,i)}const fEe=180,SC={x:0,y:0},mEe=2;function gEe(s,i,a){const{context:c}=s,p=a.count.numerator*a.count.denominator,_=a.count.numerator/a.count.denominator,y=fEe*(_-mEe)/_,T=Math.PI-jg(y);if(c){c.beginPath(),c.translate(i.x,i.y),c.moveTo(SC.x,SC.y);for(let C=0;C<p;C++)c.lineTo(a.length,SC.y),c.translate(a.length,SC.y),c.rotate(T)}}const _Ee=5;class RH{draw(i){const{particle:a,radius:c}=i,p=this.getCenter(a,c),_=this.getSidesData(a,c);gEe(i,p,_)}getSidesCount(i){const a=i.shapeData;return Math.round(nt((a==null?void 0:a.sides)??_Ee))}}const LG=3.5,xG=2.66,EEe=3;class yEe extends RH{constructor(){super(...arguments),this.validTypes=["polygon"]}getCenter(i,a){return{x:-a/(i.sides/LG),y:-a/(xG/LG)}}getSidesData(i,a){const c=i.sides;return{count:{denominator:1,numerator:c},length:a*xG/(c/EEe)}}}const vEe=1.66,SEe=3,TEe=2;class REe extends RH{constructor(){super(...arguments),this.validTypes=["triangle"]}getCenter(i,a){return{x:-a,y:a/vEe}}getSidesCount(){return SEe}getSidesData(i,a){const c=a*TEe;return{count:{denominator:2,numerator:3},length:c}}}async function wEe(s,i=!0){s.checkVersion("3.8.1"),await s.addShape(new yEe,i)}async function CEe(s,i=!0){s.checkVersion("3.8.1"),await s.addShape(new REe,i)}async function bEe(s,i=!0){s.checkVersion("3.8.1"),await wEe(s,i),await CEe(s,i)}class AEe{constructor(){this.enable=!1,this.speed=0,this.decay=0,this.sync=!1}load(i){Ke(i)||(i.enable!==void 0&&(this.enable=i.enable),i.speed!==void 0&&(this.speed=At(i.speed)),i.decay!==void 0&&(this.decay=At(i.decay)),i.sync!==void 0&&(this.sync=i.sync))}}class IEe extends qa{constructor(){super(),this.animation=new AEe,this.direction=bs.clockwise,this.path=!1,this.value=0}load(i){Ke(i)||(super.load(i),i.direction!==void 0&&(this.direction=i.direction),this.animation.load(i.animation),i.path!==void 0&&(this.path=i.path))}}const wH=2,OEe=Math.PI*wH,NEe=1,PEe=360;class DEe{constructor(i){this.container=i}init(i){const a=i.options.rotate;if(!a)return;i.rotate={enable:a.animation.enable,value:jg(nt(a.value)),min:0,max:OEe},i.pathRotation=a.path;let c=a.direction;switch(c===bs.random&&(c=Math.floor(en()*wH)>0?bs.counterClockwise:bs.clockwise),c){case bs.counterClockwise:case"counterClockwise":i.rotate.status=Bi.decreasing;break;case bs.clockwise:i.rotate.status=Bi.increasing;break}const p=a.animation;p.enable&&(i.rotate.decay=NEe-nt(p.decay),i.rotate.velocity=nt(p.speed)/PEe*this.container.retina.reduceFactor,p.sync||(i.rotate.velocity*=en())),i.rotation=i.rotate.value}isEnabled(i){const a=i.options.rotate;return a?!i.destroyed&&!i.spawning&&(!!a.value||a.animation.enable||a.path):!1}loadOptions(i,...a){i.rotate||(i.rotate=new IEe);for(const c of a)i.rotate.load(c==null?void 0:c.rotate)}update(i,a){this.isEnabled(i)&&(i.isRotating=!!i.rotate,i.rotate&&(Ab(i,i.rotate,!1,Id.none,a),i.rotation=i.rotate.value))}}async function kEe(s,i=!0){s.checkVersion("3.8.1"),await s.addParticleUpdater("rotate",a=>Promise.resolve(new DEe(a)),i)}const LEe=2,xEe=Math.sqrt(LEe),MEe=2;function UEe(s){const{context:i,radius:a}=s,c=a/xEe,p=c*MEe;i.rect(-c,-c,p,p)}const VEe=4;class FEe{constructor(){this.validTypes=["edge","square"]}draw(i){UEe(i)}getSidesCount(){return VEe}}async function BEe(s,i=!0){s.checkVersion("3.8.1"),await s.addShape(new FEe,i)}const jEe=2,Cg={x:0,y:0};function GEe(s){const{context:i,particle:a,radius:c}=s,p=a.sides,_=a.starInset??jEe;i.moveTo(Cg.x,Cg.y-c);for(let y=0;y<p;y++)i.rotate(Math.PI/p),i.lineTo(Cg.x,Cg.y-c*_),i.rotate(Math.PI/p),i.lineTo(Cg.x,Cg.y-c)}const WEe=2,zEe=5;class HEe{constructor(){this.validTypes=["star"]}draw(i){GEe(i)}getSidesCount(i){const a=i.shapeData;return Math.round(nt((a==null?void 0:a.sides)??zEe))}particleInit(i,a){const c=a.shapeData;a.starInset=nt((c==null?void 0:c.inset)??WEe)}}async function KEe(s,i=!0){s.checkVersion("3.8.1"),await s.addShape(new HEe,i)}const qEe=1;class YEe{constructor(i,a){this._container=i,this._engine=a}init(i){var y;const a=this._container,c=i.options,p=su(c.stroke,i.id,c.reduceDuplicates);i.strokeWidth=nt(p.width)*a.retina.pixelRatio,i.strokeOpacity=nt(p.opacity??qEe),i.strokeAnimation=(y=p.color)==null?void 0:y.animation;const _=a_(this._engine,p.color)??i.getFillColor();_&&(i.strokeColor=aH(_,i.strokeAnimation,a.retina.reduceFactor))}isEnabled(i){const a=i.strokeAnimation,{strokeColor:c}=i;return!i.destroyed&&!i.spawning&&!!a&&((c==null?void 0:c.h.value)!==void 0&&c.h.enable||(c==null?void 0:c.s.value)!==void 0&&c.s.enable||(c==null?void 0:c.l.value)!==void 0&&c.l.enable)}update(i,a){this.isEnabled(i)&&cH(i.strokeColor,a)}}async function XEe(s,i=!0){s.checkVersion("3.8.1"),await s.addParticleUpdater("strokeColor",a=>Promise.resolve(new YEe(a,s)),i)}async function JEe(s,i=!0){s.checkVersion("3.8.1"),await M_e(s,!1),await Bme(s,!1),await Xme(s,!1),await ige(s,!1),await pge(s,!1),await Rge(s,!1),await bge(s,!1),await Pge(s,!1),await xge(s,!1),await Kge(s,!1),await $ge(s,!1),await F_e(s,!1),await Y_e(s,!1),await pEe(s,!1),await Nme(s,!1),await kme(s,!1),await R_e(s,!1),await L_e(s,!1),await bEe(s,!1),await BEe(s,!1),await KEe(s,!1),await N_e(s,!1),await kEe(s,!1),await XEe(s,!1),await Ome(s,i)}const CH=2,MG=.5;function $Ee(s){const{context:i,particle:a,radius:c,opacity:p}=s,_=a.shapeData;if(!_)return;const y=_.value;if(y===void 0)return;a.text===void 0&&(a.text=su(y,a.randomIndexData));const T=a.text,C=_.style??"",I=_.weight??"400",D=Math.round(c)*CH,L=_.font??"Verdana",j=a.shapeFill,Y=T==null?void 0:T.split(`
`);if(Y){i.font=`${C} ${I} ${D}px "${L}"`,i.globalAlpha=p;for(let X=0;X<Y.length;X++)QEe(i,Y[X],c,p,X,j);i.globalAlpha=1}}function QEe(s,i,a,c,p,_){const y=i.length*a*MG,T={x:-y,y:a*MG},C=a*CH;_?s.fillText(i,T.x,T.y+C*p):s.strokeText(i,T.x,T.y+C*p)}class ZEe{constructor(){this.validTypes=["text","character","char","multiline-text"]}draw(i){$Ee(i)}async init(i){const a=i.actualOptions,{validTypes:c}=this;if(c.find(p=>di(p,a.particles.shape.type))){const p=c.map(y=>a.particles.shape.options[y]).find(y=>!!y),_=[];hs(p,y=>{_.push(mD(y.font,y.weight))}),await Promise.all(_)}}particleInit(i,a){if(!a.shape||!this.validTypes.includes(a.shape))return;const c=a.shapeData;if(c===void 0)return;const p=c.value;p!==void 0&&(a.text=su(p,a.randomIndexData))}}async function eye(s,i=!0){s.checkVersion("3.8.1"),await s.addShape(new ZEe,i)}var yd;(function(s){s.clockwise="clockwise",s.counterClockwise="counter-clockwise",s.random="random"})(yd||(yd={}));class tye{constructor(){this.enable=!1,this.speed=0,this.decay=0,this.sync=!1}load(i){Ke(i)||(i.enable!==void 0&&(this.enable=i.enable),i.speed!==void 0&&(this.speed=At(i.speed)),i.decay!==void 0&&(this.decay=At(i.decay)),i.sync!==void 0&&(this.sync=i.sync))}}class nye extends qa{constructor(){super(),this.animation=new tye,this.direction=yd.clockwise,this.enable=!1,this.value=0}load(i){super.load(i),!Ke(i)&&(this.animation.load(i.animation),i.direction!==void 0&&(this.direction=i.direction),i.enable!==void 0&&(this.enable=i.enable))}}const RP=1,bH=2,iye=Math.PI*bH,rye=360;class sye{constructor(i){this.container=i}getTransformValues(i){var c;const a=((c=i.tilt)==null?void 0:c.enable)&&i.tilt;return{b:a?Math.cos(a.value)*a.cosDirection:void 0,c:a?Math.sin(a.value)*a.sinDirection:void 0}}init(i){var _;const a=i.options.tilt;if(!a)return;i.tilt={enable:a.enable,value:jg(nt(a.value)),sinDirection:en()>=ro?RP:-1,cosDirection:en()>=ro?RP:-1,min:0,max:iye};let c=a.direction;switch(c===yd.random&&(c=Math.floor(en()*bH)>0?yd.counterClockwise:yd.clockwise),c){case yd.counterClockwise:case"counterClockwise":i.tilt.status=Bi.decreasing;break;case yd.clockwise:i.tilt.status=Bi.increasing;break}const p=(_=i.options.tilt)==null?void 0:_.animation;p!=null&&p.enable&&(i.tilt.decay=RP-nt(p.decay),i.tilt.velocity=nt(p.speed)/rye*this.container.retina.reduceFactor,p.sync||(i.tilt.velocity*=en()))}isEnabled(i){var c;const a=(c=i.options.tilt)==null?void 0:c.animation;return!i.destroyed&&!i.spawning&&!!(a!=null&&a.enable)}loadOptions(i,...a){i.tilt||(i.tilt=new nye);for(const c of a)i.tilt.load(c==null?void 0:c.tilt)}async update(i,a){!this.isEnabled(i)||!i.tilt||(Ab(i,i.tilt,!1,Id.none,a),await Promise.resolve())}}async function oye(s,i=!0){s.checkVersion("3.8.1"),await s.addParticleUpdater("tilt",a=>Promise.resolve(new sye(a)),i)}class UG{constructor(){this.enable=!1,this.frequency=.05,this.opacity=1}load(i){Ke(i)||(i.color!==void 0&&(this.color=Sr.create(this.color,i.color)),i.enable!==void 0&&(this.enable=i.enable),i.frequency!==void 0&&(this.frequency=i.frequency),i.opacity!==void 0&&(this.opacity=At(i.opacity)))}}class aye{constructor(){this.lines=new UG,this.particles=new UG}load(i){Ke(i)||(this.lines.load(i.lines),this.particles.load(i.particles))}}class cye{constructor(i){this._engine=i}getColorStyles(i,a,c,p){const _=i.options,y=_.twinkle;if(!y)return{};const T=y.particles,C=T.enable&&en()<T.frequency,I=i.options.zIndex,D=1,L=(D-i.zIndexFactor)**I.opacityRate,j=C?nt(T.opacity)*L:p,Y=a_(this._engine,T.color),X=Y?nb(Y,j):void 0,ee={},Q=C&&X;return ee.fill=Q?X:void 0,ee.stroke=Q?X:void 0,ee}async init(){await Promise.resolve()}isEnabled(i){const a=i.options,c=a.twinkle;return c?c.particles.enable:!1}loadOptions(i,...a){i.twinkle||(i.twinkle=new aye);for(const c of a)i.twinkle.load(c==null?void 0:c.twinkle)}async update(){await Promise.resolve()}}async function lye(s,i=!0){s.checkVersion("3.8.1"),await s.addParticleUpdater("twinkle",()=>Promise.resolve(new cye(s)),i)}class uye{constructor(){this.angle=50,this.move=10}load(i){Ke(i)||(i.angle!==void 0&&(this.angle=At(i.angle)),i.move!==void 0&&(this.move=At(i.move)))}}class dye{constructor(){this.distance=5,this.enable=!1,this.speed=new uye}load(i){if(!Ke(i)&&(i.distance!==void 0&&(this.distance=At(i.distance)),i.enable!==void 0&&(this.enable=i.enable),i.speed!==void 0))if(aa(i.speed))this.speed.load({angle:i.speed});else{const a=i.speed;a.min!==void 0?this.speed.load({angle:a}):this.speed.load(i.speed)}}}const hye=0,pye=2,fye=Math.PI*pye,mye=60;function gye(s,i){const{wobble:a}=s.options,{wobble:c}=s;if(!(a!=null&&a.enable)||!c)return;const p=c.angleSpeed*i.factor,_=c.moveSpeed*i.factor,y=_*((s.retina.wobbleDistance??hye)*i.factor)/(os/mye),T=fye,{position:C}=s;c.angle+=p,c.angle>T&&(c.angle-=T),C.x+=y*Math.cos(c.angle),C.y+=y*Math.abs(Math.sin(c.angle))}const _ye=2,Eye=Math.PI*_ye,yye=360,vye=10,Sye=0;class Tye{constructor(i){this.container=i}init(i){const a=i.options.wobble;a!=null&&a.enable?i.wobble={angle:en()*Eye,angleSpeed:nt(a.speed.angle)/yye,moveSpeed:nt(a.speed.move)/vye}:i.wobble={angle:0,angleSpeed:0,moveSpeed:0},i.retina.wobbleDistance=nt((a==null?void 0:a.distance)??Sye)*this.container.retina.pixelRatio}isEnabled(i){var a;return!i.destroyed&&!i.spawning&&!!((a=i.options.wobble)!=null&&a.enable)}loadOptions(i,...a){i.wobble||(i.wobble=new dye);for(const c of a)i.wobble.load(c==null?void 0:c.wobble)}update(i,a){this.isEnabled(i)&&gye(i,a)}}async function Rye(s,i=!0){s.checkVersion("3.8.1"),await s.addParticleUpdater("wobble",a=>Promise.resolve(new Tye(a)),i)}async function wye(s,i=!0){s.checkVersion("3.8.1"),await sfe(s,!1),await xfe(s,!1),await oye(s,!1),await lye(s,!1),await Rye(s,!1),await eye(s,!1),await Ife(s,!1),await Hpe(s,!1),await _fe(s,!1),await Sfe(s,!1),await Cfe(s,!1),await JEe(s,i)}const wP=({icon:s,title:i,description:a,color:c})=>H.jsxs(A8.div,{whileHover:{scale:1.05,rotate:.5},whileTap:{scale:.97},initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{duration:.7,ease:"easeOut"},className:"bg-white/10 backdrop-blur-xl border border-white/30 p-5 sm:p-6 rounded-3xl shadow-[0_0_30px_rgba(255,255,255,0.1)] transition-all duration-300 group relative overflow-hidden hover:shadow-[0_0_60px_10px_rgba(255,255,255,0.2)]",children:[H.jsx("div",{className:"absolute inset-0 rounded-3xl bg-gradient-to-br from-white/10 to-transparent opacity-0 group-hover:opacity-100 transition duration-500 pointer-events-none"}),H.jsxs("h2",{className:"text-2xl sm:text-3xl font-extrabold mb-3 flex items-center justify-center gap-3 text-white drop-shadow-lg text-center",children:[H.jsx(s,{className:`${c} drop-shadow-glow text-xl sm:text-2xl`})," ",i]}),H.jsx("p",{className:"text-base sm:text-lg text-gray-200 text-center leading-relaxed",children:a})]}),Cye=async s=>{await wye(s)},bye=()=>H.jsxs("div",{className:"relative min-h-screen flex items-center justify-center bg-gradient-to-br from-indigo-900 via-purple-900 to-indigo-800 overflow-hidden px-2 sm:px-4 py-10 sm:py-20 pt-24 text-white",children:[H.jsx(Cb,{id:"tsparticles",init:Cye,options:{fullScreen:{enable:!1},background:{color:"transparent"},particles:{number:{value:50},color:{value:"#ffffff"},shape:{type:"circle"},opacity:{value:.05},size:{value:3},move:{enable:!0,speed:.5}}},className:"absolute inset-0 z-0"}),H.jsxs("div",{className:"z-10 text-center max-w-6xl w-full",children:[H.jsxs(A8.h1,{initial:{opacity:0,y:-40},animate:{opacity:1,y:0},transition:{duration:1},className:"text-4xl sm:text-5xl md:text-6xl font-extrabold mb-10 sm:mb-14 leading-tight drop-shadow-[0_0_30px_rgba(255,255,255,0.2)]",children:[" Welcome to ",H.jsx("span",{className:"text-yellow-400",children:"SafeSpace"})]}),H.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6",children:[H.jsx(Vr,{to:"/list",children:H.jsx(wP,{icon:doe,title:"Listener",description:"Talk to someone who will listen without judgment and provide mental suport. ",color:"text-yellow-300"})}),H.jsx(Vr,{to:"/call",children:H.jsx(wP,{icon:QW,title:"Call",description:"Randomly connect with someone online users via voice call who are in online. ",color:"text-green-300"})}),H.jsx("div",{className:"sm:col-span-2",children:H.jsx(Vr,{to:"/home",children:H.jsx(wP,{icon:coe,title:"Chat",description:"A safe place for open and anonymous conversations. ",color:"text-pink-300"})})})]})]})]}),Aye=[{id:1,name:"Balaji",age:21,gender:"Male",phNo:"9342874173"},{id:2,name:"Sandy",age:28,gender:"Male",phNo:"9362622255"},{id:3,name:"Dhanush",age:35,gender:"Male",phNo:"8838319686"},{id:4,name:"Emily Davis",age:32,gender:"Female",phNo:"9566319064"},{id:5,name:"Chris Wilson",age:29,gender:"Male",phNo:"333-444-5555"},{id:6,name:"Sophia Martinez",age:31,gender:"Female",phNo:"222-333-4444"}],Iye=()=>{const[s,i]=_e.useState([]),a=c=>{i(p=>p.includes(c)?p.filter(_=>_!==c):[...p,c])};return H.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-500 flex flex-col items-center pt-20 px-4 pb-12",children:[H.jsx("h1",{className:"text-4xl font-extrabold text-white mb-12 drop-shadow-lg text-center",children:" Call an Employee"}),H.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 w-full max-w-6xl",children:Aye.map(c=>H.jsxs("div",{className:"bg-white/10 backdrop-blur-lg border border-white/20 rounded-3xl p-6 shadow-lg transform transition duration-300 hover:scale-[1.03] relative overflow-hidden",children:[H.jsx("div",{className:"absolute inset-0 bg-white/5 opacity-0 hover:opacity-100 rounded-3xl transition duration-500 pointer-events-none"}),H.jsxs("h2",{className:"text-2xl font-bold text-white mb-2",children:[" ",c.name]}),H.jsxs("p",{className:"text-white/90",children:[" Age: ",c.age]}),H.jsxs("p",{className:"text-white/90",children:[" Gender: ",c.gender]}),H.jsxs("div",{className:"mt-2 flex items-center justify-between text-white/90",children:[H.jsxs("span",{children:[" ",s.includes(c.id)?c.phNo:"Hidden"]}),H.jsx("button",{onClick:()=>a(c.id),className:"text-white hover:text-yellow-300 transition",title:"Toggle phone number",children:s.includes(c.id)?H.jsx(loe,{}):H.jsx(uoe,{})})]}),H.jsxs("a",{href:`tel:${c.phNo}`,className:"mt-5 inline-flex items-center gap-2 bg-green-500 hover:bg-green-600 text-white font-semibold px-4 py-2 rounded-full transition duration-200 w-full justify-center",children:[H.jsx(QW,{}),"Call"]})]},c.id))})]})};var VC={exports:{}},Oye=VC.exports,VG;function Nye(){return VG||(VG=1,function(s,i){(function(a,c){s.exports=c()})(Oye,function(){function a(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in e)){var o=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(e,r,o.get?o:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(e)}var c=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof AN<"u"?AN:typeof self<"u"?self:{};function p(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var _=function(e){try{return!!e()}catch{return!0}},y=!_(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),T=y,C=Function.prototype,I=C.call,D=T&&C.bind.bind(I,I),L=T?D:function(e){return function(){return I.apply(e,arguments)}},j=L({}.isPrototypeOf),Y=function(e){return e&&e.Math==Math&&e},X=Y(typeof globalThis=="object"&&globalThis)||Y(typeof window=="object"&&window)||Y(typeof self=="object"&&self)||Y(typeof c=="object"&&c)||function(){return this}()||c||Function("return this")(),ee=y,Q=Function.prototype,se=Q.apply,fe=Q.call,me=typeof Reflect=="object"&&Reflect.apply||(ee?fe.bind(se):function(){return fe.apply(se,arguments)}),Oe=L,Ve=Oe({}.toString),Ze=Oe("".slice),ut=function(e){return Ze(Ve(e),8,-1)},rt=ut,dn=L,tn=function(e){if(rt(e)==="Function")return dn(e)},bi=typeof document=="object"&&document.all,Ai={all:bi,IS_HTMLDDA:bi===void 0&&bi!==void 0},Qi=Ai.all,qt=Ai.IS_HTMLDDA?function(e){return typeof e=="function"||e===Qi}:function(e){return typeof e=="function"},Tr={},xn=!_(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Yt=y,ze=Function.prototype.call,Xe=Yt?ze.bind(ze):function(){return ze.apply(ze,arguments)},$e={},de={}.propertyIsEnumerable,Ue=Object.getOwnPropertyDescriptor,zt=Ue&&!de.call({1:2},1);$e.f=zt?function(e){var t=Ue(this,e);return!!t&&t.enumerable}:de;var Dt,sn,Ht=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Gn=_,On=ut,Wn=Object,ps=L("".split),Qc=Gn(function(){return!Wn("z").propertyIsEnumerable(0)})?function(e){return On(e)=="String"?ps(e,""):Wn(e)}:Wn,Zc=function(e){return e==null},Hp=Zc,c_=TypeError,el=function(e){if(Hp(e))throw c_("Can't call method on "+e);return e},Hv=Qc,l_=el,ca=function(e){return Hv(l_(e))},Kp=qt,Md=Ai.all,ji=Ai.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:Kp(e)||e===Md}:function(e){return typeof e=="object"?e!==null:Kp(e)},Rr={},qp=Rr,Yp=X,Kv=qt,u_=function(e){return Kv(e)?e:void 0},Zi=function(e,t){return arguments.length<2?u_(qp[e])||u_(Yp[e]):qp[e]&&qp[e][t]||Yp[e]&&Yp[e][t]},oo=typeof navigator<"u"&&String(navigator.userAgent)||"",d_=X,tl=oo,au=d_.process,qv=d_.Deno,h_=au&&au.versions||qv&&qv.version,p_=h_&&h_.v8;p_&&(sn=(Dt=p_.split("."))[0]>0&&Dt[0]<4?1:+(Dt[0]+Dt[1])),!sn&&tl&&(!(Dt=tl.match(/Edge\/(\d+)/))||Dt[1]>=74)&&(Dt=tl.match(/Chrome\/(\d+)/))&&(sn=+Dt[1]);var nl=sn,Xp=nl,f_=_,m_=X.String,Xa=!!Object.getOwnPropertySymbols&&!f_(function(){var e=Symbol();return!m_(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Xp&&Xp<41}),Jp=Xa&&!Symbol.sham&&typeof Symbol.iterator=="symbol",cu=Zi,lu=qt,Yv=j,Xv=Object,uu=Jp?function(e){return typeof e=="symbol"}:function(e){var t=cu("Symbol");return lu(t)&&Yv(t.prototype,Xv(e))},Jv=String,il=function(e){try{return Jv(e)}catch{return"Object"}},g_=qt,$v=il,Ud=TypeError,wr=function(e){if(g_(e))return e;throw Ud($v(e)+" is not a function")},Vd=wr,Ob=Zc,Ja=function(e,t){var n=e[t];return Ob(n)?void 0:Vd(n)},Fd=Xe,Bd=qt,$p=ji,Nb=TypeError,Qv={exports:{}},Zv=X,rl=Object.defineProperty,eS=function(e,t){try{rl(Zv,e,{value:t,configurable:!0,writable:!0})}catch{Zv[e]=t}return t},__="__core-js_shared__",E_=X[__]||eS(__,{}),y_=E_;(Qv.exports=function(e,t){return y_[e]||(y_[e]=t!==void 0?t:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var sl=Qv.exports,tS=el,nS=Object,bo=function(e){return nS(tS(e))},Pb=bo,Ei=L({}.hasOwnProperty),yi=Object.hasOwn||function(e,t){return Ei(Pb(e),t)},v_=L,iS=0,Qp=Math.random(),Db=v_(1 .toString),Zp=function(e){return"Symbol("+(e===void 0?"":e)+")_"+Db(++iS+Qp,36)},ef=sl,ao=yi,kb=Zp,co=Xa,Lb=Jp,du=X.Symbol,S_=ef("wks"),tf=Lb?du.for||du:du&&du.withoutSetter||kb,_n=function(e){return ao(S_,e)||(S_[e]=co&&ao(du,e)?du[e]:tf("Symbol."+e)),S_[e]},jd=Xe,Gd=ji,rS=uu,xb=Ja,T_=function(e,t){var n,r;if(Bd(n=e.toString)&&!$p(r=Fd(n,e))||Bd(n=e.valueOf)&&!$p(r=Fd(n,e)))return r;throw Nb("Can't convert object to primitive value")},sS=TypeError,R_=_n("toPrimitive"),Wd=function(e,t){if(!Gd(e)||rS(e))return e;var n,r=xb(e,R_);if(r){if(n=jd(r,e,t),!Gd(n)||rS(n))return n;throw sS("Can't convert object to primitive value")}return T_(e)},Mb=uu,hu=function(e){var t=Wd(e,"string");return Mb(t)?t:t+""},Cn=ji,nf=X.document,oS=Cn(nf)&&Cn(nf.createElement),zd=function(e){return oS?nf.createElement(e):{}},aS=zd,w_=!xn&&!_(function(){return Object.defineProperty(aS("div"),"a",{get:function(){return 7}}).a!=7}),cS=xn,C_=Xe,rf=$e,$a=Ht,Qa=ca,Za=hu,Hd=yi,Kd=w_,la=Object.getOwnPropertyDescriptor;Tr.f=cS?la:function(e,t){if(e=Qa(e),t=Za(t),Kd)try{return la(e,t)}catch{}if(Hd(e,t))return $a(!C_(rf.f,e,t),e[t])};var Ub=_,lS=qt,qd=/#|\.prototype\./,Yd=function(e,t){var n=sf[uS(e)];return n==Vb||n!=dS&&(lS(t)?Ub(t):!!t)},uS=Yd.normalize=function(e){return String(e).replace(qd,".").toLowerCase()},sf=Yd.data={},dS=Yd.NATIVE="N",Vb=Yd.POLYFILL="P",pu=Yd,Xd=wr,fu=y,of=tn(tn.bind),ec=function(e,t){return Xd(e),t===void 0?e:fu?of(e,t):function(){return e.apply(t,arguments)}},Os={},af=xn&&_(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),cf=ji,b_=String,hS=TypeError,ii=function(e){if(cf(e))return e;throw hS(b_(e)+" is not an object")},A_=xn,lf=w_,pS=af,ol=ii,Jd=hu,fS=TypeError,Cr=Object.defineProperty,mu=Object.getOwnPropertyDescriptor,$d="enumerable",al="configurable",I_="writable";Os.f=A_?pS?function(e,t,n){if(ol(e),t=Jd(t),ol(n),typeof e=="function"&&t==="prototype"&&"value"in n&&I_ in n&&!n[I_]){var r=mu(e,t);r&&r[I_]&&(e[t]=n.value,n={configurable:al in n?n[al]:r[al],enumerable:$d in n?n[$d]:r[$d],writable:!1})}return Cr(e,t,n)}:Cr:function(e,t,n){if(ol(e),t=Jd(t),ol(n),lf)try{return Cr(e,t,n)}catch{}if("get"in n||"set"in n)throw fS("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var O_=Os,N_=Ht,Ns=xn?function(e,t,n){return O_.f(e,t,N_(1,n))}:function(e,t,n){return e[t]=n,e},cl=X,mS=me,Fb=tn,Bb=qt,jb=Tr.f,P_=pu,gu=Rr,Gb=ec,_u=Ns,gS=yi,Wb=function(e){var t=function(n,r,o){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,o)}return mS(e,this,arguments)};return t.prototype=e.prototype,t},xt=function(e,t){var n,r,o,l,u,h,m,g,E,S=e.target,R=e.global,b=e.stat,x=e.proto,P=R?cl:b?cl[S]:(cl[S]||{}).prototype,k=R?gu:gu[S]||_u(gu,S,{})[S],V=k.prototype;for(l in t)r=!(n=P_(R?l:S+(b?".":"#")+l,e.forced))&&P&&gS(P,l),h=k[l],r&&(m=e.dontCallGetSet?(E=jb(P,l))&&E.value:P[l]),u=r&&m?m:t[l],r&&typeof h==typeof u||(g=e.bind&&r?Gb(u,cl):e.wrap&&r?Wb(u):x&&Bb(u)?Fb(u):u,(e.sham||u&&u.sham||h&&h.sham)&&_u(g,"sham",!0),_u(k,l,g),x&&(gS(gu,o=S+"Prototype")||_u(gu,o,{}),_u(gu[o],l,u),e.real&&V&&(n||!V[l])&&_u(V,l,u)))},zb=Math.ceil,Hb=Math.floor,Kb=Math.trunc||function(e){var t=+e;return(t>0?Hb:zb)(t)},qb=Kb,Qd=function(e){var t=+e;return t!=t||t===0?0:qb(t)},Yb=Qd,Xb=Math.max,Jb=Math.min,uf=function(e,t){var n=Yb(e);return n<0?Xb(n+t,0):Jb(n,t)},$b=Qd,Qb=Math.min,_S=function(e){return e>0?Qb($b(e),9007199254740991):0},Zb=_S,ua=function(e){return Zb(e.length)},e0=ca,t0=uf,D_=ua,Eu=function(e){return function(t,n,r){var o,l=e0(t),u=D_(l),h=t0(r,u);if(e&&n!=n){for(;u>h;)if((o=l[h++])!=o)return!0}else for(;u>h;h++)if((e||h in l)&&l[h]===n)return e||h||0;return!e&&-1}},k_={includes:Eu(!0),indexOf:Eu(!1)},ES=k_.includes;xt({target:"Array",proto:!0,forced:_(function(){return!Array(1).includes()})},{includes:function(e){return ES(this,e,arguments.length>1?arguments[1]:void 0)}});var yS=Rr,fs=function(e){return yS[e+"Prototype"]},vS=fs("Array").includes,SS=ji,yu=ut,n0=_n("match"),TS=function(e){var t;return SS(e)&&((t=e[n0])!==void 0?!!t:yu(e)=="RegExp")},i0=TS,RS=TypeError,L_={};L_[_n("toStringTag")]="z";var ll=String(L_)==="[object z]",Zd=ll,r0=qt,ul=ut,s0=_n("toStringTag"),wS=Object,x_=ul(function(){return arguments}())=="Arguments",Ps=Zd?ul:function(e){var t,n,r;return e===void 0?"Undefined":e===null?"Null":typeof(n=function(o,l){try{return o[l]}catch{}}(t=wS(e),s0))=="string"?n:x_?ul(t):(r=ul(t))=="Object"&&r0(t.callee)?"Arguments":r},CS=Ps,bS=String,Wr=function(e){if(CS(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return bS(e)},o0=_n("match"),a0=xt,c0=function(e){if(i0(e))throw RS("The method doesn't accept regular expressions");return e},l0=el,AS=Wr,lo=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[o0]=!1,"/./"[e](t)}catch{}}return!1},eh=L("".indexOf);a0({target:"String",proto:!0,forced:!lo("includes")},{includes:function(e){return!!~eh(AS(l0(this)),AS(c0(e)),arguments.length>1?arguments[1]:void 0)}});var IS=fs("String").includes,M_=j,OS=vS,NS=IS,th=Array.prototype,U_=String.prototype,u0=function(e){var t=e.includes;return e===th||M_(th,e)&&t===th.includes?OS:typeof e=="string"||e===U_||M_(U_,e)&&t===U_.includes?NS:t},Te=p(u0),V_=wr,nh=bo,F_=Qc,PS=ua,df=TypeError,vu=function(e){return function(t,n,r,o){V_(n);var l=nh(t),u=F_(l),h=PS(l),m=e?h-1:0,g=e?-1:1;if(r<2)for(;;){if(m in u){o=u[m],m+=g;break}if(m+=g,e?m<0:h<=m)throw df("Reduce of empty array with no initial value")}for(;e?m>=0:h>m;m+=g)m in u&&(o=n(o,u[m],m,l));return o}},B_={left:vu(!1)},DS=_,dl=function(e,t){var n=[][e];return!!n&&DS(function(){n.call(null,t||function(){return 1},1)})},hl=typeof process<"u"&&ut(process)=="process",kS=B_.left;xt({target:"Array",proto:!0,forced:!hl&&nl>79&&nl<83||!dl("reduce")},{reduce:function(e){var t=arguments.length;return kS(this,e,t,t>1?arguments[1]:void 0)}});var LS=fs("Array").reduce,xS=j,MS=LS,hf=Array.prototype,tc=function(e){var t=e.reduce;return e===hf||xS(hf,e)&&t===hf.reduce?MS:t},pf=tc,ms=p(pf),d0=ut,ih=Array.isArray||function(e){return d0(e)=="Array"},rh=xt,h0=ih,US=L([].reverse),j_=[1,2];rh({target:"Array",proto:!0,forced:String(j_)===String(j_.reverse())},{reverse:function(){return h0(this)&&(this.length=this.length),US(this)}});var Xn=fs("Array").reverse,G_=j,ff=Xn,pl=Array.prototype,VS=function(e){var t=e.reverse;return e===pl||G_(pl,e)&&t===pl.reverse?ff:t},mf=VS,Su=p(mf),gf=Zp,fl=sl("keys"),sh=function(e){return fl[e]||(fl[e]=gf(e))},p0=!_(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),f0=yi,FS=qt,_f=bo,Ef=p0,yf=sh("IE_PROTO"),oh=Object,W_=oh.prototype,ah=Ef?oh.getPrototypeOf:function(e){var t=_f(e);if(f0(t,yf))return t[yf];var n=t.constructor;return FS(n)&&t instanceof n?n.prototype:t instanceof oh?W_:null},m0=L,BS=wr,g0=qt,_0=String,z_=TypeError,nc=function(e,t,n){try{return m0(BS(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}},jS=ii,Tu=function(e){if(typeof e=="object"||g0(e))return e;throw z_("Can't set "+_0(e)+" as a prototype")},Ao=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=nc(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(r,o){return jS(r),Tu(o),t?e(r,o):r.__proto__=o,r}}():void 0),ic={},Ds={},ch=yi,E0=ca,y0=k_.indexOf,ml=Ds,Ru=L([].push),gl=function(e,t){var n,r=E0(e),o=0,l=[];for(n in r)!ch(ml,n)&&ch(r,n)&&Ru(l,n);for(;t.length>o;)ch(r,n=t[o++])&&(~y0(l,n)||Ru(l,n));return l},wu=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],H_=gl,Cu=wu.concat("length","prototype");ic.f=Object.getOwnPropertyNames||function(e){return H_(e,Cu)};var ks={};ks.f=Object.getOwnPropertySymbols;var Jn=Zi,zn=ic,rc=ks,cr=ii,zr=L([].concat),_l=Jn("Reflect","ownKeys")||function(e){var t=zn.f(cr(e)),n=rc.f;return n?zr(t,n(e)):t},El=yi,Hr=_l,vf=Tr,GS=Os,Sf={},Tf=gl,WS=wu,Ls=Object.keys||function(e){return Tf(e,WS)},Rf=xn,K_=af,zS=Os,v0=ii,sc=ca,bu=Ls;Sf.f=Rf&&!K_?Object.defineProperties:function(e,t){v0(e);for(var n,r=sc(t),o=bu(t),l=o.length,u=0;l>u;)zS.f(e,n=o[u++],r[n]);return e};var da,lh=Zi("document","documentElement"),wf=ii,xs=Sf,gs=wu,yl=Ds,ha=lh,pa=zd,fa="prototype",Cf="script",bf=sh("IE_PROTO"),uh=function(){},Kr=function(e){return"<"+Cf+">"+e+"</"+Cf+">"},qr=function(e){e.write(Kr("")),e.close();var t=e.parentWindow.Object;return e=null,t},Mn=function(){try{da=new ActiveXObject("htmlfile")}catch{}var e,t,n;Mn=typeof document<"u"?document.domain&&da?qr(da):(t=pa("iframe"),n="java"+Cf+":",t.style.display="none",ha.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(Kr("document.F=Object")),e.close(),e.F):qr(da);for(var r=gs.length;r--;)delete Mn[fa][gs[r]];return Mn()};yl[bf]=!0;var br=Object.create||function(e,t){var n;return e!==null?(uh[fa]=wf(e),n=new uh,uh[fa]=null,n[bf]=e):n=Mn(),t===void 0?n:xs.f(n,t)},HS=ji,KS=Ns,Af=Error,q_=L("".replace),qS=String(Af("zxcasd").stack),dh=/\n\s*at [^:]*:[^\n]*/,YS=dh.test(qS),Au=Ht,Y_=!_(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Au(1,7)),e.stack!==7)}),S0=Ns,hh=function(e,t){if(YS&&typeof e=="string"&&!Af.prepareStackTrace)for(;t--;)e=q_(e,dh,"");return e},If=Y_,X_=Error.captureStackTrace,oc={},Iu=oc,XS=_n("iterator"),Of=Array.prototype,ph=function(e){return e!==void 0&&(Iu.Array===e||Of[XS]===e)},Ou=Ps,Nf=Ja,J_=Zc,$_=oc,Q_=_n("iterator"),ma=function(e){if(!J_(e))return Nf(e,Q_)||Nf(e,"@@iterator")||$_[Ou(e)]},Ms=Xe,vl=wr,Z_=ii,JS=il,ga=ma,ac=TypeError,fh=function(e,t){var n=arguments.length<2?ga(e):t;if(vl(n))return Z_(Ms(n,e));throw ac(JS(e)+" is not iterable")},$S=Xe,Io=ii,cc=Ja,mh=function(e,t,n){var r,o;Io(e);try{if(!(r=cc(e,"return"))){if(t==="throw")throw n;return n}r=$S(r,e)}catch(l){o=!0,r=l}if(t==="throw")throw n;if(o)throw r;return Io(r),n},QS=ec,Pf=Xe,ZS=ii,gh=il,Oo=ph,_h=ua,Nu=j,Sl=fh,eE=ma,Tl=mh,eT=TypeError,Pu=function(e,t){this.stopped=e,this.result=t},Zn=Pu.prototype,lc=function(e,t,n){var r,o,l,u,h,m,g,E=n&&n.that,S=!(!n||!n.AS_ENTRIES),R=!(!n||!n.IS_RECORD),b=!(!n||!n.IS_ITERATOR),x=!(!n||!n.INTERRUPTED),P=QS(t,E),k=function(F){return r&&Tl(r,"normal",F),new Pu(!0,F)},V=function(F){return S?(ZS(F),x?P(F[0],F[1],k):P(F[0],F[1])):x?P(F,k):P(F)};if(R)r=e.iterator;else if(b)r=e;else{if(!(o=eE(e)))throw eT(gh(e)+" is not iterable");if(Oo(o)){for(l=0,u=_h(e);u>l;l++)if((h=V(e[l]))&&Nu(Zn,h))return h;return new Pu(!1)}r=Sl(e,o)}for(m=R?e.next:r.next;!(g=Pf(m,r)).done;){try{h=V(g.value)}catch(F){Tl(r,"throw",F)}if(typeof h=="object"&&h&&Nu(Zn,h))return h}return new Pu(!1)},tE=Wr,nE=xt,Df=j,iE=ah,No=Ao,ri=function(e,t,n){for(var r=Hr(t),o=GS.f,l=vf.f,u=0;u<r.length;u++){var h=r[u];El(e,h)||n&&El(n,h)||o(e,h,l(t,h))}},Ii=br,Oi=Ns,Du=Ht,Eh=function(e,t){HS(t)&&"cause"in t&&KS(e,"cause",t.cause)},yh=function(e,t,n,r){If&&(X_?X_(e,t):S0(e,"stack",hh(n,r)))},T0=lc,lr=function(e,t){return e===void 0?arguments.length<2?"":t:tE(e)},rE=_n("toStringTag"),ku=Error,sE=[].push,Ar=function(e,t){var n,r=Df(Yr,this);No?n=No(ku(),r?iE(this):Yr):(n=r?this:Ii(Yr),Oi(n,rE,"Error")),t!==void 0&&Oi(n,"message",lr(t)),yh(n,Ar,n.stack,1),arguments.length>2&&Eh(n,arguments[2]);var o=[];return T0(e,sE,{that:o}),Oi(n,"errors",o),n};No?No(Ar,ku):ri(Ar,ku,{name:!0});var Yr=Ar.prototype=Ii(ku.prototype,{constructor:Du(1,Ar),message:Du(1,""),name:Du(1,"AggregateError")});nE({global:!0},{AggregateError:Ar});var uc,Rl,Lu,tT=qt,oE=X.WeakMap,nT=tT(oE)&&/native code/.test(String(oE)),aE=X,iT=ji,rT=Ns,kf=yi,Lf=E_,vh=sh,sT=Ds,Sh="Object already initialized",xu=aE.TypeError,oT=aE.WeakMap;if(nT||Lf.state){var Us=Lf.state||(Lf.state=new oT);Us.get=Us.get,Us.has=Us.has,Us.set=Us.set,uc=function(e,t){if(Us.has(e))throw xu(Sh);return t.facade=e,Us.set(e,t),t},Rl=function(e){return Us.get(e)||{}},Lu=function(e){return Us.has(e)}}else{var wl=vh("state");sT[wl]=!0,uc=function(e,t){if(kf(e,wl))throw xu(Sh);return t.facade=e,rT(e,wl,t),t},Rl=function(e){return kf(e,wl)?e[wl]:{}},Lu=function(e){return kf(e,wl)}}var dc,cE,lE,_a={set:uc,get:Rl,has:Lu,enforce:function(e){return Lu(e)?Rl(e):uc(e,{})},getterFor:function(e){return function(t){var n;if(!iT(t)||(n=Rl(t)).type!==e)throw xu("Incompatible receiver, "+e+" required");return n}}},xf=xn,aT=yi,uE=Function.prototype,R0=xf&&Object.getOwnPropertyDescriptor,dE=aT(uE,"name"),cT={PROPER:dE&&(function(){}).name==="something",CONFIGURABLE:dE&&(!xf||xf&&R0(uE,"name").configurable)},w0=Ns,Ea=function(e,t,n,r){return r&&r.enumerable?e[t]=n:w0(e,t,n),e},lT=_,uT=qt,Mf=ji,C0=br,dT=ah,b0=Ea,_s=_n("iterator"),Uf=!1;[].keys&&("next"in(lE=[].keys())?(cE=dT(dT(lE)))!==Object.prototype&&(dc=cE):Uf=!0);var Vf=!Mf(dc)||lT(function(){var e={};return dc[_s].call(e)!==e});uT((dc=Vf?{}:C0(dc))[_s])||b0(dc,_s,function(){return this});var hE={IteratorPrototype:dc,BUGGY_SAFARI_ITERATORS:Uf},hT=Ps,pT=ll?{}.toString:function(){return"[object "+hT(this)+"]"},pE=ll,Mu=Os.f,fE=Ns,mE=yi,A0=pT,gE=_n("toStringTag"),ya=function(e,t,n,r){if(e){var o=n?e:e.prototype;mE(o,gE)||Mu(o,gE,{configurable:!0,value:t}),r&&!pE&&fE(o,"toString",A0)}},fT=hE.IteratorPrototype,mT=br,gT=Ht,I0=ya,Xr=oc,Ir=function(){return this},Ff=function(e,t,n,r){var o=t+" Iterator";return e.prototype=mT(fT,{next:gT(+!r,n)}),I0(e,o,!1,!0),Xr[o]=Ir,e},_T=xt,ET=Xe,yT=cT,vT=Ff,_E=ah,ST=ya,Bf=Ea,EE=oc,TT=hE,yE=yT.PROPER,Uu=TT.BUGGY_SAFARI_ITERATORS,jf=_n("iterator"),Gf="keys",Cl="values",RT="entries",wT=function(){return this},Wf=function(e,t,n,r,o,l,u){vT(n,t,r);var h,m,g,E=function(V){if(V===o&&P)return P;if(!Uu&&V in b)return b[V];switch(V){case Gf:case Cl:case RT:return function(){return new n(this,V)}}return function(){return new n(this)}},S=t+" Iterator",R=!1,b=e.prototype,x=b[jf]||b["@@iterator"]||o&&b[o],P=!Uu&&x||E(o),k=t=="Array"&&b.entries||x;if(k&&(h=_E(k.call(new e)))!==Object.prototype&&h.next&&(ST(h,S,!0,!0),EE[S]=wT),yE&&o==Cl&&x&&x.name!==Cl&&(R=!0,P=function(){return ET(x,this)}),o)if(m={values:E(Cl),keys:l?P:E(Gf),entries:E(RT)},u)for(g in m)(Uu||R||!(g in b))&&Bf(b,g,m[g]);else _T({target:t,proto:!0,forced:Uu||R},m);return u&&b[jf]!==P&&Bf(b,jf,P,{}),EE[t]=P,m},zf=function(e,t){return{value:e,done:t}},Hf=ca,Po=oc,CT=_a;Os.f;var bT=Wf,Kf=zf,vE="Array Iterator",AT=CT.set,Th=CT.getterFor(vE);bT(Array,"Array",function(e,t){AT(this,{type:vE,target:Hf(e),index:0,kind:t})},function(){var e=Th(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,Kf(void 0,!0)):Kf(n=="keys"?r:n=="values"?t[r]:[r,t[r]],!1)},"values"),Po.Arguments=Po.Array;var ur=Os,qf=function(e,t,n){return ur.f(e,t,n)},O0=Zi,Yf=qf,dr=xn,IT=_n("species"),st=j,Vu=TypeError,Rh=function(e,t){if(st(t,e))return e;throw Vu("Incorrect invocation")},OT=qt,SE=E_,wh=L(Function.toString);OT(SE.inspectSource)||(SE.inspectSource=function(e){return wh(e)});var Ch=SE.inspectSource,TE=L,NT=_,RE=qt,PT=Ps,wE=Ch,Xf=function(){},er=[],Vs=Zi("Reflect","construct"),Do=/^\s*(?:class|function)\b/,DT=TE(Do.exec),kT=!Do.exec(Xf),Or=function(e){if(!RE(e))return!1;try{return Vs(Xf,er,e),!0}catch{return!1}},CE=function(e){if(!RE(e))return!1;switch(PT(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return kT||!!DT(Do,wE(e))}catch{return!0}};CE.sham=!0;var Jr,Fu,bE,Jf,bh=!Vs||NT(function(){var e;return Or(Or.call)||!Or(Object)||!Or(function(){e=!0})||e})?CE:Or,LT=bh,N0=il,$f=TypeError,Qf=ii,Fs=function(e){if(LT(e))return e;throw $f(N0(e)+" is not a constructor")},hn=Zc,Xi=_n("species"),hi=function(e,t){var n,r=Qf(e).constructor;return r===void 0||hn(n=Qf(r)[Xi])?t:Fs(n)},Ni=L([].slice),Es=TypeError,uo=function(e,t){if(e<t)throw Es("Not enough arguments");return e},Pi=/(?:ipad|iphone|ipod).*applewebkit/i.test(oo),tr=X,bl=me,Zf=ec,em=qt,Ah=yi,Nr=_,tm=lh,Bu=Ni,ko=zd,nm=uo,AE=Pi,hc=hl,ju=tr.setImmediate,Lo=tr.clearImmediate,im=tr.process,Al=tr.Dispatch,IE=tr.Function,Ih=tr.MessageChannel,rm=tr.String,nr=0,Bs={},js="onreadystatechange";Nr(function(){Jr=tr.location});var hr=function(e){if(Ah(Bs,e)){var t=Bs[e];delete Bs[e],t()}},sm=function(e){return function(){hr(e)}},om=function(e){hr(e.data)},am=function(e){tr.postMessage(rm(e),Jr.protocol+"//"+Jr.host)};ju&&Lo||(ju=function(e){nm(arguments.length,1);var t=em(e)?e:IE(e),n=Bu(arguments,1);return Bs[++nr]=function(){bl(t,void 0,n)},Fu(nr),nr},Lo=function(e){delete Bs[e]},hc?Fu=function(e){im.nextTick(sm(e))}:Al&&Al.now?Fu=function(e){Al.now(sm(e))}:Ih&&!AE?(Jf=(bE=new Ih).port2,bE.port1.onmessage=om,Fu=Zf(Jf.postMessage,Jf)):tr.addEventListener&&em(tr.postMessage)&&!tr.importScripts&&Jr&&Jr.protocol!=="file:"&&!Nr(am)?(Fu=am,tr.addEventListener("message",om,!1)):Fu=js in ko("script")?function(e){tm.appendChild(ko("script"))[js]=function(){tm.removeChild(this),hr(e)}}:function(e){setTimeout(sm(e),0)});var cm={set:ju,clear:Lo},va=function(){this.head=null,this.tail=null};va.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Il,Oh,Sa,Nh,pc,OE=va,xT=/ipad|iphone|ipod/i.test(oo)&&typeof Pebble<"u",NE=/web0s(?!.*chrome)/i.test(oo),xo=X,MT=ec,P0=Tr.f,lm=cm.set,UT=OE,Ol=Pi,D0=xT,Gu=NE,um=hl,si=xo.MutationObserver||xo.WebKitMutationObserver,VT=xo.document,PE=xo.process,dm=xo.Promise,FT=P0(xo,"queueMicrotask"),hm=FT&&FT.value;if(!hm){var Ph=new UT,pm=function(){var e,t;for(um&&(e=PE.domain)&&e.exit();t=Ph.get();)try{t()}catch(n){throw Ph.head&&Il(),n}e&&e.enter()};Ol||um||Gu||!si||!VT?!D0&&dm&&dm.resolve?((Nh=dm.resolve(void 0)).constructor=dm,pc=MT(Nh.then,Nh),Il=function(){pc(pm)}):um?Il=function(){PE.nextTick(pm)}:(lm=MT(lm,xo),Il=function(){lm(pm)}):(Oh=!0,Sa=VT.createTextNode(""),new si(pm).observe(Sa,{characterData:!0}),Il=function(){Sa.data=Oh=!Oh}),hm=function(e){Ph.head||Il(),Ph.add(e)}}var ys=hm,fc=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Nl=X.Promise,Ta=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",fm=!Ta&&!hl&&typeof window=="object"&&typeof document=="object",Pl=X,mc=Nl,DE=qt,kE=pu,k0=Ch,LE=_n,L0=fm,BT=Ta,mm=nl,Dh=mc&&mc.prototype,gm=LE("species"),xE=DE(Pl.PromiseRejectionEvent),ME=kE("Promise",function(){var e=k0(mc),t=e!==String(mc);if(!t&&mm===66||!Dh.catch||!Dh.finally)return!0;if(!mm||mm<51||!/native code/.test(e)){var n=new mc(function(o){o(1)}),r=function(o){o(function(){},function(){})};if((n.constructor={})[gm]=r,!(n.then(function(){})instanceof r))return!0}return!t&&(L0||BT)&&!xE}),kh={CONSTRUCTOR:ME,REJECTION_EVENT:xE},ho={},_m=wr,Em=TypeError,UE=function(e){var t,n;this.promise=new e(function(r,o){if(t!==void 0||n!==void 0)throw Em("Bad Promise constructor");t=r,n=o}),this.resolve=_m(t),this.reject=_m(n)};ho.f=function(e){return new UE(e)};var Wu,VE,x0=xt,Dl=hl,gc=X,Ra=Xe,M0=Ea,ym=ya,d=function(e){var t=O0(e);dr&&t&&!t[IT]&&Yf(t,IT,{configurable:!0,get:function(){return this}})},f=wr,v=qt,w=ji,N=Rh,M=hi,z=cm.set,te=ys,ae=function(e,t){try{arguments.length==1?console.error(e):console.error(e,t)}catch{}},ve=fc,Fe=OE,Be=_a,Me=Nl,et=kh,ot=ho,at="Promise",pi=et.CONSTRUCTOR,ge=et.REJECTION_EVENT,ce=Be.getterFor(at),ye=Be.set,Ge=Me&&Me.prototype,ct=Me,ht=Ge,gt=gc.TypeError,Ct=gc.document,Di=gc.process,cn=ot.f,_c=cn,U0=!!(Ct&&Ct.createEvent&&gc.dispatchEvent),bk="unhandledrejection",Ak=function(e){var t;return!(!w(e)||!v(t=e.then))&&t},Ik=function(e,t){var n,r,o,l=t.value,u=t.state==1,h=u?e.ok:e.fail,m=e.resolve,g=e.reject,E=e.domain;try{h?(u||(t.rejection===2&&NH(t),t.rejection=1),h===!0?n=l:(E&&E.enter(),n=h(l),E&&(E.exit(),o=!0)),n===e.promise?g(gt("Promise-chain cycle")):(r=Ak(n))?Ra(r,n,m,g):m(n)):g(l)}catch(S){E&&!o&&E.exit(),g(S)}},Ok=function(e,t){e.notified||(e.notified=!0,te(function(){for(var n,r=e.reactions;n=r.get();)Ik(n,e);e.notified=!1,t&&!e.rejection&&OH(e)}))},Nk=function(e,t,n){var r,o;U0?((r=Ct.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),gc.dispatchEvent(r)):r={promise:t,reason:n},!ge&&(o=gc["on"+e])?o(r):e===bk&&ae("Unhandled promise rejection",n)},OH=function(e){Ra(z,gc,function(){var t,n=e.facade,r=e.value;if(Pk(e)&&(t=ve(function(){Dl?Di.emit("unhandledRejection",r,n):Nk(bk,n,r)}),e.rejection=Dl||Pk(e)?2:1,t.error))throw t.value})},Pk=function(e){return e.rejection!==1&&!e.parent},NH=function(e){Ra(z,gc,function(){var t=e.facade;Dl?Di.emit("rejectionHandled",t):Nk("rejectionhandled",t,e.value)})},vm=function(e,t,n){return function(r){e(t,r,n)}},Sm=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,Ok(e,!0))},V0=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw gt("Promise can't be resolved itself");var r=Ak(t);r?te(function(){var o={done:!1};try{Ra(r,t,vm(V0,o,e),vm(Sm,o,e))}catch(l){Sm(o,l,e)}}):(e.value=t,e.state=1,Ok(e,!1))}catch(o){Sm({done:!1},o,e)}}};pi&&(ht=(ct=function(e){N(this,ht),f(e),Ra(Wu,this);var t=ce(this);try{e(vm(V0,t),vm(Sm,t))}catch(n){Sm(t,n)}}).prototype,(Wu=function(e){ye(this,{type:at,done:!1,notified:!1,parent:!1,reactions:new Fe,rejection:!1,state:0,value:void 0})}).prototype=M0(ht,"then",function(e,t){var n=ce(this),r=cn(M(this,ct));return n.parent=!0,r.ok=!v(e)||e,r.fail=v(t)&&t,r.domain=Dl?Di.domain:void 0,n.state==0?n.reactions.add(r):te(function(){Ik(r,n)}),r.promise}),VE=function(){var e=new Wu,t=ce(e);this.promise=e,this.resolve=vm(V0,t),this.reject=vm(Sm,t)},ot.f=cn=function(e){return e===ct||e===void 0?new VE(e):_c(e)}),x0({global:!0,wrap:!0,forced:pi},{Promise:ct}),ym(ct,at,!1,!0),d(at);var Dk=_n("iterator"),kk=!1;try{var PH=0,Lk={next:function(){return{done:!!PH++}},return:function(){kk=!0}};Lk[Dk]=function(){return this},Array.from(Lk,function(){throw 2})}catch{}var DH=Nl,kH=function(e,t){if(!kk)return!1;var n=!1;try{var r={};r[Dk]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch{}return n},jT=kh.CONSTRUCTOR||!kH(function(e){DH.all(e).then(void 0,function(){})}),LH=Xe,xH=wr,MH=ho,UH=fc,VH=lc;xt({target:"Promise",stat:!0,forced:jT},{all:function(e){var t=this,n=MH.f(t),r=n.resolve,o=n.reject,l=UH(function(){var u=xH(t.resolve),h=[],m=0,g=1;VH(e,function(E){var S=m++,R=!1;g++,LH(u,t,E).then(function(b){R||(R=!0,h[S]=b,--g||r(h))},o)}),--g||r(h)});return l.error&&o(l.value),n.promise}});var FH=xt,BH=kh.CONSTRUCTOR;Nl&&Nl.prototype,FH({target:"Promise",proto:!0,forced:BH,real:!0},{catch:function(e){return this.then(void 0,e)}});var jH=Xe,GH=wr,WH=ho,zH=fc,HH=lc;xt({target:"Promise",stat:!0,forced:jT},{race:function(e){var t=this,n=WH.f(t),r=n.reject,o=zH(function(){var l=GH(t.resolve);HH(e,function(u){jH(l,t,u).then(n.resolve,r)})});return o.error&&r(o.value),n.promise}});var KH=Xe,qH=ho;xt({target:"Promise",stat:!0,forced:kh.CONSTRUCTOR},{reject:function(e){var t=qH.f(this);return KH(t.reject,void 0,e),t.promise}});var YH=ii,XH=ji,JH=ho,xk=function(e,t){if(YH(e),XH(t)&&t.constructor===e)return t;var n=JH.f(e);return(0,n.resolve)(t),n.promise},$H=xt,QH=Nl,ZH=kh.CONSTRUCTOR,eK=xk,tK=Zi("Promise"),nK=!ZH;$H({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return eK(nK&&this===tK?QH:this,e)}});var iK=Xe,rK=wr,sK=ho,oK=fc,aK=lc;xt({target:"Promise",stat:!0,forced:jT},{allSettled:function(e){var t=this,n=sK.f(t),r=n.resolve,o=n.reject,l=oK(function(){var u=rK(t.resolve),h=[],m=0,g=1;aK(e,function(E){var S=m++,R=!1;g++,iK(u,t,E).then(function(b){R||(R=!0,h[S]={status:"fulfilled",value:b},--g||r(h))},function(b){R||(R=!0,h[S]={status:"rejected",reason:b},--g||r(h))})}),--g||r(h)});return l.error&&o(l.value),n.promise}});var cK=Xe,lK=wr,uK=Zi,dK=ho,hK=fc,pK=lc,Mk="No one promise resolved";xt({target:"Promise",stat:!0,forced:jT},{any:function(e){var t=this,n=uK("AggregateError"),r=dK.f(t),o=r.resolve,l=r.reject,u=hK(function(){var h=lK(t.resolve),m=[],g=0,E=1,S=!1;pK(e,function(R){var b=g++,x=!1;E++,cK(h,t,R).then(function(P){x||S||(S=!0,o(P))},function(P){x||S||(x=!0,m[b]=P,--E||l(new n(m,Mk)))})}),--E||l(new n(m,Mk))});return u.error&&l(u.value),r.promise}});var fK=xt,F0=Nl,mK=_,gK=Zi,_K=qt,EK=hi,Uk=xk,yK=F0&&F0.prototype;fK({target:"Promise",proto:!0,real:!0,forced:!!F0&&mK(function(){yK.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=EK(this,gK("Promise")),n=_K(e);return this.then(n?function(r){return Uk(t,e()).then(function(){return r})}:e,n?function(r){return Uk(t,e()).then(function(){throw r})}:e)}});var B0=L,vK=Qd,SK=Wr,TK=el,RK=B0("".charAt),Vk=B0("".charCodeAt),wK=B0("".slice),Fk=function(e){return function(t,n){var r,o,l=SK(TK(t)),u=vK(n),h=l.length;return u<0||u>=h?e?"":void 0:(r=Vk(l,u))<55296||r>56319||u+1===h||(o=Vk(l,u+1))<56320||o>57343?e?RK(l,u):r:e?wK(l,u,u+2):o-56320+(r-55296<<10)+65536}},j0={codeAt:Fk(!1),charAt:Fk(!0)},CK=j0.charAt,bK=Wr,Bk=_a,AK=Wf,jk=zf,Gk="String Iterator",IK=Bk.set,OK=Bk.getterFor(Gk);AK(String,"String",function(e){IK(this,{type:Gk,string:bK(e),index:0})},function(){var e,t=OK(this),n=t.string,r=t.index;return r>=n.length?jk(void 0,!0):(e=CK(n,r),t.index+=e.length,jk(e,!1))});var NK=Rr.Promise,PK={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},DK=X,kK=Ps,LK=Ns,Wk=oc,zk=_n("toStringTag");for(var G0 in PK){var Hk=DK[G0],W0=Hk&&Hk.prototype;W0&&kK(W0)!==zk&&LK(W0,zk,G0),Wk[G0]=Wk.Array}var Kk=NK,we=p(Kk),xK=fs("Array").values,MK=Ps,UK=yi,VK=j,FK=xK,z0=Array.prototype,BK={DOMTokenList:!0,NodeList:!0},jK=function(e){var t=e.values;return e===z0||VK(z0,e)&&t===z0.values||UK(BK,MK(e))?FK:t},Gs=p(jK),GK=_,WK=_n("iterator"),H0=!GK(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2"),r="";return e.pathname="c%20d",t.forEach(function(o,l){t.delete("b"),r+=l+o}),n.delete("a",2),!e.toJSON||!n.has("a",1)||n.has("a",2)||!t.size&&!0||!t.sort||e.href!=="http://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[WK]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||r!=="a1c3"||new URL("http://x",void 0).host!=="x"}),zK=Ea,HK=hu,KK=Os,qK=Ht,GT=function(e,t,n){var r=HK(t);r in e?KK.f(e,r,qK(0,n)):e[r]=n},qk=uf,YK=ua,XK=GT,JK=Array,$K=Math.max,K0=function(e,t,n){for(var r=YK(e),o=qk(t,r),l=qk(n===void 0?r:n,r),u=JK($K(l-o,0)),h=0;o<l;o++,h++)XK(u,h,e[o]);return u.length=h,u},Yk=K0,QK=Math.floor,q0=function(e,t){var n=e.length,r=QK(n/2);return n<8?ZK(e,t):eq(e,q0(Yk(e,0,r),t),q0(Yk(e,r),t),t)},ZK=function(e,t){for(var n,r,o=e.length,l=1;l<o;){for(r=l,n=e[l];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==l++&&(e[r]=n)}return e},eq=function(e,t,n,r){for(var o=t.length,l=n.length,u=0,h=0;u<o||h<l;)e[u+h]=u<o&&h<l?r(t[u],n[h])<=0?t[u++]:n[h++]:u<o?t[u++]:n[h++];return e},Xk=q0,Y0=xt,Tm=X,WT=Xe,Ec=L,Rm=xn,Jk=H0,$k=Ea,tq=qf,nq=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:zK(e,r,t[r],n);return e},iq=ya,rq=Ff,X0=_a,Qk=Rh,J0=qt,sq=yi,oq=ec,aq=Ps,cq=ii,Zk=ji,vs=Wr,lq=br,eL=Ht,$0=fh,uq=ma,wm=uo,dq=Xk,hq=_n("iterator"),FE="URLSearchParams",tL=FE+"Iterator",nL=X0.set,Mo=X0.getterFor(FE),pq=X0.getterFor(tL),fq=Object.getOwnPropertyDescriptor,Q0=function(e){if(!Rm)return Tm[e];var t=fq(Tm,e);return t&&t.value},iL=Q0("fetch"),zT=Q0("Request"),BE=Q0("Headers"),Z0=zT&&zT.prototype,rL=BE&&BE.prototype,mq=Tm.RegExp,gq=Tm.TypeError,sL=Tm.decodeURIComponent,_q=Tm.encodeURIComponent,Eq=Ec("".charAt),oL=Ec([].join),Lh=Ec([].push),eA=Ec("".replace),yq=Ec([].shift),aL=Ec([].splice),cL=Ec("".split),vq=Ec("".slice),Sq=/\+/g,lL=Array(4),Tq=function(e){return lL[e-1]||(lL[e-1]=mq("((?:%[\\da-f]{2}){"+e+"})","gi"))},Rq=function(e){try{return sL(e)}catch{return e}},uL=function(e){var t=eA(e,Sq," "),n=4;try{return sL(t)}catch{for(;n;)t=eA(t,Tq(n--),Rq);return t}},wq=/[!'()~]|%20/g,Cq={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},bq=function(e){return Cq[e]},dL=function(e){return eA(_q(e),wq,bq)},tA=rq(function(e,t){nL(this,{type:tL,iterator:$0(Mo(e).entries),kind:t})},"Iterator",function(){var e=pq(this),t=e.kind,n=e.iterator.next(),r=n.value;return n.done||(n.value=t==="keys"?r.key:t==="values"?r.value:[r.key,r.value]),n},!0),hL=function(e){this.entries=[],this.url=null,e!==void 0&&(Zk(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?Eq(e,0)==="?"?vq(e,1):e:vs(e)))};hL.prototype={type:FE,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,o,l,u,h,m=uq(e);if(m)for(n=(t=$0(e,m)).next;!(r=WT(n,t)).done;){if(l=(o=$0(cq(r.value))).next,(u=WT(l,o)).done||(h=WT(l,o)).done||!WT(l,o).done)throw gq("Expected sequence with length 2");Lh(this.entries,{key:vs(u.value),value:vs(h.value)})}else for(var g in e)sq(e,g)&&Lh(this.entries,{key:g,value:vs(e[g])})},parseQuery:function(e){if(e)for(var t,n,r=cL(e,"&"),o=0;o<r.length;)(t=r[o++]).length&&(n=cL(t,"="),Lh(this.entries,{key:uL(yq(n)),value:uL(oL(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],Lh(n,dL(e.key)+"="+dL(e.value));return oL(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var HT=function(){Qk(this,Cm);var e=nL(this,new hL(arguments.length>0?arguments[0]:void 0));Rm||(this.size=e.entries.length)},Cm=HT.prototype;if(nq(Cm,{append:function(e,t){var n=Mo(this);wm(arguments.length,2),Lh(n.entries,{key:vs(e),value:vs(t)}),Rm||this.length++,n.updateURL()},delete:function(e){for(var t=Mo(this),n=wm(arguments.length,1),r=t.entries,o=vs(e),l=n<2?void 0:arguments[1],u=l===void 0?l:vs(l),h=0;h<r.length;){var m=r[h];if(m.key!==o||u!==void 0&&m.value!==u)h++;else if(aL(r,h,1),u!==void 0)break}Rm||(this.size=r.length),t.updateURL()},get:function(e){var t=Mo(this).entries;wm(arguments.length,1);for(var n=vs(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){var t=Mo(this).entries;wm(arguments.length,1);for(var n=vs(e),r=[],o=0;o<t.length;o++)t[o].key===n&&Lh(r,t[o].value);return r},has:function(e){for(var t=Mo(this).entries,n=wm(arguments.length,1),r=vs(e),o=n<2?void 0:arguments[1],l=o===void 0?o:vs(o),u=0;u<t.length;){var h=t[u++];if(h.key===r&&(l===void 0||h.value===l))return!0}return!1},set:function(e,t){var n=Mo(this);wm(arguments.length,1);for(var r,o=n.entries,l=!1,u=vs(e),h=vs(t),m=0;m<o.length;m++)(r=o[m]).key===u&&(l?aL(o,m--,1):(l=!0,r.value=h));l||Lh(o,{key:u,value:h}),Rm||(this.size=o.length),n.updateURL()},sort:function(){var e=Mo(this);dq(e.entries,function(t,n){return t.key>n.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=Mo(this).entries,r=oq(e,arguments.length>1?arguments[1]:void 0),o=0;o<n.length;)r((t=n[o++]).value,t.key,this)},keys:function(){return new tA(this,"keys")},values:function(){return new tA(this,"values")},entries:function(){return new tA(this,"entries")}},{enumerable:!0}),$k(Cm,hq,Cm.entries,{}),$k(Cm,"toString",function(){return Mo(this).serialize()},{enumerable:!0}),Rm&&tq(Cm,"size",{get:function(){return Mo(this).entries.length},configurable:!0,enumerable:!0}),iq(HT,FE),Y0({global:!0,forced:!Jk},{URLSearchParams:HT}),!Jk&&J0(BE)){var Aq=Ec(rL.has),Iq=Ec(rL.set),pL=function(e){if(Zk(e)){var t,n=e.body;if(aq(n)===FE)return t=e.headers?new BE(e.headers):new BE,Aq(t,"content-type")||Iq(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),lq(e,{body:eL(0,vs(n)),headers:eL(0,t)})}return e};if(J0(iL)&&Y0({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return iL(e,arguments.length>1?pL(arguments[1]):{})}}),J0(zT)){var nA=function(e){return Qk(this,Z0),new zT(e,arguments.length>1?pL(arguments[1]):{})};Z0.constructor=nA,nA.prototype=Z0,Y0({global:!0,dontCallGetSet:!0,forced:!0},{Request:nA})}}var Uo,Oq={URLSearchParams:HT,getState:Mo},Nq=Rr.URLSearchParams,fL=xn,Pq=L,Dq=Xe,kq=_,iA=Ls,Lq=ks,xq=$e,Mq=bo,Uq=Qc,bm=Object.assign,mL=Object.defineProperty,Vq=Pq([].concat),Fq=!bm||kq(function(){if(fL&&bm({b:1},bm(mL({},"a",{enumerable:!0,get:function(){mL(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(o){t[o]=o}),bm({},e)[n]!=7||iA(bm({},t)).join("")!=r})?function(e,t){for(var n=Mq(e),r=arguments.length,o=1,l=Lq.f,u=xq.f;r>o;)for(var h,m=Uq(arguments[o++]),g=l?Vq(iA(m),l(m)):iA(m),E=g.length,S=0;E>S;)h=g[S++],fL&&!Dq(u,m,h)||(n[h]=m[h]);return n}:bm,Bq=ii,jq=mh,Gq=ec,Wq=Xe,zq=bo,Hq=function(e,t,n,r){try{return r?t(Bq(n)[0],n[1]):t(n)}catch(o){jq(e,"throw",o)}},Kq=ph,qq=bh,Yq=ua,gL=GT,Xq=fh,Jq=ma,_L=Array,xh=L,rA=2147483647,$q=/[^\0-\u007E]/,EL=/[.\u3002\uFF0E\uFF61]/g,yL="Overflow: input needs wider integers to process",vL=RangeError,Qq=xh(EL.exec),Am=Math.floor,sA=String.fromCharCode,SL=xh("".charCodeAt),TL=xh([].join),zu=xh([].push),Zq=xh("".replace),eY=xh("".split),tY=xh("".toLowerCase),RL=function(e){return e+22+75*(e<26)},nY=function(e,t,n){var r=0;for(e=n?Am(e/700):e>>1,e+=Am(e/t);e>455;)e=Am(e/35),r+=36;return Am(r+36*e/(e+38))},iY=function(e){var t=[];e=function(V){for(var F=[],K=0,$=V.length;K<$;){var Z=SL(V,K++);if(Z>=55296&&Z<=56319&&K<$){var J=SL(V,K++);(64512&J)==56320?zu(F,((1023&Z)<<10)+(1023&J)+65536):(zu(F,Z),K--)}else zu(F,Z)}return F}(e);var n,r,o=e.length,l=128,u=0,h=72;for(n=0;n<e.length;n++)(r=e[n])<128&&zu(t,sA(r));var m=t.length,g=m;for(m&&zu(t,"-");g<o;){var E=rA;for(n=0;n<e.length;n++)(r=e[n])>=l&&r<E&&(E=r);var S=g+1;if(E-l>Am((rA-u)/S))throw vL(yL);for(u+=(E-l)*S,l=E,n=0;n<e.length;n++){if((r=e[n])<l&&++u>rA)throw vL(yL);if(r==l){for(var R=u,b=36;;){var x=b<=h?1:b>=h+26?26:b-h;if(R<x)break;var P=R-x,k=36-x;zu(t,sA(RL(x+P%k))),R=Am(P/k),b+=36}zu(t,sA(RL(R))),h=nY(u,S,g==m),u=0,g++}}u++,l++}return TL(t,"")},rY=xt,oA=xn,sY=H0,aA=X,wL=ec,Vo=L,KT=Ea,Fo=qf,oY=Rh,cA=yi,lA=Fq,Im=function(e){var t=zq(e),n=qq(this),r=arguments.length,o=r>1?arguments[1]:void 0,l=o!==void 0;l&&(o=Gq(o,r>2?arguments[2]:void 0));var u,h,m,g,E,S,R=Jq(t),b=0;if(!R||this===_L&&Kq(R))for(u=Yq(t),h=n?new this(u):_L(u);u>b;b++)S=l?o(t[b],b):t[b],gL(h,b,S);else for(E=(g=Xq(t,R)).next,h=n?new this:[];!(m=Wq(E,g)).done;b++)S=l?Hq(g,o,[m.value,b],!0):m.value,gL(h,b,S);return h.length=b,h},wa=K0,aY=j0.codeAt,cY=function(e){var t,n,r=[],o=eY(Zq(tY(e),EL,"."),".");for(t=0;t<o.length;t++)n=o[t],zu(r,Qq($q,n)?"xn--"+iY(n):n);return TL(r,".")},kl=Wr,lY=ya,uY=uo,CL=Oq,bL=_a,dY=bL.set,qT=bL.getterFor("URL"),hY=CL.URLSearchParams,pY=CL.getState,jE=aA.URL,uA=aA.TypeError,YT=aA.parseInt,fY=Math.floor,AL=Math.pow,Bo=Vo("".charAt),Ca=Vo(/./.exec),GE=Vo([].join),mY=Vo(1 .toString),gY=Vo([].pop),Om=Vo([].push),dA=Vo("".replace),_Y=Vo([].shift),EY=Vo("".split),WE=Vo("".slice),XT=Vo("".toLowerCase),yY=Vo([].unshift),hA="Invalid scheme",Mh="Invalid host",IL="Invalid port",OL=/[a-z]/i,vY=/[\d+-.a-z]/i,pA=/\d/,SY=/^0x/i,TY=/^[0-7]+$/,RY=/^\d+$/,NL=/^[\da-f]+$/i,wY=/[\0\t\n\r #%/:<>?@[\\\]^|]/,CY=/[\0\t\n\r #/:<>?@[\\\]^|]/,bY=/^[\u0000-\u0020]+/,AY=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,IY=/[\t\n\r]/g,zE=function(e){var t,n,r,o;if(typeof e=="number"){for(t=[],n=0;n<4;n++)yY(t,e%256),e=fY(e/256);return GE(t,".")}if(typeof e=="object"){for(t="",r=function(l){for(var u=null,h=1,m=null,g=0,E=0;E<8;E++)l[E]!==0?(g>h&&(u=m,h=g),m=null,g=0):(m===null&&(m=E),++g);return g>h&&(u=m,h=g),u}(e),n=0;n<8;n++)o&&e[n]===0||(o&&(o=!1),r===n?(t+=n?":":"::",o=!0):(t+=mY(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},JT={},PL=lA({},JT,{" ":1,'"':1,"<":1,">":1,"`":1}),DL=lA({},PL,{"#":1,"?":1,"{":1,"}":1}),fA=lA({},DL,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Hu=function(e,t){var n=aY(e,0);return n>32&&n<127&&!cA(t,e)?e:encodeURIComponent(e)},$T={ftp:21,file:null,http:80,https:443,ws:80,wss:443},HE=function(e,t){var n;return e.length==2&&Ca(OL,Bo(e,0))&&((n=Bo(e,1))==":"||!t&&n=="|")},kL=function(e){var t;return e.length>1&&HE(WE(e,0,2))&&(e.length==2||(t=Bo(e,2))==="/"||t==="\\"||t==="?"||t==="#")},OY=function(e){return e==="."||XT(e)==="%2e"},mA={},LL={},gA={},xL={},ML={},_A={},UL={},VL={},QT={},ZT={},EA={},yA={},vA={},SA={},FL={},TA={},Nm={},yc={},BL={},Uh={},Ll={},RA=function(e,t,n){var r,o,l,u=kl(e);if(t){if(o=this.parse(u))throw uA(o);this.searchParams=null}else{if(n!==void 0&&(r=new RA(n,!0)),o=this.parse(u,null,r))throw uA(o);(l=pY(new hY)).bindURL(this),this.searchParams=l}};RA.prototype={type:"URL",parse:function(e,t,n){var r,o,l,u,h,m=this,g=t||mA,E=0,S="",R=!1,b=!1,x=!1;for(e=kl(e),t||(m.scheme="",m.username="",m.password="",m.host=null,m.port=null,m.path=[],m.query=null,m.fragment=null,m.cannotBeABaseURL=!1,e=dA(e,bY,""),e=dA(e,AY,"$1")),e=dA(e,IY,""),r=Im(e);E<=r.length;){switch(o=r[E],g){case mA:if(!o||!Ca(OL,o)){if(t)return hA;g=gA;continue}S+=XT(o),g=LL;break;case LL:if(o&&(Ca(vY,o)||o=="+"||o=="-"||o=="."))S+=XT(o);else{if(o!=":"){if(t)return hA;S="",g=gA,E=0;continue}if(t&&(m.isSpecial()!=cA($T,S)||S=="file"&&(m.includesCredentials()||m.port!==null)||m.scheme=="file"&&!m.host))return;if(m.scheme=S,t)return void(m.isSpecial()&&$T[m.scheme]==m.port&&(m.port=null));S="",m.scheme=="file"?g=SA:m.isSpecial()&&n&&n.scheme==m.scheme?g=xL:m.isSpecial()?g=VL:r[E+1]=="/"?(g=ML,E++):(m.cannotBeABaseURL=!0,Om(m.path,""),g=BL)}break;case gA:if(!n||n.cannotBeABaseURL&&o!="#")return hA;if(n.cannotBeABaseURL&&o=="#"){m.scheme=n.scheme,m.path=wa(n.path),m.query=n.query,m.fragment="",m.cannotBeABaseURL=!0,g=Ll;break}g=n.scheme=="file"?SA:_A;continue;case xL:if(o!="/"||r[E+1]!="/"){g=_A;continue}g=QT,E++;break;case ML:if(o=="/"){g=ZT;break}g=yc;continue;case _A:if(m.scheme=n.scheme,o==Uo)m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,m.path=wa(n.path),m.query=n.query;else if(o=="/"||o=="\\"&&m.isSpecial())g=UL;else if(o=="?")m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,m.path=wa(n.path),m.query="",g=Uh;else{if(o!="#"){m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,m.path=wa(n.path),m.path.length--,g=yc;continue}m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,m.path=wa(n.path),m.query=n.query,m.fragment="",g=Ll}break;case UL:if(!m.isSpecial()||o!="/"&&o!="\\"){if(o!="/"){m.username=n.username,m.password=n.password,m.host=n.host,m.port=n.port,g=yc;continue}g=ZT}else g=QT;break;case VL:if(g=QT,o!="/"||Bo(S,E+1)!="/")continue;E++;break;case QT:if(o!="/"&&o!="\\"){g=ZT;continue}break;case ZT:if(o=="@"){R&&(S="%40"+S),R=!0,l=Im(S);for(var P=0;P<l.length;P++){var k=l[P];if(k!=":"||x){var V=Hu(k,fA);x?m.password+=V:m.username+=V}else x=!0}S=""}else if(o==Uo||o=="/"||o=="?"||o=="#"||o=="\\"&&m.isSpecial()){if(R&&S=="")return"Invalid authority";E-=Im(S).length+1,S="",g=EA}else S+=o;break;case EA:case yA:if(t&&m.scheme=="file"){g=TA;continue}if(o!=":"||b){if(o==Uo||o=="/"||o=="?"||o=="#"||o=="\\"&&m.isSpecial()){if(m.isSpecial()&&S=="")return Mh;if(t&&S==""&&(m.includesCredentials()||m.port!==null))return;if(u=m.parseHost(S))return u;if(S="",g=Nm,t)return;continue}o=="["?b=!0:o=="]"&&(b=!1),S+=o}else{if(S=="")return Mh;if(u=m.parseHost(S))return u;if(S="",g=vA,t==yA)return}break;case vA:if(!Ca(pA,o)){if(o==Uo||o=="/"||o=="?"||o=="#"||o=="\\"&&m.isSpecial()||t){if(S!=""){var F=YT(S,10);if(F>65535)return IL;m.port=m.isSpecial()&&F===$T[m.scheme]?null:F,S=""}if(t)return;g=Nm;continue}return IL}S+=o;break;case SA:if(m.scheme="file",o=="/"||o=="\\")g=FL;else{if(!n||n.scheme!="file"){g=yc;continue}if(o==Uo)m.host=n.host,m.path=wa(n.path),m.query=n.query;else if(o=="?")m.host=n.host,m.path=wa(n.path),m.query="",g=Uh;else{if(o!="#"){kL(GE(wa(r,E),""))||(m.host=n.host,m.path=wa(n.path),m.shortenPath()),g=yc;continue}m.host=n.host,m.path=wa(n.path),m.query=n.query,m.fragment="",g=Ll}}break;case FL:if(o=="/"||o=="\\"){g=TA;break}n&&n.scheme=="file"&&!kL(GE(wa(r,E),""))&&(HE(n.path[0],!0)?Om(m.path,n.path[0]):m.host=n.host),g=yc;continue;case TA:if(o==Uo||o=="/"||o=="\\"||o=="?"||o=="#"){if(!t&&HE(S))g=yc;else if(S==""){if(m.host="",t)return;g=Nm}else{if(u=m.parseHost(S))return u;if(m.host=="localhost"&&(m.host=""),t)return;S="",g=Nm}continue}S+=o;break;case Nm:if(m.isSpecial()){if(g=yc,o!="/"&&o!="\\")continue}else if(t||o!="?")if(t||o!="#"){if(o!=Uo&&(g=yc,o!="/"))continue}else m.fragment="",g=Ll;else m.query="",g=Uh;break;case yc:if(o==Uo||o=="/"||o=="\\"&&m.isSpecial()||!t&&(o=="?"||o=="#")){if((h=XT(h=S))===".."||h==="%2e."||h===".%2e"||h==="%2e%2e"?(m.shortenPath(),o=="/"||o=="\\"&&m.isSpecial()||Om(m.path,"")):OY(S)?o=="/"||o=="\\"&&m.isSpecial()||Om(m.path,""):(m.scheme=="file"&&!m.path.length&&HE(S)&&(m.host&&(m.host=""),S=Bo(S,0)+":"),Om(m.path,S)),S="",m.scheme=="file"&&(o==Uo||o=="?"||o=="#"))for(;m.path.length>1&&m.path[0]==="";)_Y(m.path);o=="?"?(m.query="",g=Uh):o=="#"&&(m.fragment="",g=Ll)}else S+=Hu(o,DL);break;case BL:o=="?"?(m.query="",g=Uh):o=="#"?(m.fragment="",g=Ll):o!=Uo&&(m.path[0]+=Hu(o,JT));break;case Uh:t||o!="#"?o!=Uo&&(o=="'"&&m.isSpecial()?m.query+="%27":m.query+=o=="#"?"%23":Hu(o,JT)):(m.fragment="",g=Ll);break;case Ll:o!=Uo&&(m.fragment+=Hu(o,PL))}E++}},parseHost:function(e){var t,n,r;if(Bo(e,0)=="["){if(Bo(e,e.length-1)!="]"||(t=function(o){var l,u,h,m,g,E,S,R=[0,0,0,0,0,0,0,0],b=0,x=null,P=0,k=function(){return Bo(o,P)};if(k()==":"){if(Bo(o,1)!=":")return;P+=2,x=++b}for(;k();){if(b==8)return;if(k()!=":"){for(l=u=0;u<4&&Ca(NL,k());)l=16*l+YT(k(),16),P++,u++;if(k()=="."){if(u==0||(P-=u,b>6))return;for(h=0;k();){if(m=null,h>0){if(!(k()=="."&&h<4))return;P++}if(!Ca(pA,k()))return;for(;Ca(pA,k());){if(g=YT(k(),10),m===null)m=g;else{if(m==0)return;m=10*m+g}if(m>255)return;P++}R[b]=256*R[b]+m,++h!=2&&h!=4||b++}if(h!=4)return;break}if(k()==":"){if(P++,!k())return}else if(k())return;R[b++]=l}else{if(x!==null)return;P++,x=++b}}if(x!==null)for(E=b-x,b=7;b!=0&&E>0;)S=R[b],R[b--]=R[x+E-1],R[x+--E]=S;else if(b!=8)return;return R}(WE(e,1,-1)),!t))return Mh;this.host=t}else if(this.isSpecial()){if(e=cY(e),Ca(wY,e)||(t=function(o){var l,u,h,m,g,E,S,R=EY(o,".");if(R.length&&R[R.length-1]==""&&R.length--,(l=R.length)>4)return o;for(u=[],h=0;h<l;h++){if((m=R[h])=="")return o;if(g=10,m.length>1&&Bo(m,0)=="0"&&(g=Ca(SY,m)?16:8,m=WE(m,g==8?1:2)),m==="")E=0;else{if(!Ca(g==10?RY:g==8?TY:NL,m))return o;E=YT(m,g)}Om(u,E)}for(h=0;h<l;h++)if(E=u[h],h==l-1){if(E>=AL(256,5-l))return null}else if(E>255)return null;for(S=gY(u),h=0;h<u.length;h++)S+=u[h]*AL(256,3-h);return S}(e),t===null))return Mh;this.host=t}else{if(Ca(CY,e))return Mh;for(t="",n=Im(e),r=0;r<n.length;r++)t+=Hu(n[r],JT);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return cA($T,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme=="file"&&t==1&&HE(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,o=e.host,l=e.port,u=e.path,h=e.query,m=e.fragment,g=t+":";return o!==null?(g+="//",e.includesCredentials()&&(g+=n+(r?":"+r:"")+"@"),g+=zE(o),l!==null&&(g+=":"+l)):t=="file"&&(g+="//"),g+=e.cannotBeABaseURL?u[0]:u.length?"/"+GE(u,"/"):"",h!==null&&(g+="?"+h),m!==null&&(g+="#"+m),g},setHref:function(e){var t=this.parse(e);if(t)throw uA(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e=="blob")try{return new Pm(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+zE(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(kl(e)+":",mA)},getUsername:function(){return this.username},setUsername:function(e){var t=Im(kl(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=Hu(t[n],fA)}},getPassword:function(){return this.password},setPassword:function(e){var t=Im(kl(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=Hu(t[n],fA)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?zE(e):zE(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,EA)},getHostname:function(){var e=this.host;return e===null?"":zE(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,yA)},getPort:function(){var e=this.port;return e===null?"":kl(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=kl(e))==""?this.port=null:this.parse(e,vA))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+GE(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Nm))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=kl(e))==""?this.query=null:(Bo(e,0)=="?"&&(e=WE(e,1)),this.query="",this.parse(e,Uh)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=kl(e))!=""?(Bo(e,0)=="#"&&(e=WE(e,1)),this.fragment="",this.parse(e,Ll)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Pm=function(e){var t=oY(this,Ss),n=uY(arguments.length,1)>1?arguments[1]:void 0,r=dY(t,new RA(e,!1,n));oA||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},Ss=Pm.prototype,jo=function(e,t){return{get:function(){return qT(this)[e]()},set:t&&function(n){return qT(this)[t](n)},configurable:!0,enumerable:!0}};if(oA&&(Fo(Ss,"href",jo("serialize","setHref")),Fo(Ss,"origin",jo("getOrigin")),Fo(Ss,"protocol",jo("getProtocol","setProtocol")),Fo(Ss,"username",jo("getUsername","setUsername")),Fo(Ss,"password",jo("getPassword","setPassword")),Fo(Ss,"host",jo("getHost","setHost")),Fo(Ss,"hostname",jo("getHostname","setHostname")),Fo(Ss,"port",jo("getPort","setPort")),Fo(Ss,"pathname",jo("getPathname","setPathname")),Fo(Ss,"search",jo("getSearch","setSearch")),Fo(Ss,"searchParams",jo("getSearchParams")),Fo(Ss,"hash",jo("getHash","setHash"))),KT(Ss,"toJSON",function(){return qT(this).serialize()},{enumerable:!0}),KT(Ss,"toString",function(){return qT(this).serialize()},{enumerable:!0}),jE){var jL=jE.createObjectURL,GL=jE.revokeObjectURL;jL&&KT(Pm,"createObjectURL",wL(jL,jE)),GL&&KT(Pm,"revokeObjectURL",wL(GL,jE))}lY(Pm,"URL"),rY({global:!0,forced:!sY,sham:!oA},{URL:Pm});var NY=xt,PY=_,DY=uo,WL=Wr,kY=H0,zL=Zi("URL");NY({target:"URL",stat:!0,forced:!(kY&&PY(function(){zL.canParse()}))},{canParse:function(e){var t=DY(arguments.length,1),n=WL(e),r=t<2||arguments[1]===void 0?void 0:WL(arguments[1]);try{return!!new zL(n,r)}catch{return!1}}});var eR=p(Rr.URL);let HL=!0,KL=!0;function tR(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function Vh(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,o=r.addEventListener;r.addEventListener=function(u,h){if(u!==t)return o.apply(this,arguments);const m=g=>{const E=n(g);E&&(h.handleEvent?h.handleEvent(E):h(E))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(h,m),o.apply(this,[u,m])};const l=r.removeEventListener;r.removeEventListener=function(u,h){if(u!==t||!this._eventMap||!this._eventMap[t])return l.apply(this,arguments);if(!this._eventMap[t].has(h))return l.apply(this,arguments);const m=this._eventMap[t].get(h);return this._eventMap[t].delete(h),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,l.apply(this,[u,m])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(u){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),u&&this.addEventListener(t,this["_on"+t]=u)},enumerable:!0,configurable:!0})}function LY(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(HL=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function xY(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(KL=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function qL(){if(typeof window=="object"){if(HL)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function wA(e,t){KL&&console.warn(e+" is deprecated, please use "+t+" instead.")}function YL(e){return Object.prototype.toString.call(e)==="[object Object]"}function XL(e){var t;return YL(e)?ms(t=Object.keys(e)).call(t,function(n,r){const o=YL(e[r]),l=o?XL(e[r]):e[r],u=o&&!Object.keys(l).length;return l===void 0||u?n:Object.assign(n,{[r]:l})},{}):e}function CA(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?CA(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(o=>{CA(e,e.get(o),n)})}))}function JL(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",o=new Map;if(t===null)return o;const l=[];return e.forEach(u=>{u.type==="track"&&u.trackIdentifier===t.id&&l.push(u)}),l.forEach(u=>{e.forEach(h=>{h.type===r&&h.trackId===u.id&&CA(e,h,o)})}),o}const $L=qL;function QL(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(u){if(typeof u!="object"||u.mandatory||u.optional)return u;const h={};return Object.keys(u).forEach(m=>{if(m==="require"||m==="advanced"||m==="mediaSource")return;const g=typeof u[m]=="object"?u[m]:{ideal:u[m]};g.exact!==void 0&&typeof g.exact=="number"&&(g.min=g.max=g.exact);const E=function(S,R){return S?S+R.charAt(0).toUpperCase()+R.slice(1):R==="deviceId"?"sourceId":R};if(g.ideal!==void 0){h.optional=h.optional||[];let S={};typeof g.ideal=="number"?(S[E("min",m)]=g.ideal,h.optional.push(S),S={},S[E("max",m)]=g.ideal,h.optional.push(S)):(S[E("",m)]=g.ideal,h.optional.push(S))}g.exact!==void 0&&typeof g.exact!="number"?(h.mandatory=h.mandatory||{},h.mandatory[E("",m)]=g.exact):["min","max"].forEach(S=>{g[S]!==void 0&&(h.mandatory=h.mandatory||{},h.mandatory[E(S,m)]=g[S])})}),u.advanced&&(h.optional=(h.optional||[]).concat(u.advanced)),h},o=function(u,h){if(t.version>=61)return h(u);if((u=JSON.parse(JSON.stringify(u)))&&typeof u.audio=="object"){const m=function(g,E,S){E in g&&!(S in g)&&(g[S]=g[E],delete g[E])};m((u=JSON.parse(JSON.stringify(u))).audio,"autoGainControl","googAutoGainControl"),m(u.audio,"noiseSuppression","googNoiseSuppression"),u.audio=r(u.audio)}if(u&&typeof u.video=="object"){let m=u.video.facingMode;m=m&&(typeof m=="object"?m:{ideal:m});const g=t.version<66;if(m&&(m.exact==="user"||m.exact==="environment"||m.ideal==="user"||m.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||g)){let E;if(delete u.video.facingMode,m.exact==="environment"||m.ideal==="environment"?E=["back","rear"]:m.exact!=="user"&&m.ideal!=="user"||(E=["front"]),E)return n.mediaDevices.enumerateDevices().then(S=>{let R=(S=S.filter(b=>b.kind==="videoinput")).find(b=>E.some(x=>{var P;return Te(P=b.label.toLowerCase()).call(P,x)}));return!R&&S.length&&Te(E).call(E,"back")&&(R=S[S.length-1]),R&&(u.video.deviceId=m.exact?{exact:R.deviceId}:{ideal:R.deviceId}),u.video=r(u.video),$L("chrome: "+JSON.stringify(u)),h(u)})}u.video=r(u.video)}return $L("chrome: "+JSON.stringify(u)),h(u)},l=function(u){return t.version>=64?u:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[u.name]||u.name,message:u.message,constraint:u.constraint||u.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(u,h,m){o(u,g=>{n.webkitGetUserMedia(g,h,E=>{m&&m(l(E))})})}).bind(n),n.mediaDevices.getUserMedia){const u=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(h){return o(h,m=>u(m).then(g=>{if(m.audio&&!g.getAudioTracks().length||m.video&&!g.getVideoTracks().length)throw g.getTracks().forEach(E=>{E.stop()}),new DOMException("","NotFoundError");return g},g=>we.reject(l(g))))}}}function ZL(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function e1(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",r=>{let o;o=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(u=>u.track&&u.track.id===r.track.id):{track:r.track};const l=new Event("track");l.track=r.track,l.receiver=o,l.transceiver={receiver:o},l.streams=[n.stream],this.dispatchEvent(l)}),n.stream.getTracks().forEach(r=>{let o;o=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(u=>u.track&&u.track.id===r.id):{track:r};const l=new Event("track");l.track=r,l.receiver=o,l.transceiver={receiver:o},l.streams=[n.stream],this.dispatchEvent(l)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Vh(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function t1(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(o,l){return{track:l,get dtmf(){return this._dtmf===void 0&&(l.kind==="audio"?this._dtmf=o.createDTMFSender(l):this._dtmf=null),this._dtmf},_pc:o}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const o=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,h){let m=o.apply(this,arguments);return m||(m=t(this,u),this._senders.push(m)),m};const l=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){l.apply(this,arguments);const h=this._senders.indexOf(u);h!==-1&&this._senders.splice(h,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(l=>{this._senders.push(t(this,l))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],r.apply(this,[o]),o.getTracks().forEach(l=>{const u=this._senders.find(h=>h.track===l);u&&this._senders.splice(this._senders.indexOf(u),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function n1(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,r,o]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const l=function(h){const m={};return h.result().forEach(g=>{const E={id:g.id,timestamp:g.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[g.type]||g.type};g.names().forEach(S=>{E[S]=g.stat(S)}),m[E.id]=E}),m},u=function(h){return new Map(Object.keys(h).map(m=>[m,h[m]]))};if(arguments.length>=2){const h=function(m){r(u(l(m)))};return t.apply(this,[h,n])}return new we((h,m)=>{t.apply(this,[function(g){h(u(l(g)))},m])}).then(r,o)}}function i1(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(l=>l._pc=this),o});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=r.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(l=>JL(l,o.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(o=>o._pc=this),r}),Vh(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>JL(o,r.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let r,o,l;return this.getSenders().forEach(u=>{u.track===n&&(r?l=!0:r=u)}),this.getReceivers().forEach(u=>(u.track===n&&(o?l=!0:o=u),u.track===n)),l||r&&o?we.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():o?o.getStats():we.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function r1(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(l=>this._shimmedLocalStreams[l][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(l,u){if(!u)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const h=t.apply(this,arguments);return this._shimmedLocalStreams[u.id]?this._shimmedLocalStreams[u.id].indexOf(h)===-1&&this._shimmedLocalStreams[u.id].push(h):this._shimmedLocalStreams[u.id]=[u,h],h};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(l){this._shimmedLocalStreams=this._shimmedLocalStreams||{},l.getTracks().forEach(m=>{if(this.getSenders().find(E=>E.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const u=this.getSenders();n.apply(this,arguments);const h=this.getSenders().filter(m=>u.indexOf(m)===-1);this._shimmedLocalStreams[l.id]=[l].concat(h)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[l.id],r.apply(this,arguments)};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},l&&Object.keys(this._shimmedLocalStreams).forEach(u=>{const h=this._shimmedLocalStreams[u].indexOf(l);h!==-1&&this._shimmedLocalStreams[u].splice(h,1),this._shimmedLocalStreams[u].length===1&&delete this._shimmedLocalStreams[u]}),o.apply(this,arguments)}}function s1(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return r1(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const m=n.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(g=>this._reverseStreams[g.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(g=>{if(this.getSenders().find(S=>S.track===g))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){const g=new e.MediaStream(m.getTracks());this._streams[m.id]=g,this._reverseStreams[g.id]=m,m=g}r.apply(this,[m])};const o=e.RTCPeerConnection.prototype.removeStream;function l(m,g){let E=g.sdp;return Object.keys(m._reverseStreams||[]).forEach(S=>{const R=m._reverseStreams[S],b=m._streams[R.id];E=E.replace(new RegExp(b.id,"g"),R.id)}),new RTCSessionDescription({type:g.type,sdp:E})}e.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},e.RTCPeerConnection.prototype.addTrack=function(m,g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const E=[].slice.call(arguments,1);if(E.length!==1||!E[0].getTracks().find(b=>b===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(b=>b.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const R=this._streams[g.id];if(R)R.addTrack(m),we.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const b=new e.MediaStream([m]);this._streams[g.id]=b,this._reverseStreams[b.id]=g,this.addStream(b)}return this.getSenders().find(b=>b.track===m)},["createOffer","createAnswer"].forEach(function(m){const g=e.RTCPeerConnection.prototype[m],E={[m](){const S=arguments;return arguments.length&&typeof arguments[0]=="function"?g.apply(this,[R=>{const b=l(this,R);S[0].apply(null,[b])},R=>{S[1]&&S[1].apply(null,R)},arguments[2]]):g.apply(this,arguments).then(R=>l(this,R))}};e.RTCPeerConnection.prototype[m]=E[m]});const u=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(m,g){let E=g.sdp;return Object.keys(m._reverseStreams||[]).forEach(S=>{const R=m._reverseStreams[S],b=m._streams[R.id];E=E.replace(new RegExp(R.id,"g"),b.id)}),new RTCSessionDescription({type:g.type,sdp:E})}(this,arguments[0]),u.apply(this,arguments)):u.apply(this,arguments)};const h=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const m=h.get.apply(this);return m.type===""?m:l(this,m)}}),e.RTCPeerConnection.prototype.removeTrack=function(m){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(m._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let g;this._streams=this._streams||{},Object.keys(this._streams).forEach(E=>{this._streams[E].getTracks().find(S=>m.track===S)&&(g=this._streams[E])}),g&&(g.getTracks().length===1?this.removeStream(this._reverseStreams[g.id]):g.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function bA(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=e.RTCPeerConnection.prototype[n],o={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=o[n]})}function o1(e,t){Vh(e,"negotiationneeded",n=>{const r=n.target;if(!(t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return n})}var a1=Object.freeze({__proto__:null,fixNegotiationNeeded:o1,shimAddTrackRemoveTrack:s1,shimAddTrackRemoveTrackWithNative:r1,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(r=>{const o=n.video&&n.video.width,l=n.video&&n.video.height,u=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:u||3}},o&&(n.video.mandatory.maxWidth=o),l&&(n.video.mandatory.maxHeight=l),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:t1,shimGetStats:n1,shimGetUserMedia:QL,shimMediaStream:ZL,shimOnTrack:e1,shimPeerConnection:bA,shimSenderReceiverGetStats:i1});function c1(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(o,l,u){wA("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(o).then(l,u)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const o=function(u,h,m){h in u&&!(m in u)&&(u[m]=u[h],delete u[h])},l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(u){return typeof u=="object"&&typeof u.audio=="object"&&(u=JSON.parse(JSON.stringify(u)),o(u.audio,"autoGainControl","mozAutoGainControl"),o(u.audio,"noiseSuppression","mozNoiseSuppression")),l(u)},r&&r.prototype.getSettings){const u=r.prototype.getSettings;r.prototype.getSettings=function(){const h=u.apply(this,arguments);return o(h,"mozAutoGainControl","autoGainControl"),o(h,"mozNoiseSuppression","noiseSuppression"),h}}if(r&&r.prototype.applyConstraints){const u=r.prototype.applyConstraints;r.prototype.applyConstraints=function(h){return this.kind==="audio"&&typeof h=="object"&&(h=JSON.parse(JSON.stringify(h)),o(h,"autoGainControl","mozAutoGainControl"),o(h,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[h])}}}}function l1(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function AA(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const l=e.RTCPeerConnection.prototype[o],u={[o](){return arguments[0]=new(o==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),l.apply(this,arguments)}};e.RTCPeerConnection.prototype[o]=u[o]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[o,l,u]=arguments;return r.apply(this,[o||null]).then(h=>{if(t.version<53&&!l)try{h.forEach(m=>{m.type=n[m.type]||m.type})}catch(m){if(m.name!=="TypeError")throw m;h.forEach((g,E)=>{h.set(E,Object.assign({},g,{type:n[g.type]||g.type}))})}return h}).then(l,u)}}function u1(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(o=>o._pc=this),r});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):we.resolve(new Map)}}function d1(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n}),Vh(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function h1(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){wA("removeStream","removeTrack"),this.getSenders().forEach(n=>{var r;n.track&&Te(r=t.getTracks()).call(r,n.track)&&this.removeTrack(n)})})}function p1(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function f1(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const r=n.length>0;r&&n.forEach(l=>{if("rid"in l&&!/^[a-z0-9]{0,16}$/i.test(l.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in l&&!(parseFloat(l.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in l&&!(parseFloat(l.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=t.apply(this,arguments);if(r){const{sender:l}=o,u=l.getParameters();(!("encodings"in u)||u.encodings.length===1&&Object.keys(u.encodings[0]).length===0)&&(u.encodings=n,l.sendEncodings=n,this.setParametersPromises.push(l.setParameters(u).then(()=>{delete l.sendEncodings}).catch(()=>{delete l.sendEncodings})))}return o})}function m1(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function g1(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?we.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function _1(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?we.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var E1=Object.freeze({__proto__:null,shimAddTransceiver:f1,shimCreateAnswer:_1,shimCreateOffer:g1,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,we.reject(r)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:m1,shimGetUserMedia:c1,shimOnTrack:l1,shimPeerConnection:AA,shimRTCDataChannel:p1,shimReceiverGetStats:d1,shimRemoveStream:h1,shimSenderGetStats:u1});function y1(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var r;this._localStreams||(this._localStreams=[]),Te(r=this._localStreams).call(r,n)||this._localStreams.push(n),n.getAudioTracks().forEach(o=>t.call(this,o,n)),n.getVideoTracks().forEach(o=>t.call(this,o,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var r=arguments.length,o=new Array(r>1?r-1:0),l=1;l<r;l++)o[l-1]=arguments[l];return o&&o.forEach(u=>{var h;this._localStreams?Te(h=this._localStreams).call(h,u)||this._localStreams.push(u):this._localStreams=[u]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const r=t.getTracks();this.getSenders().forEach(o=>{Te(r).call(r,o.track)&&this.removeTrack(o)})})}}function v1(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(o=>{var l;if(this._remoteStreams||(this._remoteStreams=[]),Te(l=this._remoteStreams).call(l,o))return;this._remoteStreams.push(o);const u=new Event("addstream");u.stream=o,this.dispatchEvent(u)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(o=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(o)>=0)return;n._remoteStreams.push(o);const l=new Event("addstream");l.stream=o,n.dispatchEvent(l)})}),t.apply(n,arguments)}}}function S1(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,o=t.setLocalDescription,l=t.setRemoteDescription,u=t.addIceCandidate;t.createOffer=function(m,g){const E=arguments.length>=2?arguments[2]:arguments[0],S=n.apply(this,[E]);return g?(S.then(m,g),we.resolve()):S},t.createAnswer=function(m,g){const E=arguments.length>=2?arguments[2]:arguments[0],S=r.apply(this,[E]);return g?(S.then(m,g),we.resolve()):S};let h=function(m,g,E){const S=o.apply(this,[m]);return E?(S.then(g,E),we.resolve()):S};t.setLocalDescription=h,h=function(m,g,E){const S=l.apply(this,[m]);return E?(S.then(g,E),we.resolve()):S},t.setRemoteDescription=h,h=function(m,g,E){const S=u.apply(this,[m]);return E?(S.then(g,E),we.resolve()):S},t.addIceCandidate=h}function T1(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=o=>r(R1(o))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,r,o){t.mediaDevices.getUserMedia(n).then(r,o)}).bind(t))}function R1(e){return e&&e.video!==void 0?Object.assign({},e,{video:XL(e.video)}):e}function w1(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,r){if(n&&n.iceServers){const o=[];for(let l=0;l<n.iceServers.length;l++){let u=n.iceServers[l];!u.hasOwnProperty("urls")&&u.hasOwnProperty("url")?(wA("RTCIceServer.url","RTCIceServer.urls"),u=JSON.parse(JSON.stringify(u)),u.urls=u.url,delete u.url,o.push(u)):o.push(n.iceServers[l])}n.iceServers=o}return new t(n,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function C1(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function b1(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const r=this.getTransceivers().find(l=>l.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveAudio!==!0||r||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const o=this.getTransceivers().find(l=>l.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):n.offerToReceiveVideo!==!0||o||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function A1(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var I1=Object.freeze({__proto__:null,shimAudioContext:A1,shimCallbacksAPI:S1,shimConstraints:R1,shimCreateOfferLegacy:b1,shimGetUserMedia:T1,shimLocalStreamsAPI:y1,shimRTCIceServerUrls:w1,shimRemoteStreamsAPI:v1,shimTrackEventTransceiver:C1}),O1=`	
\v\f\r \u2028\u2029\uFEFF`,MY=el,UY=Wr,IA=O1,N1=L("".replace),VY=RegExp("^["+IA+"]+"),FY=RegExp("(^|[^"+IA+"])["+IA+"]+$"),BY=function(e){return function(t){var n=UY(MY(t));return 1&e&&(n=N1(n,VY,"")),2&e&&(n=N1(n,FY,"$1")),n}},jY={trim:BY(3)},GY=cT.PROPER,WY=_,P1=O1,zY=jY.trim;xt({target:"String",proto:!0,forced:function(e){return WY(function(){return!!P1[e]()||""[e]()!==""||GY&&P1[e].name!==e})}("trim")},{trim:function(){return zY(this)}});var HY=fs("String").trim,KY=j,qY=HY,OA=String.prototype,YY=function(e){var t=e.trim;return typeof e=="string"||e===OA||KY(OA,e)&&t===OA.trim?qY:t},ir=p(YY),D1={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(n){return n.split(`
m=`).map((r,o)=>(o>0?"m="+r:r).trim()+`\r
`)},t.getDescription=function(n){const r=t.splitSections(n);return r&&r[0]},t.getMediaSections=function(n){const r=t.splitSections(n);return r.shift(),r},t.matchPrefix=function(n,r){return t.splitLines(n).filter(o=>o.indexOf(r)===0)},t.parseCandidate=function(n){let r;r=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const o={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let l=8;l<r.length;l+=2)switch(r[l]){case"raddr":o.relatedAddress=r[l+1];break;case"rport":o.relatedPort=parseInt(r[l+1],10);break;case"tcptype":o.tcpType=r[l+1];break;case"ufrag":o.ufrag=r[l+1],o.usernameFragment=r[l+1];break;default:o[r[l]]===void 0&&(o[r[l]]=r[l+1])}return o},t.writeCandidate=function(n){const r=[];r.push(n.foundation);const o=n.component;o==="rtp"?r.push(1):o==="rtcp"?r.push(2):r.push(o),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const l=n.type;return r.push("typ"),r.push(l),l!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let r=n.substring(9).split(" ");const o={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),o.name=r[0],o.clockRate=parseInt(r[1],10),o.channels=r.length===3?parseInt(r[2],10):1,o.numChannels=o.channels,o},t.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const o=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(o!==1?"/"+o:"")+`\r
`},t.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const r={};let o;const l=n.substring(n.indexOf(" ")+1).split(";");for(let u=0;u<l.length;u++)o=l[u].trim().split("="),r[o[0].trim()]=o[1];return r},t.writeFmtp=function(n){let r="",o=n.payloadType;if(n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const l=[];Object.keys(n.parameters).forEach(u=>{n.parameters[u]!==void 0?l.push(u+"="+n.parameters[u]):l.push(u)}),r+="a=fmtp:"+o+" "+l.join(";")+`\r
`}return r},t.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(n){let r="",o=n.payloadType;return n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(l=>{r+="a=rtcp-fb:"+o+" "+l.type+(l.parameter&&l.parameter.length?" "+l.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(n){const r=n.indexOf(" "),o={ssrc:parseInt(n.substring(7,r),10)},l=n.indexOf(":",r);return l>-1?(o.attribute=n.substring(r+1,l),o.value=n.substring(l+1)):o.attribute=n.substring(r+1),o},t.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(o=>parseInt(o,10))}},t.getMid=function(n){const r=t.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:t.matchPrefix(n+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,r){let o="a=setup:"+r+`\r
`;return n.fingerprints.forEach(l=>{o+="a=fingerprint:"+l.algorithm+" "+l.value+`\r
`}),o},t.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,r){return t.matchPrefix(n+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,r){const o=t.matchPrefix(n+r,"a=ice-ufrag:")[0],l=t.matchPrefix(n+r,"a=ice-pwd:")[0];return o&&l?{usernameFragment:o.substring(12),password:l.substring(10)}:null},t.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=t.splitLines(n)[0].split(" ");r.profile=o[2];for(let u=3;u<o.length;u++){const h=o[u],m=t.matchPrefix(n,"a=rtpmap:"+h+" ")[0];if(m){const g=t.parseRtpMap(m),E=t.matchPrefix(n,"a=fmtp:"+h+" ");switch(g.parameters=E.length?t.parseFmtp(E[0]):{},g.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+h+" ").map(t.parseRtcpFb),r.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(g.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach(u=>{r.headerExtensions.push(t.parseExtmap(u))});const l=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(u=>{l.forEach(h=>{u.rtcpFeedback.find(m=>m.type===h.type&&m.parameter===h.parameter)||u.rtcpFeedback.push(h)})}),r},t.writeRtpDescription=function(n,r){let o="";o+="m="+n+" ",o+=r.codecs.length>0?"9":"0",o+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",o+=r.codecs.map(u=>u.preferredPayloadType!==void 0?u.preferredPayloadType:u.payloadType).join(" ")+`\r
`,o+=`c=IN IP4 0.0.0.0\r
`,o+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(u=>{o+=t.writeRtpMap(u),o+=t.writeFmtp(u),o+=t.writeRtcpFb(u)});let l=0;return r.codecs.forEach(u=>{u.maxptime>l&&(l=u.maxptime)}),l>0&&(o+="a=maxptime:"+l+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(u=>{o+=t.writeExtmap(u)}),o},t.parseRtpEncodingParameters=function(n){const r=[],o=t.parseRtpParameters(n),l=o.fecMechanisms.indexOf("RED")!==-1,u=o.fecMechanisms.indexOf("ULPFEC")!==-1,h=t.matchPrefix(n,"a=ssrc:").map(R=>t.parseSsrcMedia(R)).filter(R=>R.attribute==="cname"),m=h.length>0&&h[0].ssrc;let g;const E=t.matchPrefix(n,"a=ssrc-group:FID").map(R=>R.substring(17).split(" ").map(b=>parseInt(b,10)));E.length>0&&E[0].length>1&&E[0][0]===m&&(g=E[0][1]),o.codecs.forEach(R=>{if(R.name.toUpperCase()==="RTX"&&R.parameters.apt){let b={ssrc:m,codecPayloadType:parseInt(R.parameters.apt,10)};m&&g&&(b.rtx={ssrc:g}),r.push(b),l&&(b=JSON.parse(JSON.stringify(b)),b.fec={ssrc:m,mechanism:u?"red+ulpfec":"red"},r.push(b))}}),r.length===0&&m&&r.push({ssrc:m});let S=t.matchPrefix(n,"b=");return S.length&&(S=S[0].indexOf("b=TIAS:")===0?parseInt(S[0].substring(7),10):S[0].indexOf("b=AS:")===0?1e3*parseInt(S[0].substring(5),10)*.95-16e3:void 0,r.forEach(R=>{R.maxBitrate=S})),r},t.parseRtcpParameters=function(n){const r={},o=t.matchPrefix(n,"a=ssrc:").map(h=>t.parseSsrcMedia(h)).filter(h=>h.attribute==="cname")[0];o&&(r.cname=o.value,r.ssrc=o.ssrc);const l=t.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=l.length>0,r.compound=l.length===0;const u=t.matchPrefix(n,"a=rtcp-mux");return r.mux=u.length>0,r},t.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},t.parseMsid=function(n){let r;const o=t.matchPrefix(n,"a=msid:");if(o.length===1)return r=o[0].substring(7).split(" "),{stream:r[0],track:r[1]};const l=t.matchPrefix(n,"a=ssrc:").map(u=>t.parseSsrcMedia(u)).filter(u=>u.attribute==="msid");return l.length>0?(r=l[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(n){const r=t.parseMLine(n),o=t.matchPrefix(n,"a=max-message-size:");let l;o.length>0&&(l=parseInt(o[0].substring(19),10)),isNaN(l)&&(l=65536);const u=t.matchPrefix(n,"a=sctp-port:");if(u.length>0)return{port:parseInt(u[0].substring(12),10),protocol:r.fmt,maxMessageSize:l};const h=t.matchPrefix(n,"a=sctpmap:");if(h.length>0){const m=h[0].substring(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:l}}},t.writeSctpDescription=function(n,r){let o=[];return o=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&o.push("a=max-message-size:"+r.maxMessageSize+`\r
`),o.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,r,o){let l;const u=r!==void 0?r:2;return l=n||t.generateSessionId(),`v=0\r
o=`+(o||"thisisadapterortc")+" "+l+" "+u+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,r){const o=t.splitLines(n);for(let l=0;l<o.length;l++)switch(o[l]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return o[l].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const r=t.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(n){const r=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=t.splitLines(n);for(let o=0;o<r.length;o++)if(r[o].length<2||r[o].charAt(1)!=="=")return!1;return!0},e.exports=t})(D1);var k1=D1.exports,Dm=p(k1),XY=a({__proto__:null,default:Dm},[k1]);function nR(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const r=new t(n),o=Dm.parseCandidate(n.candidate),l=Object.assign(r,o);return l.toJSON=function(){return{candidate:l.candidate,sdpMid:l.sdpMid,sdpMLineIndex:l.sdpMLineIndex,usernameFragment:l.usernameFragment}},l}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,Vh(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function NA(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Vh(e,"icecandidate",t=>{if(t.candidate){const n=Dm.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function iR(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(h){if(!h||!h.sdp)return!1;const m=Dm.splitSections(h.sdp);return m.shift(),m.some(g=>{const E=Dm.parseMLine(g);return E&&E.kind==="application"&&E.protocol.indexOf("SCTP")!==-1})},r=function(h){const m=h.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(m===null||m.length<2)return-1;const g=parseInt(m[1],10);return g!=g?-1:g},o=function(h){let m=65536;return t.browser==="firefox"&&(m=t.version<57?h===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),m},l=function(h,m){let g=65536;t.browser==="firefox"&&t.version===57&&(g=65535);const E=Dm.matchPrefix(h.sdp,"a=max-message-size:");return E.length>0?g=parseInt(E[0].substr(19),10):t.browser==="firefox"&&m!==-1&&(g=2147483637),g},u=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:h}=this.getConfiguration();h==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const h=r(arguments[0]),m=o(h),g=l(arguments[0],h);let E;E=m===0&&g===0?Number.POSITIVE_INFINITY:m===0||g===0?Math.max(m,g):Math.min(m,g);const S={};Object.defineProperty(S,"maxMessageSize",{get:()=>E}),this._sctp=S}return u.apply(this,arguments)}}function rR(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,o){const l=r.send;r.send=function(){const u=arguments[0],h=u.length||u.size||u.byteLength;if(r.readyState==="open"&&o.sctp&&h>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return l.apply(r,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return t(r,this),r},Vh(e,"datachannel",r=>(t(r.channel,r.target),r))}function PA(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=o=>{const l=o.target;if(l._lastConnectionState!==l.connectionState){l._lastConnectionState=l.connectionState;const u=new Event("connectionstatechange",o);l.dispatchEvent(u)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function DA(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=r.sdp.split(`
`).filter(l=>ir(l).call(l)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&r instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:r.type,sdp:o}):r.sdp=o}return n.apply(this,arguments)}}function sR(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?we.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),we.resolve())})}function oR(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var JY=Object.freeze({__proto__:null,removeExtmapAllowMixed:DA,shimAddIceCandidateNullOrEmpty:sR,shimConnectionState:PA,shimMaxMessageSize:iR,shimParameterlessSetLocalDescription:oR,shimRTCIceCandidate:nR,shimRTCIceCandidateRelayProtocol:NA,shimSendThrowTypeError:rR});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=qL,r=function(l){const u={browser:null,version:null};if(l===void 0||!l.navigator)return u.browser="Not a browser.",u;const{navigator:h}=l;if(h.mozGetUserMedia)u.browser="firefox",u.version=tR(h.userAgent,/Firefox\/(\d+)\./,1);else if(h.webkitGetUserMedia||l.isSecureContext===!1&&l.webkitRTCPeerConnection)u.browser="chrome",u.version=tR(h.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!l.RTCPeerConnection||!h.userAgent.match(/AppleWebKit\/(\d+)\./))return u.browser="Not a supported browser.",u;u.browser="safari",u.version=tR(h.userAgent,/AppleWebKit\/(\d+)\./,1),u.supportsUnifiedPlan=l.RTCRtpTransceiver&&"currentDirection"in l.RTCRtpTransceiver.prototype}return u}(e),o={browserDetails:r,commonShim:JY,extractVersion:tR,disableLog:LY,disableWarnings:xY,sdp:XY};switch(r.browser){case"chrome":if(!a1||!bA||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),o;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),o;n("adapter.js shimming chrome."),o.browserShim=a1,sR(e,r),oR(e),QL(e,r),ZL(e),bA(e,r),e1(e),s1(e,r),t1(e),n1(e),i1(e),o1(e,r),nR(e),NA(e),PA(e),iR(e,r),rR(e),DA(e,r);break;case"firefox":if(!E1||!AA||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),o;n("adapter.js shimming firefox."),o.browserShim=E1,sR(e,r),oR(e),c1(e,r),AA(e,r),l1(e),h1(e),u1(e),d1(e),p1(e),f1(e),m1(e),g1(e),_1(e),nR(e),PA(e),iR(e,r),rR(e);break;case"safari":if(!I1||!t.shimSafari)return n("Safari shim is not included in this adapter release."),o;n("adapter.js shimming safari."),o.browserShim=I1,sR(e,r),oR(e),w1(e),b1(e),S1(e),y1(e),v1(e),C1(e),T1(e),A1(e),nR(e),NA(e),iR(e,r),rR(e),DA(e,r);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var L1=il,$Y=TypeError,x1=oo.match(/firefox\/(\d+)/i),QY=!!x1&&+x1[1],ZY=/MSIE|Trident/.test(oo),M1=oo.match(/AppleWebKit\/(\d+)\./),e9=!!M1&&+M1[1],t9=xt,U1=L,n9=wr,i9=bo,V1=ua,r9=function(e,t){if(!delete e[t])throw $Y("Cannot delete property "+L1(t)+" of "+L1(e))},F1=Wr,kA=_,s9=Xk,o9=dl,B1=QY,a9=ZY,j1=nl,G1=e9,Ku=[],W1=U1(Ku.sort),c9=U1(Ku.push),l9=kA(function(){Ku.sort(void 0)}),u9=kA(function(){Ku.sort(null)}),d9=o9("sort"),z1=!kA(function(){if(j1)return j1<70;if(!(B1&&B1>3)){if(a9)return!0;if(G1)return G1<603;var e,t,n,r,o="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)Ku.push({k:t+r,v:n})}for(Ku.sort(function(l,u){return u.v-l.v}),r=0;r<Ku.length;r++)t=Ku[r].k.charAt(0),o.charAt(o.length-1)!==t&&(o+=t);return o!=="DGBEFHACIJK"}});t9({target:"Array",proto:!0,forced:l9||!u9||!d9||!z1},{sort:function(e){e!==void 0&&n9(e);var t=i9(this);if(z1)return e===void 0?W1(t):W1(t,e);var n,r,o=[],l=V1(t);for(r=0;r<l;r++)r in t&&c9(o,t[r]);for(s9(o,function(u){return function(h,m){return m===void 0?-1:h===void 0?1:u!==void 0?+u(h,m)||0:F1(h)>F1(m)?1:-1}}(e)),n=V1(o),r=0;r<n;)t[r]=o[r++];for(;r<l;)r9(t,r++);return t}});var h9=fs("Array").sort,p9=j,f9=h9,LA=Array.prototype,m9=function(e){var t=e.sort;return e===LA||p9(LA,e)&&t===LA.sort?f9:t},KE=p(m9),xA=X;xt({global:!0,forced:xA.globalThis!==xA},{globalThis:xA});var H1=p(X),MA={exports:{}};(function(e,t){(function(n,r){var o="function",l="undefined",u="object",h="string",m="major",g="model",E="name",S="type",R="vendor",b="version",x="architecture",P="console",k="mobile",V="tablet",F="smarttv",K="wearable",$="embedded",Z="Amazon",J="Apple",re="ASUS",pe="BlackBerry",Ce="Browser",Ie="Chrome",_t="Firefox",Et="Google",Qt="Huawei",kn="LG",An="Microsoft",Ur="Motorola",le="Opera",Se="Samsung",Le="Sharp",ue="Sony",O="Xiaomi",W="Zebra",q="Facebook",Ee="Chromium OS",tt="Mac OS",Gt=function(Yn){for(var ui={},ln=0;ln<Yn.length;ln++)ui[Yn[ln].toUpperCase()]=Yn[ln];return ui},li=function(Yn,ui){return typeof Yn===h&&ns(ui).indexOf(ns(Yn))!==-1},ns=function(Yn){return Yn.toLowerCase()},$l=function(Yn,ui){if(typeof Yn===h)return Yn=Yn.replace(/^\s\s*/,""),typeof ui===l?Yn:Yn.substring(0,350)},mp=function(Yn,ui){for(var ln,ws,Vc,Ln,Pt,is,fd=0;fd<ui.length&&!Pt;){var Fa=ui[fd],E4=ui[fd+1];for(ln=ws=0;ln<Fa.length&&!Pt&&Fa[ln];)if(Pt=Fa[ln++].exec(Yn))for(Vc=0;Vc<E4.length;Vc++)is=Pt[++ws],typeof(Ln=E4[Vc])===u&&Ln.length>0?Ln.length===2?typeof Ln[1]==o?this[Ln[0]]=Ln[1].call(this,is):this[Ln[0]]=Ln[1]:Ln.length===3?typeof Ln[1]!==o||Ln[1].exec&&Ln[1].test?this[Ln[0]]=is?is.replace(Ln[1],Ln[2]):r:this[Ln[0]]=is?Ln[1].call(this,is,Ln[2]):r:Ln.length===4&&(this[Ln[0]]=is?Ln[3].call(this,is.replace(Ln[1],Ln[2])):r):this[Ln]=is||r;fd+=2}},Xy=function(Yn,ui){for(var ln in ui)if(typeof ui[ln]===u&&ui[ln].length>0){for(var ws=0;ws<ui[ln].length;ws++)if(li(ui[ln][ws],Yn))return ln==="?"?r:ln}else if(li(ui[ln],Yn))return ln==="?"?r:ln;return Yn},iC={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},rC={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[b,[E,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[b,[E,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[E,b],[/opios[\/ ]+([\w\.]+)/i],[b,[E,le+" Mini"]],[/\bopr\/([\w\.]+)/i],[b,[E,le]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[E,b],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[b,[E,"UC"+Ce]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[b,[E,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[b,[E,"WeChat"]],[/konqueror\/([\w\.]+)/i],[b,[E,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[b,[E,"IE"]],[/yabrowser\/([\w\.]+)/i],[b,[E,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[E,/(.+)/,"$1 Secure "+Ce],b],[/\bfocus\/([\w\.]+)/i],[b,[E,_t+" Focus"]],[/\bopt\/([\w\.]+)/i],[b,[E,le+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[b,[E,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[b,[E,"Dolphin"]],[/coast\/([\w\.]+)/i],[b,[E,le+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[b,[E,"MIUI "+Ce]],[/fxios\/([-\w\.]+)/i],[b,[E,_t]],[/\bqihu|(qi?ho?o?|360)browser/i],[[E,"360 "+Ce]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[E,/(.+)/,"$1 "+Ce],b],[/(comodo_dragon)\/([\w\.]+)/i],[[E,/_/g," "],b],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[E,b],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[E],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[E,q],b],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[E,b],[/\bgsa\/([\w\.]+) .*safari\//i],[b,[E,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[b,[E,Ie+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[E,Ie+" WebView"],b],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[b,[E,"Android "+Ce]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[E,b],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[b,[E,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[b,E],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[E,[b,Xy,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[E,b],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[E,"Netscape"],b],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[b,[E,_t+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[E,b],[/(cobalt)\/([\w\.]+)/i],[E,[b,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[x,"amd64"]],[/(ia32(?=;))/i],[[x,ns]],[/((?:i[346]|x)86)[;\)]/i],[[x,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[x,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[x,"armhf"]],[/windows (ce|mobile); ppc;/i],[[x,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[x,/ower/,"",ns]],[/(sun4\w)[;\)]/i],[[x,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[x,ns]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[g,[R,Se],[S,V]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[g,[R,Se],[S,k]],[/\((ip(?:hone|od)[\w ]*);/i],[g,[R,J],[S,k]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[g,[R,J],[S,V]],[/(macintosh);/i],[g,[R,J]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[g,[R,Le],[S,k]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[g,[R,Qt],[S,V]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[g,[R,Qt],[S,k]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[g,/_/g," "],[R,O],[S,k]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[g,/_/g," "],[R,O],[S,V]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[g,[R,"OPPO"],[S,k]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[g,[R,"Vivo"],[S,k]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[g,[R,"Realme"],[S,k]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[g,[R,Ur],[S,k]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[g,[R,Ur],[S,V]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[g,[R,kn],[S,V]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[g,[R,kn],[S,k]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[g,[R,"Lenovo"],[S,V]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[g,/_/g," "],[R,"Nokia"],[S,k]],[/(pixel c)\b/i],[g,[R,Et],[S,V]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[g,[R,Et],[S,k]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[g,[R,ue],[S,k]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[g,"Xperia Tablet"],[R,ue],[S,V]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[g,[R,"OnePlus"],[S,k]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[g,[R,Z],[S,V]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[g,/(.+)/g,"Fire Phone $1"],[R,Z],[S,k]],[/(playbook);[-\w\),; ]+(rim)/i],[g,R,[S,V]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[g,[R,pe],[S,k]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[g,[R,re],[S,V]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[g,[R,re],[S,k]],[/(nexus 9)/i],[g,[R,"HTC"],[S,V]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[R,[g,/_/g," "],[S,k]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[g,[R,"Acer"],[S,V]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[g,[R,"Meizu"],[S,k]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[R,g,[S,k]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[R,g,[S,V]],[/(surface duo)/i],[g,[R,An],[S,V]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[g,[R,"Fairphone"],[S,k]],[/(u304aa)/i],[g,[R,"AT&T"],[S,k]],[/\bsie-(\w*)/i],[g,[R,"Siemens"],[S,k]],[/\b(rct\w+) b/i],[g,[R,"RCA"],[S,V]],[/\b(venue[\d ]{2,7}) b/i],[g,[R,"Dell"],[S,V]],[/\b(q(?:mv|ta)\w+) b/i],[g,[R,"Verizon"],[S,V]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[g,[R,"Barnes & Noble"],[S,V]],[/\b(tm\d{3}\w+) b/i],[g,[R,"NuVision"],[S,V]],[/\b(k88) b/i],[g,[R,"ZTE"],[S,V]],[/\b(nx\d{3}j) b/i],[g,[R,"ZTE"],[S,k]],[/\b(gen\d{3}) b.+49h/i],[g,[R,"Swiss"],[S,k]],[/\b(zur\d{3}) b/i],[g,[R,"Swiss"],[S,V]],[/\b((zeki)?tb.*\b) b/i],[g,[R,"Zeki"],[S,V]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[R,"Dragon Touch"],g,[S,V]],[/\b(ns-?\w{0,9}) b/i],[g,[R,"Insignia"],[S,V]],[/\b((nxa|next)-?\w{0,9}) b/i],[g,[R,"NextBook"],[S,V]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[R,"Voice"],g,[S,k]],[/\b(lvtel\-)?(v1[12]) b/i],[[R,"LvTel"],g,[S,k]],[/\b(ph-1) /i],[g,[R,"Essential"],[S,k]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[g,[R,"Envizen"],[S,V]],[/\b(trio[-\w\. ]+) b/i],[g,[R,"MachSpeed"],[S,V]],[/\btu_(1491) b/i],[g,[R,"Rotor"],[S,V]],[/(shield[\w ]+) b/i],[g,[R,"Nvidia"],[S,V]],[/(sprint) (\w+)/i],[R,g,[S,k]],[/(kin\.[onetw]{3})/i],[[g,/\./g," "],[R,An],[S,k]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[g,[R,W],[S,V]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[g,[R,W],[S,k]],[/smart-tv.+(samsung)/i],[R,[S,F]],[/hbbtv.+maple;(\d+)/i],[[g,/^/,"SmartTV"],[R,Se],[S,F]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[R,kn],[S,F]],[/(apple) ?tv/i],[R,[g,J+" TV"],[S,F]],[/crkey/i],[[g,Ie+"cast"],[R,Et],[S,F]],[/droid.+aft(\w)( bui|\))/i],[g,[R,Z],[S,F]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[g,[R,Le],[S,F]],[/(bravia[\w ]+)( bui|\))/i],[g,[R,ue],[S,F]],[/(mitv-\w{5}) bui/i],[g,[R,O],[S,F]],[/Hbbtv.*(technisat) (.*);/i],[R,g,[S,F]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[R,$l],[g,$l],[S,F]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[S,F]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[R,g,[S,P]],[/droid.+; (shield) bui/i],[g,[R,"Nvidia"],[S,P]],[/(playstation [345portablevi]+)/i],[g,[R,ue],[S,P]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[g,[R,An],[S,P]],[/((pebble))app/i],[R,g,[S,K]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[g,[R,J],[S,K]],[/droid.+; (glass) \d/i],[g,[R,Et],[S,K]],[/droid.+; (wt63?0{2,3})\)/i],[g,[R,W],[S,K]],[/(quest( 2| pro)?)/i],[g,[R,q],[S,K]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[R,[S,$]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[g,[S,k]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[g,[S,V]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[S,V]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[S,k]],[/(android[-\w\. ]{0,9});.+buil/i],[g,[R,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[b,[E,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[b,[E,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[E,b],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[b,E]],os:[[/microsoft (windows) (vista|xp)/i],[E,b],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[E,[b,Xy,iC]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[E,"Windows"],[b,Xy,iC]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[b,/_/g,"."],[E,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[E,tt],[b,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[b,E],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[E,b],[/\(bb(10);/i],[b,[E,pe]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[b,[E,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[b,[E,_t+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[b,[E,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[b,[E,"watchOS"]],[/crkey\/([\d\.]+)/i],[b,[E,Ie+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[E,Ee],b],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[E,b],[/(sunos) ?([\w\.\d]*)/i],[[E,"Solaris"],b],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[E,b]]},Ro=function(Yn,ui){if(typeof Yn===u&&(ui=Yn,Yn=r),!(this instanceof Ro))return new Ro(Yn,ui).getResult();var ln=typeof n!==l&&n.navigator?n.navigator:r,ws=Yn||(ln&&ln.userAgent?ln.userAgent:""),Vc=ln&&ln.userAgentData?ln.userAgentData:r,Ln=ui?function(Pt,is){var fd={};for(var Fa in Pt)is[Fa]&&is[Fa].length%2==0?fd[Fa]=is[Fa].concat(Pt[Fa]):fd[Fa]=Pt[Fa];return fd}(rC,ui):rC;return this.getBrowser=function(){var Pt={};return Pt[E]=r,Pt[b]=r,mp.call(Pt,ws,Ln.browser),Pt[m]=function(is){return typeof is===h?is.replace(/[^\d\.]/g,"").split(".")[0]:r}(Pt[b]),ln&&ln.brave&&typeof ln.brave.isBrave==o&&(Pt[E]="Brave"),Pt},this.getCPU=function(){var Pt={};return Pt[x]=r,mp.call(Pt,ws,Ln.cpu),Pt},this.getDevice=function(){var Pt={};return Pt[R]=r,Pt[g]=r,Pt[S]=r,mp.call(Pt,ws,Ln.device),!Pt[S]&&Vc&&Vc.mobile&&(Pt[S]=k),Pt[g]=="Macintosh"&&ln&&typeof ln.standalone!==l&&ln.maxTouchPoints&&ln.maxTouchPoints>2&&(Pt[g]="iPad",Pt[S]=V),Pt},this.getEngine=function(){var Pt={};return Pt[E]=r,Pt[b]=r,mp.call(Pt,ws,Ln.engine),Pt},this.getOS=function(){var Pt={};return Pt[E]=r,Pt[b]=r,mp.call(Pt,ws,Ln.os),!Pt[E]&&Vc&&Vc.platform!="Unknown"&&(Pt[E]=Vc.platform.replace(/chrome os/i,Ee).replace(/macos/i,tt)),Pt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ws},this.setUA=function(Pt){return ws=typeof Pt===h&&Pt.length>350?$l(Pt,350):Pt,this},this.setUA(ws),this};Ro.VERSION="0.7.34",Ro.BROWSER=Gt([E,b,m]),Ro.CPU=Gt([x]),Ro.DEVICE=Gt([g,R,S,P,k,F,V,K,$]),Ro.ENGINE=Ro.OS=Gt([E,b]),e.exports&&(t=e.exports=Ro),t.UAParser=Ro;var pd=typeof n!==l&&(n.jQuery||n.Zepto);if(pd&&!pd.ua){var gp=new Ro;pd.ua=gp.getResult(),pd.ua.get=function(){return gp.getUA()},pd.ua.set=function(Yn){gp.setUA(Yn);var ui=gp.getResult();for(var ln in ui)pd.ua[ln]=ui[ln]}}})(typeof window=="object"?window:c)})(MA,MA.exports);var g9=p(MA.exports),_9=Ps,E9=yi,y9=Zc,v9=oc,S9=_n("iterator"),T9=Object,R9=function(e){if(y9(e))return!1;var t=T9(e);return t[S9]!==void 0||"@@iterator"in t||E9(v9,_9(t))},w9=p(R9),K1=cm.clear;xt({global:!0,bind:!0,forced:X.clearImmediate!==K1},{clearImmediate:K1});var C9=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",q1=X,b9=me,A9=qt,I9=C9,O9=oo,N9=Ni,P9=uo,D9=q1.Function,k9=/MSIE .\./.test(O9)||I9&&function(){var e=q1.Bun.version.split(".");return e.length<3||e[0]==0&&(e[1]<3||e[1]==3&&e[2]==0)}(),L9=xt,Y1=X,X1=cm.set,x9=function(e,t){var n=1;return k9?function(r,o){var l=P9(arguments.length,1)>n,u=A9(r)?r:D9(r),h=l?N9(arguments,n):[],m=l?function(){b9(u,this,h)}:u;return e(m)}:e},J1=Y1.setImmediate?x9(X1):X1;L9({global:!0,bind:!0,forced:Y1.setImmediate!==J1},{setImmediate:J1});var $1=p(Rr.setImmediate),M9=xt,U9=ys,V9=wr,F9=uo,B9=hl,j9=X.process;M9({global:!0,dontCallGetSet:!0},{queueMicrotask:function(e){F9(arguments.length,1),V9(e);var t=B9&&j9.domain;U9(t?t.bind(e):e)}});var Q1=p(Rr.queueMicrotask);function Z1(e,t){return function(){return e.apply(t,arguments)}}const{toString:G9}=Object.prototype,{getPrototypeOf:UA}=Object,aR=(VA=Object.create(null),e=>{const t=G9.call(e);return VA[t]||(VA[t]=t.slice(8,-1).toLowerCase())});var VA;const ba=e=>(e=e.toLowerCase(),t=>aR(t)===e),cR=e=>t=>typeof t===e,{isArray:km}=Array,qE=cR("undefined"),ex=ba("ArrayBuffer"),W9=cR("string"),po=cR("function"),tx=cR("number"),lR=e=>e!==null&&typeof e=="object",uR=e=>{if(aR(e)!=="object")return!1;const t=UA(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.toStringTag in e||w9(e))},z9=ba("Date"),H9=ba("File"),K9=ba("Blob"),q9=ba("FileList"),Y9=ba("URLSearchParams"),[X9,J9,$9,Q9]=["ReadableStream","Request","Response","Headers"].map(ba);function YE(e,t){let n,r,{allOwnKeys:o=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),km(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{const l=o?Object.getOwnPropertyNames(e):Object.keys(e),u=l.length;let h;for(n=0;n<u;n++)h=l[n],t.call(null,e[h],h,e)}}function nx(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,o=n.length;for(;o-- >0;)if(r=n[o],t===r.toLowerCase())return r;return null}const Fh=H1!==void 0?H1:typeof self<"u"?self:typeof window<"u"?window:AN,ix=e=>!qE(e)&&e!==Fh,Z9=(FA=typeof Uint8Array<"u"&&UA(Uint8Array),e=>FA&&e instanceof FA);var FA;const e7=ba("HTMLFormElement"),rx=(e=>{let{hasOwnProperty:t}=e;return(n,r)=>t.call(n,r)})(Object.prototype),t7=ba("RegExp"),sx=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};YE(n,(o,l)=>{let u;(u=t(o,l,e))!==!1&&(r[l]=u||o)}),Object.defineProperties(e,r)},BA="abcdefghijklmnopqrstuvwxyz",ox="0123456789",ax={DIGIT:ox,ALPHA:BA,ALPHA_DIGIT:BA+BA.toUpperCase()+ox},n7=ba("AsyncFunction"),cx=(lx=typeof $1=="function",ux=po(Fh.postMessage),lx?$1:ux?(jA="axios@".concat(Math.random()),dR=[],Fh.addEventListener("message",e=>{let{source:t,data:n}=e;t===Fh&&n===jA&&dR.length&&dR.shift()()},!1),e=>{dR.push(e),Fh.postMessage(jA,"*")}):e=>setTimeout(e));var lx,ux,jA,dR;const i7=Q1!==void 0?Q1.bind(Fh):typeof process<"u"&&process.nextTick||cx;var Re={isArray:km,isArrayBuffer:ex,isBuffer:function(e){return e!==null&&!qE(e)&&e.constructor!==null&&!qE(e.constructor)&&po(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||po(e.append)&&((t=aR(e))==="formdata"||t==="object"&&po(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&ex(e.buffer),t},isString:W9,isNumber:tx,isBoolean:e=>e===!0||e===!1,isObject:lR,isPlainObject:uR,isReadableStream:X9,isRequest:J9,isResponse:$9,isHeaders:Q9,isUndefined:qE,isDate:z9,isFile:H9,isBlob:K9,isRegExp:t7,isFunction:po,isStream:e=>lR(e)&&po(e.pipe),isURLSearchParams:Y9,isTypedArray:Z9,isFileList:q9,forEach:YE,merge:function e(){const{caseless:t}=ix(this)&&this||{},n={},r=(o,l)=>{const u=t&&nx(n,l)||l;uR(n[u])&&uR(o)?n[u]=e(n[u],o):uR(o)?n[u]=e({},o):km(o)?n[u]=o.slice():n[u]=o};for(let o=0,l=arguments.length;o<l;o++)arguments[o]&&YE(arguments[o],r);return n},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return YE(t,(o,l)=>{n&&po(o)?e[l]=Z1(o,n):e[l]=o},{allOwnKeys:r}),e},trim:e=>ir(e)?ir(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let o,l,u;const h={};if(t=t||{},e==null)return t;do{for(o=Object.getOwnPropertyNames(e),l=o.length;l-- >0;)u=o[l],r&&!r(u,e,t)||h[u]||(t[u]=e[u],h[u]=!0);e=n!==!1&&UA(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:aR,kindOfTest:ba,endsWith:(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return r!==-1&&r===n},toArray:e=>{if(!e)return null;if(km(e))return e;let t=e.length;if(!tx(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let r;for(;(r=n.next())&&!r.done;){const o=r.value;t.call(e,o[0],o[1])}},matchAll:(e,t)=>{let n;const r=[];for(;(n=e.exec(t))!==null;)r.push(n);return r},isHTMLForm:e7,hasOwnProperty:rx,hasOwnProp:rx,reduceDescriptors:sx,freezeMethods:e=>{sx(e,(t,n)=>{if(po(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=e[n];po(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},r=o=>{o.forEach(l=>{n[l]=!0})};return km(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,r){return n.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:nx,global:Fh,isContextDefined:ix,ALPHABET:ax,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ax.ALPHA_DIGIT,n="";const{length:r}=t;for(;e--;)n+=t[Math.random()*r|0];return n},isSpecCompliantForm:function(e){return!!(e&&po(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(r,o)=>{if(lR(r)){if(t.indexOf(r)>=0)return;if(!("toJSON"in r)){t[o]=r;const l=km(r)?[]:{};return YE(r,(u,h)=>{const m=n(u,o+1);!qE(m)&&(l[h]=m)}),t[o]=void 0,l}}return r};return n(e,0)},isAsyncFn:n7,isThenable:e=>e&&(lR(e)||po(e))&&po(e.then)&&po(e.catch),setImmediate:cx,asap:i7};function Bt(e,t,n,r,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),o&&(this.response=o,this.status=o.status?o.status:null)}Re.inherits(Bt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Re.toJSONObject(this.config),code:this.code,status:this.status}}});const dx=Bt.prototype,hx={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{hx[e]={value:e}}),Object.defineProperties(Bt,hx),Object.defineProperty(dx,"isAxiosError",{value:!0}),Bt.from=(e,t,n,r,o,l)=>{const u=Object.create(dx);return Re.toFlatObject(e,u,function(h){return h!==Error.prototype},h=>h!=="isAxiosError"),Bt.call(u,e.message,t,n,r,o),u.cause=e,u.name=e.name,l&&Object.assign(u,l),u};function GA(e){return Re.isPlainObject(e)||Re.isArray(e)}function px(e){return Re.endsWith(e,"[]")?e.slice(0,-2):e}function fx(e,t,n){return e?e.concat(t).map(function(r,o){return r=px(r),!n&&o?"["+r+"]":r}).join(n?".":""):t}const r7=Re.toFlatObject(Re,{},null,function(e){return/^is[A-Z]/.test(e)});function hR(e,t,n){if(!Re.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=Re.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(R,b){return!Re.isUndefined(b[R])})).metaTokens,o=n.visitor||g,l=n.dots,u=n.indexes,h=(n.Blob||typeof Blob<"u"&&Blob)&&Re.isSpecCompliantForm(t);if(!Re.isFunction(o))throw new TypeError("visitor must be a function");function m(R){if(R===null)return"";if(Re.isDate(R))return R.toISOString();if(!h&&Re.isBlob(R))throw new Bt("Blob is not supported. Use a Buffer instead.");return Re.isArrayBuffer(R)||Re.isTypedArray(R)?h&&typeof Blob=="function"?new Blob([R]):Buffer.from(R):R}function g(R,b,x){let P=R;if(R&&!x&&typeof R=="object"){if(Re.endsWith(b,"{}"))b=r?b:b.slice(0,-2),R=JSON.stringify(R);else if(Re.isArray(R)&&function(k){return Re.isArray(k)&&!k.some(GA)}(R)||(Re.isFileList(R)||Re.endsWith(b,"[]"))&&(P=Re.toArray(R)))return b=px(b),P.forEach(function(k,V){!Re.isUndefined(k)&&k!==null&&t.append(u===!0?fx([b],V,l):u===null?b:b+"[]",m(k))}),!1}return!!GA(R)||(t.append(fx(x,b,l),m(R)),!1)}const E=[],S=Object.assign(r7,{defaultVisitor:g,convertValue:m,isVisitable:GA});if(!Re.isObject(e))throw new TypeError("data must be an object");return function R(b,x){if(!Re.isUndefined(b)){if(E.indexOf(b)!==-1)throw Error("Circular reference detected in "+x.join("."));E.push(b),Re.forEach(b,function(P,k){(!(Re.isUndefined(P)||P===null)&&o.call(t,P,Re.isString(k)?ir(k).call(k):k,x,S))===!0&&R(P,x?x.concat(k):[k])}),E.pop()}}(e),t}function mx(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function WA(e,t){this._pairs=[],e&&hR(e,this,t)}const gx=WA.prototype;function s7(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function _x(e,t,n){if(!t)return e;const r=n&&n.encode||s7;Re.isFunction(n)&&(n={serialize:n});const o=n&&n.serialize;let l;if(l=o?o(t,n):Re.isURLSearchParams(t)?t.toString():new WA(t,n).toString(r),l){const u=e.indexOf("#");u!==-1&&(e=e.slice(0,u)),e+=(e.indexOf("?")===-1?"?":"&")+l}return e}gx.append=function(e,t){this._pairs.push([e,t])},gx.toString=function(e){const t=e?function(n){return e.call(this,n,mx)}:mx;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};var Ex=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Re.forEach(this.handlers,function(t){t!==null&&e(t)})}},yx={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},vx={exports:{}},o7=xt,a7=xn,Sx=Os.f;o7({target:"Object",stat:!0,forced:Object.defineProperty!==Sx,sham:!a7},{defineProperty:Sx});var Tx=Rr.Object,c7=vx.exports=function(e,t,n){return Tx.defineProperty(e,t,n)};Tx.defineProperty.sham&&(c7.sham=!0);var Rx=p(vx.exports),l7=TypeError,wx=ih,u7=bh,d7=ji,h7=_n("species"),Cx=Array,p7=function(e){var t;return wx(e)&&(t=e.constructor,(u7(t)&&(t===Cx||wx(t.prototype))||d7(t)&&(t=t[h7])===null)&&(t=void 0)),t===void 0?Cx:t},bx=function(e,t){return new(p7(e))(t===0?0:t)},f7=_,m7=nl,g7=_n("species"),Ax=function(e){return m7>=51||!f7(function(){var t=[];return(t.constructor={})[g7]=function(){return{foo:1}},t[e](Boolean).foo!==1})},_7=xt,E7=_,y7=ih,v7=ji,S7=bo,T7=ua,Ix=function(e){if(e>9007199254740991)throw l7("Maximum allowed index exceeded");return e},Ox=GT,R7=bx,w7=Ax,C7=nl,Nx=_n("isConcatSpreadable"),b7=C7>=51||!E7(function(){var e=[];return e[Nx]=!1,e.concat()[0]!==e}),A7=function(e){if(!v7(e))return!1;var t=e[Nx];return t!==void 0?!!t:y7(e)};_7({target:"Array",proto:!0,forced:!b7||!w7("concat")},{concat:function(e){var t,n,r,o,l,u=S7(this),h=R7(u,0),m=0;for(t=-1,r=arguments.length;t<r;t++)if(A7(l=t===-1?u:arguments[t]))for(o=T7(l),Ix(m+o),n=0;n<o;n++,m++)n in l&&Ox(h,m,l[n]);else Ix(m+1),Ox(h,m++,l);return h.length=m,h}});var Px={},I7=ut,O7=ca,Dx=ic.f,N7=K0,kx=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Px.f=function(e){return kx&&I7(e)=="Window"?function(t){try{return Dx(t)}catch{return N7(kx)}}(e):Dx(O7(e))};var Lm={},P7=_n;Lm.f=P7;var Lx=Rr,D7=yi,k7=Lm,L7=Os.f,ki=function(e){var t=Lx.Symbol||(Lx.Symbol={});D7(t,e)||L7(t,e,{value:k7.f(e)})},x7=Xe,M7=Zi,U7=_n,V7=Ea,xx=function(){var e=M7("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=U7("toPrimitive");t&&!t[r]&&V7(t,r,function(o){return x7(n,this)},{})},F7=ec,B7=Qc,j7=bo,G7=ua,W7=bx,Mx=L([].push),z7=function(e){var t=e==1,n=e==2,r=e==3,o=e==4,l=e==6,u=e==7,h=e==5||l;return function(m,g,E,S){for(var R,b,x=j7(m),P=B7(x),k=F7(g,E),V=G7(P),F=0,K=S||W7,$=t?K(m,V):n||u?K(m,0):void 0;V>F;F++)if((h||F in P)&&(b=k(R=P[F],F,x),e))if(t)$[F]=b;else if(b)switch(e){case 3:return!0;case 5:return R;case 6:return F;case 2:Mx($,R)}else switch(e){case 4:return!1;case 7:Mx($,R)}return l?-1:r||o?o:$}},Ux={forEach:z7(0)},pR=xt,zA=X,HA=Xe,H7=L,xm=xn,Mm=Xa,K7=_,pr=yi,q7=j,KA=ii,fR=ca,qA=hu,Y7=Wr,YA=Ht,XE=br,Vx=Ls,X7=ic,Fx=Px,J7=ks,Bx=Tr,jx=Os,$7=Sf,Gx=$e,Wx=Ea,Q7=qf,XA=sl,zx=Ds,Hx=Zp,Z7=_n,eX=Lm,tX=ki,nX=xx,iX=ya,Kx=_a,mR=Ux.forEach,Ws=sh("hidden"),gR="Symbol",JE="prototype",rX=Kx.set,qx=Kx.getterFor(gR),Aa=Object[JE],Bh=zA.Symbol,_R=Bh&&Bh[JE],sX=zA.TypeError,JA=zA.QObject,Yx=Bx.f,jh=jx.f,Xx=Fx.f,oX=Gx.f,Jx=H7([].push),xl=XA("symbols"),$E=XA("op-symbols"),aX=XA("wks"),$A=!JA||!JA[JE]||!JA[JE].findChild,QA=xm&&K7(function(){return XE(jh({},"a",{get:function(){return jh(this,"a",{value:7}).a}})).a!=7})?function(e,t,n){var r=Yx(Aa,t);r&&delete Aa[t],jh(e,t,n),r&&e!==Aa&&jh(Aa,t,r)}:jh,ZA=function(e,t){var n=xl[e]=XE(_R);return rX(n,{type:gR,tag:e,description:t}),xm||(n.description=t),n},ER=function(e,t,n){e===Aa&&ER($E,t,n),KA(e);var r=qA(t);return KA(n),pr(xl,r)?(n.enumerable?(pr(e,Ws)&&e[Ws][r]&&(e[Ws][r]=!1),n=XE(n,{enumerable:YA(0,!1)})):(pr(e,Ws)||jh(e,Ws,YA(1,{})),e[Ws][r]=!0),QA(e,r,n)):jh(e,r,n)},eI=function(e,t){KA(e);var n=fR(t),r=Vx(n).concat(eM(n));return mR(r,function(o){xm&&!HA($x,n,o)||ER(e,o,n[o])}),e},$x=function(e){var t=qA(e),n=HA(oX,this,t);return!(this===Aa&&pr(xl,t)&&!pr($E,t))&&(!(n||!pr(this,t)||!pr(xl,t)||pr(this,Ws)&&this[Ws][t])||n)},Qx=function(e,t){var n=fR(e),r=qA(t);if(n!==Aa||!pr(xl,r)||pr($E,r)){var o=Yx(n,r);return!o||!pr(xl,r)||pr(n,Ws)&&n[Ws][r]||(o.enumerable=!0),o}},Zx=function(e){var t=Xx(fR(e)),n=[];return mR(t,function(r){pr(xl,r)||pr(zx,r)||Jx(n,r)}),n},eM=function(e){var t=e===Aa,n=Xx(t?$E:fR(e)),r=[];return mR(n,function(o){!pr(xl,o)||t&&!pr(Aa,o)||Jx(r,xl[o])}),r};Mm||(Bh=function(){if(q7(_R,this))throw sX("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?Y7(arguments[0]):void 0,t=Hx(e),n=function(r){this===Aa&&HA(n,$E,r),pr(this,Ws)&&pr(this[Ws],t)&&(this[Ws][t]=!1),QA(this,t,YA(1,r))};return xm&&$A&&QA(Aa,t,{configurable:!0,set:n}),ZA(t,e)},Wx(_R=Bh[JE],"toString",function(){return qx(this).tag}),Wx(Bh,"withoutSetter",function(e){return ZA(Hx(e),e)}),Gx.f=$x,jx.f=ER,$7.f=eI,Bx.f=Qx,X7.f=Fx.f=Zx,J7.f=eM,eX.f=function(e){return ZA(Z7(e),e)},xm&&Q7(_R,"description",{configurable:!0,get:function(){return qx(this).description}})),pR({global:!0,wrap:!0,forced:!Mm,sham:!Mm},{Symbol:Bh}),mR(Vx(aX),function(e){tX(e)}),pR({target:gR,stat:!0,forced:!Mm},{useSetter:function(){$A=!0},useSimple:function(){$A=!1}}),pR({target:"Object",stat:!0,forced:!Mm,sham:!xm},{create:function(e,t){return t===void 0?XE(e):eI(XE(e),t)},defineProperty:ER,defineProperties:eI,getOwnPropertyDescriptor:Qx}),pR({target:"Object",stat:!0,forced:!Mm},{getOwnPropertyNames:Zx}),nX(),iX(Bh,gR),zx[Ws]=!0;var tM=Xa&&!!Symbol.for&&!!Symbol.keyFor,cX=xt,lX=Zi,uX=yi,dX=Wr,nM=sl,hX=tM,tI=nM("string-to-symbol-registry"),pX=nM("symbol-to-string-registry");cX({target:"Symbol",stat:!0,forced:!hX},{for:function(e){var t=dX(e);if(uX(tI,t))return tI[t];var n=lX("Symbol")(t);return tI[t]=n,pX[n]=t,n}});var fX=xt,mX=yi,gX=uu,_X=il,EX=tM,iM=sl("symbol-to-string-registry");fX({target:"Symbol",stat:!0,forced:!EX},{keyFor:function(e){if(!gX(e))throw TypeError(_X(e)+" is not a symbol");if(mX(iM,e))return iM[e]}});var rM=ih,yX=qt,sM=ut,vX=Wr,oM=L([].push),SX=xt,aM=Zi,cM=me,TX=Xe,QE=L,lM=_,uM=qt,dM=uu,hM=Ni,RX=function(e){if(yX(e))return e;if(rM(e)){for(var t=e.length,n=[],r=0;r<t;r++){var o=e[r];typeof o=="string"?oM(n,o):typeof o!="number"&&sM(o)!="Number"&&sM(o)!="String"||oM(n,vX(o))}var l=n.length,u=!0;return function(h,m){if(u)return u=!1,m;if(rM(this))return m;for(var g=0;g<l;g++)if(n[g]===h)return m}}},wX=Xa,CX=String,qu=aM("JSON","stringify"),yR=QE(/./.exec),pM=QE("".charAt),bX=QE("".charCodeAt),AX=QE("".replace),IX=QE(1 .toString),OX=/[\uD800-\uDFFF]/g,fM=/^[\uD800-\uDBFF]$/,mM=/^[\uDC00-\uDFFF]$/,gM=!wX||lM(function(){var e=aM("Symbol")();return qu([e])!="[null]"||qu({a:e})!="{}"||qu(Object(e))!="{}"}),_M=lM(function(){return qu("\uDF06\uD834")!=='"\\udf06\\ud834"'||qu("\uDEAD")!=='"\\udead"'}),NX=function(e,t){var n=hM(arguments),r=RX(t);if(uM(r)||e!==void 0&&!dM(e))return n[1]=function(o,l){if(uM(r)&&(l=TX(r,this,CX(o),l)),!dM(l))return l},cM(qu,null,n)},PX=function(e,t,n){var r=pM(n,t-1),o=pM(n,t+1);return yR(fM,e)&&!yR(mM,o)||yR(mM,e)&&!yR(fM,r)?"\\u"+IX(bX(e,0),16):e};qu&&SX({target:"JSON",stat:!0,forced:gM||_M},{stringify:function(e,t,n){var r=hM(arguments),o=cM(gM?NX:qu,null,r);return _M&&typeof o=="string"?AX(o,OX,PX):o}});var EM=ks,DX=bo;xt({target:"Object",stat:!0,forced:!Xa||_(function(){EM.f(1)})},{getOwnPropertySymbols:function(e){var t=EM.f;return t?t(DX(e)):[]}}),ki("asyncIterator"),ki("hasInstance"),ki("isConcatSpreadable"),ki("iterator"),ki("match"),ki("matchAll"),ki("replace"),ki("search"),ki("species"),ki("split");var kX=xx;ki("toPrimitive"),kX();var LX=Zi,xX=ya;ki("toStringTag"),xX(LX("Symbol"),"Symbol"),ki("unscopables"),ya(X.JSON,"JSON",!0);var MX=Rr.Symbol,UX=_n,VX=Os.f,yM=UX("metadata"),vM=Function.prototype;vM[yM]===void 0&&VX(vM,yM,{value:null}),ki("dispose"),ki("metadata");var FX=MX;ki("asyncDispose");var BX=L,nI=Zi("Symbol"),jX=nI.keyFor,GX=BX(nI.prototype.valueOf),SM=nI.isRegisteredSymbol||function(e){try{return jX(GX(e))!==void 0}catch{return!1}};xt({target:"Symbol",stat:!0},{isRegisteredSymbol:SM});for(var WX=sl,TM=Zi,zX=L,HX=uu,KX=_n,vR=TM("Symbol"),RM=vR.isWellKnownSymbol,wM=TM("Object","getOwnPropertyNames"),qX=zX(vR.prototype.valueOf),CM=WX("wks"),iI=0,bM=wM(vR),YX=bM.length;iI<YX;iI++)try{var AM=bM[iI];HX(vR[AM])&&KX(AM)}catch{}var IM=function(e){if(RM&&RM(e))return!0;try{for(var t=qX(e),n=0,r=wM(CM),o=r.length;n<o;n++)if(CM[r[n]]==t)return!0}catch{}return!1};xt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:IM}),ki("matcher"),ki("observable"),xt({target:"Symbol",stat:!0},{isRegistered:SM}),xt({target:"Symbol",stat:!0,forced:!0},{isWellKnown:IM}),ki("metadataKey"),ki("patternMatch"),ki("replaceAll");var Um=p(FX),OM=p(Lm.f("iterator"));function ZE(e){return ZE=typeof Um=="function"&&typeof OM=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Um=="function"&&t.constructor===Um&&t!==Um.prototype?"symbol":typeof t},ZE(e)}var XX=p(Lm.f("toPrimitive"));function JX(e){var t=function(n,r){if(ZE(n)!=="object"||n===null)return n;var o=n[XX];if(o!==void 0){var l=o.call(n,r);if(ZE(l)!=="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(n)}(e,"string");return ZE(t)==="symbol"?t:String(t)}function U(e,t,n){return(t=JX(t))in e?Rx(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var NM=p(Nq),$X={isBrowser:!0,classes:{URLSearchParams:NM!==void 0?NM:WA,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const rI=typeof window<"u"&&typeof document<"u",sI=typeof navigator=="object"&&navigator||void 0,QX=rI&&(!sI||["ReactNative","NativeScript","NS"].indexOf(sI.product)<0),ZX=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",eJ=rI&&window.location.href||"http://localhost";function PM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function DM(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?PM(Object(n),!0).forEach(function(r){U(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):PM(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var $r=DM(DM({},Object.freeze({__proto__:null,hasBrowserEnv:rI,hasStandardBrowserEnv:QX,hasStandardBrowserWebWorkerEnv:ZX,navigator:sI,origin:eJ})),$X),tJ=ii,nJ=Xe,iJ=yi,rJ=j,sJ=function(){var e=tJ(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},kM=RegExp.prototype,LM=function(e){var t=e.flags;return t!==void 0||"flags"in kM||iJ(e,"flags")||!rJ(kM,e)?t:nJ(sJ,e)},oJ=j0.charAt,xM=Xe,aJ=ii,cJ=qt,lJ=ut,uJ=/./.exec,dJ=TypeError,hJ=xt,MM=Xe,UM=tn,pJ=Ff,SR=zf,VM=el,FM=_S,ey=Wr,fJ=ii,mJ=Zc,gJ=ut,_J=TS,BM=LM,EJ=Ja,yJ=_,vJ=hi,SJ=function(e,t,n){return t+(n?oJ(e,t).length:1)},TJ=function(e,t){var n=e.exec;if(cJ(n)){var r=xM(n,e,t);return r!==null&&aJ(r),r}if(lJ(e)==="RegExp")return xM(uJ,e,t);throw dJ("RegExp#exec called on incompatible receiver")},jM=_a,RJ=_n("matchAll"),GM="RegExp String",WM=GM+" Iterator",wJ=jM.set,CJ=jM.getterFor(WM),bJ=TypeError,oI=UM("".indexOf),TR=UM("".matchAll),aI=!!TR&&!yJ(function(){TR("a",/./)}),AJ=pJ(function(e,t,n,r){wJ(this,{type:WM,regexp:e,string:t,global:n,unicode:r,done:!1})},GM,function(){var e=CJ(this);if(e.done)return SR(void 0,!0);var t=e.regexp,n=e.string,r=TJ(t,n);return r===null?(e.done=!0,SR(void 0,!0)):e.global?(ey(r[0])===""&&(t.lastIndex=SJ(n,FM(t.lastIndex),e.unicode)),SR(r,!1)):(e.done=!0,SR(r,!1))}),zM=function(e){var t,n,r,o=fJ(this),l=ey(e),u=vJ(o,RegExp),h=ey(BM(o));return t=new u(u===RegExp?o.source:o,h),n=!!~oI(h,"g"),r=!!~oI(h,"u"),t.lastIndex=FM(o.lastIndex),new AJ(t,l,n,r)};hJ({target:"String",proto:!0,forced:aI},{matchAll:function(e){var t,n,r,o,l=VM(this);if(mJ(e)){if(aI)return TR(l,e)}else{if(_J(e)&&(t=ey(VM(BM(e))),!~oI(t,"g")))throw bJ("`.matchAll` does not allow non-global regexes");if(aI)return TR(l,e);if((r=EJ(e,RJ))===void 0&&gJ(e)=="RegExp"&&(r=zM),r)return MM(r,e,l)}return n=ey(l),o=new RegExp(e,"g"),MM(zM,o,n)}});var IJ=fs("String").matchAll,OJ=j,NJ=IJ,cI=String.prototype,PJ=function(e){var t=e.matchAll;return typeof e=="string"||e===cI||OJ(cI,e)&&t===cI.matchAll?NJ:t},DJ=p(PJ);function HM(e){function t(n,r,o,l){let u=n[l++];if(u==="__proto__")return!0;const h=Number.isFinite(+u),m=l>=n.length;return u=!u&&Re.isArray(o)?o.length:u,m?(Re.hasOwnProp(o,u)?o[u]=[o[u],r]:o[u]=r,!h):(o[u]&&Re.isObject(o[u])||(o[u]=[]),t(n,r,o[u],l)&&Re.isArray(o[u])&&(o[u]=function(g){const E={},S=Object.keys(g);let R;const b=S.length;let x;for(R=0;R<b;R++)x=S[R],E[x]=g[x];return E}(o[u])),!h)}if(Re.isFormData(e)&&Re.isFunction(e.entries)){const n={};return Re.forEachEntry(e,(r,o)=>{t(function(l){return DJ(Re).call(Re,/\w+|\[(\w*)]/g,l).map(u=>u[0]==="[]"?"":u[1]||u[0])}(r),o,n,0)}),n}return null}const lI={transitional:yx,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,o=Re.isObject(e);if(o&&Re.isHTMLForm(e)&&(e=new FormData(e)),Re.isFormData(e))return r?JSON.stringify(HM(e)):e;if(Re.isArrayBuffer(e)||Re.isBuffer(e)||Re.isStream(e)||Re.isFile(e)||Re.isBlob(e)||Re.isReadableStream(e))return e;if(Re.isArrayBufferView(e))return e.buffer;if(Re.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(u,h){return hR(u,new $r.classes.URLSearchParams,Object.assign({visitor:function(m,g,E,S){return $r.isNode&&Re.isBuffer(m)?(this.append(g,m.toString("base64")),!1):S.defaultVisitor.apply(this,arguments)}},h))}(e,this.formSerializer).toString();if((l=Re.isFileList(e))||n.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return hR(l?{"files[]":e}:e,u&&new u,this.formSerializer)}}return o||r?(t.setContentType("application/json",!1),function(u,h,m){if(Re.isString(u))try{return(h||JSON.parse)(u),ir(Re).call(Re,u)}catch(g){if(g.name!=="SyntaxError")throw g}return(m||JSON.stringify)(u)}(e)):e}],transformResponse:[function(e){const t=this.transitional||lI.transitional,n=t&&t.forcedJSONParsing,r=this.responseType==="json";if(Re.isResponse(e)||Re.isReadableStream(e))return e;if(e&&Re.isString(e)&&(n&&!this.responseType||r)){const o=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(l){if(o)throw l.name==="SyntaxError"?Bt.from(l,Bt.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:$r.classes.FormData,Blob:$r.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Re.forEach(["delete","get","head","post","put","patch"],e=>{lI.headers[e]={}});var uI=lI;const kJ=Re.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),KM=Symbol("internals");function ty(e){var t;return e&&ir(t=String(e)).call(t).toLowerCase()}function RR(e){return e===!1||e==null?e:Re.isArray(e)?e.map(RR):String(e)}function dI(e,t,n,r,o){return Re.isFunction(r)?r.call(this,t,n):(o&&(t=n),Re.isString(t)?Re.isString(r)?t.indexOf(r)!==-1:Re.isRegExp(r)?r.test(t):void 0:void 0)}class wR{constructor(t){t&&this.set(t)}set(t,n,r){const o=this;function l(m,g,E){const S=ty(g);if(!S)throw new Error("header name must be a non-empty string");const R=Re.findKey(o,S);(!R||o[R]===void 0||E===!0||E===void 0&&o[R]!==!1)&&(o[R||g]=RR(m))}const u=(m,g)=>Re.forEach(m,(E,S)=>l(E,S,g));if(Re.isPlainObject(t)||t instanceof this.constructor)u(t,n);else if(Re.isString(t)&&(t=ir(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(ir(h=t).call(h)))u((m=>{const g={};let E,S,R;return m&&m.split(`
`).forEach(function(b){var x,P;R=b.indexOf(":"),E=ir(x=b.substring(0,R)).call(x).toLowerCase(),S=ir(P=b.substring(R+1)).call(P),!E||g[E]&&kJ[E]||(E==="set-cookie"?g[E]?g[E].push(S):g[E]=[S]:g[E]=g[E]?g[E]+", "+S:S)}),g})(t),n);else if(Re.isHeaders(t))for(const[m,g]of t.entries())l(g,m,r);else t!=null&&l(n,t,r);var h;return this}get(t,n){if(t=ty(t)){const r=Re.findKey(this,t);if(r){const o=this[r];if(!n)return o;if(n===!0)return function(l){const u=Object.create(null),h=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let m;for(;m=h.exec(l);)u[m[1]]=m[2];return u}(o);if(Re.isFunction(n))return n.call(this,o,r);if(Re.isRegExp(n))return n.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=ty(t)){const r=Re.findKey(this,t);return!(!r||this[r]===void 0||n&&!dI(0,this[r],r,n))}return!1}delete(t,n){const r=this;let o=!1;function l(u){if(u=ty(u)){const h=Re.findKey(r,u);!h||n&&!dI(0,r[h],h,n)||(delete r[h],o=!0)}}return Re.isArray(t)?t.forEach(l):l(t),o}clear(t){const n=Object.keys(this);let r=n.length,o=!1;for(;r--;){const l=n[r];t&&!dI(0,this[l],l,t,!0)||(delete this[l],o=!0)}return o}normalize(t){const n=this,r={};return Re.forEach(this,(o,l)=>{var u;const h=Re.findKey(r,l);if(h)return n[h]=RR(o),void delete n[l];const m=t?function(g){return ir(g).call(g).toLowerCase().replace(/([a-z\d])(\w*)/g,(E,S,R)=>S.toUpperCase()+R)}(l):ir(u=String(l)).call(u);m!==l&&delete n[l],n[m]=RR(o),r[m]=!0}),this}concat(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return this.constructor.concat(this,...n)}toJSON(t){const n=Object.create(null);return Re.forEach(this,(r,o)=>{r!=null&&r!==!1&&(n[o]=t&&Re.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[n,r]=t;return n+": "+r}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const n=new this(t);for(var r=arguments.length,o=new Array(r>1?r-1:0),l=1;l<r;l++)o[l-1]=arguments[l];return o.forEach(u=>n.set(u)),n}static accessor(t){const n=(this[KM]=this[KM]={accessors:{}}).accessors,r=this.prototype;function o(l){const u=ty(l);n[u]||(function(h,m){const g=Re.toCamelCase(" "+m);["get","set","has"].forEach(E=>{Object.defineProperty(h,E+g,{value:function(S,R,b){return this[E].call(this,m,S,R,b)},configurable:!0})})}(r,l),n[u]=!0)}return Re.isArray(t)?t.forEach(o):o(t),this}}wR.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Re.reduceDescriptors(wR.prototype,(e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(o){this[r]=o}}}),Re.freezeMethods(wR);var Ia=wR;function hI(e,t){const n=this||uI,r=t||n,o=Ia.from(r.headers);let l=r.data;return Re.forEach(e,function(u){l=u.call(n,l,o.normalize(),t?t.status:void 0)}),o.normalize(),l}function qM(e){return!(!e||!e.__CANCEL__)}function Vm(e,t,n){Bt.call(this,e??"canceled",Bt.ERR_CANCELED,t,n),this.name="CanceledError"}function YM(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new Bt("Request failed with status code "+n.status,[Bt.ERR_BAD_REQUEST,Bt.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}Re.inherits(Vm,Bt,{__CANCEL__:!0});const CR=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,r=0;const o=function(l,u){l=l||10;const h=new Array(l),m=new Array(l);let g,E=0,S=0;return u=u!==void 0?u:1e3,function(R){const b=Date.now(),x=m[S];g||(g=b),h[E]=R,m[E]=b;let P=S,k=0;for(;P!==E;)k+=h[P++],P%=l;if(E=(E+1)%l,E===S&&(S=(S+1)%l),b-g<u)return;const V=x&&b-x;return V?Math.round(1e3*k/V):void 0}}(50,250);return function(l,u){let h,m,g=0,E=1e3/u;const S=function(R){g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),h=null,m&&(clearTimeout(m),m=null),l.apply(null,R)};return[function(){const R=Date.now(),b=R-g;for(var x=arguments.length,P=new Array(x),k=0;k<x;k++)P[k]=arguments[k];b>=E?S(P,R):(h=P,m||(m=setTimeout(()=>{m=null,S(h)},E-b)))},()=>h&&S(h)]}(l=>{const u=l.loaded,h=l.lengthComputable?l.total:void 0,m=u-r,g=o(m);r=u,e({loaded:u,total:h,progress:h?u/h:void 0,bytes:m,rate:g||void 0,estimated:g&&h&&u<=h?(h-u)/g:void 0,event:l,lengthComputable:h!=null,[t?"download":"upload"]:!0})},n)},XM=(e,t)=>{const n=e!=null;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},JM=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Re.asap(()=>e(...n))};var LJ=$r.hasStandardBrowserEnv?((e,t)=>n=>(n=new eR(n,$r.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new eR($r.origin),$r.navigator&&/(msie|trident)/i.test($r.navigator.userAgent)):()=>!0,xJ=$r.hasStandardBrowserEnv?{write(e,t,n,r,o,l){const u=[e+"="+encodeURIComponent(t)];Re.isNumber(n)&&u.push("expires="+new Date(n).toGMTString()),Re.isString(r)&&u.push("path="+r),Re.isString(o)&&u.push("domain="+o),l===!0&&u.push("secure"),document.cookie=u.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function $M(e,t){return e&&!function(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}(t)?function(n,r){return r?n.replace(/\/?\/$/,"")+"/"+r.replace(/^\/+/,""):n}(e,t):t}function QM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}const ZM=e=>e instanceof Ia?function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?QM(Object(r),!0).forEach(function(o){U(t,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):QM(Object(r)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(r,o))})}return t}({},e):e;function Gh(e,t){t=t||{};const n={};function r(g,E,S,R){return Re.isPlainObject(g)&&Re.isPlainObject(E)?Re.merge.call({caseless:R},g,E):Re.isPlainObject(E)?Re.merge({},E):Re.isArray(E)?E.slice():E}function o(g,E,S,R){return Re.isUndefined(E)?Re.isUndefined(g)?void 0:r(void 0,g,0,R):r(g,E,0,R)}function l(g,E){if(!Re.isUndefined(E))return r(void 0,E)}function u(g,E){return Re.isUndefined(E)?Re.isUndefined(g)?void 0:r(void 0,g):r(void 0,E)}function h(g,E,S){return S in t?r(g,E):S in e?r(void 0,g):void 0}const m={url:l,method:l,data:l,baseURL:u,transformRequest:u,transformResponse:u,paramsSerializer:u,timeout:u,timeoutMessage:u,withCredentials:u,withXSRFToken:u,adapter:u,responseType:u,xsrfCookieName:u,xsrfHeaderName:u,onUploadProgress:u,onDownloadProgress:u,decompress:u,maxContentLength:u,maxBodyLength:u,beforeRedirect:u,transport:u,httpAgent:u,httpsAgent:u,cancelToken:u,socketPath:u,responseEncoding:u,validateStatus:h,headers:(g,E,S)=>o(ZM(g),ZM(E),0,!0)};return Re.forEach(Object.keys(Object.assign({},e,t)),function(g){const E=m[g]||o,S=E(e[g],t[g],g);Re.isUndefined(S)&&E!==h||(n[g]=S)}),n}var e2=e=>{const t=Gh({},e);let n,{data:r,withXSRFToken:o,xsrfHeaderName:l,xsrfCookieName:u,headers:h,auth:m}=t;if(t.headers=h=Ia.from(h),t.url=_x($M(t.baseURL,t.url),e.params,e.paramsSerializer),m&&h.set("Authorization","Basic "+btoa((m.username||"")+":"+(m.password?unescape(encodeURIComponent(m.password)):""))),Re.isFormData(r)){if($r.hasStandardBrowserEnv||$r.hasStandardBrowserWebWorkerEnv)h.setContentType(void 0);else if((n=h.getContentType())!==!1){const[g,...E]=n?n.split(";").map(S=>ir(S).call(S)).filter(Boolean):[];h.setContentType([g||"multipart/form-data",...E].join("; "))}}if($r.hasStandardBrowserEnv&&(o&&Re.isFunction(o)&&(o=o(t)),o||o!==!1&&LJ(t.url))){const g=l&&u&&xJ.read(u);g&&h.set(l,g)}return t},MJ=typeof XMLHttpRequest<"u"&&function(e){return new we(function(t,n){const r=e2(e);let o=r.data;const l=Ia.from(r.headers).normalize();let u,h,m,g,E,{responseType:S,onUploadProgress:R,onDownloadProgress:b}=r;function x(){g&&g(),E&&E(),r.cancelToken&&r.cancelToken.unsubscribe(u),r.signal&&r.signal.removeEventListener("abort",u)}let P=new XMLHttpRequest;function k(){if(!P)return;const F=Ia.from("getAllResponseHeaders"in P&&P.getAllResponseHeaders());YM(function(K){t(K),x()},function(K){n(K),x()},{data:S&&S!=="text"&&S!=="json"?P.response:P.responseText,status:P.status,statusText:P.statusText,headers:F,config:e,request:P}),P=null}P.open(r.method.toUpperCase(),r.url,!0),P.timeout=r.timeout,"onloadend"in P?P.onloadend=k:P.onreadystatechange=function(){P&&P.readyState===4&&(P.status!==0||P.responseURL&&P.responseURL.indexOf("file:")===0)&&setTimeout(k)},P.onabort=function(){P&&(n(new Bt("Request aborted",Bt.ECONNABORTED,e,P)),P=null)},P.onerror=function(){n(new Bt("Network Error",Bt.ERR_NETWORK,e,P)),P=null},P.ontimeout=function(){let F=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const K=r.transitional||yx;r.timeoutErrorMessage&&(F=r.timeoutErrorMessage),n(new Bt(F,K.clarifyTimeoutError?Bt.ETIMEDOUT:Bt.ECONNABORTED,e,P)),P=null},o===void 0&&l.setContentType(null),"setRequestHeader"in P&&Re.forEach(l.toJSON(),function(F,K){P.setRequestHeader(K,F)}),Re.isUndefined(r.withCredentials)||(P.withCredentials=!!r.withCredentials),S&&S!=="json"&&(P.responseType=r.responseType),b&&([m,E]=CR(b,!0),P.addEventListener("progress",m)),R&&P.upload&&([h,g]=CR(R),P.upload.addEventListener("progress",h),P.upload.addEventListener("loadend",g)),(r.cancelToken||r.signal)&&(u=F=>{P&&(n(!F||F.type?new Vm(null,e,P):F),P.abort(),P=null)},r.cancelToken&&r.cancelToken.subscribe(u),r.signal&&(r.signal.aborted?u():r.signal.addEventListener("abort",u)));const V=function(F){const K=/^([-+\w]{1,25})(:?\/\/|:)/.exec(F);return K&&K[1]||""}(r.url);V&&$r.protocols.indexOf(V)===-1?n(new Bt("Unsupported protocol "+V+":",Bt.ERR_BAD_REQUEST,e)):P.send(o||null)})},UJ=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let r,o=new AbortController;const l=function(g){if(!r){r=!0,h();const E=g instanceof Error?g:this.reason;o.abort(E instanceof Bt?E:new Vm(E instanceof Error?E.message:E))}};let u=t&&setTimeout(()=>{u=null,l(new Bt("timeout ".concat(t," of ms exceeded"),Bt.ETIMEDOUT))},t);const h=()=>{e&&(u&&clearTimeout(u),u=null,e.forEach(g=>{g.unsubscribe?g.unsubscribe(l):g.removeEventListener("abort",l)}),e=null)};e.forEach(g=>g.addEventListener("abort",l));const{signal:m}=o;return m.unsubscribe=()=>Re.asap(h),m}},VJ=Kk,FJ=ho;xt({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=FJ.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var BJ=ho,jJ=fc;xt({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=BJ.f(this),n=jJ(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}});var pI=p(VJ),t2=Lm.f("asyncIterator"),GJ=p(t2);function fI(e,t){this.v=e,this.k=t}function ny(e){var t,n;function r(l,u){try{var h=e[l](u),m=h.value,g=m instanceof fI;pI.resolve(g?m.v:m).then(function(E){if(g){var S=l==="return"?"return":"next";if(!m.k||E.done)return r(S,E);E=e[S](E).value}o(h.done?"return":"normal",E)},function(E){r("throw",E)})}catch(E){o("throw",E)}}function o(l,u){switch(l){case"return":t.resolve({value:u,done:!0});break;case"throw":t.reject(u);break;default:t.resolve({value:u,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(l,u){return new pI(function(h,m){var g={key:l,arg:u,resolve:h,reject:m,next:null};n?n=n.next=g:(t=n=g,r(l,u))})},typeof e.return!="function"&&(this.return=void 0)}function fo(e){return function(){return new ny(e.apply(this,arguments))}}function St(e){return new fI(e,0)}function bR(e){var t={},n=!1;function r(o,l){return n=!0,{done:!1,value:new fI(l=new pI(function(u){u(e[o](l))}),1)}}return t[Um!==void 0&&OM||"@@iterator"]=function(){return this},t.next=function(o){return n?(n=!1,o):r("next",o)},typeof e.throw=="function"&&(t.throw=function(o){if(n)throw n=!1,o;return r("throw",o)}),typeof e.return=="function"&&(t.return=function(o){return n?(n=!1,o):r("return",o)}),t}ny.prototype[typeof Um=="function"&&GJ||"@@asyncIterator"]=function(){return this},ny.prototype.next=function(e){return this._invoke("next",e)},ny.prototype.throw=function(e){return this._invoke("throw",e)},ny.prototype.return=function(e){return this._invoke("return",e)};var mI=p(t2);function gI(e){var t,n,r,o=2;for(typeof Symbol<"u"&&(n=mI,r=Symbol.iterator);o--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new AR(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function AR(e){function t(n){if(Object(n)!==n)return we.reject(new TypeError(n+" is not an object."));var r=n.done;return we.resolve(n.value).then(function(o){return{value:o,done:r}})}return AR=function(n){this.s=n,this.n=n.next},AR.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?we.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?we.reject(n):t(r.apply(this.s,arguments))}},new AR(e)}const WJ=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,o=0;for(;o<n;)r=o+t,yield e.slice(o,r),o=r},zJ=function(){var e=fo(function*(t,n){var r,o=!1,l=!1;try{for(var u,h=gI(HJ(t));o=!(u=yield St(h.next())).done;o=!1){const m=u.value;yield*bR(gI(WJ(m,n)))}}catch(m){l=!0,r=m}finally{try{o&&h.return!=null&&(yield St(h.return()))}finally{if(l)throw r}}});return function(t,n){return e.apply(this,arguments)}}(),HJ=function(){var e=fo(function*(t){if(t[mI])return void(yield*bR(gI(t)));const n=t.getReader();try{for(;;){const{done:r,value:o}=yield St(n.read());if(r)break;yield o}}finally{yield St(n.cancel())}});return function(t){return e.apply(this,arguments)}}(),n2=(e,t,n,r)=>{const o=zJ(e,t);let l,u=0,h=m=>{l||(l=!0,r&&r(m))};return new ReadableStream({async pull(m){try{const{done:g,value:E}=await o.next();if(g)return h(),void m.close();let S=E.byteLength;if(n){let R=u+=S;n(R)}m.enqueue(new Uint8Array(E))}catch(g){throw h(g),g}},cancel:m=>(h(m),o.return())},{highWaterMark:2})};function i2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function r2(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?i2(Object(n),!0).forEach(function(r){U(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const IR=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",s2=IR&&typeof ReadableStream=="function",KJ=IR&&(typeof TextEncoder=="function"?(o2=new TextEncoder,e=>o2.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var o2;const a2=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e(...n)}catch{return!1}},qJ=s2&&a2(()=>{let e=!1;const t=new Request($r.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),_I=s2&&a2(()=>Re.isReadableStream(new Response("").body)),OR={stream:_I&&(e=>e.body)};var c2;IR&&(c2=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!OR[e]&&(OR[e]=Re.isFunction(c2[e])?t=>t[e]():(t,n)=>{throw new Bt("Response type '".concat(e,"' is not supported"),Bt.ERR_NOT_SUPPORT,n)})}));const YJ=async(e,t)=>{const n=Re.toFiniteNumber(e.getContentLength());return n??(async r=>r==null?0:Re.isBlob(r)?r.size:Re.isSpecCompliantForm(r)?(await new Request($r.origin,{method:"POST",body:r}).arrayBuffer()).byteLength:Re.isArrayBufferView(r)||Re.isArrayBuffer(r)?r.byteLength:(Re.isURLSearchParams(r)&&(r+=""),Re.isString(r)?(await KJ(r)).byteLength:void 0))(t)};var XJ=IR&&(async e=>{let{url:t,method:n,data:r,signal:o,cancelToken:l,timeout:u,onDownloadProgress:h,onUploadProgress:m,responseType:g,headers:E,withCredentials:S="same-origin",fetchOptions:R}=e2(e);g=g?(g+"").toLowerCase():"text";let b,x=UJ([o,l&&l.toAbortSignal()],u);const P=x&&x.unsubscribe&&(()=>{x.unsubscribe()});let k;try{if(m&&qJ&&n!=="get"&&n!=="head"&&(k=await YJ(E,r))!==0){let Z,J=new Request(t,{method:"POST",body:r,duplex:"half"});if(Re.isFormData(r)&&(Z=J.headers.get("content-type"))&&E.setContentType(Z),J.body){const[re,pe]=XM(k,CR(JM(m)));r=n2(J.body,65536,re,pe)}}Re.isString(S)||(S=S?"include":"omit");const V="credentials"in Request.prototype;b=new Request(t,r2(r2({},R),{},{signal:x,method:n.toUpperCase(),headers:E.normalize().toJSON(),body:r,duplex:"half",credentials:V?S:void 0}));let F=await fetch(b);const K=_I&&(g==="stream"||g==="response");if(_I&&(h||K&&P)){const Z={};["status","statusText","headers"].forEach(Ce=>{Z[Ce]=F[Ce]});const J=Re.toFiniteNumber(F.headers.get("content-length")),[re,pe]=h&&XM(J,CR(JM(h),!0))||[];F=new Response(n2(F.body,65536,re,()=>{pe&&pe(),P&&P()}),Z)}g=g||"text";let $=await OR[Re.findKey(OR,g)||"text"](F,e);return!K&&P&&P(),await new we((Z,J)=>{YM(Z,J,{data:$,headers:Ia.from(F.headers),status:F.status,statusText:F.statusText,config:e,request:b})})}catch(V){throw P&&P(),V&&V.name==="TypeError"&&/fetch/i.test(V.message)?Object.assign(new Bt("Network Error",Bt.ERR_NETWORK,e,b),{cause:V.cause||V}):Bt.from(V,V&&V.code,e,b)}});const EI={http:null,xhr:MJ,fetch:XJ};Re.forEach(EI,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const l2=e=>"- ".concat(e),JJ=e=>Re.isFunction(e)||e===null||e===!1;var u2={getAdapter:e=>{e=Re.isArray(e)?e:[e];const{length:t}=e;let n,r;const o={};for(let l=0;l<t;l++){let u;if(n=e[l],r=n,!JJ(n)&&(r=EI[(u=String(n)).toLowerCase()],r===void 0))throw new Bt("Unknown adapter '".concat(u,"'"));if(r)break;o[u||"#"+l]=r}if(!r){const l=Object.entries(o).map(u=>{let[h,m]=u;return"adapter ".concat(h," ")+(m===!1?"is not supported by the environment":"is not available in the build")});throw new Bt("There is no suitable adapter to dispatch the request "+(t?l.length>1?`since :
`+l.map(l2).join(`
`):" "+l2(l[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:EI};function yI(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Vm(null,e)}function d2(e){return yI(e),e.headers=Ia.from(e.headers),e.data=hI.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),u2.getAdapter(e.adapter||uI.adapter)(e).then(function(t){return yI(e),t.data=hI.call(e,e.transformResponse,t),t.headers=Ia.from(t.headers),t},function(t){return qM(t)||(yI(e),t&&t.response&&(t.response.data=hI.call(e,e.transformResponse,t.response),t.response.headers=Ia.from(t.response.headers))),we.reject(t)})}const h2="1.7.9",NR={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{NR[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const p2={};NR.transitional=function(e,t,n){function r(o,l){return"[Axios v"+h2+"] Transitional option '"+o+"'"+l+(n?". "+n:"")}return(o,l,u)=>{if(e===!1)throw new Bt(r(l," has been removed"+(t?" in "+t:"")),Bt.ERR_DEPRECATED);return t&&!p2[l]&&(p2[l]=!0,console.warn(r(l," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(o,l,u)}},NR.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var PR={assertOptions:function(e,t,n){if(typeof e!="object")throw new Bt("options must be an object",Bt.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let o=r.length;for(;o-- >0;){const l=r[o],u=t[l];if(u){const h=e[l],m=h===void 0||u(h,l,e);if(m!==!0)throw new Bt("option "+l+" must be "+m,Bt.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new Bt("Unknown option "+l,Bt.ERR_BAD_OPTION)}},validators:NR};const vc=PR.validators;let DR=class{constructor(e){this.defaults=e,this.interceptors={request:new Ex,response:new Ex}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const o=r.stack?r.stack.replace(/^.+\n/,""):"";try{n.stack?o&&!String(n.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+o):n.stack=o}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=Gh(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:o}=t;n!==void 0&&PR.assertOptions(n,{silentJSONParsing:vc.transitional(vc.boolean),forcedJSONParsing:vc.transitional(vc.boolean),clarifyTimeoutError:vc.transitional(vc.boolean)},!1),r!=null&&(Re.isFunction(r)?t.paramsSerializer={serialize:r}:PR.assertOptions(r,{encode:vc.function,serialize:vc.function},!0)),PR.assertOptions(t,{baseUrl:vc.spelling("baseURL"),withXsrfToken:vc.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let l=o&&Re.merge(o.common,o[t.method]);o&&Re.forEach(["delete","get","head","post","put","patch","common"],b=>{delete o[b]}),t.headers=Ia.concat(l,o);const u=[];let h=!0;this.interceptors.request.forEach(function(b){typeof b.runWhen=="function"&&b.runWhen(t)===!1||(h=h&&b.synchronous,u.unshift(b.fulfilled,b.rejected))});const m=[];let g;this.interceptors.response.forEach(function(b){m.push(b.fulfilled,b.rejected)});let E,S=0;if(!h){const b=[d2.bind(this),void 0];for(b.unshift.apply(b,u),b.push.apply(b,m),E=b.length,g=we.resolve(t);S<E;)g=g.then(b[S++],b[S++]);return g}E=u.length;let R=t;for(S=0;S<E;){const b=u[S++],x=u[S++];try{R=b(R)}catch(P){x.call(this,P);break}}try{g=d2.call(this,R)}catch(b){return we.reject(b)}for(S=0,E=m.length;S<E;)g=g.then(m[S++],m[S++]);return g}getUri(e){return _x($M((e=Gh(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};Re.forEach(["delete","get","head","options"],function(e){DR.prototype[e]=function(t,n){return this.request(Gh(n||{},{method:e,url:t,data:(n||{}).data}))}}),Re.forEach(["post","put","patch"],function(e){function t(n){return function(r,o,l){return this.request(Gh(l||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:r,data:o}))}}DR.prototype[e]=t(),DR.prototype[e+"Form"]=t(!0)});var kR=DR;class vI{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new we(function(o){n=o});const r=this;this.promise.then(o=>{if(!r._listeners)return;let l=r._listeners.length;for(;l-- >0;)r._listeners[l](o);r._listeners=null}),this.promise.then=o=>{let l;const u=new we(h=>{r.subscribe(h),l=h}).then(o);return u.cancel=function(){r.unsubscribe(l)},u},t(function(o,l,u){r.reason||(r.reason=new Vm(o,l,u),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=r=>{t.abort(r)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new vI(function(r){t=r}),cancel:t}}}var $J=vI;const SI={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(SI).forEach(e=>{let[t,n]=e;SI[n]=t});var QJ=SI;const Ji=function e(t){const n=new kR(t),r=Z1(kR.prototype.request,n);return Re.extend(r,kR.prototype,n,{allOwnKeys:!0}),Re.extend(r,n,null,{allOwnKeys:!0}),r.create=function(o){return e(Gh(t,o))},r}(uI);Ji.Axios=kR,Ji.CanceledError=Vm,Ji.CancelToken=$J,Ji.isCancel=qM,Ji.VERSION=h2,Ji.toFormData=hR,Ji.AxiosError=Bt,Ji.Cancel=Ji.CanceledError,Ji.all=function(e){return we.all(e)},Ji.spread=function(e){return function(t){return e.apply(null,t)}},Ji.isAxiosError=function(e){return Re.isObject(e)&&e.isAxiosError===!0},Ji.mergeConfig=Gh,Ji.AxiosHeaders=Ia,Ji.formToJSON=e=>HM(Re.isHTMLForm(e)?new FormData(e):e),Ji.getAdapter=u2.getAdapter,Ji.HttpStatusCode=QJ,Ji.default=Ji;var Pr=Ji;const ZJ=()=>{};function iy(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:ZJ};return e.promise=new we((t,n)=>{e.resolve=r=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(r),e.value=r)},e.reject=r=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(r))}}),e}const LR=new Map,xR=new Map,Sc=new Map;let oi=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Ot=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const f2=new g9;let Oa=f2.getResult(),TI=null;function Tt(e){if(!TI){Oa=f2.getResult();const t=function(h){if(h.engine.name==="Blink"&&h.browser.name!=="WeChat")return Ot.CHROME;switch(h.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Ot.CHROME;case"Safari":case"Mobile Safari":return Ot.SAFARI;case"Edge":return Ot.EDGE;case"Firefox":return Ot.FIREFOX;case"QQ":case"QQBrowser":return Ot.QQ;case"Opera":return Ot.OPERA;case"WeChat":return Ot.WECHAT;default:return h.browser.name||""}}(Oa),n=m2(Oa),r=function(h){return h.os.name==="Windows"?h.os.version?h.os.name+" "+h.os.version:h.os.name:h.os.name||""}(Oa),o=Oa.os.version,l=m2(Oa,!1),u=Oa.device.type;if(!(t&&n&&r&&o))return{name:t,version:n,os:r,osVersion:o,browserVersion:l,deviceType:u};TI={name:t,version:n,os:r,osVersion:o,browserVersion:l,deviceType:u}}return TI}function m2(e){let t,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function MR(){return Tt().os}function g2(){const e=Tt();return"".concat(e.os," ").concat(e.osVersion)}function UR(){const e=Tt();return!!(Oa.engine.name==="WebKit"&&e.os===oi.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Ot.SAFARI||fr()&&e.name!==Ot.SAFARI)}function Ml(){return Tt().name===Ot.CHROME}function Li(){return Tt().name===Ot.SAFARI}function _2(){return Tt().name===Ot.EDGE}function vn(){return Tt().name===Ot.FIREFOX}function fr(){return Tt().os===oi.IOS}function ry(e){const t=Tt();return!(t.name!==Ot.CHROME||!t.osVersion)&&Number(t.version)>=e}function E2(e){const t=Tt();return!(t.name!==Ot.CHROME||!t.osVersion)&&Number(t.version)<e}function RI(e,t,n){const r=Tt();return!(r.name!==e||!r.osVersion)&&(n?Number(r.version)>=t&&Number(r.version)<=n:Number(r.version)===t)}function wI(e){const t=Tt();return!(t.name!==Ot.EDGE||!t.osVersion)&&Number(t.version)>=e}function y2(e){const t=Tt();return!(t.name!==Ot.SAFARI||!t.osVersion)&&Number(t.version)>=e}function v2(e,t,n){const r=Tt();if(r.os!==oi.IOS||!r.osVersion)return!1;const o=r.osVersion.split(".");return t&&Number(o[0])===e&&Number(o[1])<t||Number(o[0])<e}function S2(e,t,n){const r=Tt();if(r.name!==Ot.SAFARI||!r.osVersion||!r.browserVersion)return!1;const o=r.browserVersion.split(".");return n?t&&Number(o[0])===e&&Number(o[1])<t||Number(o[0])<e:t?Number(o[0])===e&&Number(o[1])<=t||Number(o[0])<e:Number(o[0])<=e}function CI(e){const t=Tt();return!(t.name!==Ot.OPERA||!t.osVersion)&&Number(t.version)>=e}function T2(){const e=Tt();if(e.os!==oi.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function Fm(){const e=Tt();if(e.os!==oi.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function bI(){const e=Tt();if(e.os!==oi.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function R2(){const e=Tt();if(e.os!==oi.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Go(){return Li()&&navigator.maxTouchPoints>0}function w2(){return Tt().name===Ot.WECHAT}function C2(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function AI(){const e=MR();return function(){const{deviceType:t}=Tt();return t==="mobile"||t==="tablet"}()||e===oi.ANDROID||e===oi.IOS||e===oi.HARMONY_OS}function Ul(){const e=Tt();return e.name!==Ot.EDGE&&e.name!==Ot.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function VR(){return MR()===oi.ANDROID}function sy(){const e=Tt();return VR()&&(e.name===Ot.CHROME||e.name===Ot.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function b2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Ne(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?b2(Object(n),!0).forEach(function(r){Qe(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Qe(e,t,n){return(t=function(r){var o=function(l,u){if(typeof l!="object"||l===null)return l;var h=l[Symbol.toPrimitive];if(h!==void 0){var m=h.call(l,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(r);return typeof o=="symbol"?o:String(o)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let B=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),oe=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),Qe(this,"code",void 0),Qe(this,"message",void 0),Qe(this,"data",void 0),Qe(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Vl(e,t){if(typeof e!="boolean")throw new oe(B.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function ei(e,t,n){if(!Te(n).call(n,e))throw new oe(B.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function jt(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(o){return typeof o=="number"&&o%1==0}(e))throw new oe(B.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function II(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new oe(B.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&jt(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&jt(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&jt(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&jt(e.ideal,"".concat(t,".ideal"),1,1/0)}else jt(e,t,1,1/0)}function vi(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,o=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new oe(B.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!A2(e,n,r,o))throw new oe(B.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(o?" ASCII characters only.":""))}function Fl(e,t){if(!Array.isArray(e))throw new oe(B.INVALID_PARAMS,"".concat(t," should be an array"))}function Sn(e){return e==null}function A2(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!r||function(o){if(typeof o!="string")return!1;for(let l=0;l<o.length;l+=1){const u=o.charCodeAt(l);if(u<0||u>255)return!1}return!0}(e))}var oy=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(oy||{}),OI=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(OI||{});const I2=new class{constructor(){Qe(this,"_clientSize",null),Qe(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Qe(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Qe(this,"getStyle",e=>window.getComputedStyle(e,null)),Qe(this,"checkCssVisibleProperty",e=>{var t;let n=!0;const r=this.getStyle(e),{display:o,visibility:l,opacity:u,filter:h}=r;return(o==="none"||Te(t=["hidden","collapse"]).call(t,l)||Number(u)<.1)&&(n=!1),!!n&&(h&&h.split(" ").filter(m=>{var g;const E=m.split("(")[0];return Te(g=["brightness","blur","opacity"]).call(g,E)}).map(m=>{const[g,E]=m.split(/\(|\)/);return[g,Number(E.match(/^[0-9\.]+/))]}).forEach(m=>{const[g,E]=m;switch(g){case"brightness":(E<.1||E>3)&&(n=!1);break;case"blur":E>3&&(n=!1);break;case"opacity":E<.1&&(n=!1)}}),n)}),Qe(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,r=!0;const o=u=>t(u);let l=e;for(;l&&r;)o(l)||(n=!1,r=!1),l=l.parentElement,l||(r=!1);return n}),Qe(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),Qe(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:r,right:o,top:l,bottom:u}=e.getBoundingClientRect(),h=this.getClientWidth(),m=this.getClientHeight();return{width:t,height:n,left:r,right:o,top:l,bottom:u,clientWidth:h,clientHeight:m,clientMin:Math.min(h,m)}}),Qe(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),Qe(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),Qe(this,"checkCoverForAPoint",(e,t,n)=>{const r=this.elementFromPoint(e,t);return r!==null&&r!==n}),Qe(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:r}=this._clientSize,o=e/6,l=t/6,u=[],h=10**6;for(let m=0;m<5;m++)for(let g=0;g<5;g++){const E=(n*h+(m===0?.1:m===4?(o*m*h-1e5)/h:o*m)*h)/h,S=(r*h+(g===0?.1:g===4?(l*g*h-1e5)/h:l*g)*h)/h;u.push({x:E,y:S})}return[...u]}),Qe(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),Qe(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),Qe(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:r,clientHeight:o,clientWidth:l,clientMin:u}=this._clientSize;let h,m,g,E;if(e<0)h=0;else{if(!(e<l))return!1;h=e}if(t<0)return!1;if(m=t<l?t:l,n<0)g=0;else{if(!(n<o))return!1;g=n}if(r<0)return!1;E=r<o?r:o;const S=m-h,R=E-g;return this.checkSizeIsVisible(S,R,u)}),Qe(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),Qe(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(oy.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(oy.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(oy.SIZE)}}return this.returnHiddenResult(oy.STYLE)}return this.returnHiddenResult(OI.UNMOUNTED)}return this.returnHiddenResult(OI.INVALID_HTML_ELEMENT)}),Qe(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function NI(e){return new TextEncoder().encode(e)}const O2=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},PI=async e=>function(t,n){let r="";return new Uint8Array(t).forEach(o=>{r+=o.toString(n).padStart(2,"0")}),r}(await crypto.subtle.digest("SHA-256",NI(e)),16);let En=class{constructor(){Qe(this,"_events",{}),Qe(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const n=this._events[e],r=this._indexOfListener(n,t);r!==-1&&n.splice(r,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map(l=>l);for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];for(let l=0;l<t.length;l+=1){const u=t[l];u.once&&this.off(e,u.listener),u.listener.apply(this,r||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];[...this._events[e]||[]].forEach(o=>{o.once&&this.off(e,o.listener);try{o.listener.apply(this,n)}catch(l){console.error("safeEmit event:".concat(e," error ").concat(l==null?void 0:l.toString()))}})}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}},ay=null;function N2(){if(ay)return ay;if(window.electron)return ay=window.electron;if(!window.require)return null;try{return ay=window.require("electron"),ay}catch{return null}}let Hn=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),Tn=function(e){return e.TRACER="tracer",e}({});function P2(e){return jt(e.timeout,"config.timeout",0,1e5),jt(e.timeoutFactor,"config.timeoutFactor",0,100,!1),jt(e.maxRetryCount,"config.maxRetryConfig",0,1/0),jt(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let e$=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),kt=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function cy(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function D2(e){return vi(e.turnServerURL,"turnServerURL"),vi(e.username,"username"),vi(e.password,"password"),e.udpport&&jt(e.udpport,"udpport",1,99999,!0),e.forceturn&&Vl(e.forceturn,"forceturn"),e.security&&Vl(e.security,"security"),e.tcpport&&jt(e.tcpport,"tcpport",1,99999,!0),!0}function DI(e){return e.level!==void 0&&ei(e.level,"level",[1,2,3]),e.delay!==void 0&&jt(e.delay,"delay",0,3e3,!0),!0}let pt=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),xi=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),Ts=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Bm=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function Mi(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return e.getListeners(t).length===0?we.reject(new oe(B.UNEXPECTED_ERROR,"can not emit promise")):new we((l,u)=>{e.emit(t,...r,l,u)})}function Xt(e,t){if(e.getListeners(t).length===0)return we.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return Mi(e,t,...r)}function zs(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return ly(e,t,...r)}function ly(e,t){let n=null,r=null;for(var o=arguments.length,l=new Array(o>2?o-2:0),u=2;u<o;u++)l[u-2]=arguments[u];if(e.emit(t,...l,h=>{n=h},h=>{r=h}),r!==null)throw r;if(n===null)throw new oe(B.UNEXPECTED_ERROR,"handler is not sync");return n}const Un=new class extends En{set networkState(e){this.emit(Bm.NETWORK_STATE_CHANGE,e,this._networkState),e===Ts.ONLINE?this.emit(Bm.ONLINE):e===Ts.OFFLINE&&(this.onlineWaiter=new we(t=>{this.once(Bm.ONLINE,()=>{this.onlineWaiter=void 0,t(Ts.ONLINE)})}),this.emit(Bm.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Ts.ONLINE}constructor(){super(),Qe(this,"_moduleName","network-indicator"),Qe(this,"_networkState",Ts.ONLINE),Qe(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Ts.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Ts.OFFLINE})}};function FR(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function jm(e){const t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function BR(e){we!==void 0?we.resolve().then(e):setTimeout(e,0)}function Rn(e){return JSON.parse(JSON.stringify(e))}function Wh(e){try{return Rn(e)}catch{return e}}const k2={};function Yu(e,t){k2[t]||(k2[t]=!0,e())}function zh(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function Xu(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function L2(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const r=new Uint8Array(t);r.set(n),n=r}return n}function x2(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=ms(t).call(t,(u,h)=>u+h.length,0),o=new Uint8Array(new ArrayBuffer(r));let l=0;return t.forEach(u=>{o.set(u,l),l+=u.length}),o}function Tc(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function M2(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(n=>{t+=typeof n=="string"?Tc(n):n.size}),t+138}function t$(e){const t=new oe(B.TIMEOUT,"timeout");return new we((n,r)=>{window.setTimeout(()=>r(t),e)})}function Si(e){return new we(t=>{window.setTimeout(t,e)})}function Jt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+Jt(e-n.length,"")}function Hh(){return Jt(32,"").toUpperCase()}const jR=()=>{},U2=new class{constructor(){Qe(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var o=arguments.length,l=new Array(o>4?o-4:0),u=4;u<o;u++)l[u-4]=arguments[u];if(this.fnMap.has(t)){const h=this.fnMap.get(t);if(h.threshold!==n){h.fn(...h.args),clearTimeout(h.timer);const m=window.setTimeout(()=>{const g=this.fnMap.get(t);g&&g.fn(...g.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:m,args:l,skipFn:r})}else h.skipFn&&h.skipFn(...h.args),this.fnMap.set(t,Ne(Ne({},h),{},{fn:e,args:l,skipFn:r}))}else{const h=window.setTimeout(()=>{const m=this.fnMap.get(t);m&&m.fn(...m.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:h,args:l,skipFn:r})}}},V2=U2.throttleByKey.bind(U2);function F2(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function kI(e,t){if(!F2(e)||!F2(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let r=0;r<t.length;r++)n[r]=kI(e[r],t[r]);return n}{const n=Ne({},e);for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?n[r]=kI(e[r],t[r]):n[r]=t[r]);return n}}function B2(e,t){let n=[0];if(n=new Array(t).fill(0),e===0)return n;let r=0;for(;e>0&&(n[r]=255&e,e>>=8,r++,r!==t););return n}function LI(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function j2(e){const t="0123456789abcdef";function n(K){let $,Z="";for($=0;$<=3;$++)Z+=t.charAt(K>>8*$+4&15)+t.charAt(K>>8*$&15);return Z}function r(K,$){const Z=(65535&K)+(65535&$);return(K>>16)+($>>16)+(Z>>16)<<16|65535&Z}function o(K,$,Z,J,re,pe){return r(function(Ce,Ie){return Ce<<Ie|Ce>>>32-Ie}(r(r($,K),r(J,pe)),re),Z)}function l(K,$,Z,J,re,pe,Ce){return o($&Z|~$&J,K,$,re,pe,Ce)}function u(K,$,Z,J,re,pe,Ce){return o($&J|Z&~J,K,$,re,pe,Ce)}function h(K,$,Z,J,re,pe,Ce){return o($^Z^J,K,$,re,pe,Ce)}function m(K,$,Z,J,re,pe,Ce){return o(Z^($|~J),K,$,re,pe,Ce)}const g=function(K){let $;const Z=1+(K.length+8>>6),J=new Array(16*Z);for($=0;$<16*Z;$++)J[$]=0;for($=0;$<K.length;$++)J[$>>2]|=K.charCodeAt($)<<$%4*8;return J[$>>2]|=128<<$%4*8,J[16*Z-2]=8*K.length,J}(e);let E,S,R,b,x,P=1732584193,k=-271733879,V=-1732584194,F=271733878;for(E=0;E<g.length;E+=16)S=P,R=k,b=V,x=F,P=l(P,k,V,F,g[E+0],7,-680876936),F=l(F,P,k,V,g[E+1],12,-389564586),V=l(V,F,P,k,g[E+2],17,606105819),k=l(k,V,F,P,g[E+3],22,-1044525330),P=l(P,k,V,F,g[E+4],7,-176418897),F=l(F,P,k,V,g[E+5],12,1200080426),V=l(V,F,P,k,g[E+6],17,-1473231341),k=l(k,V,F,P,g[E+7],22,-45705983),P=l(P,k,V,F,g[E+8],7,1770035416),F=l(F,P,k,V,g[E+9],12,-1958414417),V=l(V,F,P,k,g[E+10],17,-42063),k=l(k,V,F,P,g[E+11],22,-1990404162),P=l(P,k,V,F,g[E+12],7,1804603682),F=l(F,P,k,V,g[E+13],12,-40341101),V=l(V,F,P,k,g[E+14],17,-1502002290),k=l(k,V,F,P,g[E+15],22,1236535329),P=u(P,k,V,F,g[E+1],5,-165796510),F=u(F,P,k,V,g[E+6],9,-1069501632),V=u(V,F,P,k,g[E+11],14,643717713),k=u(k,V,F,P,g[E+0],20,-373897302),P=u(P,k,V,F,g[E+5],5,-701558691),F=u(F,P,k,V,g[E+10],9,38016083),V=u(V,F,P,k,g[E+15],14,-660478335),k=u(k,V,F,P,g[E+4],20,-405537848),P=u(P,k,V,F,g[E+9],5,568446438),F=u(F,P,k,V,g[E+14],9,-1019803690),V=u(V,F,P,k,g[E+3],14,-187363961),k=u(k,V,F,P,g[E+8],20,1163531501),P=u(P,k,V,F,g[E+13],5,-1444681467),F=u(F,P,k,V,g[E+2],9,-51403784),V=u(V,F,P,k,g[E+7],14,1735328473),k=u(k,V,F,P,g[E+12],20,-1926607734),P=h(P,k,V,F,g[E+5],4,-378558),F=h(F,P,k,V,g[E+8],11,-2022574463),V=h(V,F,P,k,g[E+11],16,1839030562),k=h(k,V,F,P,g[E+14],23,-35309556),P=h(P,k,V,F,g[E+1],4,-1530992060),F=h(F,P,k,V,g[E+4],11,1272893353),V=h(V,F,P,k,g[E+7],16,-155497632),k=h(k,V,F,P,g[E+10],23,-1094730640),P=h(P,k,V,F,g[E+13],4,681279174),F=h(F,P,k,V,g[E+0],11,-358537222),V=h(V,F,P,k,g[E+3],16,-722521979),k=h(k,V,F,P,g[E+6],23,76029189),P=h(P,k,V,F,g[E+9],4,-640364487),F=h(F,P,k,V,g[E+12],11,-421815835),V=h(V,F,P,k,g[E+15],16,530742520),k=h(k,V,F,P,g[E+2],23,-995338651),P=m(P,k,V,F,g[E+0],6,-198630844),F=m(F,P,k,V,g[E+7],10,1126891415),V=m(V,F,P,k,g[E+14],15,-1416354905),k=m(k,V,F,P,g[E+5],21,-57434055),P=m(P,k,V,F,g[E+12],6,1700485571),F=m(F,P,k,V,g[E+3],10,-1894986606),V=m(V,F,P,k,g[E+10],15,-1051523),k=m(k,V,F,P,g[E+1],21,-2054922799),P=m(P,k,V,F,g[E+8],6,1873313359),F=m(F,P,k,V,g[E+15],10,-30611744),V=m(V,F,P,k,g[E+6],15,-1560198380),k=m(k,V,F,P,g[E+13],21,1309151649),P=m(P,k,V,F,g[E+4],6,-145523070),F=m(F,P,k,V,g[E+11],10,-1120210379),V=m(V,F,P,k,g[E+2],15,718787259),k=m(k,V,F,P,g[E+9],21,-343485551),P=r(P,S),k=r(k,R),V=r(V,b),F=r(F,x);return n(P)+n(k)+n(V)+n(F)}let n$=1,G2=console,Gi=class{static setLogger(e){G2=e}constructor(e,t){Qe(this,"id",void 0),Qe(this,"lockingPromise",we.resolve()),Qe(this,"locks",0),Qe(this,"name",""),Qe(this,"lockId",void 0),this.lockId=n$++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),r=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");G2.debug("".concat(n," ").concat(r))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new we(o=>{t=()=>{this.locks-=1,this.logger("unlocked",e),o()}}),r=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),r}};function Gm(e,t){return function(n,r,o){const l=o.value;if(typeof l!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){const u=this[t];if(!u)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const h=await u.lock("From ".concat(e,".").concat(r));try{for(var m=arguments.length,g=new Array(m),E=0;E<m;E++)g[E]=arguments[E];return await l.apply(this,g)}finally{h()}},o}}const Kn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function xI(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function Na(e,t,n,r){const o=Object.assign({},Kn,r);let l=o.timeout;const u=async()=>{await function(g){return new we(E=>{window.setTimeout(E,g)})}(l),l*=o.timeoutFactor,l=Math.min(o.maxRetryTimeout,l)};let h=!1;const m=new we(async(g,E)=>{t=t||(()=>!1),n=n||(()=>!0);for(let S=0;S<o.maxRetryCount;S+=1){if(h)return E(new oe(B.OPERATION_ABORTED));try{const R=await e();if(!t(R,S)||S+1===o.maxRetryCount)return g(R);await u()}catch(R){if(!n(R,S)||S+1===o.maxRetryCount)return E(R);await u()}}});return m.cancel=()=>h=!0,m}let GR,W2=class{constructor(e){Qe(this,"input",[]),Qe(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:ms(e=this.input).call(e,(t,n)=>t+n)/this.input.length}},WR=0,MI=0;function UI(e,t,n,r){return new we((o,l)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),WR+=Tc(t.data)):n&&(t.data.size?WR+=t.data.size:t.data instanceof FormData?WR+=M2(t.data):WR+=Tc(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Pr.request(t).then(u=>{typeof u.data=="string"?MI+=Tc(u.data):u.data instanceof ArrayBuffer||u.data instanceof Uint8Array?MI+=u.data.byteLength:MI+=Tc(JSON.stringify(u.data)),o(u.data)}).catch(u=>{Pr.isCancel(u)?l(new oe(B.OPERATION_ABORTED,"cancel token canceled")):u.code==="ECONNABORTED"?l(new oe(B.NETWORK_TIMEOUT,u.message)):u.response?l(new oe(B.NETWORK_RESPONSE_ERROR,u.response.status)):l(new oe(B.NETWORK_ERROR,u.message))})})}async function i$(e,t){const n=new Blob([t.data],{type:"buffer"});return await UI(e,Ne(Ne({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const z2=()=>window.isSecureContext!==void 0;function Wo(e){if(Array.isArray(e))return e.map(n=>n);if(!H2(e))return e;const t={};for(const n in e){const r=e[n];H2(r)||Array.isArray(r)?t[n]=Wo(r):t[n]=r}return t}function H2(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let VI=class{constructor(e){Qe(this,"input",[]),Qe(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Rc={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},uy={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Rc,remoteCandidate:Rc},updateInterval:0},K2={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},q2={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},Y2={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},X2={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let FI=class{constructor(e,t){Qe(this,"onFirstVideoReceived",void 0),Qe(this,"onFirstVideoDecoded",void 0),Qe(this,"onFirstAudioReceived",void 0),Qe(this,"onFirstVideoDecodedTimeout",void 0),Qe(this,"onFirstAudioDecoded",void 0),Qe(this,"onSelectedLocalCandidateChanged",void 0),Qe(this,"onSelectedRemoteCandidateChanged",void 0),Qe(this,"videoIsReady",!1),Qe(this,"videoIsReady2",{}),Qe(this,"pc",void 0),Qe(this,"options",void 0),Qe(this,"intervalTimer",void 0),Qe(this,"stats",Wo(uy)),Qe(this,"isFirstVideoReceived",{}),Qe(this,"isFirstVideoDecoded",{}),Qe(this,"isFirstAudioReceived",{}),Qe(this,"isFirstAudioDecoded",{}),Qe(this,"isFirstVideoDecodedTimeout",{}),Qe(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new we(e=>{e({local:Ne({},Rc),remote:Ne({},Rc)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let r=0,o=0,l=0,u=0;for(const h of n)e[h].forEach((m,g)=>{if(!this.lossRateWindowStats[t-1][h][g]||!this.lossRateWindowStats[0][h][g])return;const E=this.lossRateWindowStats[t-1][h][g].packets-this.lossRateWindowStats[0][h][g].packets,S=this.lossRateWindowStats[t-1][h][g].packetsLost-this.lossRateWindowStats[0][h][g].packetsLost;h==="videoSend"||h==="audioSend"?(r+=E,l+=S):(o+=E,u+=S),Number.isNaN(E)||Number.isNaN(E)?m.packetLostRate=0:m.packetLostRate=E<=0||S<=0?0:S/(E+S)});e.sendPacketLossRate=r<=0||l<=0?0:l/(r+l),e.recvPacketLossRate=o<=0||u<=0?0:u/(o+u)}},r$=class extends FI{constructor(){super(...arguments),Qe(this,"_stats",uy),Qe(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=Wo(uy);const n=t.filter(o=>o.type==="ssrc");this.processSSRCStats(n);const r=t.find(o=>o.type==="VideoBwe");r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var n;const r=Te(n=t.id).call(n,"send");switch("".concat(t.mediaType,"_").concat(r?"send":"recv")){case"video_send":{const o=Wo(q2);o.codec=t.googCodecName,o.adaptionChangeReason="none",t.googCpuLimitedResolution&&(o.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(o.adaptionChangeReason="bandwidth"),o.avgEncodeMs=Number(t.googAvgEncodeMs),o.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},o.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},o.firsCount=Number(t.googFirReceived),o.nacksCount=Number(t.googNacksReceived),o.plisCount=Number(t.googPlisReceived),o.frameCount=Number(t.framesEncoded),o.bytes=Number(t.bytesSent),o.packets=Number(t.packetsSent),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(o),this._stats.rtt=o.rttMs;break}case"video_recv":{const o=Wo(K2),l=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(o.codec=t.googCodecName,o.targetDelayMs=Number(t.googTargetDelayMs),o.renderDelayMs=Number(t.googRenderDelayMs),o.currentDelayMs=Number(t.googCurrentDelayMs),o.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),o.decodeMs=Number(t.googDecodeMs),o.maxDecodeMs=Number(t.googMaxDecodeMs),o.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},o.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},o.decodeFrameRate=Number(t.googFrameRateDecoded),o.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},o.jitterBufferMs=Number(t.googJitterBufferMs),o.firsCount=Number(t.googFirsSent),o.nacksCount=Number(t.googNacksSent),o.plisCount=Number(t.googPlisSent),o.framesDecodeCount=Number(t.framesDecoded),o.bytes=Number(t.bytesReceived),o.packets=Number(t.packetsReceived),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.packets>0&&!this.isFirstVideoReceived[o.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(o.ssrc),this.isFirstVideoReceived[o.ssrc]=!0),o.framesDecodeCount>0&&!this.isFirstVideoDecoded[o.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(o.ssrc,o.decodedFrame.width,o.decodedFrame.height),this.isFirstVideoDecoded[o.ssrc]=!0),l){const u=l.stats,h=Date.now()-l.lts;o.framesDecodeFreezeTime=u.framesDecodeFreezeTime,o.framesDecodeInterval=u.framesDecodeInterval,o.framesDecodeCount>u.framesDecodeCount&&this.isFirstVideoDecoded[o.ssrc]?(l.lts=Date.now(),o.framesDecodeInterval=h,o.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?o.framesDecodeFreezeTime+=o.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):o.framesDecodeCount<l.stats.framesDecodeCount&&(o.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(o.ssrc,{stats:Ne({},o),lts:Date.now()}),this._stats.videoRecv.push(o);break}case"audio_recv":{const o=Wo(X2);o.codec=t.googCodecName,o.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,o.decodingCNG=Number(t.googDecodingCNG),o.decodingCTN=Number(t.googDecodingCTN),o.decodingCTSG=Number(t.googDecodingCTSG),o.decodingNormal=Number(t.googDecodingNormal),o.decodingPLC=Number(t.googDecodingPLC),o.decodingPLCCNG=Number(t.googDecodingPLCCNG),o.expandRate=Number(t.googExpandRate),o.accelerateRate=Number(t.googAccelerateRate),o.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),o.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),o.speechExpandRate=Number(t.googSpeechExpandRate),o.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),o.jitterBufferMs=Number(t.googJitterBufferMs),o.jitterMs=Number(t.googJitterReceived),o.bytes=Number(t.bytesReceived),o.packets=Number(t.packetsReceived),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),o.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),o.receivedFrames>0&&!this.isFirstAudioReceived[o.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(o.ssrc),this.isFirstAudioReceived[o.ssrc]=!0),o.decodingNormal>0&&!this.isFirstAudioDecoded[o.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(o.ssrc),this.isFirstAudioDecoded[o.ssrc]=!0),this._stats.audioRecv.push(o);break}case"audio_send":{const o=Wo(Y2);o.codec=t.googCodecName,o.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,o.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),o.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),o.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),o.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),o.bytes=Number(t.bytesSent),o.packets=Number(t.packetsSent),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.rttMs=Number(t.googRtt||0),this._stats.rtt=o.rttMs,this._stats.audioSend.push(o);break}}})}_getStats(){return new we((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(n=>{const r={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(o=>{r[o]=n.stat(o)}),t.push(r)}),t}},dy=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),zR=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),BI=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),Hs=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var Wm=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(Wm||{});function hy(e,t,n,r){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Wm.kNone;if(!t)return;const l=Number(t[n]);if(typeof l!="number")return;const u=Number(t[r]);if(typeof u!="number")return;if(!e)return u?l/u*o:void 0;const h=Number(e[n]);if(typeof h!="number")return;const m=Number(e[r]);if(typeof m!="number")return;const g=u-m;return g?(l-h)/g*o:void 0}let J2=class extends FI{constructor(){super(...arguments),Qe(this,"_stats",uy),Qe(this,"report",void 0),Qe(this,"lastDecodeVideoReceiverStats",new Map),Qe(this,"lastVideoFramesRecv",new Map),Qe(this,"lastVideoFramesSent",new Map),Qe(this,"lastVideoFramesDecode",new Map),Qe(this,"lastVideoFramesOutput",new Map),Qe(this,"lastVideoJBDelay",new Map),Qe(this,"lastAudioJBDelay",new Map),Qe(this,"mediaBytesSent",new Map),Qe(this,"mediaBytesRetransmit",new Map),Qe(this,"mediaBytesTargetEncode",new Map),Qe(this,"lastDecodeAudioReceiverStats",new Map),Qe(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Wo(uy),this.report.forEach(e=>{switch(e.type){case Hs.OUTBOUND:case Hs.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===Hs.OUTBOUND?t==="audio"||r?this.processAudioOutboundStats(e):(t==="video"||n)&&this.processVideoOutboundStats(e):e.type===Hs.INBOUND&&(t==="audio"||r?this.processAudioInboundStats(e):(t==="video"||n)&&this.processVideoInboundStats(e));break}case Hs.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case Hs.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:Ne({},Rc),remote:Ne({},Rc)};return e.forEach(n=>{let r;if(n.type===Hs.TRANSPORT&&(r=e.get(n.selectedCandidatePairId)),n.type===Hs.CANDIDATE_PAIR&&n.selected&&(r=n),r){const o=(l,u)=>{l.type=u.type,l.id=u.id,u.address&&(l.address=u.address),u.candidateType&&(l.candidateType=u.candidateType),u.port&&(l.port=u.port),u.priority&&(l.priority=u.priority),u.protocol&&(l.protocol=u.protocol),u.relayProtocol&&(l.relayProtocol=u.relayProtocol)};if(r.localCandidateId){const l=e.get(r.localCandidateId);l&&o(t.local,l)}if(r.remoteCandidateId){const l=e.get(r.remoteCandidateId);l&&o(t.remote,l)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===Hs.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===Hs.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===Hs.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Ne({},t),Ne({},this.stats.selectedCandidatePair.localCandidate)),e.type===Hs.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Ne({},t),Ne({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(r=>r.ssrc===e.ssrc);t||(t=Wo(X2),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=hy(n,t,"totalProcessingDelay","jitterBufferEmittedCount",Wm.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,Ne({},t))}processVideoInboundStats(e){let t=this._stats.videoRecv.find(u=>u.ssrc===e.ssrc);t||(t=Wo(K2),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),o=this.lastVideoFramesOutput.get(t.ssrc),l=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const u=t.decodedFrame?t.decodedFrame.width:0,h=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,u,h),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const u=n.stats,h=l-n.lts;t.framesDecodeFreezeTime=u.framesDecodeFreezeTime,t.framesDecodeInterval=u.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&h>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>u.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=h,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<u.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=hy(n==null?void 0:n.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=hy(n==null?void 0:n.stats,t,"totalProcessingDelay","framesDecodeCount",Wm.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=hy(n==null?void 0:n.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",Wm.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=hy(n==null?void 0:n.stats,t,"totalInterFrameDelay","framesDecodeCount",Wm.kMillisecondsFromSeconds),r&&l-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((l-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:l,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:l,rate:0}),t.framesDroppedCount&&e.framesReceived&&(o&&l-o.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-o.count)/((l-o.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:l,rate:Math.max(t.outputFrameRate,0)})):o?t.outputFrameRate=o.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:l,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:Ne({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(r=>r.ssrc===e.ssrc);t||(t=Wo(q2),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const r=new VI(10);r.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,r)}if(e.retransmittedBytesSent!==void 0){const r=this.mediaBytesRetransmit.get(e.ssrc);if(r)r.add(e.retransmittedBytesSent);else{const o=new VI(10);o.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,o)}}if(e.totalEncodedBytesTarget){const r=this.mediaBytesTargetEncode.get(e.ssrc);if(r)r.add(e.totalEncodedBytesTarget);else{const o=new VI(10);o.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,o)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,e.totalEncodeTime&&e.framesEncoded){const r=this.lastEncoderMs.get(e.ssrc);if(!r||r.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const o=e.framesEncoded-r.lastFrameCount,l=e.totalEncodeTime-r.lastEncoderTime;t.avgEncodeMs=1e3*l/o}}if(e.framesEncoded&&e.qpSum){const r=this.lastEncoderMs.get(e.ssrc);!r||r.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-r.lastQpSum)/(e.framesEncoded-r.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const r=this.findRemoteStatsId(e.ssrc,Hs.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(n=>n.ssrc===e.ssrc);if(t||(t=Wo(Y2),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,Hs.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;const r=Array.from(Gs(n=this.report).call(n)).find(o=>o.type===t&&o.ssrc===e);return r?r.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var r,o,l,u;const h=t?this.report.get(t):void 0,m=(r=h==null?void 0:h.framesSent)!==null&&r!==void 0?r:e.framesSent;if(typeof m!="number")return;let g=(o=h==null?void 0:h.frameWidth)!==null&&o!==void 0?o:e.frameWidth,E=(l=h==null?void 0:h.frameHeight)!==null&&l!==void 0?l:e.frameHeight,S=(u=h==null?void 0:h.framesPerSecond)!==null&&u!==void 0?u:e.framesPerSecond;if(typeof g=="number"&&typeof E=="number"||(g=0,E=0),S==null){const R=Date.now(),b=this.lastVideoFramesSent.get(n.ssrc);b&&R-b.lts>=800?(S=Math.round((m-b.count)/((R-b.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:m,lts:R,rate:S})):b?S=b.rate:this.lastVideoFramesSent.set(n.ssrc,{count:m,lts:R,rate:0})}n.sentFrame={width:g,height:E,frameRate:Math.max(0,S)}}processVideoTrackReceiverStats(e,t,n){var r,o,l,u,h;const m=t?this.report.get(t):void 0,g=(r=m==null?void 0:m.framesReceived)!==null&&r!==void 0?r:e.framesReceived,E=(o=m==null?void 0:m.frameWidth)!==null&&o!==void 0?o:e.frameWidth,S=(l=m==null?void 0:m.frameHeight)!==null&&l!==void 0?l:e.frameHeight,R=(u=m==null?void 0:m.jitterBufferDelay)!==null&&u!==void 0?u:e.jitterBufferDelay,b=(h=m==null?void 0:m.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount;if(typeof g=="number"){const x=this.lastVideoFramesRecv.get(n.ssrc),P=Date.now();n.framesReceivedCount=g;let k=0;x&&P-x.lts>=800?(k=Math.round((g-x.count)/((P-x.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:g,lts:P,rate:k})):x?k=x.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:g,lts:P,rate:0}),n.receivedFrame={width:E||0,height:S||0,frameRate:k||0},n.decodedFrame={width:E||0,height:S||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:E||0,height:S||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(R&&b){const x=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let P=x.jitterBufferMs;const k=b-x.jitterBufferEmittedCount;k>0&&(P=1e3*(R-x.jitterBufferDelay)/k),n.jitterBufferMs=P,n.currentDelayMs=Math.round(P),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:R,jitterBufferEmittedCount:b,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var r,o,l,u;const h=t?this.report.get(t):void 0,m=(r=(o=h==null?void 0:h.echoReturnLoss)!==null&&o!==void 0?o:e.echoReturnLoss)!==null&&r!==void 0?r:0,g=(l=(u=h==null?void 0:h.echoReturnLossEnhancement)!==null&&u!==void 0?u:e.echoReturnLossEnhancement)!==null&&l!==void 0?l:0;n.aecReturnLoss=m,n.aecReturnLossEnhancement=g}processAudioTrackReceiverStats(e,t,n){var r,o,l,u,h,m,g;const E=t?this.report.get(t):void 0,S=(r=E==null?void 0:E.removedSamplesForAcceleration)!==null&&r!==void 0?r:e.removedSamplesForAcceleration,R=(o=E==null?void 0:E.totalSamplesReceived)!==null&&o!==void 0?o:e.totalSamplesReceived,b=(l=E==null?void 0:E.jitterBufferDelay)!==null&&l!==void 0?l:e.jitterBufferDelay,x=(u=E==null?void 0:E.jitterBufferEmittedCount)!==null&&u!==void 0?u:e.jitterBufferEmittedCount,P=(h=E==null?void 0:E.audioLevel)!==null&&h!==void 0?h:e==null?void 0:e.audioLevel,k=(m=E==null?void 0:E.totalSamplesDuration)!==null&&m!==void 0?m:e==null?void 0:e.totalSamplesDuration,V=(g=E==null?void 0:E.concealedSamples)!==null&&g!==void 0?g:e.concealedSamples;if(typeof R=="number"&&(n.totalSamplesReceived=R),S&&R&&(n.accelerateRate=S/R),b&&x){const K=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let $=K.jitterBufferMs;const Z=x-K.jitterBufferEmittedCount;Z>0&&($=1e3*(b-K.jitterBufferDelay)/Z),n.jitterBufferMs=Math.round($),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:b,jitterBufferEmittedCount:x,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=P;let F=1920;k&&R&&(F=R/k/50,n.receivedFrames=Math.round(R/F)),V&&(n.droppedFrames=Math.round(V/F))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach(o=>{e+=o.diffMean()}),this.mediaBytesRetransmit.forEach(o=>{t=t===null?o.diffMean():t+o.diffMean()}),this.mediaBytesTargetEncode.forEach(o=>{n=n===null?o.diffMean():n+o.diffMean()});const r=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},s$=class extends FI{updateStats(){return we.resolve()}};function jI(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const l=function(){const u=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return u&&u[0]?Number(u[0].split("/")[1]):null}();return l?l<76?new r$(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:o}):new J2(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:o}):function(u){if(!window.RTCStatsReport)return!1;const h=u.getStats();return!!(h instanceof we||function(m){return!!m&&(typeof m=="object"||typeof m=="function")&&typeof m.then=="function"}(h))}(e)?new J2(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:o}):new s$(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:o})}const $2="websdk_ng_install_id";function GI(){try{if(G("INSTALL_ID"))return G("INSTALL_ID");let e=window.localStorage.getItem($2);return e||(e=Hh(),window.localStorage.setItem($2,e)),Vt("INSTALL_ID",e),e}catch{return}}const mo=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const n=t[1],r=t[2];return"".concat(n,".").concat(r)}return"4.0.0.999"}("4.23.2"),WI=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let Kh=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const Ui=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const r=n.join(""),o=[];for(let h=0;h<6;h++)o.push("1");const l=o.join(""),u={};return u[e]=r,u[t]=l,Object.assign(u,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Ui;const HR={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},zI={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},HI="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",KI={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},on=Ne(Ne(Ne({},KI),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:zI,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},HR),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function Vt(e,t,n){var r,o,l;Te(r=Object.keys(on)).call(r,e)&&(!n&&Te(o=Object.keys(Pa)).call(o,e)||(on[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS_METADATA"||t!==!0||(on.ENABLE_ENCODED_TRANSFORM=!0,e==="ENABLE_AUDIO_PTS_METADATA"&&(on.ENABLE_AUDIO_METADATA=!0)),e==="USE_NEW_NETWORK_CONFIG"&&t&&(l=!!t,on.USE_NEW_NETWORK_CONFIG=l,l&&(on.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],on.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],on.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],on.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],on.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",on.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",on.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(on.ENABLE_INSTANT_VIDEO=!0,on.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(on.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(on.NEW_TURN_MODE||(on.NEW_TURN_MODE=4))))}function G(e){return on[e]}WI||(on.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],on.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],on.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],on.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],on.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],on.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],on.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",on.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",on.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",on.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",on.AREAS=["NORTH_AMERICA","OVERSEA"]);let Q2=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const Pa={};var ft=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(ft||{});let KR=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const Z2=128,o$=96,eU=1e3,zm=10;let a$=0;var tU=(()=>{var e={8:(r,o,l)=>{l.r(o),l.d(o,{Parser:()=>Ce,Printer:()=>kn,parse:()=>Se,print:()=>Le});const u=`
`,h="".concat("\r").concat(u),m=" ";let g;function E(ue){return ue>="0"&&ue<="9"}function S(ue){return ue>="!"&&ue<="~"}function R(ue){return S(ue)||ue>=""&&ue<=""}function b(ue){return ue==="!"||ue>="#"&&ue<="'"||ue>="*"&&ue<="+"||ue>="-"&&ue<="."||ue>="0"&&ue<="9"||ue>="A"&&ue<="Z"||ue>="^"&&ue<="~"}function x(ue){return ue>="1"&&ue<="9"}function P(ue){return ue>="A"&&ue<="Z"||ue>="a"&&ue<="z"}function k(ue){return ue==="d"||ue==="h"||ue==="m"||ue==="s"}function V(ue){return ue>""&&ue<"	"||ue>"\v"&&ue<"\f"||ue>""&&ue<""}function F(ue){return P(ue)||E(ue)||ue==="+"||ue==="/"}function K(ue){return E(ue)||P(ue)||ue==="+"||ue==="/"||ue==="-"||ue==="_"}function $(ue){return P(ue)||E(ue)||ue==="+"||ue==="/"}function Z(ue,O){var W=Object.keys(ue);if(Object.getOwnPropertySymbols){var q=Object.getOwnPropertySymbols(ue);O&&(q=q.filter(function(Ee){return Object.getOwnPropertyDescriptor(ue,Ee).enumerable})),W.push.apply(W,q)}return W}function J(ue){for(var O=1;O<arguments.length;O++){var W=arguments[O]!=null?arguments[O]:{};O%2?Z(Object(W),!0).forEach(function(q){re(ue,q,W[q])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ue,Object.getOwnPropertyDescriptors(W)):Z(Object(W)).forEach(function(q){Object.defineProperty(ue,q,Object.getOwnPropertyDescriptor(W,q))})}return ue}function re(ue,O,W){return O in ue?Object.defineProperty(ue,O,{value:W,enumerable:!0,configurable:!0,writable:!0}):ue[O]=W,ue}(function(ue){ue.VERSION="v",ue.ORIGIN="o",ue.SESSION_NAME="s",ue.INFORMATION="i",ue.URI="u",ue.EMAIL="e",ue.PHONE="p",ue.CONNECTION="c",ue.BANDWIDTH="b",ue.TIME="t",ue.REPEAT="r",ue.ZONE_ADJUSTMENTS="z",ue.KEY="k",ue.ATTRIBUTE="a",ue.MEDIA="m"})(g||(g={}));class pe{consumeText(O,W){let q=W;for(;q<O.length;){const Ee=O[q];if(Ee==="\0"||Ee==="\r"||Ee===u)break;q+=1}if(q-W==0)throw new Error("Invalid text, at ".concat(O));return q}consumeUnicastAddress(O,W,q){return this.consumeTill(O,W,m)}consumeOneOrMore(O,W,q){let Ee=W;for(;q(O[Ee]);)Ee++;if(Ee-W==0)throw new Error("Invalid rule at ".concat(W,"."));return Ee}consumeSpace(O,W){if(O[W]===m)return W+1;throw new Error("Invalid space at ".concat(W,"."))}consumeIP4Address(O,W){let q=W;for(let Ee=0;Ee<4;Ee++)if(q=this.consumeDecimalUChar(O,q),Ee!==3){if(O[q]!==".")throw new Error("Invalid IP4 address.");q++}return q}consumeDecimalUChar(O,W){let q=W;for(let tt=0;tt<3&&E(O[q]);tt++,q++);if(q-W==0)throw new Error("Invalid decimal uchar.");const Ee=parseInt(O.slice(W,q));if(Ee>=0&&Ee<=255)return q;throw new Error("Invalid decimal uchar")}consumeIP6Address(O,W){let q=this.consumeHexpart(O,W);return O[q]===":"&&(q+=1,q=this.consumeIP4Address(O,q)),q}consumeHexpart(O,W){let q=W;if(O[q]===":"&&O[q+1]===":"){q+=2;try{q=this.consumeHexseq(O,q)}catch{}return q}if(q=this.consumeHexseq(O,q),O[q]===":"&&O[q+1]===":"){q+=2;try{q=this.consumeHexseq(O,q)}catch{}return q}return q}consumeHexseq(O,W){let q=W;for(;q=this.consumeHex4(O,q),O[q]===":"&&O[q+1]!==":";)q+=1;return q}consumeHex4(O,W){let q=0;for(;q<4;q++)if(!((Ee=O[W+q])>="0"&&Ee<="9"||Ee>="a"&&Ee<="f"||Ee>="A"&&Ee<="F")){if(q===0)throw new Error("Invalid hex 4");break}var Ee;return W+q}consumeFQDN(O,W){let q=W;for(;E(O[q])||P(O[q])||O[q]==="-"||O[q]===".";)q+=1;if(q-W<4)throw new Error("Invalid FQDN");return q}consumeExtnAddr(O,W){return this.consumeOneOrMore(O,W,R)}consumeMulticastAddress(O,W,q){switch(q){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(O,W);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(O,W);default:try{return this.consumeFQDN(O,W)}catch{return this.consumeExtnAddr(O,W)}}}consumeIP6MulticastAddress(O,W){const q=this.consumeHexpart(O,W);return O[q]==="/"?this.consumeInteger(O,q+1):q}consumeIP4MulticastAddress(O,W){let q=W+3;const Ee=O.slice(W,q),tt=parseInt(Ee);if(tt<224||tt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Gt=0;Gt<3;Gt++){if(O[q]!==".")throw new Error("Invalid IP4 multicast address.");q+=1,q=this.consumeDecimalUChar(O,q)}return O[q]==="/"&&(q+=1),q=this.consumeTTL(O,q),O[q]==="/"&&(q=this.consumeInteger(O,q)),q}consumeInteger(O,W){if(!x(O[W]))throw new Error("Invalid integer.");for(W+=1;E(O[W]);)W+=1;return W}consumeTTL(O,W){if(O[W]==="0")return W+1;if(!x(O[W]))throw new Error("Invalid TTL.");W+=1;for(let q=0;q<2&&E(O[W]);q++)W+=1;return W}consumeToken(O,W){return this.consumeOneOrMore(O,W,b)}consumeTime(O,W){let q=W;if(O[q]==="0")return q+1;for(x(O[q])&&(q+=1);E(O[q]);)q++;if(q-W<10)throw new Error("Invalid time");return q}consumeAddress(O,W){return this.consumeTill(O,W,m)}consumeTypedTime(O,W){let q=W;return q=this.consumeOneOrMore(O,q,E),k(O[q])?q+1:q}consumeRepeatInterval(O,W){if(!x(O[W]))throw new Error("Invalid repeat interval");for(W+=1;E(O[W]);)W+=1;return k(O[W])&&(W+=1),W}consumePort(O,W){return this.consumeOneOrMore(O,W,E)}consume(O,W,q){for(let Ee=0;Ee<q.length;Ee++){if(W+Ee>=O.length)throw new Error("consume exceeding value length");if(O[W+Ee]!==q[Ee])throw new Error("consume ".concat(q," failed at ").concat(Ee))}return W+q.length}consumeTill(O,W,q){let Ee=W;for(;Ee<O.length&&(typeof q!="string"||O[Ee]!==q)&&(typeof q!="function"||!q(O[Ee]));)Ee++;return Ee}}class Ce extends pe{constructor(){super(),re(this,"records",[]),re(this,"currentLine",0)}parse(O){const W=this.probeEOL(O);this.records=O.split(W).filter(gp=>!!ir(gp).call(gp)).map(this.parseLine),this.currentLine=0;const q=this.parseVersion(),Ee=this.parseOrigin(),tt=this.parseSessionName(),Gt=this.parseInformation(),li=this.parseUri(),ns=this.parseEmail(),$l=this.parsePhone(),mp=this.parseConnection(),Xy=this.parseBandWidth(),iC=this.parseTimeFields(),rC=this.parseKey(),Ro=this.parseSessionAttribute(),pd=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:q,origin:Ee,sessionName:tt,information:Gt,uri:li,emails:ns,phones:$l,connection:mp,bandwidths:Xy,timeFields:iC,key:rC,attributes:Ro,mediaDescriptions:pd}}getCurrentRecord(){const O=this.records[this.currentLine];if(!O)throw new Error("Record doesn't exit.");return O}probeEOL(O){for(let W=0;W<O.length;W++)if(O[W]===u)return O[W-1]==="\r"?h:u;throw new Error("Invalid newline character.")}parseLine(O,W){if(O.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const q=O[0];if(O[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:q,value:O.slice(2),line:W,cur:0}}parseSessionAttribute(){const O=new _t;for(;this.currentLine<this.records.length;){const W=this.getCurrentRecord();if(W.type!==g.ATTRIBUTE)break;const q={attField:this.extractOneOrMore(W,Ee=>b(Ee)&&Ee!==":"),_cur:0};W.value[W.cur]===":"&&(W.cur+=1,q.attValue=this.extractOneOrMore(W,V)),O.parse(q),this.currentLine++}return O.digest()}parseMediaAttributes(O){const W=new Et(O);for(;this.currentLine<this.records.length;){const q=this.getCurrentRecord();if(q.type!==g.ATTRIBUTE)break;const Ee={attField:this.extractOneOrMore(q,tt=>b(tt)&&tt!==":"),_cur:0};q.value[q.cur]===":"&&(q.cur+=1,Ee.attValue=this.extractOneOrMore(q,V)),W.parse(Ee),this.currentLine++}return W.digest()}parseKey(){const O=this.getCurrentRecord();if(O.type===g.KEY){if(O.value==="prompt"||O.value==="clear:"||O.value==="base64:"||O.value==="uri:")return O.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const O=this.getCurrentRecord();if(O.type===g.ZONE_ADJUSTMENTS){const W=[];for(;;)try{const q=this.extract(O,this.consumeTime);this.consumeSpaceForRecord(O);let Ee=!1;O.value[O.cur]==="-"&&(Ee=!0,O.cur+=1);const tt=this.extract(O,this.consumeTypedTime);W.push({time:q,typedTime:tt,back:Ee})}catch{break}if(W.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,W}return[]}parseRepeat(){const O=[];for(;;){const W=this.getCurrentRecord();if(W.type!==g.REPEAT)break;{const q=this.extract(W,this.consumeRepeatInterval),Ee=this.parseTypedTime(W);O.push({repeatInterval:q,typedTimes:Ee}),this.currentLine++}}return O}parseTypedTime(O){const W=[];for(;;)try{this.consumeSpaceForRecord(O),W.push(this.extract(O,this.consumeTypedTime))}catch{break}if(W.length===0)throw new Error("Invalid typed time.");return W}parseTime(){const O=this.getCurrentRecord(),W=this.extract(O,this.consumeTime);this.consumeSpaceForRecord(O);const q=this.extract(O,this.consumeTime);return this.currentLine++,{startTime:W,stopTime:q}}parseBandWidth(){const O=[];for(;this.currentLine<this.records.length;){const W=this.getCurrentRecord();if(W.type!==g.BANDWIDTH)break;{const q=this.extractOneOrMore(W,b);if(W.value[W.cur]!==":")throw new Error("Invalid bandwidth field.");W.cur++;const Ee=this.extractOneOrMore(W,E);O.push({bwtype:q,bandwidth:Ee}),this.currentLine++}}return O}parseVersion(){const O=this.getCurrentRecord();if(O.type!==g.VERSION)throw new Error("first sdp record must be version");const W=O.value.slice(0,this.consumeOneOrMore(O.value,0,E));if(W.length!==O.value.length)throw new Error('invalid proto version, "v='.concat(O.value,'"'));return this.currentLine++,W}parseOrigin(){const O=this.getCurrentRecord();if(O.type!==g.ORIGIN)throw new Error("second line of sdp must be origin");const W=this.extractOneOrMore(O,R);this.consumeSpaceForRecord(O);const q=this.extractOneOrMore(O,E);this.consumeSpaceForRecord(O);const Ee=this.extractOneOrMore(O,E);this.consumeSpaceForRecord(O);const tt=this.extractOneOrMore(O,b);this.consumeSpaceForRecord(O);const Gt=this.extractOneOrMore(O,b);this.consumeSpaceForRecord(O);const li=this.extract(O,this.consumeUnicastAddress);return this.currentLine++,{username:W,sessId:q,sessVersion:Ee,nettype:tt,addrtype:Gt,unicastAddress:li}}parseSessionName(){const O=this.getCurrentRecord();if(O.type===g.SESSION_NAME){const W=this.extract(O,this.consumeText);return this.currentLine++,W}}parseInformation(){const O=this.getCurrentRecord();if(O.type!==g.INFORMATION)return;const W=this.extract(O,this.consumeText);return this.currentLine++,W}parseUri(){const O=this.getCurrentRecord();if(O.type===g.URI)return this.currentLine++,O.value}parseEmail(){const O=[];for(;;){const W=this.getCurrentRecord();if(W.type!==g.EMAIL)break;O.push(W.value),this.currentLine++}return O}parsePhone(){const O=[];for(;;){const W=this.getCurrentRecord();if(W.type!==g.PHONE)break;O.push(W.value),this.currentLine++}return O}parseConnection(){const O=this.getCurrentRecord();if(O.type===g.CONNECTION){const W=this.extractOneOrMore(O,b);this.consumeSpaceForRecord(O);const q=this.extractOneOrMore(O,b);this.consumeSpaceForRecord(O);const Ee=this.extract(O,this.consumeAddress);return this.currentLine++,{nettype:W,addrtype:q,address:Ee}}}parseMedia(){const O=this.getCurrentRecord(),W=this.extract(O,this.consumeToken);this.consumeSpaceForRecord(O);let q=this.extract(O,this.consumePort);O.value[O.cur]==="/"&&(O.cur+=1,q+=this.extract(O,this.consumeInteger)),this.consumeSpaceForRecord(O);const Ee=[];for(Ee.push(this.extract(O,this.consumeToken));O.value[O.cur]==="/";)O.cur+=1,Ee.push(this.extract(O,this.consumeToken));if(Ee.length===0)throw new Error("Invalid proto");const tt=this.parseFmt(O);return this.currentLine++,{mediaType:W,port:q,protos:Ee,fmts:tt}}parseTimeFields(){const O=[];for(;this.getCurrentRecord().type===g.TIME;){const W=this.parseTime(),q=this.parseRepeat(),Ee=this.parseZone();O.push({time:W,repeats:q,zones:Ee})}return O}parseMediaDescription(){const O=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===g.MEDIA;){const W=this.parseMedia(),q=this.parseInformation(),Ee=this.parseConnections(),tt=this.parseBandWidth(),Gt=this.parseKey(),li=this.parseMediaAttributes(W);O.push({media:W,information:q,connections:Ee,bandwidths:tt,key:Gt,attributes:li})}return O}parseConnections(){const O=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===g.CONNECTION;)O.push(this.parseConnection());return O}parseFmt(O){const W=[];for(;;)try{this.consumeSpaceForRecord(O),W.push(this.extract(O,this.consumeToken))}catch{break}if(W.length===0)throw new Error("Invalid fmts");return W}extract(O,W){for(var q=arguments.length,Ee=new Array(q>2?q-2:0),tt=2;tt<q;tt++)Ee[tt-2]=arguments[tt];const Gt=W.call(this,O.value,O.cur,...Ee),li=O.value.slice(O.cur,Gt);return O.cur=Gt,li}extractOneOrMore(O,W){const q=this.consumeOneOrMore(O.value,O.cur,W),Ee=O.value.slice(O.cur,q);return O.cur=q,Ee}consumeSpaceForRecord(O){if(O.value[O.cur]!==m)throw new Error("Invalid space at ".concat(O.cur,"."));O.cur+=1}}class Ie extends pe{constructor(){super(...arguments),re(this,"attributes",void 0),re(this,"digested",!1)}extractOneOrMore(O,W,q){const Ee=this.consumeOneOrMore(O.attValue,O._cur,W),tt=O.attValue.slice(O._cur,Ee),[Gt,li]=q||[];if(typeof Gt=="number"&&tt.length<Gt)throw new Error("error in length, should be more or equal than ".concat(Gt," characters."));if(typeof li=="number"&&tt.length>li)throw new Error("error in length, should be less or equal than ".concat(li," characters."));return O._cur=Ee,tt}consumeAttributeSpace(O){if(O.attValue[O._cur]!==m)throw new Error("Invalid space at ".concat(O._cur,"."));O._cur+=1}extract(O,W){if(!O.attValue)throw new Error("Nothing to extract from attValue.");for(var q=arguments.length,Ee=new Array(q>2?q-2:0),tt=2;tt<q;tt++)Ee[tt-2]=arguments[tt];const Gt=W.call(this,O.attValue,O._cur,...Ee),li=O.attValue.slice(O._cur,Gt);return O._cur=Gt,li}atEnd(O){if(!O.attValue)throw new Error;return O._cur>=O.attValue.length}peekChar(O){if(!O.attValue)throw new Error;return O.attValue[O._cur]}peek(O,W){if(!O.attValue)throw new Error;for(let q=0;q<W.length;q++)if(W[q]!==O.attValue[O._cur+q])return!1;return!0}parseIceUfrag(O){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(O,F,[4,256])}parseIcePwd(O){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(O,F,[22,256])}parseIceOptions(O){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const W=[];for(;!this.atEnd(O);){W.push(this.extractOneOrMore(O,F));try{this.consumeAttributeSpace(O)}catch(q){if(this.atEnd(O))break;throw q}}this.attributes.iceOptions=W}parseFingerprint(O){const W=this.extract(O,this.consumeToken);this.consumeAttributeSpace(O);const q=this.extract(O,this.consumeTill);this.attributes.fingerprints.push({hashFunction:W,fingerprint:q})}parseExtmap(O){const W=this.extractOneOrMore(O,E);let q;this.peekChar(O)==="/"&&(this.extract(O,this.consume,"/"),q=this.extract(O,this.consumeToken)),this.consumeAttributeSpace(O);const Ee=this.extract(O,this.consumeTill,m),tt=J(J({entry:parseInt(W,10)},q&&{direction:q}),{},{extensionName:Ee});this.peekChar(O)===m&&(this.consumeAttributeSpace(O),tt.extensionAttributes=this.extract(O,this.consumeTill)),this.attributes.extmaps.push(tt)}parseSetup(O){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const W=this.extract(O,this.consumeTill);if(W!=="active"&&W!=="passive"&&W!=="actpass"&&W!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=W}}class _t extends Ie{constructor(){super(...arguments),re(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(O){if(this.digested)throw new Error("already digested");try{switch(O.attField){case"group":this.parseGroup(O);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(O);break;case"ice-pwd":this.parseIcePwd(O);break;case"ice-options":this.parseIceOptions(O);break;case"fingerprint":this.parseFingerprint(O);break;case"setup":this.parseSetup(O);break;case"tls-id":this.parseTlsId(O);break;case"identity":this.parseIdentity(O);break;case"extmap":this.parseExtmap(O);break;case"msid-semantic":this.parseMsidSemantic(O);break;default:O.ignored=!0,this.attributes.unrecognized.push(O)}}catch(W){throw console.error("parsing session attribute ".concat(O.attField,' error, "a=').concat(O.attField,":").concat(O.attValue,'"')),W}if(!O.ignored&&O.attValue&&!this.atEnd(O))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(O){const W=this.extract(O,this.consumeToken),q=[];for(;!this.atEnd(O)&&this.peekChar(O)===m;)this.consumeAttributeSpace(O),q.push(this.extract(O,this.consumeToken));this.attributes.groups.push({semantic:W,identificationTag:q})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(O){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(O,K)}parseIdentity(O){const W=this.extractOneOrMore(O,$),q=[];for(;!this.atEnd(O)&&this.peekChar(O)===m;){this.consumeAttributeSpace(O);const Ee=this.extract(O,this.consumeToken);this.extract(O,this.consume,"=");const tt=this.extractOneOrMore(O,Gt=>Gt!==m&&V(Gt));q.push({name:Ee,value:tt})}this.attributes.identities.push({assertionValue:W,extensions:q})}parseMsidSemantic(O){this.peekChar(O)===m&&this.consumeAttributeSpace(O);const W={semantic:this.extract(O,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(O)}catch{break}if(this.peekChar(O)==="*"){this.extract(O,this.consume,"*"),W.applyForAll=!0;break}{const q=this.extract(O,this.consumeTill,m);W.identifierList.push(q)}}this.attributes.msidSemantic=W}}class Et extends Ie{constructor(O){super(),re(this,"attributes",void 0),O.protos.indexOf("RTP")!==-1||O.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(O){if(this.digested)throw new Error("already digested");try{switch(O.attField){case"extmap":this.parseExtmap(O);break;case"setup":this.parseSetup(O);break;case"ice-ufrag":this.parseIceUfrag(O);break;case"ice-pwd":this.parseIcePwd(O);break;case"ice-options":this.parseIceOptions(O);break;case"candidate":this.parseCandidate(O);break;case"remote-candidate":this.parseRemoteCandidate(O);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(O);break;case"rtpmap":this.parseRtpmap(O);break;case"ptime":this.parsePtime(O);break;case"maxptime":this.parseMaxPtime(O);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(O);break;case"ssrc":this.parseSSRC(O);break;case"fmtp":this.parseFmtp(O);break;case"rtcp-fb":this.parseRtcpFb(O);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(O);break;case"mid":this.parseMid(O);break;case"msid":this.parseMsid(O);break;case"imageattr":this.parseImageAttr(O);break;case"rid":this.parseRid(O);break;case"simulcast":this.parseSimulcast(O);break;case"sctp-port":this.parseSctpPort(O);break;case"max-message-size":this.parseMaxMessageSize(O);break;case"ssrc-group":this.parseSSRCGroup(O);break;default:O.ignored=!0,this.attributes.unrecognized.push(O)}}catch(W){throw console.error("parsing media attribute ".concat(O.attField,' error, "a=').concat(O.attField,":").concat(O.attValue,'"')),W}if(!O.ignored&&O.attValue&&!this.atEnd(O))throw new Error("attribute parsing error")}parseCandidate(O){const W=this.extractOneOrMore(O,F,[1,32]);this.consumeAttributeSpace(O);const q=this.extractOneOrMore(O,E,[1,5]);this.consumeAttributeSpace(O);const Ee=this.extract(O,this.consumeToken);this.consumeAttributeSpace(O);const tt=this.extractOneOrMore(O,E,[1,10]);this.consumeAttributeSpace(O);const Gt=this.extract(O,this.consumeAddress);this.consumeAttributeSpace(O);const li=this.extract(O,this.consumePort);this.consumeAttributeSpace(O),this.extract(O,this.consume,"typ"),this.consumeAttributeSpace(O);const ns={foundation:W,componentId:q,transport:Ee,priority:tt,connectionAddress:Gt,port:li,type:this.extract(O,this.consumeToken),extension:{}};for(this.peek(O," raddr")&&(this.extract(O,this.consume," raddr"),this.consumeAttributeSpace(O),ns.relAddr=this.extract(O,this.consumeAddress)),this.peek(O," rport")&&(this.extract(O,this.consume," rport"),this.consumeAttributeSpace(O),ns.relPort=this.extract(O,this.consumePort));this.peekChar(O)===m;){this.consumeAttributeSpace(O);const $l=this.extract(O,this.consumeToken);this.consumeAttributeSpace(O),ns.extension[$l]=this.extractOneOrMore(O,S)}this.attributes.candidates.push(ns)}parseRemoteCandidate(O){const W=[];for(;;){const q=this.extractOneOrMore(O,E,[1,5]);this.consumeAttributeSpace(O);const Ee=this.extract(O,this.consumeAddress);this.consumeAttributeSpace(O);const tt=this.extract(O,this.consumePort);W.push({componentId:q,connectionAddress:Ee,port:tt});try{this.consumeAttributeSpace(O)}catch{break}}this.attributes.remoteCandidatesList.push(W)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(O){const W=this.extract(O,this.consumeToken);this.consumeAttributeSpace(O);const q=this.extract(O,this.consumeTill,"/");this.extract(O,this.consume,"/");const Ee={encodingName:q,clockRate:this.extractOneOrMore(O,E)};this.atEnd(O)||this.peekChar(O)!=="/"||(this.extract(O,this.consume,"/"),Ee.encodingParameters=parseInt(this.extract(O,this.consumeTill),10));const tt=this.attributes.payloads.find(Gt=>Gt.payloadType===parseInt(W,10));tt?tt.rtpMap=Ee:this.attributes.payloads.push({payloadType:parseInt(W,10),rtpMap:Ee,rtcpFeedbacks:[]})}parsePtime(O){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(O,this.consumeTill)}parseMaxPtime(O){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(O,this.consumeTill)}parseDirection(O){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=O.attField}parseSSRC(O){const W=this.extractOneOrMore(O,E);this.consumeAttributeSpace(O);const q=this.extract(O,this.consumeTill,":");let Ee;this.peekChar(O)===":"&&(this.extract(O,this.consume,":"),Ee=this.extract(O,this.consumeTill));const tt=this.attributes.ssrcs.find(Gt=>Gt.ssrcId===parseInt(W,10));tt?tt.attributes[q]=Ee:this.attributes.ssrcs.push({ssrcId:parseInt(W,10),attributes:{[q]:Ee}})}parseFmtp(O){const W=this.extract(O,this.consumeTill,m);this.consumeAttributeSpace(O);const q=this.extract(O,this.consumeTill),Ee={};q.split(";").forEach(Gt=>{let[li,ns]=Gt.split("=");li=ir(li).call(li);const $l=typeof ns=="string"?ir(ns).call(ns):null;typeof li=="string"&&li.length>0&&(Ee[li]=$l)});const tt=this.attributes.payloads.find(Gt=>Gt.payloadType===parseInt(W,10));tt?tt.fmtp={parameters:Ee}:this.attributes.payloads.push({payloadType:parseInt(W,10),rtcpFeedbacks:[],fmtp:{parameters:Ee}})}parseFmtParameters(O){const W={},q=this.extract(O,this.consumeTill,"=");O._cur++;const Ee=this.extract(O,this.consumeTill,";");for(W[q]=Ee;O.attValue[O._cur]===";";){const tt=this.extract(O,this.consumeTill,"=");O._cur++;const Gt=this.extract(O,this.consumeTill,";");W[tt]=Gt}return W}parseRtcpFb(O){let W="";W=this.peekChar(O)==="*"?this.extract(O,this.consume,"*"):this.extract(O,this.consumeTill,m),this.consumeAttributeSpace(O);const q=this.extract(O,this.consumeTill,m);let Ee;if(q==="trr-int")Ee={type:q,interval:this.extract(O,this.consumeTill)};else{const tt={type:q};this.peekChar(O)===m&&(this.consumeAttributeSpace(O),tt.parameter=this.extract(O,this.consumeToken),this.peekChar(O)===m&&(tt.additional=this.extract(O,this.consumeTill))),Ee=tt}if(W==="*")this.attributes.rtcpFeedbackWildcards.push(Ee);else{const tt=this.attributes.payloads.find(Gt=>Gt.payloadType===parseInt(W,10));tt?tt.rtcpFeedbacks.push(Ee):this.attributes.payloads.push({payloadType:parseInt(W,10),rtcpFeedbacks:[Ee]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(O){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const W={port:this.extract(O,this.consumePort)};this.peekChar(O)===m&&(this.consumeAttributeSpace(O),W.netType=this.extractOneOrMore(O,b),this.consumeAttributeSpace(O),W.addressType=this.extractOneOrMore(O,b),this.consumeAttributeSpace(O),W.address=this.extract(O,this.consumeAddress)),this.attributes.rtcp=W}parseMsid(O){const W={id:this.extractOneOrMore(O,b,[1,64])};this.peekChar(O)===m&&(this.consumeAttributeSpace(O),W.appdata=this.extractOneOrMore(O,b,[1,64])),this.attributes.msids.push(W)}parseImageAttr(O){this.attributes.imageattr.push(O.attValue)}parseRid(O){const W=this.extractOneOrMore(O,Ee=>P(Ee)||E(Ee)||Ee==="_"||Ee==="-");this.consumeAttributeSpace(O);const q={id:W,direction:this.extract(O,this.consumeToken),params:[]};if(this.peekChar(O)===m){if(this.consumeAttributeSpace(O),this.peek(O,"pt=")){this.extract(O,this.consume,"pt=");const Ee=[];for(;;){const tt=this.extract(O,this.consumeToken);Ee.push(tt);try{this.extract(O,this.consume,",")}catch{break}}q.payloads=Ee,this.peekChar(O)===m&&this.extract(O,this.consume,m)}for(;;){const Ee=this.extract(O,this.consumeToken);switch(Ee){case"depend":{const tt={type:Ee,rids:this.extract(O,this.consume,"=").split(",")};q.params.push(tt);break}default:{const tt={type:Ee};this.peekChar(O)==="="&&(this.extract(O,this.consume,"="),tt.val=this.extract(O,this.consumeTill,";")),q.params.push(tt)}}try{this.extract(O,this.consume,";")}catch{break}}}this.attributes.rids.push(q)}parseSimulcast(O){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=O.attValue,this.extract(O,this.consumeTill)}parseSctpPort(O){this.attributes.sctpPort=this.extractOneOrMore(O,E,[1,5])}parseMaxMessageSize(O){this.attributes.maxMessageSize=this.extractOneOrMore(O,E,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(O){this.attributes.mid=this.extract(O,this.consumeToken)}parseSSRCGroup(O){const W=this.extract(O,this.consumeToken),q=[];for(;;)try{this.consumeAttributeSpace(O);const Ee=this.extract(O,this.consumeInteger);q.push(parseInt(Ee,10))}catch{break}this.attributes.ssrcGroups.push({semantic:W,ssrcIds:q})}}function Qt(ue,O,W){return O in ue?Object.defineProperty(ue,O,{value:W,enumerable:!0,configurable:!0,writable:!0}):ue[O]=W,ue}class kn{constructor(){Qt(this,"eol",h)}print(O,W){let q="";return W&&(this.eol=W),q+=this.printVersion(O.version),q+=this.printOrigin(O.origin),q+=this.printSessionName(O.sessionName),q+=this.printInformation(O.information),q+=this.printUri(O.uri),q+=this.printEmail(O.emails),q+=this.printPhone(O.phones),q+=this.printConnection(O.connection),q+=this.printBandwidth(O.bandwidths),q+=this.printTimeFields(O.timeFields),q+=this.printKey(O.key),q+=this.printSessionAttributes(O.attributes),q+=this.printMediaDescription(O.mediaDescriptions),q}printVersion(O){return"v=".concat(O).concat(this.eol)}printOrigin(O){return"o=".concat(O.username," ").concat(O.sessId," ").concat(O.sessVersion," ").concat(O.nettype," ").concat(O.addrtype," ").concat(O.unicastAddress).concat(this.eol)}printSessionName(O){return O?"s=".concat(O).concat(this.eol):""}printInformation(O){return O?"i=".concat(O).concat(this.eol):""}printUri(O){return O?"u=".concat(O).concat(this.eol):""}printEmail(O){let W="";for(const q of O)W+="e=".concat(q).concat(this.eol);return W}printPhone(O){let W="";for(const q of O)W+="e=".concat(q).concat(this.eol);return W}printConnection(O){return O?"c=".concat(O.nettype," ").concat(O.addrtype," ").concat(O.address).concat(this.eol):""}printBandwidth(O){let W="";for(const q of O)W+="b=".concat(q.bwtype,":").concat(q.bandwidth).concat(this.eol);return W}printTimeFields(O){let W="";for(const q of O){W+="t=".concat(q.time.startTime," ").concat(q.time.startTime).concat(this.eol);for(const Ee of q.repeats)W+="r=".concat(Ee.repeatInterval," ").concat(Ee.typedTimes.join(" ")).concat(this.eol);q.zoneAdjustments&&(W+="z=",W+="z=".concat(q.zoneAdjustments.map(Ee=>"".concat(Ee.time," ").concat(Ee.back?"-":""," ").concat(Ee.typedTime)).join(" ")).concat(this.eol),W+=this.eol)}return W}printKey(O){return O?"k=".concat(O).concat(this.eol):""}printAttributes(O){let W="";for(const q of O)W+="a=".concat(q.attField).concat(q.attValue?":".concat(q.attValue):"").concat(this.eol);return W}printMediaDescription(O){let W="";for(const q of O)W+=this.printMedia(q.media),W+=this.printInformation(q.information),W+=this.printConnections(q.connections),W+=this.printBandwidth(q.bandwidths),W+=this.printKey(q.key),W+=this.printMediaAttributes(q);return W}printConnections(O){let W="";for(const q of O)W+=this.printConnection(q);return W}printMedia(O){return"m=".concat(O.mediaType," ").concat(O.port," ").concat(O.protos.join("/")," ").concat(O.fmts.join(" ")).concat(this.eol)}printSessionAttributes(O){return new Ur(this.eol).print(O)}printMediaAttributes(O){return new le(this.eol).print(O)}}class An{constructor(O){Qt(this,"eol",void 0),this.eol=O}printIceUfrag(O){return O===void 0?"":"a=ice-ufrag:".concat(O).concat(this.eol)}printIcePwd(O){return O===void 0?"":"a=ice-pwd:".concat(O).concat(this.eol)}printIceOptions(O){return O===void 0?"":"a=ice-options:".concat(O.join(m)).concat(this.eol)}printFingerprints(O){return O.length>0?O.map(W=>"a=fingerprint:".concat(W.hashFunction).concat(m).concat(W.fingerprint)).join(this.eol)+this.eol:""}printExtmap(O){return O.map(W=>"a=extmap:".concat(W.entry).concat(W.direction?"/".concat(W.direction):"").concat(m).concat(W.extensionName).concat(W.extensionAttributes?"".concat(m).concat(W.extensionAttributes):"").concat(this.eol)).join("")}printSetup(O){return O===void 0?"":"a=setup:".concat(O).concat(this.eol)}printUnrecognized(O){return O.map(W=>"a=".concat(W.attField).concat(W.attValue?":".concat(W.attValue):"").concat(this.eol)).join("")}}class Ur extends An{print(O){let W="";return W+=this.printGroups(O.groups),W+=this.printMsidSemantic(O.msidSemantic),W+=this.printIceLite(O.iceLite),W+=this.printIceUfrag(O.iceUfrag),W+=this.printIcePwd(O.icePwd),W+=this.printIceOptions(O.iceOptions),W+=this.printFingerprints(O.fingerprints),W+=this.printSetup(O.setup),W+=this.printTlsId(O.tlsId),W+=this.printIdentity(O.identities),W+=this.printExtmap(O.extmaps),W+=this.printUnrecognized(O.unrecognized),W}printGroups(O){let W="";return O.length>0&&(W+=O.map(q=>"a=group:".concat(q.semantic).concat(q.identificationTag.map(Ee=>"".concat(m).concat(Ee)).join("")).concat(this.eol)).join("")),W}printIceLite(O){return O===void 0?"":"a=ice-lite"+this.eol}printTlsId(O){return O?"a=tls-id:".concat(O).concat(this.eol):""}printIdentity(O){return O.length===0?"":O.map(W=>"a=identity:".concat(W.assertionValue).concat(W.extensions.map(q=>"".concat(m).concat(q.name).concat(q.value?"=".concat(q.value):"")))).join(this.eol)+this.eol}printMsidSemantic(O){if(!O)return"";let W="a=msid-semantic:".concat(O.semantic);return O.applyForAll?W+="".concat(m,"*"):O.identifierList.length>0&&(W+=O.identifierList.map(q=>"".concat(m).concat(q))),W+this.eol}}class le extends An{print(O){const W=O.attributes;let q="";return q+=this.printRTCP(W.rtcp),q+=this.printIceUfrag(W.iceUfrag),q+=this.printIcePwd(W.icePwd),q+=this.printIceOptions(W.iceOptions),q+=this.printCandidates(W.candidates),q+=this.printRemoteCandidatesList(W.remoteCandidatesList),q+=this.printEndOfCandidates(W.endOfCandidates),q+=this.printFingerprints(W.fingerprints),q+=this.printSetup(W.setup),q+=this.printMid(W.mid),q+=this.printExtmap(W.extmaps),q+=this.printRTPRelated(W),q+=this.printPtime(W.ptime),q+=this.printMaxPtime(W.maxPtime),q+=this.printDirection(W.direction),q+=this.printSSRCGroups(W.ssrcGroups),q+=this.printSSRC(W.ssrcs),q+=this.printRTCPMux(W.rtcpMux),q+=this.printRTCPMuxOnly(W.rtcpMuxOnly),q+=this.printRTCPRsize(W.rtcpRsize),q+=this.printMSId(W.msids),q+=this.printImageattr(W.imageattr),q+=this.printRid(W.rids),q+=this.printSimulcast(W.simulcast),q+=this.printSCTPPort(W.sctpPort),q+=this.printMaxMessageSize(W.maxMessageSize),q+=this.printUnrecognized(W.unrecognized),q}printCandidates(O){return O.map(W=>"a=candidate:".concat(W.foundation).concat(m).concat(W.componentId).concat(m).concat(W.transport).concat(m).concat(W.priority).concat(m).concat(W.connectionAddress).concat(m).concat(W.port).concat(m,"typ").concat(m).concat(W.type).concat(W.relAddr?"".concat(m,"raddr").concat(m).concat(W.relAddr):"").concat(W.relPort?"".concat(m,"rport").concat(m).concat(W.relPort):"").concat(Object.keys(W.extension).map(q=>"".concat(m).concat(q).concat(m).concat(W.extension[q])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(O){return O.map(W=>"a=remote-candidates:".concat(W.join(m)).concat(this.eol)).join("")}printEndOfCandidates(O){return O===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(O){if(!O.payloads)return"";const W=O.payloads;let q="";q+=O.rtcpFeedbackWildcards.map(Ee=>this.printRTCPFeedback("*",Ee)).join("");for(const Ee of W)q+=this.printRtpMap(Ee.payloadType,Ee.rtpMap),q+=this.printFmtp(Ee.payloadType,Ee.fmtp),q+=Ee.rtcpFeedbacks.map(tt=>this.printRTCPFeedback(Ee.payloadType,tt)).join("");return q}printFmtp(O,W){if(!W)return"";const q=Object.keys(W.parameters);return q.length===1&&W.parameters[q[0]]===null?"a=fmtp:".concat(O).concat(m).concat(q[0]).concat(this.eol):"a=fmtp:".concat(O).concat(m).concat(Object.keys(W.parameters).map(Ee=>"".concat(Ee,"=").concat(W.parameters[Ee])).join(";")).concat(this.eol)}printRtpMap(O,W){return W?"a=rtpmap:".concat(O).concat(m).concat(W.encodingName,"/").concat(W.clockRate).concat(W.encodingParameters?"/".concat(W.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(O,W){let q="a=rtcp-fb:".concat(O).concat(m),Ee=W;return Ee.type==="trr-int"?q+="ttr-int".concat(m).concat(Ee.interval):(q+="".concat(Ee.type),Ee.parameter&&(q+="".concat(m).concat(Ee.parameter),Ee.additional&&(q+="".concat(m).concat(Ee.additional)))),q+this.eol}printPtime(O){return O===void 0?"":"a=ptime:".concat(O).concat(this.eol)}printMaxPtime(O){return O===void 0?"":"a=maxptime:".concat(O).concat(this.eol)}printDirection(O){return O===void 0?"":"a=".concat(O).concat(this.eol)}printSSRC(O){return O.map(W=>Object.keys(W.attributes).map(q=>"a=ssrc:".concat(W.ssrcId.toString(10)).concat(m).concat(q).concat(W.attributes[q]?":".concat(W.attributes[q]):"").concat(this.eol)).join("")).join("")}printRTCPMux(O){return O===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(O){return O===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(O){return O===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(O){if(O===void 0)return"";let W="a=rtcp:".concat(O.port);return O.netType&&(W+="".concat(m).concat(O.netType)),O.addressType&&(W+="".concat(m).concat(O.addressType)),O.address&&(W+="".concat(m).concat(O.address)),W+this.eol}printMSId(O){return O.map(W=>"a=msid:".concat(W.id).concat(W.appdata?"".concat(m).concat(W.appdata):"").concat(this.eol)).join("")}printImageattr(O){return O.map(W=>"a=imageattr:".concat(W).concat(this.eol)).join("")}printRid(O){return O.map(W=>{let q="a=rid:".concat(W.id).concat(m).concat(W.direction);return W.payloads&&(q+="".concat(m,"pt=").concat(W.payloads.join(","))),W.params.length>0&&(q+="".concat(m).concat(W.params.map(Ee=>Ee.type==="depend"?"depend=".concat(Ee.rids.join(",")):"".concat(Ee.type,"=").concat(Ee.val)).join(";"))),q+this.eol}).join("")}printSimulcast(O){return O===void 0?"":"a=simulcast:".concat(O).concat(this.eol)}printSCTPPort(O){return O===void 0?"":"a=sctp-port:".concat(O).concat(this.eol)}printMaxMessageSize(O){return O===void 0?"":"a=max-message-size:".concat(O).concat(this.eol)}printMid(O){return O===void 0?"":"a=mid:".concat(O).concat(this.eol)}printSSRCGroups(O){return O.map(W=>"a=ssrc-group:".concat(W.semantic).concat(W.ssrcIds.map(q=>"".concat(m).concat(q.toString(10))).join("")).concat(this.eol)).join("")}}function Se(ue){return new Ce().parse(ue)}function Le(ue,O){return new kn().print(ue,O)}}},t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}return n.d=(r,o)=>{for(var l in o)n.o(o,l)&&!n.o(r,l)&&Object.defineProperty(r,l,{enumerable:!0,get:o[l]})},n.o=(r,o)=>Object.prototype.hasOwnProperty.call(r,o),n.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},n(8)})();function Qr(e){return tU.parse(e)}function Ju(e,t){return tU.print(e,t)}var c$=fs("Array").keys,l$=Ps,u$=yi,d$=j,h$=c$,qI=Array.prototype,p$={DOMTokenList:!0,NodeList:!0},f$=function(e){var t=e.keys;return e===qI||d$(qI,e)&&t===qI.keys||u$(p$,l$(e))?h$:t},Ks=p(f$);function nU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function lt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?nU(Object(n),!0).forEach(function(r){wn(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function wn(e,t,n){return(t=function(r){var o=function(l,u){if(typeof l!="object"||l===null)return l;var h=l[Symbol.toPrimitive];if(h!==void 0){var m=h.call(l,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(r);return typeof o=="symbol"?o:String(o)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const iU=new class extends En{constructor(){super(...arguments),wn(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class m${constructor(t){wn(this,"logger",void 0),wn(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function YI(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function rU(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const go={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},qR=Date.now(),py=e=>{for(const t in go)if(Object.prototype.hasOwnProperty.call(go,t)&&go[t]===e)return t;return"DEFAULT"},A=new class{constructor(){wn(this,"proxyServerURL",void 0),wn(this,"logLevel",go.DEBUG),wn(this,"uploadState","collecting"),wn(this,"uploadLogWaitingList",[]),wn(this,"uploadLogUploadingList",[]),wn(this,"uploadErrorCount",0),wn(this,"currentLogID",0),wn(this,"url",void 0),wn(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[go.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[go.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[go.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[go.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[go.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Vt("UPLOAD_LOG",!0)}disableLogUpload(){Vt("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new m$(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-qR<100)return void setTimeout(()=>{this.log(...t)},Date.now()-qR);const r=Math.max(0,Math.min(4,t[0]));if(t[0]=YI()+" Agora-SDK [".concat(py(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;const o=YI()+" %cAgora-SDK [".concat(py(r),"]:");let l=[];if(!G("USE_NEW_LOG"))switch(r){case go.DEBUG:l=[o,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,l);break;case go.INFO:l=[o,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,l);break;case go.WARNING:l=[o,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,l);break;case go.ERROR:l=[o,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,l)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-qR<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-qR);const r=Math.max(0,Math.min(4,t[0]));t[0]=YI()+" Agora-SDK [".concat(py(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!G("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=rU()+" Agora-SDK [".concat(py(e),"]:"):n[0]=rU()+" Agora-SDK [".concat(py(e),"]:");let o="";n.forEach(l=>{typeof l=="object"&&(l=JSON.stringify(l)),o+="".concat(l," ")}),this.uploadLogWaitingList.push({payload_str:o,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:mo,process_id:G("PROCESS_ID"),payload:JSON.stringify(e)};return Na(async()=>{const n=await Pr.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(G("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(G("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const r=new Error("unexpected upload log response");throw r.response=n,r}},()=>(this.uploadLogUploadingList=[],!1),n=>{const r={status:-1,message:n.message,errorRange:e.map(o=>o.log_item_id)};return n.response?(r.status=n.response.status,r.data=n.response.data,r.headers=n.response.headers):n.request&&(r.status=n.request.status),iU.reportLogUploadError(r),!0},{timeout:G("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:G("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,G("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),G("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),G("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),G("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var sU;function g$(e){return vi(e.reportId,"params.reportId",0,100,!1),vi(e.category,"params.category",0,100,!1),vi(e.event,"params.event",0,100,!1),vi(e.label,"params.label",0,100,!1),jt(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(sU={}).FREE="free",sU.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const _$={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let ai=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),pn=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let E$=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function He(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,r){const o=r.value;if(typeof o=="function"){const l=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);r.value=function(){for(var u,h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];let E=m;if(e.argsMap)try{E=e.argsMap(this,...m)}catch(R){A.warning(R),E=[]}try{JSON.stringify(E)}catch{A.warning("arguments for method ".concat(l,".").concat(String(n)," not serializable for apiInvoke.")),E=[]}const S=(e.report||xe).reportApiInvoke(this._sessionId||null,{id:this._clientId||((u=this.store)===null||u===void 0?void 0:u.clientId)||this._ID,name:"".concat(l,".").concat(String(n)),options:E,tag:Tn.TRACER,reportResult:e.reportResult},e.throttleTime);try{const R=o.apply(this,m);return R instanceof we?R.then(b=>(S.onSuccess(e.reportResult&&b),b)).catch(b=>{throw S.onError(b),b}):(S.onSuccess(e.reportResult&&R),R)}catch(R){throw S.onError(R),R}}}return r}}const xe=new class{constructor(){wn(this,"baseInfoMap",new Map),wn(this,"proxyServer",void 0),wn(this,"eventUploadTimer",void 0),wn(this,"setSessionIdTimer",void 0),wn(this,"url",void 0),wn(this,"sids",new Set),wn(this,"backupUrl",void 0),wn(this,"_appId",void 0),wn(this,"_aid",0),wn(this,"keyEventUploadPendingItems",[]),wn(this,"normalEventUploadPendingItems",[]),wn(this,"apiInvokeUploadPendingItems",[]),wn(this,"apiInvokeCount",0),wn(this,"apiInvokeLoggedCount",0),wn(this,"ltsList",[]),wn(this,"lastSendNormalEventTime",Date.now()),wn(this,"customReportCounterTimer",void 0),wn(this,"customReportCount",0),wn(this,"extApiInvoke",async e=>{for(const t of e){const n=lt(lt({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Tn.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),G("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),G("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[n,r]=t;return n+r}),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const r=Date.now();this.apiInvokeCount+=1;const o=this.apiInvokeCount,l=!!G("SHOW_REPORT_INVOKER_LOG"),u=!!G("SHOW_REPORT_USER_INVOKER_LOG"),h=l||u&&t.id;h&&(this.apiInvokeLoggedCount+=1);const m=this.apiInvokeLoggedCount;function g(b,x){if(h){let P="[apiInvoke-".concat(m,"]");t.id&&(P+="[".concat(t.id,"]")),t.name&&(P+="[".concat(t.name,"]")),A.info("".concat(P," ").concat(b),b==="start"?t.options:x||"")}}const E=()=>({tag:t.tag,invokeId:o,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null});g("start");let S=!1;Si(t.timeout).then(()=>{S||(this.sendApiInvoke(lt(lt({},E()),{},{error:B.API_INVOKE_TIMEOUT,success:!1})),g("timeout"))});const R=new oe(B.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:b=>{const x=()=>{if(S)throw R;return S=!0,this.sendApiInvoke(lt(lt({},E()),{},{success:!0},t.reportResult&&{result:b})),g("onSuccess"),b};return n?V2(x,t.name+"Success",n,()=>S=!0):x()},onError:b=>{const x=()=>{if(S)throw b;S=!0,this.sendApiInvoke(lt(lt({},E()),{},{success:!1,error:b})),g("onFailure",b.toString())};return n?V2(x,t.name+"Error",n,()=>S=!0):x()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname;const o=Object.assign({},{willUploadConsoleLog:G("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:WI?"global":"oversea",areas:G("AREAS")&&G("AREAS").join(",")},t.extend),{stringUid:l,channelProfile:u,channelMode:h,isABTestSuccess:m,lsid:g,clientRole:E}=t,S=Date.now(),R=lt(lt({},r),{},{eventType:ai.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:HI,lts:S,elapse:S-n,extend:JSON.stringify(o),mode:t.mode,process:G("PROCESS_ID"),appType:G("APP_TYPE"),success:!0,version:mo,stringUid:l,channelProfile:u,channelMode:h,isABTestSuccess:m,lsid:g,clientType:Te(b=window.navigator.userAgent).call(b,"AgoraWebView")?42:20,clientRole:E,serviceId:G("PROCESS_ID"),extensionID:G("PLUGIN_INFO").join(",")||""});var b;this.send({type:pn.SESSION,data:R},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),l=lt(lt({},r),{},{role:t.role,eventType:ai.JOIN_CHOOSE_SERVER,lts:o,eventElapse:t.elapse||o-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:o-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0});this.send({type:pn.JOIN_CHOOSE_SERVER,data:l},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),l=lt(lt({},r),{},{eventType:ai.REQ_USER_ACCOUNT,lts:o,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||o-n.startTime,eventElapse:o-t.lts,extend:JSON.stringify(t.extend)});this.send({type:pn.REQ_USER_ACCOUNT,data:l},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;const o=Date.now(),{firstSuccess:l,avoidJoinStartTime:u,addr:h,isProxy:m}=t,g=o-(l&&u?u:n.startTime),E=lt(lt({},r),{},{eventType:ai.JOIN_GATEWAY,lts:o,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:g,eventElapse:o-t.lts,firstSuccess:l,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:GI(),isABTestSuccess:t.isABTestSuccess?1:0}),S=E.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=o),l)this.send({type:pn.JOIN_GATEWAY,data:E},!0);else{let R;if(h)if(m){const x=h.match(/h=(\d{1,3}-){3}\d{1,3}/g),P=h.match(/p=[0-9]{1,6}/g);R={isSuccess:S,gatewayIp:x&&x.length?x[0].split("=")[1].replace(/-/g,"."):"",port:P&&P.length?P[0].split("=")[1]:"",isProxy:m?1:0}}else{const x=h.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),P=h.match(/(:|p=)[0-9]{1,6}/g);R={isSuccess:S,gatewayIp:x&&x.length?x[0].split("//")[1].replace(/-/g,"."):"",port:P&&P.length?P[0].split(/:|p=/g)[1]:"",isProxy:m?1:0}}else R={isSuccess:S,gatewayIp:"",port:"",isProxy:m?1:0};delete E.success,delete E.eventType,delete E.firstSuccess,E.vid=Number(E.vid);const b=Object.assign({},E,R,{eventType:ai.REJOIN_GATEWAY});this.send({type:pn.RE_JOIN_GATEWAY,data:b},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=Date.now(),o=lt(lt({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:pn.JOIN_CHANNEL_TIMEOUT,data:o},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),l=lt(lt({},r),{},{eventType:ai.PUBLISH,lts:o,eventElapse:t.eventElapse,elapse:o-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:pn.PUBLISH,data:l},!0)}subscribe(e,t,n){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,l=Date.now(),u=lt(lt({},o),{},{eventType:ai.SUBSCRIBE,lts:l,eventElapse:t.eventElapse,elapse:l-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?u.peerSuid=t.peerid:u.peer=t.peerid,this.send({type:pn.SUBSCRIBE,data:u},!0)}wsCompressorInit(e){var t;const n=[...Ks(t=this.baseInfoMap).call(t)],r=n.length?n[0]:"UnableToGetSid",o=this.baseInfoMap.get(r);if(!o)return;const l=o.info,u=Date.now(),h=lt(lt({},l),{},{eventType:ai.WS_COMPRESSOR_INIT,lts:u,eventElapse:e.eventElapse,elapse:u-o.startTime,status:e.status?1:2});this.send({type:pn.WS_COMPRESSOR_INIT,data:h},!0)}firstRemoteVideoDecode(e,t,n,r){const o=this.baseInfoMap.get(e);if(!o)return;const l=o.info,u=Date.now(),h=lt(lt(lt({},l),r),{},{elapse:u-o.startTime,eventType:t,lts:u,firstDecodeFrame:Math.max((r.firstFrame||u)-o.startTime,0),apEnd:Math.max(r.apEnd-o.startTime,0),apStart:Math.max(r.apStart-o.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-o.startTime,0),joinGwStart:Math.max(r.joinGwStart-o.startTime,0),pcEnd:Math.max(r.pcEnd-o.startTime,0),pcStart:Math.max(r.pcStart-o.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-o.startTime,0),subscriberStart:Math.max(r.subscriberStart-o.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-o.startTime,0)});this.send({type:n,data:h},!0)}firstRemoteFrame(e,t,n,r){const o=this.baseInfoMap.get(e);if(!o)return;const l=o.info,u=Date.now(),h=lt(lt(lt({},l),r),{},{elapse:u-o.startTime,eventType:t,lts:u});this.send({type:n,data:h},!0)}abTest(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),l=lt(lt(lt({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:o-n.startTime,eventType:ai.AB_TEST,lts:o});this.send({type:pn.AB_TEST,data:l},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),l=lt(lt(lt({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:o-n.startTime,eventType:ai.PC_STATS,lts:o,preallocation:t.preallocation?1:0});this.send({type:pn.PC_STATS,data:l},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),l=lt(lt(lt({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),eventType:ai.UPDATE_REMOTE_RTPCAPABILITIES,lts:o});this.send({type:pn.UPDATE_REMOTE_RTPCAPABILITIES,data:l},!0)}}onGatewayStream(e,t,n,r){const o=this.baseInfoMap.get(e);if(!o)return;const l=o.info,u=Date.now(),h=lt(lt(lt({},l),r),{},{eventType:t,lts:u});this.send({type:n,data:h},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),l=lt(lt({},r),{},{eventType:ai.STREAM_SWITCH,lts:o,isDual:t.isdual,elapse:o-n.startTime,success:t.succ});this.send({type:pn.STREAM_SWITCH,data:l},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),l=lt(lt({},r),{},{eventType:ai.REQUEST_PROXY_APPCENTER,lts:o,eventElapse:o-t.lts,elapse:o-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:pn.REQUEST_PROXY_APPCENTER,data:l},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),l=lt(lt({},r),{},{eventType:ai.REQUEST_PROXY_WORKER_MANAGER,lts:o,eventElapse:o-t.lts,elapse:o-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:pn.REQUEST_PROXY_WORKER_MANAGER,data:l},!0)}setProxyServer(e){this.proxyServer=e,e?A.debug("reportProxyServerurl: ".concat(e)):A.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),l=lt(lt({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:o,elapse:o-n.startTime,joinChannelSuccessElapse:o-(n.lastJoinSuccessTime||o),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:pn.PEER_PUBLISH_STATUS,data:l},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now();(function(l,u,h){const m=l[u];if(!m||typeof m!="string")return[l];l[u]="";const g=Tc(JSON.stringify(l));let E=0;const S=[];let R=0;for(let b=0;b<m.length;b++)R+=m.charCodeAt(b)<=127?1:3,R<=h-g||(S[S.length]=Ne(Ne({},l),{},{[u]:m.substring(E,b)}),E=b,R=m.charCodeAt(b)<=127?1:3);return E!==m.length-1&&(S[S.length]=Ne(Ne({},l),{},{[u]:m.substring(E)})),S})(lt(lt(lt({},r),t),{},{elapse:o-n.startTime,lts:o,productType:"WebRTC"}),"payload",1300).forEach(l=>this.send({type:pn.WORKER_EVENT,data:l},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),l=lt(lt(lt({},r),t),{},{elapse:o-n.startTime,lts:o});this.send({type:pn.AP_WORKER_EVENT,data:l},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),l=lt(lt(lt({},r),t),{},{elapse:o-n.startTime,lts:o,extend:t.extend||void 0});this.send({type:pn.JOIN_WEB_PROXY_AP,data:l},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),l=lt(lt(lt({},r),t),{},{elapse:o-n.startTime,lts:o});this.send({type:pn.WEBSOCKET_QUIT,data:l},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>G("CUSTOM_REPORT_LIMIT"))throw new oe(B.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),r=t.map(o=>({type:pn.USER_ANALYTICS,data:lt(lt({sid:e},o),{},{lts:n})}));try{G("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(o){throw A.error("send custom report message failed",o.toString()),new oe(B.CUSTOM_REPORT_SEND_FAILED,o.message)}}sendApiInvoke(e){const t=G("NOT_REPORT_EVENT");if(e.tag&&Te(t)&&Te(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:r,uid:o,cid:l}=n.info;let u;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof oe){const{code:m,message:g}=e.error;u=m||g||e.error.toString()}else u=e.error.toString();const h={invokeId:e.invokeId,sid:e.sid,cname:r,cid:l,uid:o,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?u:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:pn.API_INVOKE,data:h},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find(n=>n!==null);t&&e.forEach(n=>{n&&(n.sid=t,this.sendApiInvoke(Object.assign({},n)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>G("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],r=[];for(;e.length;){const l=e.shift();n.length<20?n.push(l):r.push(l)}e.push(...r);for(const l of[...n]){var o;this.ltsList.indexOf(l.data.lts)!==-1?(l.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(l.data.lts)):(this.ltsList.push(l.data.lts),KE(o=this.ltsList).call(o,(u,h)=>u-h))}return t||(this.lastSendNormalEventTime=Date.now()),G("ENABLE_EVENT_REPORT")&&n.length&&(G("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((l=>u=>{G("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(l):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(l),this.normalEventUploadPendingItems.length>G("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-G("NORMAL_EVENT_QUEUE_CAPACITY")),A.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){Un.networkState===Ts.OFFLINE&&await we.race([Un.onlineWaiter,Si(2*Kn.maxRetryTimeout)]);const t=o=>{let l=new Uint8Array;return o.forEach(u=>{const h=NI(JSON.stringify(u.data)),m=new ArrayBuffer(5),g=(S=>{let R=0;return Object.entries(pn).forEach(b=>{let[x,P]=b;P===S.type&&(R=E$[x])}),R})(u),E=new DataView(m);E.setUint16(0,h.byteLength,!0),E.setUint8(2,255&g),E.setUint8(3,g>>>8&255),E.setUint8(4,g>>>16&255),l=O2(l,new Uint8Array(m)),l=O2(l,h)}),l},n="event";let r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(G("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let o=0;o<2;o+=1){o===1&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(G("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await UI(r,{timeout:1e4,data:t(e),headers:lt(lt({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(l){if(o===1)throw l;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(h=>{const m=h&&h.data.sid&&this.baseInfoMap.get(h.data.sid);return m&&m.info.vid&&+m.info.vid||0})(e[0]),r=n?void 0:this._aid,o={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(h=>JSON.stringify(h)),vid:n,aid:r};Un.networkState===Ts.OFFLINE&&await we.race([Un.onlineWaiter,Si(2*Kn.maxRetryTimeout)]);const l=t?"/events/proto-raws":"/events/messages";let u=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("EVENT_REPORT_DOMAIN"),"&p=").concat(G("STATS_COLLECTOR_PORT"),"&d=").concat(l):"https://".concat(G("EVENT_REPORT_DOMAIN"),":").concat(G("STATS_COLLECTOR_PORT")).concat(l));for(let h=0;h<2;h+=1){h===1&&(u=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(G("STATS_COLLECTOR_PORT"),"&d=").concat(l):"https://".concat(G("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(G("STATS_COLLECTOR_PORT")).concat(l)));try{t?await i$(u,{timeout:1e4,data:o}):await UI(u,{timeout:1e4,data:o})}catch(m){if(h===1)throw m;continue}return}}createBaseInfo(e,t){const n=Object.assign({},_$);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:Tn.TRACER}).onSuccess()}};iU.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Un.networkState,xe.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Tn.TRACER}).onSuccess("logUploadError")});class ie extends oe{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),wn(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,A)}throw(){super.throw(A)}}const Ti={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function bt(){return Ti}function oU(){return"setSinkId"in HTMLAudioElement.prototype&&(!G("RESTRICTION_SET_PLAYBACK_DEVICE")||(Ml()||_2())&&!AI())}function aU(){return!Ti.supportUnifiedPlan||G("CHROME_FORCE_PLAN_B")&&Ul()}let Ri=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Hm(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function Rt(e,t,n,r,o){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:o}}function zo(e,t,n,r,o){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:o}}function XI(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const y$={"90p":Rt(160,90),"90p_1":Rt(160,90),"120p":Rt(160,120,15,30,65),"120p_1":Rt(160,120,15,30,65),"120p_3":Rt(120,120,15,30,50),"120p_4":Rt(212,120),"180p":Rt(320,180,15,30,140),"180p_1":Rt(320,180,15,30,140),"180p_3":Rt(180,180,15,30,100),"180p_4":Rt(240,180,15,30,120),"240p":Rt(320,240,15,40,200),"240p_1":Rt(320,240,15,40,200),"240p_3":Rt(240,240,15,40,140),"240p_4":Rt(424,240,15,40,220),"360p":Rt(640,360,15,80,400),"360p_1":Rt(640,360,15,80,400),"360p_3":Rt(360,360,15,80,260),"360p_4":Rt(640,360,30,80,600),"360p_6":Rt(360,360,30,80,400),"360p_7":Rt(480,360,15,80,320),"360p_8":Rt(480,360,30,80,490),"360p_9":Rt(640,360,15,80,800),"360p_10":Rt(640,360,24,80,800),"360p_11":Rt(640,360,24,80,1e3),"480p":Rt(640,480,15,100,500),"480p_1":Rt(640,480,15,100,500),"480p_2":Rt(640,480,30,100,1e3),"480p_3":Rt(480,480,15,100,400),"480p_4":Rt(640,480,30,100,750),"480p_6":Rt(480,480,30,100,600),"480p_8":Rt(848,480,15,100,610),"480p_9":Rt(848,480,30,100,930),"480p_10":Rt(640,480,10,100,400),"720p":Rt(1280,720,15,120,1130),"720p_auto":Rt(1280,720,30,900,3e3),"720p_1":Rt(1280,720,15,120,1130),"720p_2":Rt(1280,720,30,120,2e3),"720p_3":Rt(1280,720,30,120,1710),"720p_5":Rt(960,720,15,120,910),"720p_6":Rt(960,720,30,120,1380),"1080p":Rt(1920,1080,15,120,2080),"1080p_1":Rt(1920,1080,15,120,2080),"1080p_2":Rt(1920,1080,30,120,3e3),"1080p_3":Rt(1920,1080,30,120,3150),"1080p_5":Rt(1920,1080,60,120,4780),"1440p":Rt(2560,1440,30,120,4850),"1440p_1":Rt(2560,1440,30,120,4850),"1440p_2":Rt(2560,1440,60,120,7350),"4k":Rt(3840,2160,30,120,8910),"4k_1":Rt(3840,2160,30,120,8910),"4k_3":Rt(3840,2160,60,120,13500)},v$={"480p":zo(640,480,5),"480p_1":zo(640,480,5),"480p_2":zo(640,480,30),"480p_3":zo(640,480,15),"720p":zo(1280,720,5),"720p_auto":Rt(1280,720,30,900,3e3),"720p_1":zo(1280,720,5),"720p_2":zo(1280,720,30),"720p_3":zo(1280,720,15),"1080p":zo(1920,1080,5),"1080p_1":zo(1920,1080,5),"1080p_2":zo(1920,1080,30),"1080p_3":zo(1920,1080,15)},S$={"1SL1TL":XI(1,1),"3SL3TL":XI(3,3),"2SL3TL":XI(2,3)};function wc(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},y$[e]):e}function JI(e){return typeof e=="string"?Object.assign({},v$[e]):e}function YR(e){return typeof e=="string"?Object.assign({},S$[e]):e}const T$={speech_low_quality:Hm(16e3,!1),speech_standard:Hm(32e3,!1,18),music_standard:Hm(48e3,!1),standard_stereo:Hm(48e3,!0,56),high_quality:Hm(48e3,!1,128),high_quality_stereo:Hm(48e3,!0,192)};function XR(e){return typeof e=="string"?Object.assign({},T$[e]):e}const Km=[];function cU(e){return ei(e,"mediaSource",["screen","window","application"]),!0}let De=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),$t=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),qm=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),R$=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),w$=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),qh=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),Ym=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),Xm=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),Jm=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),qs=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const $I={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},QI={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},lU={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},C$={uplinkNetworkQuality:0,downlinkNetworkQuality:0},uU={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let mr=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),Ys=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),fy=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),Yh=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),rr=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),Cc=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const ZI={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let JR=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function dU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function fn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?dU(Object(n),!0).forEach(function(r){ne(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function ne(e,t,n){return(t=function(r){var o=function(l,u){if(typeof l!="object"||l===null)return l;var h=l[Symbol.toPrimitive];if(h!==void 0){var m=h.call(l,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(r);return typeof o=="symbol"?o:String(o)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function wt(e,t,n,r,o){var l,u,h={};return Object.keys(r).forEach(function(m){h[m]=r[m]}),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=ms(l=Su(u=n.slice()).call(u)).call(l,function(m,g){return g(e,t,m)||m},h),o&&h.initializer!==void 0&&(h.value=h.initializer?h.initializer.call(o):void 0,h.initializer=void 0),h.initializer===void 0&&(Object.defineProperty(e,t,h),h=null),h}class hU extends En{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(qh.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),ne(this,"trackMediaType",void 0),ne(this,"_ID",void 0),ne(this,"_rtpTransceiver",void 0),ne(this,"_lowRtpTransceiver",void 0),ne(this,"_hints",[]),ne(this,"_isClosed",!1),ne(this,"_originMediaStreamTrack",void 0),ne(this,"mediaStreamTrack",void 0),ne(this,"_external",{}),this._ID=n||Jt(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(r){Te(Km).call(Km,r)||Km.push(r)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Yu(()=>{var n;xe.reportApiInvoke(null,{name:Hn.GET_MEDIA_STREAM_TRACK,options:[],tag:Tn.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===qm.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const n=Km.indexOf(t);n!==-1&&Km.splice(n,1)}(this),this.emit(Ym.CLOSED),this.removeAllListeners(qh.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===qm.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(qh.TRANSCEIVER_UPDATED,t,n)}}class $m extends hU{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),ne(this,"_enabled",!0),ne(this,"_muted",!1),ne(this,"_isExternalTrack",!1),ne(this,"_isClosed",!1),ne(this,"_enabledMutex",void 0),ne(this,"processor",void 0),ne(this,"_processorContext",void 0),ne(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Gi("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,A.debug("[".concat(this.getTrackId(),"] close")),this.emit(De.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=r,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Xt(this,De.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){A.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Ym.TRACK_ENDED)}stateCheck(t,n){if(A.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),Vl(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new oe(B.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",A);if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new oe(B.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",A)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():we.resolve([])}}const pU=window.AudioContext||window.webkitAudioContext;let Xs=null;const Ft=new class extends En{constructor(){super(...arguments),ne(this,"prevState",void 0),ne(this,"curState",void 0),ne(this,"currentTime",void 0),ne(this,"currentTimeStuckAt",void 0),ne(this,"interruptDetectorTrack",void 0),ne(this,"onLocalAudioTrackMute",()=>{A.info("ios15-interruption-start"),this.emit(Ri.IOS_15_16_INTERRUPTION_START)}),ne(this,"onLocalAudioTrackUnmute",async()=>{A.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?A.info("ios15-interruption-end-canceled"):(Xs&&await Xs.suspend(),this.emit(Ri.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){A.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){A.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Qm(){if(!Xs){if(function(){if(!pU)return void A.error("your browser is not support web audio");A.info("create audio context");const e=fn({},G("WEBAUDIO_INIT_OPTIONS"));A.debug("audio context init option:",JSON.stringify(e)),Xs=new pU(e),Ft.curState=Xs.state,Xs.onstatechange=()=>{Ft.prevState=Ft.curState,Ft.curState=Xs?Xs.state:void 0;const{prevState:t,curState:n}=Ft,r=n==="running",o=n==="interrupted",l=t==="running",u=t==="suspended",h=t==="interrupted",m=Tt().osVersion;(fr()||Go())&&l&&o&&(A.info("ios".concat(m,"-interruption-start")),Ft.emit(Ri.IOS_INTERRUPTION_START)),(fr()||Go())&&(u||h)&&r&&(A.info("ios".concat(m,"-interruption-end")),Ft.emit(Ri.IOS_INTERRUPTION_END)),t!==n&&Ft.emit(Ri.STATE_CHANGE,n,t)},setInterval(()=>{var t;const n=(t=Xs)===null||t===void 0?void 0:t.currentTime;Ft.currentTime!==n?(Ft.currentTimeStuckAt&&(A.debug("AudioContext current time resume at ".concat(n)),Ft.currentTimeStuckAt=void 0),Ft.currentTime=n):(n!==Ft.currentTimeStuckAt&&(xe.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:Tn.TRACER}).onSuccess(),A.warning("AudioContext current time stuck at ".concat(n))),Ft.currentTimeStuckAt=n)},5e3),async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let r,o=!1,l=!1,u=!1;function h(P){t.state==="running"?m(!1):fr()||Go()?t.state==="suspended"&&(m(!0),P&&t.resume().then(g,g)):t.state!=="closed"&&(m(!0),P&&t.resume().then(g,g))}function m(P){if(o!==P){o=P;for(let k=0,V=n;k<V.length;k+=1){const F=V[k];P?window.addEventListener(F,E,{capture:!0,passive:!0}):window.removeEventListener(F,E,{capture:!0,passive:!0})}}}function g(){h(!1)}function E(){h(!0)}function S(P){if(!u)if(r.paused)if(P){let k;R(!1),u=!0;try{k=r.play(),k?k.then(b,b):(r.addEventListener("playing",b),r.addEventListener("abort",b),r.addEventListener("error",b))}catch{b()}}else R(!0);else R(!1)}function R(P){if(l!==P){l=P;for(let k=0,V=n;k<V.length;k++){const F=V[k];P?window.addEventListener(F,x,{capture:!0,passive:!0}):window.removeEventListener(F,x,{capture:!0,passive:!0})}}}function b(){r.removeEventListener("playing",b),r.removeEventListener("abort",b),r.removeEventListener("error",b),u=!1,S(!1)}function x(){S(!0)}if(fr()){const P=t.createMediaStreamDestination(),k=document.createElement("div");k.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=k.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=P.stream,S(!0)}Ft.on(Ri.STATE_CHANGE,function(){h(!0)}),h(!1)}(Xs)}(),!Xs)throw new oe(B.NOT_SUPPORTED,"can not create audio context");return Xs}return Xs}function Xh(e){if(function(){if(eO!==null)return eO;const r=Qm(),o=r.createBufferSource(),l=r.createGain(),u=r.createGain();o.connect(l),o.connect(u),o.disconnect(l);let h=!1;try{o.disconnect(l)}catch{h=!0}return o.disconnect(),eO=h,h}())return;const t=e.connect,n=e.disconnect;e.connect=(r,o,l)=>{var u;return e._inputNodes||(e._inputNodes=[]),Te(u=e._inputNodes).call(u,r)||(r instanceof AudioNode?(e._inputNodes.push(r),t.call(e,r,o,l)):t.call(e,r,o)),e},e.disconnect=(r,o,l)=>{n.call(e),r?FR(e._inputNodes,r):e._inputNodes=[];for(const u of e._inputNodes)t.call(e,u)}}let eO=null;function tO(e,t){let n=!1;const r=1/t;if(G("DISABLE_WEBAUDIO")){const o=window.setInterval(()=>{n?window.clearInterval(o):e(performance.now()/1e3)},1e3*r)}else{const o=Qm();let l=o.createGain();l.gain.value=0,l.connect(o.destination);const u=()=>{if(n)return void(l=null);const h=o.createOscillator();h.onended=u,h.connect(l),h.start(0),h.stop(o.currentTime+r),e(o.currentTime)};u()}return()=>{n=!0}}class fU{constructor(){ne(this,"context",void 0),ne(this,"analyserNode",void 0),ne(this,"sourceNode",void 0),this.context=Qm(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||fr()||Go()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const r=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r);for(let o=0;o<t.length;++o)t[o]=r[o]/128-1}const n=ms(t).call(t,(r,o)=>r+o*o,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{A.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class mU extends En{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var r;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),ne(this,"outputNode",void 0),ne(this,"outputTrack",void 0),ne(this,"isPlayed",!1),ne(this,"sourceNode",void 0),ne(this,"context",void 0),ne(this,"audioBufferNode",void 0),ne(this,"destNode",void 0),ne(this,"audioOutputLevel",0),ne(this,"volumeLevelAnalyser",void 0),ne(this,"_processedNode",void 0),ne(this,"playNode",void 0),ne(this,"isDestroyed",!1),ne(this,"onNoAudioInput",void 0),ne(this,"isNoAudioInput",!1),ne(this,"_noAudioInputCount",0),this.context=Qm(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Xh(this.outputNode),this.volumeLevelAnalyser=new fU}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(qs.ON_AUDIO_BUFFER,function(r){for(let o=0;o<r.outputBuffer.numberOfChannels;o+=1){const l=r.outputBuffer.getChannelData(o);for(let u=0;u<l.length;u+=1)l[u]=0}return r.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!bt().webAudioMediaStreamDest)throw new oe(B.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&BR(()=>{Ft.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;fr()||Go()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let r;n.getFloatTimeDomainData?(r=new Float32Array(n.fftSize),n.getFloatTimeDomainData(r)):(r=new Uint8Array(n.fftSize),n.getByteTimeDomainData(r));let o=!1;for(let l=0;l<r.length;l++)r[l]!==0&&(o=!0);return o?(this.isNoAudioInput=!1,!0):(await Si(200),await this.checkHasAudioInput(t?t+1:1)&&o)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class gU extends mU{get isFreeze(){return!1}constructor(t,n,r){var o;if(super(),ne(this,"sourceNode",void 0),ne(this,"track",void 0),ne(this,"clonedTrack",void 0),ne(this,"audioElement",void 0),ne(this,"isCurrentTrackCloned",!1),ne(this,"isRemoteTrack",!1),ne(this,"originVolumeLevelAnalyser",void 0),ne(this,"rebuildWebAudio",async()=>{if(A.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void A.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>A.info("resume success")),A.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const h=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?h.stop():this.isCurrentTrackCloned=!0;const m=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(m),Xh(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const g=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(g,this.context.currentTime),Xh(this.outputNode),this.emit(qs.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=m,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new oe(B.UNEXPECTED_ERROR);this.track=t;const l=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(l),Xh(this.sourceNode),r){const h=r.clone();h.enabled=!0,this.clonedTrack=h,A.debug("create an unmuted track ".concat(h.id," from the original track ").concat(r.id," to get the volume"));const m=this.context.createMediaStreamSource(new MediaStream([h]));Xh(m),this.originVolumeLevelAnalyser=new fU,this.originVolumeLevelAnalyser.updateSource(m)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=l;const u=Tt();n&&u.os===oi.IOS&&Number((o=u.osVersion)===null||o===void 0?void 0:o.split(".")[0])<15&&(Ft.on(Ri.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(h=>{h||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),Xh(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(qs.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),Ft.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),A.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const r=this.context.createMediaStreamSource(new MediaStream([n]));Xh(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function _U(e,t,n){const r=(l,u)=>l?typeof l!="number"?l.max||l.exact||l.ideal||l.min||u:l:u,o={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(o.video.mandatory.maxFrameRate=t.frameRate.max,o.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(o.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(o)}async function b$(e,t){const n=await EU(e.mediaSource),{sourceId:r,audio:o}=await function(l){let u=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new we((h,m)=>{const g=document.createElement("div");g.innerText="share screen",g.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const E=document.createElement("div");E.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const S=document.createElement("div");S.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",S.setAttribute("style","height: 12%;");const R=document.createElement("div");R.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const b=document.createElement("div");b.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const x=document.createElement("button");x.innerHTML="cancel",x.setAttribute("style","width: 85px;"),x.onclick=()=>{document.body.removeChild(V);const F=new Error("NotAllowedError");F.name="NotAllowedError",m(F)};let P=u;const k=document.createElement("div");if(u){const F=document.createElement("input");F.setAttribute("type","checkbox");const K=document.createElement("span");F.setAttribute("style","margin-right: 6px;"),K.innerText="Share audio",F.checked=P,F.onchange=()=>{P=F.checked},k.appendChild(F),k.appendChild(K)}b.appendChild(k),b.appendChild(x),E.appendChild(S),E.appendChild(R),E.appendChild(b);const V=document.createElement("div");V.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),V.appendChild(g),V.appendChild(E),document.body.appendChild(V),l.map(F=>{if(F.id){const K=document.createElement("div");K.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let $=F.thumbnail;try{const{width:Z}=$.getSize();Z>1920&&($=$.resize({width:1920}))}catch(Z){throw Z&&Z.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),Z}K.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+$.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+F.name.replace(/[\u00A0-\u9999<>\&]/g,function(Z){return"&#"+Z.charCodeAt(0)+";"})+"</span>",K.onclick=()=>{document.body.removeChild(V),h({sourceId:F.id,audio:P})},R.appendChild(K)}})})}(n,t);return await _U(r,e,o)}async function EU(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=N2();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new oe(B.ELECTRON_IS_NULL);let r=null;try{var o;r=((o=n.desktopCapturer)===null||o===void 0?void 0:o.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{r=null}r&&r.then||(r=new we((l,u)=>{n.desktopCapturer.getSources({types:t},(h,m)=>{h?u(h):l(m)})}));try{return await r}catch(l){throw new oe(B.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,l.toString())}}const nO=new Gi("safari");let yU=!1,vU=!1;async function Js(e,t){let n=0,r=null;for(;n<2;)try{r=await A$(e,t,n>0);break}catch(o){if(o instanceof oe)throw A.error("[".concat(t,"] ").concat(o.toString())),o;const l=$R(o.name||o.code||o,o.message);if(l.code===B.MEDIA_OPTION_INVALID){A.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await Si(500);continue}throw A.error("[".concat(t,"] ").concat(l.toString())),l}if(!r)throw new oe(B.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function A$(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new oe(B.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const r=bt(),o=new MediaStream;if(e.audioSource&&o.addTrack(e.audioSource),e.videoSource&&o.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return A.debug("Using Video Source/ Audio Source"),o;if(e.screen)if(N2())e.screen.sourceId?Zm(o,await _U(e.screen.sourceId,e.screen,!!e.screenAudio)):Zm(o,await b$(e.screen,!!e.screenAudio));else if(Ml()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new oe(B.NOT_SUPPORTED,"This browser does not support screen sharing");A.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const R=await(u=e.screen.extensionId,h=t,new we((b,x)=>{try{chrome.runtime.sendMessage(u,{getStream:!0},P=>{if(!P||!P.streamId)return A.error("[".concat(h,"] No response from Chrome Plugin. Plugin not installed properly"),P),void x(new oe(B.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));b(P.streamId)})}catch(P){A.error("[".concat(h,"] AgoraRTC screensharing plugin is not accessible(").concat(u,")"),P.toString()),x(new oe(B.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=R,Zm(o,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var l;e.screen.mediaSource&&cU(e.screen.mediaSource);const R={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(l=e.screen.displaySurface)!==null&&l!==void 0?l:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:b,surfaceSwitching:x,systemAudio:P,preferCurrentTab:k}=e.screen,V={selfBrowserSurface:b,surfaceSwitching:x,systemAudio:P,preferCurrentTab:k};!b&&delete V.selfBrowserSurface,!x&&delete V.surfaceSwitching,!P&&delete V.systemAudio,!k&&delete V.preferCurrentTab,A.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:R,audio:e.screenAudio,controls:V})),Zm(o,await navigator.mediaDevices.getDisplayMedia(fn({video:R,audio:e.screenAudio},V)))}else{if(!vn())throw A.error("[".concat(t,"] This browser does not support screenSharing")),new oe(B.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&cU(e.screen.mediaSource);const R={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};A.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(R))),Zm(o,await navigator.mediaDevices.getUserMedia(R))}}var u,h;if(!e.video&&!e.audio)return o;let m={video:e.video,audio:e.audio},g=G("MEDIA_DEVICE_CONSTRAINTS");if(g)try{typeof g=="string"&&(g=JSON.parse(g)),m=kI(m,g)}catch{}A.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(m)),Tt();let E,S=null;(Li()||fr()||UR())&&(S=await nO.lock());try{E=await navigator.mediaDevices.getUserMedia(m)}catch(R){throw S&&S(),R}return m.audio&&(yU=!0),m.video&&(vU=!0),Zm(o,E),S&&S(),o}function $R(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new oe(B.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new oe(B.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new oe(B.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new oe(B.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new oe(B.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new oe(B.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return A.error("getUserMedia unexpected error",e),new oe(B.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Zm(e,t){const n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],o=t.getVideoTracks()[0],l=t.getAudioTracks()[0];l&&(r&&e.removeTrack(r),e.addTrack(l)),o&&(n&&e.removeTrack(n),e.addTrack(o))}const $s=new class extends En{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Yh.STATE_CHANGE,e),this._state=e)}constructor(){super(),ne(this,"_state",fy.IDLE),ne(this,"isAccessMicrophonePermission",!1),ne(this,"isAccessCameraPermission",!1),ne(this,"lastAccessMicrophonePermission",!1),ne(this,"lastAccessCameraPermission",!1),ne(this,"checkdeviceMatched",!1),ne(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(G("ENUMERATE_DEVICES_INTERVAL")||(VR()||MR()===oi.HARMONY_OS)&&Ul())&&this.updateDevicesInfo()},G("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>A.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new oe(B.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r=await navigator.mediaDevices.enumerateDevices(),o=this.checkMediaDeviceInfoIsOk(r);let l=!this.isAccessMicrophonePermission&&e,u=!this.isAccessCameraPermission&&t;o.audio&&(l=!1),o.video&&(u=!1);let h=null,m=null,g=null;if(!n&&(l||u)){if(nO.isLocked&&(A.debug("[device manager] wait GUM lock"),(await nO.lock())(),A.debug("[device manager] GUM unlock")),yU&&(l=!1,this.isAccessMicrophonePermission=!0),vU&&(u=!1,this.isAccessCameraPermission=!0),A.debug("[device manager] check media device permissions",e,t,l,u),l&&u){try{g=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(E){const S=$R(E.name||E.code||E,E.message);if(S.code===B.PERMISSION_DENIED)throw S;A.warning("getUserMedia failed in getDevices",S)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(l){try{h=await navigator.mediaDevices.getUserMedia({audio:e})}catch(E){const S=$R(E.name||E.code||E,E.message);if(S.code===B.PERMISSION_DENIED)throw S;A.warning("getUserMedia failed in getDevices",S)}this.isAccessMicrophonePermission=!0}else if(u){try{m=await navigator.mediaDevices.getUserMedia({video:t})}catch(E){const S=$R(E.name||E.code||E,E.message);if(S.code===B.PERMISSION_DENIED)throw S;A.warning("getUserMedia failed in getDevices",S)}this.isAccessCameraPermission=!0}A.debug("[device manager] mic permission",e,"cam permission",t)}try{const E=await navigator.mediaDevices.enumerateDevices();return h&&h.getTracks().forEach(S=>S.stop()),m&&m.getTracks().forEach(S=>S.stop()),g&&g.getTracks().forEach(S=>S.stop()),h=null,m=null,g=null,E}catch(E){return h&&h.getTracks().forEach(S=>S.stop()),m&&m.getTracks().forEach(S=>S.stop()),g&&g.getTracks().forEach(S=>S.stop()),h=null,m=null,g=null,new oe(B.ENUMERATE_DEVICES_FAILED,E.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new oe(B.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=fy.INITING;try{await this.updateDevicesInfo(),this.state=fy.INITEND}catch(e){throw A.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=fy.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new oe(B.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const o=e.find(u=>u.kind==="audioinput"&&u.deviceId==="default"),l=e.find(u=>u.kind==="audiooutput"&&u.deviceId==="default");o&&l?l.groupId===o.groupId?A.debug("[device-check] default input ".concat(o.label," and output ").concat(l.label," is the same group")):A.debug("[device-check] default input ".concat(o.label," and output ").concat(l.label," is not the same group")):A.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(o=>{if(!o.deviceId)return;const l=this.deviceInfoMap.get("".concat(o.kind,"_").concat(o.deviceId));if((l?l.state:"INACTIVE")!=="ACTIVE"){const u={initAt:t,updateAt:t,device:o,state:"ACTIVE"};this.deviceInfoMap.set("".concat(o.kind,"_").concat(o.deviceId),u),n.push(u)}l&&(l.updateAt=t)}),this.deviceInfoMap.forEach((o,l)=>{o.state==="ACTIVE"&&o.updateAt!==t&&(o.state="INACTIVE",n.push(o))}),this.state!==fy.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(o=>{switch(o.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Yh.RECORDING_DEVICE_CHANGED,o);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Yh.CAMERA_DEVICE_CHANGED,o);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Yh.PLAYOUT_DEVICE_CHANGED,o)}}),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(o=>o.kind==="audioinput"),n=e.filter(o=>o.kind==="videoinput"),r={audio:!1,video:!1};for(const o of t)if(o.label&&o.deviceId){r.audio=!0;break}for(const o of n)if(o.label&&o.deviceId){r.video=!0;break}return r}};let iO=!1;const Qs=new class extends En{constructor(){super(...arguments),ne(this,"onAutoplayFailed",void 0),ne(this,"onAudioAutoplayFailed",void 0)}};function SU(){if(Tt(),!iO){const e=t=>{t.preventDefault(),iO=!1,sy()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};iO=!0,sy()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),A.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Qs.onAutoplayFailed?Qs.onAutoplayFailed():Qs.onAudioAutoplayFailed?A.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):A.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Qs.emit("autoplay-failed")}}function TU(e,t,n,r){if(!e)return;const o=xe.getBaseInfoBySessionId(e);if(!o)return;const l=o.info,u=Date.now(),h=fn(fn({},l),{},{vid:l.vid===void 0?0:Number(l.vid),lts:u,elapse:u-o.startTime,cbRegistered:Qs.onAutoplayFailed||Qs.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});xe.send({type:pn.AUTOPLAY_FAILED,data:h},!0)}const I$=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Dr=new class{constructor(){ne(this,"onAutoplayFailed",void 0),ne(this,"elementMap",new Map),ne(this,"elementStateMap",new Map),ne(this,"elementsNeedToResume",[]),ne(this,"sinkIdMap",new Map),ne(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[n,r]=t;const o=this.elementStateMap.get(n),l=r.srcObject.getAudioTracks()[0],u=l&&l.readyState;if(A.debug("resume after interrupted, ele: ".concat(o," audio: ").concat(u," ").concat(e)),u==="live"){if(e)return r.pause(),void r.play();if(Ft.curState==="running")return Fm()?(r.pause(),void r.play()):void(o&&o==="paused"&&r.play())}})}),ne(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const r=n.srcObject.getAudioTracks()[0];r&&r.readyState==="live"&&(A.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),Ft.on(Ri.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ft.on(Ri.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Ft.on(Ri.STATE_CHANGE,()=>{fr()&&Ft.prevState==="suspended"&&Ft.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(r){throw new oe(B.PERMISSION_DENIED,"can not set sink id: "+r.toString())}}play(e,t,n,r){if(this.elementMap.has(t))return;const o=document.createElement("audio");o.autoplay=!0,o.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,o),this.elementMap.set(t,o),this.elementStateMap.set(t,rr.INIT),this.setVolume(t,n);const l=this.sinkIdMap.get(t);if(l)try{o.setSinkId(l).catch(h=>{A.warning("[".concat(t,"] set sink id failed"),h.toString())})}catch(h){A.warning("[".concat(t,"] set sink id failed"),h.toString())}const u=o.play();u&&u.then&&u.catch(h=>{r&&TU(r,"audio",h.message,t),A.warning("audio element play warning",h.toString()),this.elementMap.has(t)&&h.name==="NotAllowedError"&&(A.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(o),BR(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),SU()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){I$.forEach(n=>{t.addEventListener(n,r=>{const o=this.elementStateMap.get(e),l=r.type==="pause"?"paused":r.type;if(A.debug("[".concat(e,"] audio-element-status change ").concat(o," => ").concat(l)),r.type==="error"){const u=t==null?void 0:t.error;u&&A.error("[".concat(e,"] media error, code: ").concat(u.code,", message: ").concat(u.message))}this.elementStateMap.set(e,l)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{A.debug("Auto resume audio element success")}).catch(n=>{A.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new we(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{sy()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Pn(){return function(e,t,n){const r=n.value;return typeof r=="function"&&(n.value=function(){this._isClosed&&new oe(B.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",A);for(var o=arguments.length,l=new Array(o),u=0;u<o;u++)l[u]=arguments[u];const h=r.apply(this,l);return h instanceof we?new we((m,g)=>{h.then(m).catch(g)}):h}),n}}class RU extends En{constructor(t){super(),ne(this,"name","VideoProcessorDestination"),ne(this,"ID","0"),ne(this,"_source",void 0),ne(this,"videoContext",void 0),ne(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new oe(B.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new oe(B.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(mr.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(mr.ON_TRACK,void 0)}}class wU extends En{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),ne(this,"constraintsMap",new Map),ne(this,"statsRegistry",[]),ne(this,"usageRegistry",[]),ne(this,"trackId",void 0),ne(this,"direction",void 0),ne(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await Mi(this,Ys.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var r;return A.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),Xt(this,Ys.REQUEST_UPDATE_CONSTRAINTS,Array.from(Gs(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return A.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),Xt(this,Ys.REQUEST_UPDATE_CONSTRAINTS,Array.from(Gs(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:o,cb:l}of this.statsRegistry)try{const u=l();t.push({processorID:n,processorName:r,type:o,stats:u})}catch(u){A.error(new oe(B.UNEXPECTED_ERROR,u.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof we&&(r=await r),t.push(fn(fn({},r),{},{direction:this.direction}))}catch(r){A.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class CU extends En{constructor(t){super(),ne(this,"name","AudioProcessorDestination"),ne(this,"ID","0"),ne(this,"inputTrack",void 0),ne(this,"inputNode",void 0),ne(this,"audioProcessorContext",void 0),ne(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new oe(B.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new oe(B.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(mr.ON_TRACK,void 0),this.emit(mr.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(mr.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(mr.ON_NODE,this.inputNode))}}class bU extends En{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,r){super(),ne(this,"constraintsMap",new Map),ne(this,"statsRegistry",[]),ne(this,"audioContext",void 0),ne(this,"trackId",void 0),ne(this,"direction",void 0),ne(this,"usageRegistry",[]),ne(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=r}async getConstraints(){return Mi(this,Ys.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var r;return A.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),Xt(this,Ys.REQUEST_UPDATE_CONSTRAINTS,Array.from(Gs(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),Xt(this,Ys.REQUEST_UPDATE_CONSTRAINTS,Array.from(Gs(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:o,cb:l}of this.statsRegistry)try{const u=l();t.push({processorID:n,processorName:r,type:o,stats:u})}catch(u){A.error(new oe(B.UNEXPECTED_ERROR,u.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof we&&(r=await r),t.push(fn(fn({},r),{},{direction:this.direction}))}catch(r){A.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class rO extends En{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),ne(this,"context",void 0),ne(this,"processSourceNode",void 0),ne(this,"outputTrack",void 0),ne(this,"processedNode",void 0),ne(this,"clonedTrack",void 0),ne(this,"outputNode",void 0),this.outputNode=new O$}setVolume(){}createOutputTrack(){throw new oe(B.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class O${disconnect(){}connect(){}}function AU(e){return new we((t,n)=>{let r=!1;const o=document.createElement("video");o.setAttribute("autoplay",""),o.setAttribute("muted",""),o.muted=!0,o.autoplay=!0,o.setAttribute("playsinline",""),o.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(o);const l=fr()?"canplay":"playing";o.addEventListener(l,()=>{const u=o.videoWidth,h=o.videoHeight;!u&&vn()||(r=!0,o.srcObject=null,o.remove(),t([u,h]))}),o.srcObject=new MediaStream([e]),o.play().catch(jR),setTimeout(()=>{r||(o.srcObject=null,o.remove(),t([o.videoWidth,o.videoHeight]))},4e3)})}function QR(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=wc(e.encoderConfig);return n.width!=null&&(t.width=n.width),n.height!=null&&(t.height=n.height),!C2()&&n.frameRate&&(t.frameRate=n.frameRate),_2()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),vn()&&(t.frameRate={ideal:30,max:30}),t}function IU(e){const t={};return C2()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,Ml()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function OU(e){const t=IU(e);if(e.encoderConfig){const n=XR(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),VR()&&(t.sampleRate=void 0),t}const N$=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:r,height:o}=e.getMediaStreamTrackSettings();let{frameRate:l=n,width:u=r,height:h=o}=t;if(!l||!u||!h)return;u=LI(u),h=LI(h),l=LI(l);const{max:m,min:g}=function(b,x,P){const k=200*Math.pow(P/15,.6)*Math.pow(b*x/640/360,.75);return{min:Math.floor(k),max:Math.floor(4*k)}}(u,h,l),{bitrateMax:E,bitrateMin:S}=t||{};E||A.debug("calculate bitrate: [w: ".concat(u,", h: ").concat(h,", fps: ").concat(l,"] => [brMax: ").concat(E,", brMin: ").concat(S,"]"));const{maxFramerate:R}=G("ENCODER_CONFIG_LIMIT");return R&&typeof R=="number"&&(l=Math.min(l,R)),{frameRate:l,bitrateMax:E||m,bitrateMin:S||g,scaleResolutionDownBy:1,scale:0}},NU=async(e,t,n)=>await(async(r,o,l)=>{const u=function(g){const E=[];for(let S=0;S<g.length;S+=2)E.push(parseInt(g.slice(S,S+2),16));return Uint8Array.from(E)}(j2(""+o+l)).slice(0,16),h=u.slice(0,12),m=await window.crypto.subtle.importKey("raw",u,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:h},m,r))})(e.buffer,t,n),sO=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new we((n,r)=>{t.toBlob(async o=>{if(t.remove(),o){const l=await PU(o);n({buffer:l,width:t.width,height:t.height})}else r(new oe(B.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},PU=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var DU,kU,LU,xU,MU,UU,VU,FU,BU,jU,GU,WU,zU,HU,KU,qU,YU,XU,yn,JU,$U,QU,ZU,eV,tV,bc,nV,iV,rV,sV,oV,aV,cV,lV,uV,dV,hV,pV,fV,Vi;let bn=(DU=He({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),kU=He({argsMap:(e,t)=>[e.getTrackId(),t]}),LU=Pn(),xU=Gm("LocalAudioTrack","_enabledMutex"),MU=He({argsMap:(e,t)=>[e.getTrackId(),t]}),UU=Pn(),VU=Gm("LocalAudioTrack","_enabledMutex"),FU=He({argsMap:(e,t)=>[e.getTrackId(),t]}),BU=Pn(),jU=Pn(),GU=Pn(),WU=He({argsMap:e=>[e.getTrackId()]}),zU=Pn(),HU=He({argsMap:e=>[e.getTrackId()]}),KU=Pn(),qU=He({argsMap:e=>[e.getTrackId()]}),YU=He({argsMap:(e,t)=>[e.getTrackId(),t.name]}),XU=He({argsMap:e=>[e.getTrackId()]}),wt((yn=class extends $m{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Dr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r){super(e,n),ne(this,"trackMediaType",Jm.AUDIO),ne(this,"_encoderConfig",void 0),ne(this,"_trackSource",void 0),ne(this,"metadata",[]),ne(this,"_enabled",!0),ne(this,"_volume",100),ne(this,"_useAudioElement",!0),ne(this,"_bypassWebAudio",!1),ne(this,"processor",void 0),ne(this,"_processorContext",void 0),ne(this,"_processorDestination",void 0),ne(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new rO,G("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),G("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Li()&&!Xs?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){jt(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Dr.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void A.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,Xt(this,De.NEED_REPLACE_TRACK,this).then(()=>{A.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{A.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!oU())throw new oe(B.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Dr.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(A.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await Xt(this,De.NEED_ENABLE_TRACK,this),A.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(r){throw n||(this._enabled=!1),A.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await Xt(this,De.NEED_DISABLE_TRACK,this)}catch(r){throw n||(this._enabled=!0),A.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,A.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Xt(this,De.NEED_MUTE_TRACK,this):await Xt(this,De.NEED_UNMUTE_TRACK,this))}getStats(){return Yu(()=>{A.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),zs(this,De.GET_STATS)||fn({},$I)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(qs.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(qs.ON_AUDIO_BUFFER),this._source.on(qs.ON_AUDIO_BUFFER,n=>e(n))}play(){A.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(A.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Dr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){A.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Dr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];A.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Dr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Xt(this,De.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return we.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new oe(B.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new oe(B.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(mr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await Xt(this,De.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Xt(this,De.NEED_REPLACE_TRACK,this))}),e.on(mr.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(mr.ON_TRACK),e.removeAllListeners(mr.ON_NODE)}bindProcessorContextEvents(e){e.on(Ys.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(Ys.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof rO&&(this._trackSource=new gU(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new bU(this._source.context,this.getTrackId(),"local"),t=new CU(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(qs.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Dr.stop(this.getTrackId()),this._source.play()),Xt(this,De.NEED_REPLACE_MIXING_TRACK,this).then(()=>{A.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{A.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[DU],Object.getOwnPropertyDescriptor(yn.prototype,"setVolume"),yn.prototype),wt(yn.prototype,"setPlaybackDevice",[kU,LU],Object.getOwnPropertyDescriptor(yn.prototype,"setPlaybackDevice"),yn.prototype),wt(yn.prototype,"setEnabled",[xU,MU,UU],Object.getOwnPropertyDescriptor(yn.prototype,"setEnabled"),yn.prototype),wt(yn.prototype,"setMuted",[VU,FU,BU],Object.getOwnPropertyDescriptor(yn.prototype,"setMuted"),yn.prototype),wt(yn.prototype,"getStats",[jU],Object.getOwnPropertyDescriptor(yn.prototype,"getStats"),yn.prototype),wt(yn.prototype,"setAudioFrameCallback",[GU],Object.getOwnPropertyDescriptor(yn.prototype,"setAudioFrameCallback"),yn.prototype),wt(yn.prototype,"play",[WU,zU],Object.getOwnPropertyDescriptor(yn.prototype,"play"),yn.prototype),wt(yn.prototype,"stop",[HU,KU],Object.getOwnPropertyDescriptor(yn.prototype,"stop"),yn.prototype),wt(yn.prototype,"close",[qU],Object.getOwnPropertyDescriptor(yn.prototype,"close"),yn.prototype),wt(yn.prototype,"pipe",[YU],Object.getOwnPropertyDescriptor(yn.prototype,"pipe"),yn.prototype),wt(yn.prototype,"unpipe",[XU],Object.getOwnPropertyDescriptor(yn.prototype,"unpipe"),yn.prototype),yn),ZR=(JU=He({argsMap:(e,t)=>[e.getTrackId(),t]}),$U=Pn(),QU=Gm("MicrophoneAudioTrack","_enabledMutex"),ZU=He({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),eV=Pn(),tV=He({argsMap:e=>[e.getTrackId()]}),wt((bc=class extends bn{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,r){super(e,t.encoderConfig?XR(t.encoderConfig):{},r,G("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),ne(this,"_config",void 0),ne(this,"_deviceName","default"),ne(this,"_constraints",void 0),ne(this,"_originalConstraints",void 0),ne(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(Fm()||bI())&&Ft.bindInterruptDetectorTrack(this)}async setDevice(e){if(A.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await $s.getDeviceById(e),n={};n.audio=fn({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await Js(n,this.getTrackId())}catch(o){throw A.error("[".concat(this.getTrackId(),"] setDevice failed"),o.toString()),r=await Js({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw A.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await $s.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw A.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}A.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return A.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(A.info("[".concat(this.getTrackId(),"] start setEnabled"),e),G("AUTO_RESET_AUDIO_ROUTE")&&(fr()||Go())){const u=navigator.audioSession;u&&(e||(u.type="playback"),u.type="auto")}if(!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(r=this._source.clonedTrack)===null||r===void 0||r.stop(),n||(this._enabled=!1);try{await Xt(this,De.NEED_DISABLE_TRACK,this)}catch(u){throw A.error("[".concat(this.getTrackId(),"] setEnabled false failed"),u.toString()),u}return}const o=fn({},this._constraints),l=$s.searchDeviceIdByName(this._deviceName);l&&!o.deviceId&&(o.deviceId=l);try{n||(this._enabled=!0);const u=await Js({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(u.getAudioTracks()[0],!1),await Xt(this,De.NEED_ENABLE_TRACK,this)}catch(u){throw n||(this._enabled=!1),A.error("[".concat(this.getTrackId(),"] setEnabled true failed"),u.toString()),u}A.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Fm()||bI())&&Ft.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((fr()||Go())&&this._enabled&&!this._isClosed&&Ft.duringInterruption){const e=async()=>{Ft.off(Ri.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(A.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Ft.on(Ri.IOS_INTERRUPTION_END,e)}else A.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Ym.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=$s.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const r=await Js({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(Ys.REQUEST_UPDATE_CONSTRAINTS,async(t,n,r)=>{try{const o=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(o),n()}catch(o){r(o)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(Ys.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[JU,$U],Object.getOwnPropertyDescriptor(bc.prototype,"setDevice"),bc.prototype),wt(bc.prototype,"setEnabled",[QU,ZU,eV],Object.getOwnPropertyDescriptor(bc.prototype,"setEnabled"),bc.prototype),wt(bc.prototype,"close",[tV],Object.getOwnPropertyDescriptor(bc.prototype,"close"),bc.prototype),bc),P$=(nV=He({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),iV=Pn(),rV=He({argsMap:e=>[e.getTrackId()]}),sV=Pn(),oV=He({argsMap:e=>[e.getTrackId()]}),aV=Pn(),cV=He({argsMap:e=>[e.getTrackId()]}),lV=Pn(),uV=He({argsMap:e=>[e.getTrackId()]}),dV=Pn(),hV=He({argsMap:e=>[e.getTrackId()]}),pV=He({argsMap:e=>[e.getTrackId()]}),fV=Pn(),wt((Vi=class extends bn{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),ne(this,"source",void 0),ne(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(qs.AUDIO_SOURCE_STATE_CHANGE,o=>{this.safeEmit(Ym.SOURCE_STATE_CHANGE,o)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){jt(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[nV,iV],Object.getOwnPropertyDescriptor(Vi.prototype,"startProcessAudioBuffer"),Vi.prototype),wt(Vi.prototype,"pauseProcessAudioBuffer",[rV,sV],Object.getOwnPropertyDescriptor(Vi.prototype,"pauseProcessAudioBuffer"),Vi.prototype),wt(Vi.prototype,"seekAudioBuffer",[oV,aV],Object.getOwnPropertyDescriptor(Vi.prototype,"seekAudioBuffer"),Vi.prototype),wt(Vi.prototype,"resumeProcessAudioBuffer",[cV,lV],Object.getOwnPropertyDescriptor(Vi.prototype,"resumeProcessAudioBuffer"),Vi.prototype),wt(Vi.prototype,"stopProcessAudioBuffer",[uV,dV],Object.getOwnPropertyDescriptor(Vi.prototype,"stopProcessAudioBuffer"),Vi.prototype),wt(Vi.prototype,"close",[hV],Object.getOwnPropertyDescriptor(Vi.prototype,"close"),Vi.prototype),wt(Vi.prototype,"setAudioBufferPlaybackSpeed",[pV,fV],Object.getOwnPropertyDescriptor(Vi.prototype,"setAudioBufferPlaybackSpeed"),Vi.prototype),Vi);class $n extends bn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=Qm().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,Jt(8,"track-mix-")),ne(this,"trackList",void 0),ne(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(A.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):A.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){A.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}FR(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof $n?n.emit(qh.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class D$ extends mU{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(qs.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),ne(this,"audioBuffer",void 0),ne(this,"sourceNode",void 0),ne(this,"startPlayTime",0),ne(this,"startPlayOffset",0),ne(this,"pausePlayTime",0),ne(this,"options",void 0),ne(this,"currentLoopCount",0),ne(this,"currentPlaybackSpeed",100),ne(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):A.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const mV=new Map;class oO{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const t=this.renderStats.curTs-this.renderStats.lastTs,n=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/t;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,n}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(A.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(t){ne(this,"trackId",void 0),ne(this,"config",void 0),ne(this,"onFirstVideoFrameDecoded",void 0),ne(this,"onVideoStateChanged",void 0),ne(this,"freezeTimeCounterList",[]),ne(this,"renderFreezeAccTime",0),ne(this,"isKeepLastFrame",!1),ne(this,"timeUpdatedCount",0),ne(this,"freezeTime",0),ne(this,"playbackTime",0),ne(this,"lastTimeUpdatedTime",0),ne(this,"autoplayFailed",!1),ne(this,"videoTrack",void 0),ne(this,"videoElement",void 0),ne(this,"cacheVideoElement",void 0),ne(this,"renderStats",void 0),ne(this,"_videoState",Cc.VideoStateStopped),ne(this,"videoElementCheckInterval",void 0),ne(this,"videoElementFreezeTimeout",void 0),ne(this,"_videoElementStatus",rr.NONE),ne(this,"isGettingVideoDimensions",!1),ne(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return A.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),ne(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Ft.curState==="running"&&(A.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(g2())),R2()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),ne(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=rr.PLAYING;break;case"loadeddata":if(this.videoState=Cc.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=rr.CANPLAY;break;case"stalled":this.videoElementStatus=rr.STALLED;break;case"suspend":this.videoElementStatus=rr.SUSPEND;break;case"pause":this.videoElementStatus=rr.PAUSED,fr()||Go()||Li()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(A.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=rr.WAITING;break;case"abort":this.videoElementStatus=rr.ABORT;break;case"ended":this.videoElementStatus=rr.ENDED;break;case"emptied":this.videoElementStatus=rr.EMPTIED;break;case"error":{const r=this.videoElement.error;r&&(this.videoElementStatus=rr.ERROR,A.error("[".concat(this.trackId,"] media error: ").concat(r.message," (").concat(r.code,")")));break}case"timeupdate":{const r=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r);const o=r-this.lastTimeUpdatedTime,l=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r,Bl.lastVisibleTime<Bl.lastHiddenTime||l<Bl.lastHiddenTime||l<Bl.lastVisibleTime)return;for(o>G("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=o),this.playbackTime+=o;this.playbackTime>=6e3;){this.playbackTime-=6e3;const u=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(u),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),ne(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(A.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(g2())),R2()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Ft.on(Ri.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ft.on(Ri.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch(o=>{t&&TU(t,"video",o.message,this.trackId),o.name==="NotAllowedError"?(A.warning("detected video element autoplay failed",o),this.autoplayFailed=!0,this.handleAutoPlayFailed()):A.warning("[".concat(this.trackId,"] play warning: "),o)});const r=Tt();if((r.name==="Safari"&&Number(r.version)===15||Fm())&&n&&n.then){const o=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(o).catch(o)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return A.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const r=n.getImageData(0,0,t.width,t.height);return t.remove(),r}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const o=r.getContext("2d");return o?(o.drawImage(this.videoElement,0,0,r.width,r.height),new we((l,u)=>{r.toBlob(async h=>{if(r.remove(),h){const m=await PU(h);l({buffer:m,width:r.width,height:r.height})}else u(new oe(B.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,n<0?.1:n>1?1:n)})):await sO(t)}destroy(){this.renderStats=void 0,Ft.off(Ri.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ft.off(Ri.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Cc.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=rr.INIT,!this.videoElementCheckInterval&&(gV.forEach(l=>{this.videoElement.addEventListener(l,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(l){return l!==document.body&&document.body.contains(l)})(this.videoElement)||(this.videoElementStatus=rr.DESTROYED)},1e3),G("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let l;const u=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",u),this.videoElementFreezeTimeout=window.setTimeout(h,G("VIDEO_FREEZE_DURATION")))},h=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Cc.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Cc.VideoStateFrozen:document.addEventListener("visibilitychange",u))},m=(g,E)=>{if(this.videoElementStatus===rr.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=E.mediaTime):this.renderStats={lastTs:E.mediaTime,curTs:E.mediaTime,lastRenderNum:0,renderNum:0},l){const b=E.presentationTime-l.presentationTime;this.videoState===Cc.VideoStateStarting&&(this.videoState=Cc.VideoStateDecoding),this.videoState===Cc.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(h,G("VIDEO_FREEZE_DURATION"))),b<G("VIDEO_FREEZE_DURATION")&&this.videoState===Cc.VideoStateFrozen&&(this.videoState=Cc.VideoStateDecoding),b>G("VIDEO_FREEZE_DURATION")&&Bl.lastVisibleTime>=Bl.lastHiddenTime&&l.timestamp>Bl.lastVisibleTime&&l.timestamp>Bl.lastHiddenTime&&(this.renderFreezeAccTime+=b)}l=fn(fn({},E),{},{timestamp:g})}var S,R;G("ENABLE_VIDEO_FRAME_CALLBACK")&&((S=(R=this.videoElement).requestVideoFrameCallback)===null||S===void 0||S.call(R,m))};(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(n,m)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),VR()&&!G("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const r=Tt();r.name==="Safari"&&Number(r.version)===15||Fm()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,vn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,vn()&&this.videoElement.load());const o=this.videoElement.play();o!==void 0&&o.catch(l=>{A.debug("[".concat(this.trackId,"] playback interrupted"),l.toString())})}resetVideoElement(){gV.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=rr.NONE}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{A.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(r=>{A.error(r)}),this.autoplayFailed=!1,sy()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};sy()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),SU()}}const gV=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class _V extends oO{constructor(t){super(t),ne(this,"container",void 0),ne(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,r):await sO(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",G("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var EV,yV,vV,SV,TV,RV,wV,CV,bV,AV,IV,OV,NV,PV,DV,kV,LV,xV,MV,UV,VV,FV,BV,jV,yt,GV,WV,zV,HV,KV,qV,YV,XV,Zs;let an=(EV=He({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),yV=Pn(),vV=He({argsMap:e=>[e.getTrackId()]}),SV=Gm("LocalVideoTrack","_enabledMutex"),TV=He({argsMap:(e,t)=>[e.getTrackId(),t]}),RV=Pn(),wV=Gm("LocalVideoTrack","_enabledMutex"),CV=He({argsMap:(e,t)=>[e.getTrackId(),t]}),bV=Pn(),AV=He({argsMap:(e,t)=>[e.getTrackId(),t]}),IV=Pn(),OV=Pn(),NV=He({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),PV=Pn(),DV=Pn(),kV=Pn(),LV=Pn(),xV=Pn(),MV=Pn(),UV=Pn(),VV=He({argsMap:(e,t)=>[e.getTrackId(),t.name]}),FV=He({argsMap:e=>[e.getTrackId()]}),BV=He({argsMap:e=>[e.getTrackId()]}),jV=He({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),yt=class AH extends $m{get videoHeight(){if(Li()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Li()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==rr.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,r,o,l,u){if(super(t,l),ne(this,"trackMediaType",Jm.VIDEO),ne(this,"_player",void 0),ne(this,"isUseScaleResolutionDownBy",!1),ne(this,"_videoVisibleTimer",null),ne(this,"_previousVideoVisibleStatus",void 0),ne(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),ne(this,"_encoderConfig",void 0),ne(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),ne(this,"_optimizationMode",void 0),ne(this,"_videoHeight",void 0),ne(this,"_videoWidth",void 0),ne(this,"_forceBitrateLimit",void 0),ne(this,"_enabled",!0),ne(this,"_processorDestination",void 0),ne(this,"_processorContext",void 0),Li()){const{width:h,height:m}=t.getSettings();this._videoWidth=h,this._videoHeight=m}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=n,this._scalabilityMode=r,this._optimizationMode=o,this._hints=u||[],this._hints.indexOf($t.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(RI(Ot.CHROME,115)&&MR().indexOf("Windows")!==-1){const h=function(m,g){if("VideoFrame"in window&&"TransformStream"in window&&bt().supportWebRTCInsertableStream){const E=new MediaStreamTrackProcessor(m),S=new MediaStreamTrackGenerator({kind:"video"});let R,b,x=Date.now();const P=()=>{k&&(clearInterval(k),k=void 0),R&&(R.close(),R=void 0),m.stop(),b=void 0,S.removeEventListener("ended",P)};let k=window.setInterval(()=>{if(b&&R&&Date.now()-x>1e3)try{S.readyState==="live"?b.enqueue(R.clone()):P()}catch{P()}},1e3);const V=new TransformStream({transform:(F,K)=>{S.readyState==="live"?(b=K,x=Date.now(),R===void 0?(R=F,K.enqueue(F.clone())):(K.enqueue(R),R=F)):F.close()}});return S.addEventListener("ended",P),E.readable.pipeThrough(V).pipeTo(S.writable),S}}(t);h&&(A.info("local screen video track begin to inject frame"),this._mediaStreamTrack=h)}n&&this._hints.indexOf($t.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new wU(this.getTrackId(),"local"),this._processorDestination=new RU(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const o=document.getElementById(t);o?t=o:(A.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}A.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const r=fn(fn(fn({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(r):(t instanceof HTMLVideoElement?this._player=new oO(r):this._player=new _V(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(Ym.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},G("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,A.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(A.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await Xt(this,De.NEED_DISABLE_TRACK,this)}catch(r){throw A.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}return n||(this._enabled=!1),void A.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Xt(this,De.NEED_ENABLE_TRACK,this)}catch(r){throw A.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}A.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,A.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Xt(this,De.NEED_MUTE_TRACK,this):await Xt(this,De.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(t,n){if(!this._enabled)throw new oe(B.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=wc(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const r=QR({encoderConfig:t});(Li()||fr()||Go())&&(r.deviceId=void 0),A.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(o){const l=new oe(B.UNEXPECTED_ERROR,o.toString());throw A.error("[".concat(this.getTrackId(),"] applyConstraints error"),l.toString()),l}}this._encoderConfig=t,this._hints.indexOf($t.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Xt(this,De.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(A)}}getStats(){return Yu(()=>{A.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),zs(this,De.GET_STATS)||fn({},QI)}async setBeautyEffect(t){A.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await sO(t)}async setBitrateLimit(t){A.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void A.error(B.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await Xt(this,De.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(r){throw this._optimizationMode=n,A.error("[".concat(this.getTrackId(),"] set optimization mode failed"),r.toString()),r}A.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return A.error(B.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,A.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){AU(this._originMediaStreamTrack).then(t=>{let[n,r]=t;this._videoHeight=r,this._videoWidth=n}).catch(jR)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new oe(B.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");A.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=wc(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf($t.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Xt(this,De.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(A)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:r}=this.getMediaStreamTrackSettings();if(!t||!n||!r)return;const{bitrateMax:o,bitrateMin:l}=this._encoderConfig;if(l==null||o==null){const{max:u,min:h}=function(m,g,E,S,R){const b=G("BITRATE_ADAPTER_TYPE");if(b==="DEFAULT_BITRATE")return{min:S,max:R};if(R===void 0){var x;const k=Math.floor(200*Math.pow(E/15,.6)*Math.pow(m*g/640/360,.75));R=b==="STANDARD_BITRATE"?4*k:2*k,S=(x=S)!==null&&x!==void 0?x:k}else{var P;S=(P=S)!==null&&P!==void 0?P:Math.floor(R/10)}return{min:S,max:R}}(t,n,r,l,o);this._encoderConfig.bitrateMin=h,this._encoderConfig.bitrateMax=u,A.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(u,", brMin: ").concat(h,"]"))}}getVideoElementVisibleStatus(){try{var t,n;const r=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),o={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:r==null?void 0:r.parentElement},{element:l,slot:u}=o;if(this.isPlaying&&l instanceof HTMLVideoElement&&u instanceof HTMLElement){const h=I2.checkOneElementVisible(l),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const g=xe.reportApiInvoke(null,{tag:Tn.TRACER,name:Hn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?g.onSuccess("Video is visible"):g.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(r){throw new oe(B.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new oe(B.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=fn(fn({},r),wc(t))),r=Wh(r);const o=Jt(8,"track-video-cloned-"),l=new AH(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,Wh(this._scalabilityMode),this._optimizationMode,o,Wh(this._hints));return t&&r&&l.setEncoderConfiguration(r),A.debug("clone video track from ".concat(this.getTrackId()," to ").concat(o,", clone ").concat(n)),l}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new oe(B.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new oe(B.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Yu(()=>{xe.reportApiInvoke(null,{name:Hn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Tn.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!G("ENABLE_VIDEO_SEI")||!G("ENABLE_ENCODED_TRANSFORM"))return void A.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new oe(B.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void A.warning("Video track is not published, SEI can not be send");const r=n.sender.getParameters();if(r.codecs.length===0)return;const o=r.codecs[0].mimeType.toLocaleLowerCase();o==="video/h264"?this.safeEmit("sei-to-send",t):A.warning("SEI is not supported by ".concat(o))}bindProcessorDestinationEvents(){this.processorDestination.on(mr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await Xt(this,De.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Xt(this,De.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(mr.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Ys.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Ys.REQUEST_CONSTRAINTS)}},wt(yt.prototype,"play",[EV,yV],Object.getOwnPropertyDescriptor(yt.prototype,"play"),yt.prototype),wt(yt.prototype,"stop",[vV],Object.getOwnPropertyDescriptor(yt.prototype,"stop"),yt.prototype),wt(yt.prototype,"setEnabled",[SV,TV,RV],Object.getOwnPropertyDescriptor(yt.prototype,"setEnabled"),yt.prototype),wt(yt.prototype,"setMuted",[wV,CV,bV],Object.getOwnPropertyDescriptor(yt.prototype,"setMuted"),yt.prototype),wt(yt.prototype,"setEncoderConfiguration",[AV,IV],Object.getOwnPropertyDescriptor(yt.prototype,"setEncoderConfiguration"),yt.prototype),wt(yt.prototype,"getStats",[OV],Object.getOwnPropertyDescriptor(yt.prototype,"getStats"),yt.prototype),wt(yt.prototype,"setBeautyEffect",[NV,PV],Object.getOwnPropertyDescriptor(yt.prototype,"setBeautyEffect"),yt.prototype),wt(yt.prototype,"getCurrentFrameData",[DV],Object.getOwnPropertyDescriptor(yt.prototype,"getCurrentFrameData"),yt.prototype),wt(yt.prototype,"getCurrentFrameImage",[kV],Object.getOwnPropertyDescriptor(yt.prototype,"getCurrentFrameImage"),yt.prototype),wt(yt.prototype,"setBitrateLimit",[LV],Object.getOwnPropertyDescriptor(yt.prototype,"setBitrateLimit"),yt.prototype),wt(yt.prototype,"setOptimizationMode",[xV],Object.getOwnPropertyDescriptor(yt.prototype,"setOptimizationMode"),yt.prototype),wt(yt.prototype,"setScalabiltyMode",[MV],Object.getOwnPropertyDescriptor(yt.prototype,"setScalabiltyMode"),yt.prototype),wt(yt.prototype,"updateMediaStreamTrackResolution",[UV],Object.getOwnPropertyDescriptor(yt.prototype,"updateMediaStreamTrackResolution"),yt.prototype),wt(yt.prototype,"pipe",[VV],Object.getOwnPropertyDescriptor(yt.prototype,"pipe"),yt.prototype),wt(yt.prototype,"unpipe",[FV],Object.getOwnPropertyDescriptor(yt.prototype,"unpipe"),yt.prototype),wt(yt.prototype,"close",[BV],Object.getOwnPropertyDescriptor(yt.prototype,"close"),yt.prototype),wt(yt.prototype,"replaceTrack",[jV],Object.getOwnPropertyDescriptor(yt.prototype,"replaceTrack"),yt.prototype),yt),aO=(GV=He({argsMap:(e,t)=>[e.getTrackId(),t]}),WV=Pn(),zV=Gm("CameraVideoTrack","_enabledMutex"),HV=He({argsMap:(e,t)=>[e.getTrackId(),t]}),KV=Pn(),qV=He({argsMap:(e,t)=>[e.getTrackId(),t]}),YV=Pn(),XV=He({argsMap:e=>[e.getTrackId()]}),Zs=class IH extends an{get __className__(){return"CameraVideoTrack"}constructor(t,n,r,o,l,u){super(t,wc(n.encoderConfig),o,l,u),ne(this,"_config",void 0),ne(this,"_originalConstraints",void 0),ne(this,"_constraints",void 0),ne(this,"_enabled",!0),ne(this,"_deviceName","default"),ne(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Fm()||bI())&&!function(){const h=Tt();if(h.os!==oi.IOS||!h.osVersion)return!1;const m=h.osVersion.split(".");return Number(m[0])===15&&Number(m[1])>=2}()&&w2()&&this._enabled&&!this._isClosed&&(A.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=r,this._constraints=r,this._deviceName=t.label,this._encoderConfig=wc(this._config.encoderConfig),Ft.on(Ri.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Ft.on(Ri.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(A.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const n=await $s.getDeviceById(t),r={};r.video=fn({},this._constraints),r.video.deviceId={exact:t},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let o=null;try{o=await Js(r,this.getTrackId())}catch(l){throw A.error("[".concat(this.getTrackId(),"] setDevice failed"),l.toString()),o=await Js({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),l}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw A.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await $s.getDeviceById(t);this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw A.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}A.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){A.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const n={video:fn(fn({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let r=null;try{r=await Js(n,this.getTrackId())}catch(o){throw A.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),o.toString()),r=await Js({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=fn({},n.video),A.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(A.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const r=await Js({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1)}await Xt(this,De.NEED_ENABLE_TRACK,this)}catch(r){throw A.error("[".concat(this.getTrackId(),"] setEnabled true error"),r.toString()),r}this.updateMediaStreamTrackResolution(),A.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await Xt(this,De.NEED_DISABLE_TRACK,this)}catch(r){throw A.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}A.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new oe(B.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=wc(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const r=Rn(this._config);r.encoderConfig=t;const o=QR(r);(Li()||fr()||Go())&&(o.deviceId=void 0),A.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(l){const u=new oe(B.UNEXPECTED_ERROR,l.toString());throw A.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}this._config=r,this._constraints=o,this._originalConstraints=o,this._encoderConfig=t,this._hints.indexOf($t.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Xt(this,De.NEED_UPDATE_VIDEO_ENCODER,this)}catch(l){return l.throw(A)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((fr()||Go())&&this._enabled&&!this._isClosed&&Ft.duringInterruption){const t=async()=>{Ft.off(Ri.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(A.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Ft.on(Ri.IOS_INTERRUPTION_END,t)}else A.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Ym.TRACK_ENDED)}async renewMediaStreamTrack(t){const n=t||this._constraints,r=$s.searchDeviceIdByName(this._deviceName);if(r&&!n.deviceId&&(n.deviceId={exact:r}),this._enabled){const o=await Js({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Ft.off(Ri.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Ft.off(Ri.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=fn(fn({},r),wc(t))),r=Wh(r);const o=Jt(8,"track-cam-cloned-"),l=new IH(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,Wh(fn(fn({},this._config),{},{encoderConfig:r})),Wh(this._constraints),Wh(this._scalabilityMode),this._optimizationMode,o);return t&&r&&l.setEncoderConfiguration(r),A.debug("clone track from ".concat(this.getTrackId()," to ").concat(o,", clone ").concat(n)),l}bindProcessorContextEvents(){this.processorContext.on(Ys.REQUEST_UPDATE_CONSTRAINTS,async(t,n,r)=>{try{const o=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(o),n()}catch(o){r(o)}}),this.processorContext.on(Ys.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},wt(Zs.prototype,"setDevice",[GV,WV],Object.getOwnPropertyDescriptor(Zs.prototype,"setDevice"),Zs.prototype),wt(Zs.prototype,"setEnabled",[zV,HV,KV],Object.getOwnPropertyDescriptor(Zs.prototype,"setEnabled"),Zs.prototype),wt(Zs.prototype,"setEncoderConfiguration",[qV,YV],Object.getOwnPropertyDescriptor(Zs.prototype,"setEncoderConfiguration"),Zs.prototype),wt(Zs.prototype,"close",[XV],Object.getOwnPropertyDescriptor(Zs.prototype,"close"),Zs.prototype),Zs);function cO(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=fn(fn({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?A.debug("[".concat(e,"] set content hint to"),n.optimizationMode):A.debug("[".concat(e,"] set content hint failed")))):A.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var JV,$V,QV,ZV,_o,eF,tF,nF,iF,rF,sF,sr;class oF extends hU{getUserId(){return this._userId}constructor(t,n,r,o){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(o.clientId,"_").concat(Jt(5,""))),ne(this,"_userId",void 0),ne(this,"_uintId",void 0),ne(this,"_isDestroyed",!1),ne(this,"store",void 0),ne(this,"processor",void 0),ne(this,"processorContext",void 0),this._userId=n,this._uintId=r,this.store=o}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,A.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let eg=(JV=He({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),$V=He({argsMap:e=>[e.getTrackId()]}),QV=He({argsMap:(e,t)=>[e.getTrackId(),t.name]}),ZV=He({argsMap:e=>[e.getTrackId()]}),wt((_o=class extends oF{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==rr.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r){super(e,t,n,r),ne(this,"_videoVisibleTimer",null),ne(this,"_previousVideoVisibleStatus",void 0),ne(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),ne(this,"trackMediaType",Jm.VIDEO),ne(this,"_videoWidth",void 0),ne(this,"_videoHeight",void 0),ne(this,"_player",void 0),ne(this,"processorDestination",void 0),ne(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new wU(this.getTrackId(),"remote"),this.processorDestination=new RU(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Yu(()=>{A.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),zs(this,De.GET_STATS)||fn({},uU)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const r=document.getElementById(e);r?e=r:(A.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}A.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=fn(fn({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new oO(n):this._player=new _V(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Xm.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=r=>{this.safeEmit(Xm.VIDEO_STATE_CHANGED,r)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(Xm.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},G("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,A.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){AU(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(jR)}_updatePlayerSource(){A.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:o,slot:l}=r;if(this.isPlaying&&o instanceof HTMLVideoElement&&l instanceof HTMLElement){const u=I2.checkOneElementVisible(o),h=Object.assign({},u);if(h.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=h.visible;const m=xe.reportApiInvoke(null,{tag:Tn.TRACER,name:Hn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});h.visible?m.onSuccess("Video is visible"):m.onSuccess("Invisible because of ".concat(h.reason))}return h}return}catch(n){throw new oe(B.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new oe(B.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(mr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(mr.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(qh.SEI_RECEIVED,e)}}).prototype,"play",[JV],Object.getOwnPropertyDescriptor(_o.prototype,"play"),_o.prototype),wt(_o.prototype,"stop",[$V],Object.getOwnPropertyDescriptor(_o.prototype,"stop"),_o.prototype),wt(_o.prototype,"pipe",[QV],Object.getOwnPropertyDescriptor(_o.prototype,"pipe"),_o.prototype),wt(_o.prototype,"unpipe",[ZV],Object.getOwnPropertyDescriptor(_o.prototype,"unpipe"),_o.prototype),_o),tg=(eF=He({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),tF=He({argsMap:(e,t)=>[e.getTrackId(),t]}),nF=He({argsMap:e=>[e.getTrackId()]}),iF=He({argsMap:e=>[e.getTrackId()]}),rF=He({argsMap:(e,t)=>[e.getTrackId(),t.name]}),sF=He({argsMap:e=>[e.getTrackId()]}),wt((sr=class extends oF{get isPlaying(){return this._useAudioElement?Dr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),ne(this,"trackMediaType",Jm.AUDIO),ne(this,"_source",void 0),ne(this,"_useAudioElement",!0),ne(this,"_volume",100),ne(this,"processorContext",void 0),ne(this,"processorDestination",void 0),ne(this,"_played",!1),ne(this,"_bypassWebAudio",!1),G("DISABLE_WEBAUDIO")?(this._source=new rO,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new gU(e,!0),G("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(qs.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Xm.FIRST_FRAME_DECODED)}),this.processorContext=new bU(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new CU(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(qs.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(qs.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(qs.ON_AUDIO_BUFFER),this._source.on(qs.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?Dr.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!oU())throw new oe(B.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Dr.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Yu(()=>{A.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),zs(this,De.GET_STATS)||fn({},lU)}play(){A.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(A.debug("[".concat(this.getTrackId(),"] use audio element to play")),Dr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){A.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Dr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];A.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Dr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new oe(B.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new oe(B.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new oe(B.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(mr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(mr.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(mr.ON_TRACK),this.processorDestination.removeAllListeners(mr.ON_NODE)}}).prototype,"setVolume",[eF],Object.getOwnPropertyDescriptor(sr.prototype,"setVolume"),sr.prototype),wt(sr.prototype,"setPlaybackDevice",[tF],Object.getOwnPropertyDescriptor(sr.prototype,"setPlaybackDevice"),sr.prototype),wt(sr.prototype,"play",[nF],Object.getOwnPropertyDescriptor(sr.prototype,"play"),sr.prototype),wt(sr.prototype,"stop",[iF],Object.getOwnPropertyDescriptor(sr.prototype,"stop"),sr.prototype),wt(sr.prototype,"pipe",[rF],Object.getOwnPropertyDescriptor(sr.prototype,"pipe"),sr.prototype),wt(sr.prototype,"unpipe",[sF],Object.getOwnPropertyDescriptor(sr.prototype,"unpipe"),sr.prototype),sr);const Bl=new class extends En{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),ne(this,"_lastHiddenTime",0),ne(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),A.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class aF extends En{constructor(t,n){super(),ne(this,"trackMediaType",Jm.DATA),ne(this,"_version",1),ne(this,"_type",3),ne(this,"_config",void 0),ne(this,"_originDataChannel",void 0),ne(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),ne(this,"_dataStreamPacketHandler",{serialize:r=>r,deserialize:r=>r}),ne(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return G("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new we((t,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const r=setTimeout(()=>{var o;n(new oe(B.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((o=this._originDataChannel)===null||o===void 0?void 0:o.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(r),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(r),new oe(B.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new oe(B.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[JR.OPEN,JR.CLOSE,JR.ERROR].forEach(n=>{const r=()=>{this.emit(n)};this._datachannelEventMap.set(n,r),t.addEventListener(n,r)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[r,o]=n;t.removeEventListener(r,o)}),this._datachannelEventMap.clear()}}class k$ extends aF{constructor(t){super(t),ne(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const r=n.data.slice(0,this._dataStreamPacketHeader.byteLength),o=new DataView(r).getUint8(3);if(o!==this.id)return void(G("SHOW_DATASTREAM2_LOG")&&A.debug("invalid datachannel id: ".concat(o," !== ").concat(this.id)));let l=n.data.slice(this._dataStreamPacketHeader.byteLength);l=this._dataStreamPacketHandler.deserialize(l),this.emit(JR.MESSAGE,l)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class L$ extends aF{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);const r=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);r.set(new Uint8Array(this._dataStreamPacketHeader),0),r.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r.buffer)}}}function ew(){const e=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>eR.revokeObjectURL(e),0),new Worker(eR.createObjectURL(e))}const cF=71,lO=1,uO=2,dO=1,lF=2;var jl=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(jl||{});function uF(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=e.getUint8(0);if(n!==cF)return;const r=e.getUint16(1),o=lO+uO+r,l=new Uint8Array(e.byteLength-o);l.set(new Uint8Array(e.buffer,o,e.byteLength-o));const u={m:n,tlvLen:r,tlv:[],frame:l};let h=lO+uO;for(;h<o;){const m=e.getUint8(h),g=e.getUint16(h+dO),E=dO+lF;if(m===jl.AUDIO_LEVEL){let S=e.getUint8(h+E);for(let R=1;R<g;R++)S=S<<8|e.getUint8(h+E+R);u.tlv.push({tag:m,length:g,value:t?127^S>>1:127&S})}else if(m===jl.METADATA||m===jl.AUDIO_64_BIT_PTS){const S=new Uint8Array(g);for(let R=0;R<g;R++)S[R]=e.getUint8(h+E+R);u.tlv.push({tag:m,length:g,value:S})}h+=E+g}return u}const tw=new Map,nw=127,Jh=1e-10,hO=139/13,iw=new Map;function pO(e,t,n){const r="".concat(e,"-").concat(t,"-").concat(n);let o=0;return iw.has(r)?o=iw.get(r):(o=Math.log(function(u,h){const m=u-h;h<m&&(h=m);let g=1;for(let E=u,S=1;E>h;E--,S++)g=g*E/S;return g}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(n)+n*e,iw.set(r,o)),o<Jh&&(o=Jh),o}function dF(e,t,n){const r=t.length,o=e.length/r;let l=!1;for(let u=0,h=0;u<r;u++){let m=0;for(let g=h+o;h<g;h++)e[h]>n&&m++;t[u]!==m&&(t[u]=m,l=!0)}return l}window.cache=iw;let x$=0;class hF{constructor(t){ne(this,"id",void 0),ne(this,"immediates",[]),ne(this,"lastNonSilence",-1),ne(this,"immediateSpeechActivityScore",Jh),ne(this,"lastLevelChangedTime",Date.now()),ne(this,"levels",[]),ne(this,"longs",[]),ne(this,"longSpeechActivityScore",Jh),ne(this,"mediums",[]),ne(this,"mediumSpeechActivityScore",Jh),ne(this,"minLevel",0),ne(this,"nextMinLevel",0),ne(this,"nextMinLevelWindowLength",0),ne(this,"energyScore",0),this.id=t||"".concat(x$++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,n=this.levels,r=this.minLevel+hO;let o=!1;for(let l=0;l<t.length;++l){let u=n[l];u<r&&(u=0);const h=Math.floor(u/hO);t[l]!==h&&(t[l]=h,o=!0)}return o}computeLongs(){return dF(this.mediums,this.longs,4)}computeMediums(){return dF(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=pO(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=pO(this.longs[0],10,47),this.longSpeechActivityScore>Jh&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=pO(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(Su(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let r=t;return t<0&&(r=0),t>nw&&(r=nw),this.levels.unshift(r),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(r),r>=this.minLevel+hO?r:r/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>nw&&(n=nw),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class M${constructor(t){ne(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?t=!0:setTimeout(this.execute.bind(this),n)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class fO{constructor(t,n,r){ne(this,"isDominant",void 0),ne(this,"energyRanking",void 0),ne(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=n,this.energyScore=r}}class U$ extends En{constructor(t){super(),ne(this,"dominantId",null),ne(this,"lastDecisionTime",0),ne(this,"lastLevelChangedTime",0),ne(this,"lastLevelIdleTime",0),ne(this,"relativeSpeechActivities",[]),ne(this,"speakers",new Map),ne(this,"enableSilence",!1),ne(this,"timeoutToSilenceInterval",0),ne(this,"decisionMaker",null),ne(this,"loudest",[]),ne(this,"numLoudestToTrack",3),ne(this,"energyExpireTimeMs",250),ne(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,n!=null&&(this.energyExpireTimeMs=n),r!=null&&(this.energyAlphaPct=r),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(n=>n.id===t)}levelChanged(t,n){const r=Date.now(),o=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<r&&(this.lastLevelChangedTime=r,this.maybeStartDecisionMaker());const l=o.levelChanged(n,r);return this.updateLoudestList(o,l,r)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(t){t.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(t){let n=this.speakers.get(t);return n||(n=new hF(t),this.speakers.set(t,n),this.maybeStartDecisionMaker()),n}updateLoudestList(t,n,r){const o=t.id===this.dominantId;if(n<0){let m=0;for(;m<this.loudest.length&&this.loudest[m]!==t;)++m;return new fO(o,m,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new fO(o,0,t.energyScore);const l=r-this.energyExpireTimeMs;let u=0;for(;u<this.loudest.length;){const m=this.loudest[u];if(m.getLastLevelChangedTime()<l&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(u,1);else if(m.id!==t.id)++u;else if(this.loudest.splice(u,1),this.loudest.length<this.numLoudestToTrack)break}let h=0;for(;h<this.loudest.length&&!(this.loudest[h].energyScore<t.energyScore);)++h;return h<this.numLoudestToTrack&&(this.loudest.splice(h,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new fO(o,h,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new M$(this),this.decisionMaker.execute())}makeDecision(t){let n=null,r=null;const o=this.speakers.size;let l=null;if(o===0)l=null;else if(o===1){var u;const h=Gs(u=this.speakers).call(u).next().value;this.enableSilence&&h&&(l=h.id,h.evaluateSpeechActivityScores(t),t-h.lastNonSilence>this.timeoutToSilenceInterval&&(l=null))}else{let h=this.dominantId==null?null:this.speakers.get(this.dominantId);if(h==null){const E=this.speakers.entries().next();E.value&&(l=E.value[0],h=E.value[1])}else l=h.id;h!=null&&h.evaluateSpeechActivityScores(t);const m=this.relativeSpeechActivities;let g=2;for(const E of this.speakers.entries()){const[S,R]=E;if(R===h)continue;R.evaluateSpeechActivityScores(t);for(let k=0;k<m.length;++k){const V=h==null?Jh:h.getSpeechActivityScore(k);m[k]=Math.log(R.getSpeechActivityScore(k)/V)}const b=m[0],x=m[1],P=m[2];b>3&&x>2&&P>0&&x>g&&(g=x,l=S)}this.enableSilence&&h!=null&&l===h.id&&t-h.lastNonSilence>this.timeoutToSilenceInterval&&(l=null)}l==null&&!this.enableSilence||l===this.dominantId||(n=this.dominantId,this.dominantId=l,r=this.dominantId),r==null&&!this.enableSilence||r===n||this.emit("ActiveSpeakerChanged",r)}_runInDecisionMaker(){const t=Date.now(),n=300-(t-this.lastLevelIdleTime);let r=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):r=n;let o=300-(t-this.lastDecisionTime);return o<=0&&(this.lastDecisionTime=t,this.makeDecision(t),o=300-(Date.now()-t)),o>0&&r>o&&(r=o),r}timeoutIdleLevels(t){const n=[];for(const o of Gs(r=this.speakers).call(r)){var r;const l=t-o.getLastLevelChangedTime();36e5<l&&(this.dominantId==null||o.id!==this.dominantId)?n.push(o.id):300<l&&o.levelTimedOut()}n.forEach(o=>this.speakers.delete(o))}}const ng=new Map;let Da=null,rw=null;const pF=3;let $h=[];const ka=new Map,sw=new Map;class V${get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,n){ne(this,"id",void 0),ne(this,"track",void 0),ne(this,"score",0),ne(this,"active",!0),ne(this,"muted",!1),ne(this,"timer",0),ne(this,"actives",0),ne(this,"inactives",0),this.id=t,this.track=n,this.setActive(ka.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:r}=function(){const o=[],l=[];return Array.from(Gs(ka).call(ka)).forEach(u=>{u.active?o.push(u):l.push(u)}),{actives:o,inactives:l}}();if(n.length>3){let o;n.forEach(l=>{(!o||o.score>l.score)&&(o=l)}),o&&o.setActive(!1)}if(n.length<3&&r.length>0){let o;r.forEach(l=>{(!o||o.score<l.score)&&l.id!==this.id&&(o=l)}),o&&t&&!this.active&&(o.samples>40&&o.activeRate-this.activeRate>.4?o.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=function(n){let r;return Array.from(Gs(ka).call(ka)).forEach(o=>{!o.active||o.id===n||o.samples<40||(!r||o.score<r.score)&&(r=o)}),r}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=function(n){let r;return Array.from(Gs(ka).call(ka)).forEach(o=>{o.active||o.id===n||o.samples<40||(!r||o.score>r.score)&&(r=o)}),r}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let ow;function fF(e){const t=ka.get(e);t&&(ka.delete(e),t.clearTimer())}const aw=new Map,F$=new Map;function B$(e,t,n){let r=new Uint8Array(e,t,n),o=[],l=0;for(;o.length<n;)l+3<n&&r[l]===0&&r[l+1]===0&&r[l+2]===3&&(r[l+3]===0||r[l+3]===1||r[l+3]===2||r[l+3]===3)?(o.push(r[l],r[l+1],r[l+3]),l+=4):(o.push(r[l]),l++);return new Uint8Array(o)}const cw=new Map,my=new Map;(function(){const e=Tt();Ti.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Ti.getStreamFromExtension=e.name===Ot.CHROME&&Number(e.version)>34,Ti.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),Ti.supportMinBitrate=e.name===Ot.CHROME||e.name===Ot.EDGE,Ti.supportSetRtpSenderParameters=function(){const t=Tt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Ul()||!(!Li()&&!UR())||t.name===Ot.FIREFOX&&Number(t.version)>=64)}(),e.name===Ot.SAFARI&&(Number(e.version)>=14?Ti.supportDualStream=!0:Ti.supportDualStream=!1),Ti.webAudioMediaStreamDest=function(){const t=Tt();return!(t.name===Ot.SAFARI&&Number(t.version)<12)}(),Ti.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Ti.supportWebGL=typeof WebGLRenderingContext<"u",Ti.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Ul()||(Ti.webAudioWithAEC=!0),Ti.supportShareAudio=function(){const t=Tt();return(t.os===oi.WIN_10||t.os===oi.WIN_81||t.os===oi.WIN_7||t.os===oi.LINUX||t.os===oi.MAC_OS||t.os===oi.CHROMIUM_OS)&&t.name===Ot.CHROME&&Number(t.version)>=74}(),Ti.supportDataChannel=!!(ry(76)||function(t){const n=Tt();return!(n.name!==Ot.FIREFOX||!n.osVersion)&&Number(n.version)>=t}(68)||y2(14)),Ti.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!vn()&&!!t&&t.prototype.setConfiguration instanceof Function}(),Ti.supportWebRTCEncodedTransform=function(){const t=Tt();return t.name==="Chrome"&&Number(t.version)>=87||t.name==="Safari"&&Number(t.version)>=15}(),Ti.supportWebRTCInsertableStream=function(){const t=Tt();return(t.name===Ot.CHROME||t.name===Ot.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Ti.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Ti.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,BR(()=>{Ti.supportDualStreamEncoding=function(){const t=Tt();return!!G("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&G("CHROME_DUAL_STREAM_USE_ENCODING"))}(),A.debug("browser ua: ",navigator.userAgent),A.info("browser info: ",e),A.info("browser compatibility: ",Ti)})})();const j$=["CHINA","GLOBAL"],mF=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Qh=[],ig=[];function Zh(e,t){return!!t&&Qh.some(n=>n.uid===e&&n.channelName===t)}function mO(){return ig.length>0}var G$=Ux.forEach,gF=dl("forEach")?[].forEach:function(e){return G$(this,e,arguments.length>1?arguments[1]:void 0)};xt({target:"Array",proto:!0,forced:[].forEach!=gF},{forEach:gF});var W$=fs("Array").forEach,z$=Ps,H$=yi,K$=j,q$=W$,gO=Array.prototype,Y$={DOMTokenList:!0,NodeList:!0},X$=function(e){var t=e.forEach;return e===gO||K$(gO,e)&&t===gO.forEach||H$(Y$,z$(e))?q$:t},J$=p(X$),$$=bo,_F=Ls;xt({target:"Object",stat:!0,forced:_(function(){_F(1)})},{keys:function(e){return _F($$(e))}});var EF=p(Rr.Object.keys),Q$=p(pf),Z$=p(mf),eQ=xt,yF=ih,tQ=bh,nQ=ji,vF=uf,iQ=ua,rQ=ca,sQ=GT,oQ=_n,aQ=Ni,cQ=Ax("slice"),lQ=oQ("species"),_O=Array,uQ=Math.max;eQ({target:"Array",proto:!0,forced:!cQ},{slice:function(e,t){var n,r,o,l=rQ(this),u=iQ(l),h=vF(e,u),m=vF(t===void 0?u:t,u);if(yF(l)&&(n=l.constructor,(tQ(n)&&(n===_O||yF(n.prototype))||nQ(n)&&(n=n[lQ])===null)&&(n=void 0),n===_O||n===void 0))return aQ(l,h,m);for(r=new(n===void 0?_O:n)(uQ(m-h,0)),o=0;h<m;h++,o++)h in l&&sQ(r,o,l[h]);return r.length=o,r}});var dQ=fs("Array").slice,hQ=j,pQ=dQ,EO=Array.prototype,fQ=function(e){var t=e.slice;return e===EO||hQ(EO,e)&&t===EO.slice?pQ:t},mQ=p(fQ);function ke(e,t,n,r,o){var l,u,h,m={};return J$(l=EF(r)).call(l,function(g){m[g]=r[g]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=Q$(u=Z$(h=mQ(n).call(n)).call(h)).call(u,function(g,E){return E(e,t,g)||g},m),o&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(o):void 0,m.initializer=void 0),m.initializer===void 0&&(Rx(e,t,m),m=null),m}let lw=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),yO=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Ho=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),gr=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),We=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),Zt=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Je=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),Ye=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),gy=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),mt=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),_r=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),it=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function uw(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw A.error("Invalid Channel Name ".concat(e)),new ie(B.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function dw(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||A2(e,1,255)))throw new ie(B.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&A.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Gl=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const gQ={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},vO={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function SO(e,t){vi(e.url,"".concat(t,".url"),1,1e3,!1),Sn(e.x)||jt(e.x,"".concat(t,".x"),0,1e4),Sn(e.y)||jt(e.y,"".concat(t,".y"),0,1e4),Sn(e.width)||jt(e.width,"".concat(t,".width"),0,1e4),Sn(e.height)||jt(e.height,"".concat(t,".height"),0,1e4),Sn(e.zOrder)||jt(e.zOrder,"".concat(t,".zOrder"),0,255),Sn(e.alpha)||jt(e.alpha,"".concat(t,".alpha"),0,1,!1)}const _Q={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let $u=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),TO=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Qn=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function SF(e){if(!e.channelName)throw new ie(B.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new ie(B.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&vi(e.token,"info.token",1,2047),dw(e.uid),uw(e.channelName),!0}let Er=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Wl=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Zr=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),rg=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Mt=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),fi=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),hw=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),ci=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),Nt=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const TF=[Nt.AFRICA,Nt.ASIA,Nt.CHINA,Nt.EUROPE,Nt.GLOBAL,Nt.INDIA,Nt.JAPAN,Nt.NORTH_AMERICA,Nt.OCEANIA,Nt.OVERSEA,Nt.SOUTH_AMERICA];let Wi=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const pw={CHINA:{},ASIA:{CODE:Wi.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Wi.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Wi.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Wi.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Wi.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Wi.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Wi.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Wi.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Wi.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Wi.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Wi.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Wi.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Wi.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};WI&&(pw.CHINA={CODE:Wi.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let _y=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function RF(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class wF extends En{constructor(t,n){super(),U(this,"onICEConnectionStateChange",void 0),U(this,"onConnectionStateChange",void 0),U(this,"onDTLSTransportStateChange",void 0),U(this,"onDTLSTransportError",void 0),U(this,"onICETransportStateChange",void 0),U(this,"onFirstAudioReceived",void 0),U(this,"onFirstVideoReceived",void 0),U(this,"onFirstAudioDecoded",void 0),U(this,"onFirstVideoDecoded",void 0),U(this,"onFirstVideoDecodedTimeout",void 0),U(this,"onSelectedLocalCandidateChanged",void 0),U(this,"onSelectedRemoteCandidateChanged",void 0),U(this,"onICECandidateError",void 0),U(this,"getLocalVideoStats",void 0)}}class CF extends wF{constructor(t,n){super(t,n),U(this,"establishPromise",void 0)}}let Pe=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),zi=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),zl=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const bF=["disconnected","failed"];let he=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Lt=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),je=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),Ko=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),qo=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),mi=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),AF=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),Ac=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),Eo=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),La=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),sg=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Dn=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),og=function(e){return e.ABORT="abort",e}({}),Qu=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),EQ=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const yQ={[lw.ACCESS_POINT]:{[gr.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[gr.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[gr.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[gr.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[gr.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[gr.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[gr.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[gr.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[gr.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[gr.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[gr.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[gr.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[gr.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[gr.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[gr.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[gr.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[gr.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[gr.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[lw.UNILBS]:{[Ho.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Ho.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Ho.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Ho.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Ho.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Ho.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Ho.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Ho.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Ho.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Ho.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Ho.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Ho.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[lw.STRING_UID_ALLOCATOR]:{[yO.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[yO.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[yO.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function ag(e){const t=yQ[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===lw.ACCESS_POINT){const r=e%1e4;if(r.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(r.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const vQ={[We.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[We.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[We.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[We.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[We.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[We.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[We.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[We.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[We.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[We.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[We.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[We.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[We.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[We.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[We.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[We.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[We.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[We.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[We.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[We.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[We.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[We.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[We.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[We.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[We.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[We.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[We.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[We.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[We.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[We.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[We.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[We.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[We.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[We.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[We.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[We.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[We.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[We.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[We.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[We.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[We.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[We.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[We.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[We.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[We.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[We.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[We.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[We.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[We.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[We.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[We.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[We.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[We.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[We.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[We.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[We.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[We.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[We.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[We.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[We.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[We.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[We.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[We.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[We.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Ey(e){return vQ[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function IF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function RO(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?IF(Object(n),!0).forEach(function(r){U(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):IF(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function OF(e,t){if(typeof e=="string")return e;const{proxy:n,host:r,port:o}=e;if(t){const l=G("JOIN_GATEWAY_FALLBACK_PORT")||443;return l===443?"wss://".concat(r,"/ws/?p=").concat(Number(o)+150):"wss://".concat(r,":").concat(l,"/ws/?p=").concat(Number(o)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(o):"wss://".concat(r,":").concat(o)}const SQ=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,TQ=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,RQ=/wss:\/\/(.+):([0-9]+)\/?/,wQ=/wss:\/\/(.[^\/]+)\/?/;let CQ=0;class bQ{constructor(t,n){U(this,"id",0),U(this,"store",void 0),U(this,"recordIndex",void 0),U(this,"websockets",[]),U(this,"try443PortDuration",2e3),U(this,"forceCloseWSDuration",5e3),U(this,"try443PortTimeout",null),U(this,"forceCloseTimeout",null),U(this,"isTry443PortFailed",!1),U(this,"isNormalPortFailed",!1),U(this,"useDoubleDomain",!1),U(this,"useProxy",!1),U(this,"startTime",Date.now()),this.id=++CQ,this.try443PortDuration=G("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const n=Date.now()-this.startTime;for(var r=arguments.length,o=new Array(r),l=0;l<r;l++)o[l]=arguments[l];A.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...o)}createWebSocket(t,n,r){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:r});const o=G("GATEWAY_DOMAINS"),l=Date.now(),u=[],h=o.find(R=>{var b;return Te(b=t.host).call(b,R)});h||(this.useDoubleDomain=!1);const m=[];if(this.useDoubleDomain)o.forEach(R=>{m.push(OF(RO(RO({},t),{},{host:t.host.replace(h,R)}),n))});else{const R=RO({},t);if(n&&h){const b=o.find(x=>x!==h);b&&(R.host=R.host.replace(h,b))}m.push(OF(R,n))}try{m.forEach(R=>{const b=new WebSocket(R);b.binaryType="arraybuffer",u.push(b),this.logger("ws is connecting:",b.url)})}catch(R){if(this.logger("ws create failed"),u.forEach(b=>b.close()),u.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,r);if(!n&&Number(t.port)!==443)return this.createWebSocket(t,!0,r);throw new ie(B.WS_ERR,"init websocket failed! Error: ".concat(R.toString()))}const g=iy();this.store&&this.store.recordJoinChannelService({urls:u.map(R=>R.url),service:"gateway"},this.recordIndex),u.forEach(R=>{R.onopen=()=>{this.logger("onopen: ws ".concat(R.url," open cost ").concat(Date.now()-l,"ms")),this.websockets.forEach(b=>{b!==R&&(b.onopen=null,b.onclose=null,b.onmessage=null,b.close(),this.logger("close backup websocket: ".concat(b.url)))}),this.websockets.length=0,g.resolve(R)},R.onclose=b=>{this.logger("onclose: ws ".concat(R.url," closed cost ").concat(Date.now()-l,"ms state: ").concat(R.readyState));const x=u.every(P=>P.readyState===WebSocket.CLOSED||P.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(x)),x&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(b.reason)),g.reject({code:b.code,reason:hw.A_ROUND_WS_FAILED})):!n&&x&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),S()),n?this.isTry443PortFailed=x:this.isNormalPortFailed=x},R.onmessage=b=>this.logger("".concat(R.url," onmessage: ").concat(b.data))}),this.websockets.push(...u);const E=()=>{this.websockets.forEach(R=>R.readyState!==WebSocket.OPEN&&R.close())},S=()=>{if(g.isResolved)return E();Tt().os===oi.MAC_OS&&vn()&&E(),this.createWebSocket(t,!0,!0).then(R=>{g.resolve(R)}).catch(R=>{this.isNormalPortFailed&&g.reject(R),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",g.isResolved),this.forceCloseTimeout=null,E()},this.forceCloseWSDuration)};return r||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,E()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",g.isResolved),this.try443PortTimeout=null,S()},this.try443PortDuration)})(),g.promise}chooseBestWebsocket(t,n,r,o){return this.useDoubleDomain=!!n,typeof t=="string"&&(t=function(l){let u,h,m;return[,u,h,m]=l.match(SQ)||[],u||([,h,m]=l.match(TQ)||[]),h&&m||([,h,m]=l.match(RQ)||[]),h&&m||([,h]=l.match(wQ)||[]),h||A.warning("un-destructible url: ",l),{proxy:u,host:h,port:m||"443"}}(t)),this.recordIndex=o,this.useProxy=!!t.proxy,r&&this.useProxy&&(A.warn("cannot use 443 only when use proxy"),r=!1),this.createWebSocket(t,!!r,!1).finally(()=>this.clearTimeout())}}function NF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}class PF extends En{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;Te(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(it.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(it.CONNECTED):this._state==="closed"?this.emit(it.CLOSED):this._state==="failed"&&this.emit(it.FAILED))}resetReconnectCount(t){A.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],o=arguments.length>3&&arguments[3]!==void 0&&arguments[3],l=arguments.length>4&&arguments[4]!==void 0&&arguments[4],u=arguments.length>5?arguments[5]:void 0;super(),U(this,"connectionID",0),U(this,"currentURLIndex",0),U(this,"urls",[]),U(this,"_reconnectMode","tryNext"),U(this,"reconnectReason",void 0),U(this,"_initMutex",void 0),U(this,"name",void 0),U(this,"_state","closed"),U(this,"reconnectInterrupter",void 0),U(this,"websocket",void 0),U(this,"retryConfig",void 0),U(this,"reconnectCount",0),U(this,"forceCloseTimeout",5e3),U(this,"onlineReconnectListener",void 0),U(this,"useCompress",void 0),U(this,"tryDoubleDomain",!1),U(this,"use443PortOnly",!1),U(this,"wsInflateLength",0),U(this,"wsDeflateLength",0),U(this,"closeEstablishingWs",()=>{}),U(this,"store",void 0),U(this,"joinGatewayRecordIndex",void 0),this.store=u,this.name=t,this.retryConfig=function(S){for(var R=1;R<arguments.length;R++){var b=arguments[R]!=null?arguments[R]:{};R%2?NF(Object(b),!0).forEach(function(x){U(S,x,b[x])}):Object.getOwnPropertyDescriptors?Object.defineProperties(S,Object.getOwnPropertyDescriptors(b)):NF(Object(b)).forEach(function(x){Object.defineProperty(S,x,Object.getOwnPropertyDescriptor(b,x))})}return S}({},n),this.useCompress=r,this.tryDoubleDomain=o,this.use443PortOnly=l,this._initMutex=new Gi("websocket",u?u.clientId:void 0);const{timeout:h,timeoutFactor:m}=n,g=Math.max(300,Math.floor(3*h/5)),E=Math.max(1.2,Math.floor(8*m)/10);Ts.ONLINE&&(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=E),Un.on(Bm.NETWORK_STATE_CHANGE,(S,R)=>{S!==R&&(this.resetReconnectCount("network state change: ".concat(R," -> ").concat(S)),S===Ts.ONLINE?(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=E):(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=m))})}getConnection(){return this.websocket||void 0}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=t,this.state="connecting";try{const o=iy(),l=this.urls[this.currentURLIndex];G("ENABLE_PREALLOC_PC")&&this.emit(AF.PRE_CONNECT_PC),this.createWebSocketConnection(l).then(o.resolve).catch(o.reject),this.once(it.CLOSED,()=>{o.reject(new oe(B.WS_DISCONNECT))}),this.once(it.CONNECTED,o.resolve),await o.promise}catch{}finally{r()}}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const r=this.websocket;n?setTimeout(()=>r.close(),500):r.close(),this.websocket=void 0}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void A.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),A.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new oe(B.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(r){throw new oe(B.WS_ERR,"send websocket message error"+r.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var n;const r=iy();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const o=E=>{var S;(S=this.store)===null||S===void 0||S.signalChannelOpen(),A.debug("[".concat(this.name,"] websocket opened:"),E),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r.resolve()},l=async E=>{var S;if(A.debug("[".concat(this.name,"] websocket close ").concat((S=this.websocket)===null||S===void 0?void 0:S.url,", code: ").concat(E.code,", reason: ").concat(E.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)r.reject(new oe(B.WS_DISCONNECT,"websocket close: ".concat(E.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=E.reason,this.state="reconnecting");const R=zs(this,it.WILL_RECONNECT,this.reconnectMode,E.reason)||this.reconnectMode,b=await this.reconnectWithAction(R);if(this.state==="closed")return void A.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!b)return r.reject(new oe(B.WS_DISCONNECT,"websocket reconnect failed: ".concat(E.code))),this.close(!0);r.resolve()}},u=E=>{this.emit(it.ON_MESSAGE,E)},h=E=>{A.warn("[".concat(this.connectionID,"] ws open error ").concat(E))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),G("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=G("GATEWAY_WSS_ADDRESS")),A.debug("[".concat(this.name,"] start connect, url:"),t);const m=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var g;const E=await this.chooseBestWebsocketConnection(t);this.websocket=E,o&&o(this.websocket.url),this.websocket.onclose=l,this.websocket.onmessage=u,this.websocket.onerror=h,(g=this.store)===null||g===void 0||g.recordJoinChannelService({endTs:Date.now(),status:"success"},m),this.joinGatewayRecordIndex=m}catch(E){const S=this.state==="closed",R=E instanceof oe,b=R&&E.code===B.WS_ABORT,x=R&&E.code===B.WS_ERR,P=R?E.message:E&&(E.reason||E.toString());A.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(P)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:b?"aborted":"error",errors:[E]},m),S||x?(r.reject(S?new oe(B.WS_DISCONNECT,"websocket is closed: ".concat(P)):new oe(B.WS_ERR,"init websocket failed: ".concat(P))),x&&A.error("[".concat(this.name,"] init websocket failed: ").concat(P))):l&&l(E)}return r.promise}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;A.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Un.isOnline||!Un.onlineWaiter||(this.onlineReconnectListener=Un.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let r=!0;if(this.reconnectInterrupter=()=>r=!1,n){const u=xI(this.reconnectCount,this.retryConfig);A.debug("[".concat(this.name,"] wait ").concat(u,"ms to reconnect websocket, mode: ").concat(t)),await we.race([Si(u),this.onlineReconnectListener||new we(()=>{})])}if(this._state==="closed"||!r)return!1;this.reconnectCount+=1;const o=async(u,h)=>{this.emit(it.RECONNECT_CREATE_CONNECTION,h),await this.createWebSocketConnection(u)};try{if(t==="retry")await o(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);A.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await o(this.urls[this.currentURLIndex],t)}else t==="recover"&&(A.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Mi(this,it.REQUEST_NEW_URLS),this.currentURLIndex=0,await o(this.urls[this.currentURLIndex],t))}catch(u){var l;A.error("[".concat(this.name,"] reconnect failed ").concat(u&&u.toString()));const h=u==null||(l=u.data)===null||l===void 0?void 0:l.desc;return Array.isArray(h)&&Te(h).call(h,"dynamic key expired")?(this.emit(it.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,n)}return!0}}class wO extends PF{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){const r=iy(),o=function(u,h){return new bQ(u,h)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{A.debug("[choose-best-ws] close establishing websockets"),o.closeAllWebsockets(),r.reject(new oe(B.WS_ABORT,"choose best websocket aborted"))};const l=G("GATEWAY_DOMAINS");return A.debug("[choose-best-ws] currentDomain: ",t,", domains: ",l,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),o.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(r.resolve).catch(r.reject),r.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class yy extends PF{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){return new we((r,o)=>{let l=!1;const u=[];this.closeEstablishingWs=()=>{A.debug("[choose-best-ws] close establishing websockets"),u.forEach(x=>{x.onclose=null,x.onopen=null,x.onmessage=null,x.close()}),o(new oe(B.WS_ABORT,"choose best websocket aborted"))};const h=G("GATEWAY_DOMAINS");let m;const g=t.indexOf("?h="),E=h.find(x=>g!==-1?Te(t).call(t,x,g):Te(t).call(t,x));A.debug("[choose-best-ws] currentDomain: ",E,", domains: ",h);let S=!this.tryDoubleDomain||!E;if(!S&&E){var R;const x=Date.now();try{h.forEach(P=>{const k=g===-1?t.replace(E,P):t.substr(0,g)+t.substr(g).replace(E,P),V=new WebSocket(k);V.binaryType="arraybuffer",u.push(V),A.debug("[choose-best-ws] ws is connecting:",V.url)})}catch{for(A.debug("[choose-best-ws] ws create failed, fallback to single url"),u.forEach(k=>k.close());u.length;)u.pop();S=!0}(R=this.store)===null||R===void 0||R.recordJoinChannelService({urls:u.map(P=>P.url),service:"gateway"},n),u.forEach(P=>{P.onopen=()=>{if(l)return;const k=Date.now()-x;A.debug("[choose-best-ws] ws open cost ".concat(k,"ms")),u.filter(V=>V!==P).forEach(V=>{A.debug("[choose-best-ws]close backup websocket: ".concat(V.url)),V.close()}),l=!0,r(P)},P.onclose=k=>{m=k,!l&&(u.find(V=>!(V.readyState===WebSocket.CLOSED||V.readyState===WebSocket.CLOSING))||(A.debug("[choose-best-ws] all websocket is closed"),l=!0,o(m)))},P.onmessage=k=>{A.debug("[choose-best-ws]".concat(P.url," onmessage: ").concat(k.data))}}),Si(this.forceCloseTimeout).then(()=>{u.forEach(P=>{P.readyState!==WebSocket.OPEN&&P.close()})})}if(S){var b;let x;A.debug("[choose-best-ws] use single url: ",t),(b=this.store)===null||b===void 0||b.recordJoinChannelService({urls:[t],service:"gateway"},n);try{x=new WebSocket(t),u.push(x),x.binaryType="arraybuffer"}catch(P){const k=new oe(B.WS_ERR,"init websocket failed! Error: ".concat(P.toString()));return A.error("[".concat(this.name,"]").concat(k)),void o(k)}x.onopen=()=>{r(x)},x.onclose=P=>{o(P)},x.onmessage=P=>{A.debug("[choose-best-ws]".concat(x.url," onmessage: ").concat(P.data))},Si(this.forceCloseTimeout).then(()=>{x&&x.readyState!==WebSocket.OPEN&&x.close()})}}).then(r=>(this.closeEstablishingWs=void 0,r)).catch(r=>{throw this.closeEstablishingWs=void 0,r})}}class AQ extends En{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Zt.CONNECTED?this.emit(Je.WS_CONNECTED):t===Zt.RECONNECTING?this.emit(Je.WS_RECONNECTING,this._websocketReconnectReason):t===Zt.CLOSED&&this.emit(Je.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),U(this,"_disconnectedReason",void 0),U(this,"_websocketReconnectReason",void 0),U(this,"_connectionState",Zt.CLOSED),U(this,"reconnectToken",void 0),U(this,"websocket",void 0),U(this,"openConnectionTime",void 0),U(this,"clientId",void 0),U(this,"lastMsgTime",Date.now()),U(this,"uploadCache",[]),U(this,"uploadCacheInterval",void 0),U(this,"rttRolling",new W2(5)),U(this,"pingpongTimer",void 0),U(this,"wsInflateDataTimer",void 0),U(this,"pingpongTimeoutCount",0),U(this,"joinResponse",void 0),U(this,"multiIpOption",void 0),U(this,"initError",void 0),U(this,"spec",void 0),U(this,"store",void 0),U(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(Je.ON_BINARY_DATA,r.data);const o=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){const l="res-@".concat(o._id);this.emit(l,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")){if(this.emit(o._type,o._message),o._type===mt.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===mt.ON_USER_BANNED)switch(o._message.error_code){case 14:this.close(kt.UID_BANNED);break;case 15:this.close(kt.IP_BANNED);break;case 16:this.close(kt.CHANNEL_BANNED)}if(o._type===mt.ON_USER_LICENSE_BANNED)switch(o._message.error_code){case We.ERR_LICENSE_MISSING:this.close(kt.LICENSE_MISSING);break;case We.ERR_LICENSE_EXPIRED:this.close(kt.LICENSE_EXPIRED);break;case We.ERR_LICENSE_MINUTES_EXCEEDED:this.close(kt.LICENSE_MINUTES_EXCEEDED);break;case We.ERR_LICENSE_PERIOD_INVALID:this.close(kt.LICENSE_PERIOD_INVALID);break;case We.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(kt.LICENSE_MULTIPLE_SDK_SERVICE);break;case We.ERR_LICENSE_ILLEGAL:this.close(kt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new wO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,G("JOIN_GATEWAY_USE_DUAL_DOMAIN"),G("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Zt.CONNECTED&&this.reconnect("retry",xi.OFFLINE)})}async request(t,n,r,o){const l=Jt(6,""),u={_id:l,_type:t,_message:n},h=this.websocket.connectionID,m=()=>new we((x,P)=>{if(this.connectionState===Zt.CONNECTED)return x();const k=()=>{this.off(Je.WS_CLOSED,V),x()},V=()=>{this.off(Je.WS_CONNECTED,k),P(new ie(B.WS_ABORT))};this.once(Je.WS_CONNECTED,k),this.once(Je.WS_CLOSED,V),t!==Ye.PUBLISH&&t!==Ye.PUBLISH_DATASTREAM&&t!==Ye.SUBSCRIBE&&t!==Ye.SUBSCRIBE_DATASTREAM&&t!==Ye.UNSUBSCRIBE&&t!==Ye.UNSUBSCRIBE_DATASTREAM&&t!==Ye.UNPUBLISH&&t!==Ye.UNPUBLISH_DATASTREAM&&t!==Ye.CONTROL&&t!==Ye.RESTART_ICE||this.once(Je.DISCONNECT_P2P,()=>{P(new ie(B.DISCONNECT_P2P))}),t!==Ye.PUBLISH&&t!==Ye.RESTART_ICE||this.once(Je.ABORT_P2P_EXECUTION,()=>{P(new ie(B.DISCONNECT_P2P))})});if(this.connectionState!==Zt.CONNECTING&&this.connectionState!==Zt.RECONNECTING||t===Ye.JOIN||t===Ye.REJOIN||await m(),this.websocket.sendMessage(u,!0),o)return;const g=new we((x,P)=>{let k=!1;const V=(K,$)=>{k=!0,x({isSuccess:K==="success",message:$||{}}),this.off(Je.WS_CLOSED,F),this.off(Je.WS_RECONNECTING,F),this.emit(Je.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(l),V);const F=()=>{P(new ie(B.WS_ABORT,"type: ".concat(t))),this.off(Je.WS_CLOSED,F),this.off(Je.WS_RECONNECTING,F),this.off("res-@".concat(l),V)};this.once(Je.WS_CLOSED,F),this.once(Je.WS_RECONNECTING,F),Si(G("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==h||k||(A.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Je.REQUEST_TIMEOUT,t,n))})});let E=null;try{E=await g}catch(x){if(this.connectionState===Zt.CLOSED||t===Ye.LEAVE)throw new ie(B.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?x.throw():t===Ye.JOIN||t===Ye.REJOIN?null:(await m(),await this.request(t,n))}if(E.isSuccess)return E.message;const S=Number(E.message.error_code||E.message.code),R=Ey(S),b=new ie(B.UNEXPECTED_RESPONSE,"".concat(R.desc,": ").concat(E.message.error_str),{code:S,data:E.message,desc:R.desc});return R.action==="success"?E.message:(A.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(S,", message: ").concat(R.desc,", action: ").concat(R.action)),S===We.ERR_TOO_MANY_BROADCASTERS?((t===Ye.JOIN||t===Ye.REJOIN)&&(this.initError=b,this.close()),b.throw()):R.action==="failed"?b.throw():R.action==="quit"?(this.initError=b,this.close(),b.throw()):(S===We.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=E.message.option,A.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",xi.MULTI_IP)):this.reconnect(R.action,xi.SERVER_ERROR),t===Ye.JOIN||t===Ye.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new we(r=>{const o=l=>{(!n||n(l))&&(this.off(t,o),r(l))};this.on(t,o)})}uploadWRTCStats(t){if(!this.store.sessionId)return void A.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(gy.WRTC_STATS,n)}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const l=G("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Zt.CONNECTED)return;const u=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(u._type,u._message)},G("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new we((n,r)=>{this.once(Je.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Je.WS_CLOSED,o=>r(this.initError||new ie(B.WS_ABORT,o))),this.connectionState=Zt.CONNECTING,this.websocket.init(t).catch(r),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||kt.LEAVE,this.connectionState=Zt.CLOSED,A.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Je.ABORT_P2P_EXECUTION);const t=await Mi(this,Je.REQUEST_JOIN_INFO),n=await this.request(Ye.JOIN,t);if(!n)return this.emit(Je.REPORT_JOIN_GATEWAY,hw.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Je.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Zt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new ie(B.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=ly(this,Je.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(Ye.REJOIN,t);return!!n&&(this.connectionState=Zt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(r=>{this.emit(mt.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(mt.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(mt.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(mt.MUTE_AUDIO,{uid:r.uid}):this.emit(mt.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(mt.MUTE_VIDEO,{uid:r.uid}):this.emit(mt.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(mt.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(mt.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(mt.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(mt.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(mt.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleNotification(t){A.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Ey(t.code);if(t.code===28&&"detail"in t&&(A.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(Je.RECOVER_NOTIFICATION,t.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(kt.UID_BANNED),void this.close()):void this.reconnect(n.action,xi.SERVER_ERROR);A.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=G("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(A.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>G("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",xi.TIMEOUT):this.request(Ye.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),G("REPORT_STATS")&&this.send(Ye.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(gy.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(it.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Je.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(it.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(it.CLOSED,()=>{this.connectionState=Zt.CLOSED}),this.websocket.on(it.FAILED,()=>{this._disconnectedReason=kt.NETWORK_ERROR,this.connectionState=Zt.CLOSED}),this.websocket.on(it.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Zt.CONNECTED?this.connectionState=Zt.RECONNECTING:this.connectionState=Zt.CONNECTING}),this.websocket.on(it.WILL_RECONNECT,(t,n,r)=>{const o=ly(this,Je.IS_P2P_DISCONNECTED),l=o||t!=="retry";o&&t==="retry"&&(A.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=hw.P2P_DISCONNECTED),l&&(A.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(Je.REPORT_JOIN_GATEWAY,n||hw.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Je.DISCONNECT_P2P)),r(t)}),this.websocket.on(it.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{A.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",xi.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Je.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof ie){if(t.code===B.UNEXPECTED_RESPONSE&&t.data.code===We.ERR_NO_AUTHORIZED)return this.initError=new ie(B.TOKEN_EXPIRE,"dynamic key expired"),void this.close(kt.TOKEN_EXPIRE);A.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",xi.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(it.REQUEST_NEW_URLS,(t,n)=>{Mi(this,Je.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(it.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(mt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(AF.PRE_CONNECT_PC,()=>{this.emit(Je.PRE_CONNECT_PC)})}}let IQ=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),Vn=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function DF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function fw(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?DF(Object(n),!0).forEach(function(r){U(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):DF(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Zu(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(G("TURN_DOMAIN")):(A.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function CO(e,t){e.addresses||(e.addresses=[]);const n=function(h,m){if(G("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return h.map(S=>{let{ip:R,port:b}=S;return{address:"".concat(R,":").concat(b)}});const g=G("GATEWAY_DOMAINS");let E=g[1]&&Te(m).call(m,g[1])?1:0;return h.map(S=>{let{domain_prefix:R,port:b,ip:x}=S;if(R)return{address:"".concat(R,".").concat(g[E++%g.length],":").concat(b)};const P=/^[\.\:\d]+$/.test(x),k=P?"".concat(x.replace(/[^\d]/g,"-"),".").concat(g[E++%g.length],":").concat(b):"".concat(x,":").concat(b);return P||A.debug("Cannot recognized as ip address: ".concat(x,", use as host")),{ip:x,port:b,address:k}})}(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&typeof r=="string"){const h=r.split(";");for(let m=0;m<h.length;m++){var o;const g=ir(o=h[m]).call(o);n[m]&&g&&(n[m].ip6=g)}}const l=e.detail&&e.detail.candidate;let u;if(l){const[h,m]=l.split(":");h&&m&&(u={port:Number(m),ip:h,address:"".concat(h,":").concat(m)})}return{gatewayAddrs:n,apGatewayAddress:u,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Rs(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function kF(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(Rs(t.width),"x").concat(Rs(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function LF(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function vy(e,t){let n,r,o;switch(t){case Vn.CHOOSE_SERVER:r=4096,o="choose server";break;case Vn.CLOUD_PROXY:r=1048576,o="proxy";break;case Vn.CLOUD_PROXY_5:r=4194304,o="proxy5";break;case Vn.CLOUD_PROXY_FALLBACK:r=4194310,o="proxy fallback";break;default:throw new ie(B.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(l=>{l.buffer&&l.buffer.flag===r&&(n={code:l.buffer.code,addresses:(l.buffer.edges_services||[]).map(u=>fw(fw({},u),{},{ticket:l.buffer.cert})),server_ts:e.enter_ts,uid:l.buffer.uid,cid:l.buffer.cid,cname:l.buffer.cname,detail:fw(fw({},l.buffer.detail),e.detail),flag:l.buffer.flag,opid:e.opid,cert:l.buffer.cert})}),!n)throw new ie(B.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(o," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function xF(e,t){return await we.all(e.addresses.map(async n=>({address:G("USE_TURN_IP")?n.ip:Zu(n.ip),tcpport:n.port,udpport:n.port,username:t&&G("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Ui.username,password:t&&G("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await PI(t.toString()):Ui.password})))}function bO(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||n.height,o=t.videoWidth||n.width;return r&&o?Math.max(Math.min(r,o)/Math.min(Rs(e.height),Rs(e.width)),1):(A.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function ed(e){let{candidateType:t,relayProtocol:n,type:r,address:o,port:l,protocol:u}=e;const h={candidateType:t,relayProtocol:n,protocol:u};if(r!=="local-candidate"){const m=o.split(".");m.length>=4&&(m[1]="*",m[2]="*"),h.address=m.join("."),h.port=l}return h}function mw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:G("SVC_MODE");if(G("ENABLE_SVC"))return function(t){return t in zR}(e)?e:zR.L1T3}const MF={[Pe.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Pe.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function gw(e,t,n){t.forEach(r=>{var o;const l=MF[e].find(h=>{var m;let{key:g}=h;return Te(m=r.extensionName).call(m,g)});if(!l)return;const u=n.find(h=>{let{extensionName:m}=h;return Te(m).call(m,l.key)});u&&Te(o=u.extensionName).call(o,"gdpr_forbidden")&&(r.extensionName=u.extensionName)})}function cg(e,t){t.forEach(n=>{var r;const o=MF[e].find(l=>{var u;let{key:h}=l;return Te(u=n.extensionName).call(u,h)});Te(r=n.extensionName).call(r,"gdpr_forbidden")&&o&&(n.extensionName=o.extensionName)})}function UF(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Te(e).call(e,"abs-send-time")}function _w(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Te(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function VF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function FF(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?VF(Object(n),!0).forEach(function(r){U(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VF(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Sy(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const{filterRTX:o,filterVideoFec:l,filterAudioFec:u,filterAudioCodec:h,filterVideoCodec:m}=t,{useXR:g}=n;let E=[],S=[],R=[],b=[],x=!1,P=!1;if(Qr(e).mediaDescriptions.forEach(V=>{r&&r!==V.attributes.direction||(V.media.mediaType!=="video"||x||(S=V.attributes.payloads,b=V.attributes.extmaps,x=!0),V.media.mediaType!=="audio"||P||(E=V.attributes.payloads,R=V.attributes.extmaps,P=!0))}),!b||S.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!R||E.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(S.forEach(V=>{var F;(F=V.rtpMap)!==null&&F!==void 0&&F.clockRate&&(V.rtpMap.clockRate=parseInt(V.rtpMap.clockRate)),g&&V.rtcpFeedbacks.push({type:"rrtr"})}),E.forEach(V=>{var F;(F=V.rtpMap)!==null&&F!==void 0&&F.clockRate&&(V.rtpMap.clockRate=parseInt(V.rtpMap.clockRate)),g&&V.rtcpFeedbacks.push({type:"rrtr"})}),o&&(E=E.filter(V=>{var F;return((F=V.rtpMap)===null||F===void 0?void 0:F.encodingName.toLowerCase())!=="rtx"}),S=S.filter(V=>{var F;return((F=V.rtpMap)===null||F===void 0?void 0:F.encodingName.toLowerCase())!=="rtx"})),l&&(S=S.filter(V=>{var F;return!/(red)|(ulpfec)|(flexfec)/i.test(((F=V.rtpMap)===null||F===void 0?void 0:F.encodingName)||"")})),u&&(E=E.filter(V=>{var F;return!/(red)|(ulpfec)|(flexfec)/i.test(((F=V.rtpMap)===null||F===void 0?void 0:F.encodingName)||"")})),h&&(h==null?void 0:h.length)>0&&(E=E.filter(V=>{var F;return Te(h).call(h,((F=V.rtpMap)===null||F===void 0?void 0:F.encodingName.toLowerCase())||"")})),m&&(m==null?void 0:m.length)>0){const V=S.filter(F=>{var K;return Te(m).call(m,((K=F.rtpMap)===null||K===void 0?void 0:K.encodingName.toLowerCase())||"")});S=V.concat(o?[]:OO(V,S))}const k=G("UNSUPPORTED_VIDEO_CODEC");return k&&k.length>0&&(S=S.filter(V=>!(V.rtpMap&&Te(k).call(k,V.rtpMap.encodingName.toLowerCase())))),{audioCodecs:E,videoCodecs:S,audioExtensions:R,videoExtensions:b}}function td(e){const t=Qr(e);let n,r;for(const o of t.mediaDescriptions){if(!n){const l=o.attributes.iceUfrag,u=o.attributes.icePwd;if(!l||!u)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:l,icePwd:u}}if(!r){const l=o.attributes.fingerprints;l.length>0&&(r={fingerprints:l})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function BF(e,t){const n=[],r=e.attributes.ssrcGroups.filter(u=>u.semantic==="FID"),o=e.attributes.ssrcGroups.find(u=>u.semantic==="SIM"),l=e.attributes.ssrcs;if(o)o.ssrcIds.forEach(u=>{var h;const m=(h=r.find(g=>g.ssrcIds[0]===u))===null||h===void 0?void 0:h.ssrcIds[1];n.push({ssrcId:u,rtx:t?m:void 0})});else if(r.length>0){const u=r[0].ssrcIds[0],h=r[0].ssrcIds[1];n.push({ssrcId:u,rtx:t?h:void 0})}else{if(l.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:l[0].ssrcId})}return n}function jF(e,t,n){const{cname:r}=e;let o=[];t&&(o=GF(t)),o.length===0&&(o=e.iceParameters.candidates.map(E=>({foundation:E.foundation,componentId:"1",transport:E.protocol,priority:E.priority.toString(),connectionAddress:E.ip,port:E.port.toString(),type:E.type,extension:{}})),A.debug("Using candidates from gateway."));const l={fingerprints:e.dtlsParameters.fingerprints.map(E=>({hashFunction:E.algorithm,fingerprint:E.fingerprint}))},u={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let h;switch(e.dtlsParameters.role){case"server":h="passive";break;case"client":h="active";break;case"auto":h="actpass"}const m=yw(e.rtpCapabilities),g=[];return Array.isArray(n)&&n.length>0&&n.forEach(E=>{g.push({kind:Pe.VIDEO,ssrcId:E.v,rtx:E.v_rtx,mslabel:"".concat(E.v,"_").concat(E.a)},{kind:Pe.AUDIO,ssrcId:E.a,mslabel:"".concat(E.v,"_").concat(E.a)})}),{dtlsParameters:l,iceParameters:u,candidates:o,rtpCapabilities:m,setup:h,cname:r,preSSRCs:g}}function GF(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],A.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),A.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),t}function ep(e,t,n){const r=[],o=[];return e.forEach(l=>{let{ssrcId:u,rtx:h}=l;const m=Jt(8,"track-"),g={ssrcId:u,attributes:FF({label:m,mslabel:n=n||Jt(10,""),msid:"".concat(n," ").concat(m)},t&&{cname:t})};if(r.push(g),h!==void 0){const E={ssrcId:h,attributes:FF({label:m,mslabel:n,msid:"".concat(n," ").concat(m)},t&&{cname:t})};r.push(E),o.push({semantic:"FID",ssrcIds:[u,h]})}}),e.length>1&&o.push({semantic:"SIM",ssrcIds:e.map(l=>{let{ssrcId:u}=l;return u})}),{ssrcs:r,ssrcGroups:o}}function lg(e,t){t instanceof bn&&e.attributes.payloads.forEach(n=>{var r;const o=(r=n.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase();if(!o||["opus","pcmu","pcma","g722"].indexOf(o)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const l=t._encoderConfig;l&&o!=="pcmu"&&o!=="pcma"&&o!=="g722"&&(l.bitrate&&!vn()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*l.bitrate))),l.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(l.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(l.sampleRate)),l.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"))})}function AO(e){const t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function IO(e,t){var n;if(!(t instanceof an&&t._encoderConfig&&t._hints.indexOf($t.SCREEN_TRACK)===-1))return;const r=t._encoderConfig;bt().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach(o=>{var l,u;Te(l=["h264","h265","vp8","vp9","av1"]).call(l,((u=o.rtpMap)===null||u===void 0?void 0:u.encodingName.toLowerCase())||"")&&(o.fmtp||(o.fmtp={parameters:{}}),o.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))}),bt().supportMinBitrate&&!Te(n=t._hints).call(n,$t.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach(o=>{var l,u;Te(l=["h264","h265","vp8","vp9","av1"]).call(l,((u=o.rtpMap)===null||u===void 0?void 0:u.encodingName.toLowerCase())||"")&&(o.fmtp||(o.fmtp={parameters:{}}),o.fmtp.parameters["x-google-start-bitrate"]="".concat(G("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))})}function WF(e){if(e.media.mediaType!=="video")return;const t=Tt();if(t.name!==Ot.SAFARI&&t.os!==oi.IOS)return;const n=e.attributes.extmaps.findIndex(r=>/video-orientation/g.test(r.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function Ew(e,t,n){if(!t)return;let r,o;if(e.media.mediaType==="video"?(r=n.videoExtensions,o=n.videoCodecs):(r=n.audioExtensions,o=n.audioCodecs),t.twcc===!0){const l=r.find(u=>_w(u.extensionName));if(l){const u=l.extensionName;e.attributes.extmaps.find(m=>_w(m.extensionName))||e.attributes.extmaps.push({entry:l.entry,extensionName:u}),function(m,g){return g.filter(E=>!!m.find(S=>S.payloadType===E.payloadType&&!!S.rtcpFeedbacks.find(R=>R.type==="transport-cc")))}(o,e.attributes.payloads).forEach(m=>{m.rtcpFeedbacks.find(g=>g.type==="transport-cc")||m.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){const l=e.attributes.extmaps.findIndex(u=>_w(u.extensionName));l!==-1&&e.attributes.extmaps.splice(l,1),e.attributes.payloads.forEach(u=>{const h=u.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&u.rtcpFeedbacks.splice(h,1)})}if(t.remb===!0){const l=r.find(u=>UF(u.extensionName));if(l){const u=l.extensionName;e.attributes.extmaps.find(m=>m.extensionName===u)||e.attributes.extmaps.push({entry:l.entry,extensionName:u}),function(m,g){return g.filter(E=>!!m.find(S=>S.payloadType===E.payloadType&&!!S.rtcpFeedbacks.find(R=>R.type==="goog-remb")))}(o,e.attributes.payloads).forEach(m=>{m.rtcpFeedbacks.find(g=>g.type==="goog-remb")||m.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){const l=e.attributes.extmaps.findIndex(u=>UF(u.extensionName));l!==-1&&e.attributes.extmaps.splice(l,1),e.attributes.payloads.forEach(u=>{const h=u.rtcpFeedbacks.findIndex(m=>m.type==="goog-remb");h!==-1&&u.rtcpFeedbacks.splice(h,1)})}}function zF(e,t,n){if(vn()||e.media.mediaType!=="video"||!(t instanceof an)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!G("SIMULCAST")||n==="vp9"&&G("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const r=n==="vp8"?2:t._scalabilityMode.numSpatialLayers,o=e.attributes.ssrcs[0],l=e.attributes.ssrcGroups.find(h=>h.semantic==="FID"&&h.ssrcIds[0]===o.ssrcId),u={semantic:"SIM",ssrcIds:[o.ssrcId]};for(let h=1;h<r;h++)e.attributes.ssrcs.push({ssrcId:o.ssrcId+h,attributes:Rn(o.attributes)}),u.ssrcIds.push(o.ssrcId+h),l&&(e.attributes.ssrcs.push({ssrcId:l.ssrcIds[1]+h,attributes:Rn(o.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[o.ssrcId+h,l.ssrcIds[1]+h]}));e.attributes.ssrcGroups.unshift(u)}async function HF(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const r=(await n.createOffer()).sdp,{send:o,recv:l,sendrecv:u}=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},g=arguments.length>2?arguments[2]:void 0;const E=Sy(g,h,m,"sendonly"),S=Sy(g,h,m,"recvonly"),R={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},x={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Yo(E,S,"videoExtensions",R,b,x),Yo(E,S,"videoCodecs",R,b,x),Yo(E,S,"audioExtensions",R,b,x),Yo(E,S,"audioCodecs",R,b,x),G("RAISE_H264_BASELINE_PRIORITY")){const P=[],k=[];x.videoCodecs.forEach((V,F)=>{var K;if(((K=V.rtpMap)===null||K===void 0?void 0:K.encodingName.toLocaleLowerCase())==="h264"){var $,Z;const J=x.videoCodecs[F+1],re=J&&JF(V,J),pe=($=V.fmtp)===null||$===void 0?void 0:$.parameters["profile-level-id"],Ce=(Z=V.fmtp)===null||Z===void 0?void 0:Z.parameters["packetization-mode"];!pe||pe!==G("FIRST_H264_PROFILE_LEVEL_ID")||G("FIRST_PACKETIZATION_MODE")&&Ce!==G("FIRST_PACKETIZATION_MODE")?re?k.push([V,J]):k.push([V]):re?P.push([V,J]):P.push([V])}}),P.length>0&&k.length>0&&(A.debug("raising H264 baseline profile priority"),x.videoCodecs.forEach((V,F)=>{var K;if(((K=V.rtpMap)===null||K===void 0?void 0:K.encodingName.toLocaleLowerCase())==="h264"){const $=JF(V,x.videoCodecs[F+1]),Z=P.shift()||k.shift()||[];Z.length>0&&($?x.videoCodecs.splice(F,2,...Z):x.videoCodecs.splice(F,1,...Z))}}),b.videoCodecs=b.videoCodecs.filter(V=>{var F,K;return!(((F=V.rtpMap)===null||F===void 0?void 0:F.encodingName.toLocaleLowerCase())==="h264"&&((K=V.fmtp)===null||K===void 0?void 0:K.parameters["profile-level-id"])!==G("FIRST_H264_PROFILE_LEVEL_ID"))}),G("FILTER_SEND_H264_BASELINE")&&(R.videoCodecs=R.videoCodecs.filter(V=>{var F,K;return!(((F=V.rtpMap)===null||F===void 0?void 0:F.encodingName.toLocaleLowerCase())==="h264"&&((K=V.fmtp)===null||K===void 0?void 0:K.parameters["profile-level-id"])!==G("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:R,recv:b,sendrecv:x}}(e,t,r);try{n.close()}catch{}return{send:o,recv:l,sendrecv:u}}function KF(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=Sy(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Yo(e,t,"videoExtensions",n,r,o),Yo(e,t,"videoCodecs",n,r,o),Yo(e,t,"audioExtensions",n,r,o),Yo(e,t,"audioCodecs",n,r,o),G("RAISE_H264_BASELINE_PRIORITY")){const l=o.videoCodecs.findIndex(u=>u.rtpMap&&u.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&u.fmtp&&u.fmtp.parameters["profile-level-id"]==="42001f");if(l!==-1){const u=o.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(u<l){A.debug("raising H264 baseline profile priority");const h=o.videoCodecs[l];o.videoCodecs.splice(l,1),o.videoCodecs.splice(u,0,h)}u!==-1&&(r.videoCodecs=r.videoCodecs.filter(h=>!(h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:r,sendrecv:o}}function Yo(e,t,n,r,o,l){if(n==="videoExtensions"||n==="audioExtensions"){const u=[];return e[n].forEach(h=>{t[n].some((m,g)=>{if(h.entry===m.entry&&h.extensionName===m.extensionName)return u.push(g),!0})?l[n].push(h):r[n].push(h)}),void t[n].forEach((h,m)=>{u.indexOf(m)===-1&&o[n].push(h)})}if(n==="videoCodecs"||n==="audioCodecs"){const u=[];return e[n].forEach(h=>{t[n].some((m,g)=>{if(h.payloadType===m.payloadType&&JSON.stringify(h)===JSON.stringify(m))return u.push(g),!0})?l[n].push(h):r[n].push(h)}),void t[n].forEach((h,m)=>{u.indexOf(m)===-1&&o[n].push(h)})}}function yw(e){const{send:t,recv:n,sendrecv:r}=e;if(!r){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let o,l;return t?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...t.audioCodecs,...r.audioCodecs],o.videoCodecs=[...t.videoCodecs,...r.videoCodecs],o.audioExtensions=[...t.audioExtensions,...r.audioExtensions],o.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):o=r,n?(l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},l.audioCodecs=[...n.audioCodecs,...r.audioCodecs],l.videoCodecs=[...n.videoCodecs,...r.videoCodecs],l.audioExtensions=[...n.audioExtensions,...r.audioExtensions],l.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):l=r,{send:o,recv:l}}function ug(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function Ty(e,t,n,r){let o=[];if(e===Pe.VIDEO){if(G("H264_PROFILE_LEVEL_ID")&&r==="h264"&&(o=t.videoCodecs.filter(l=>{var u;return Te(u=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(u,r)&&l&&l.fmtp&&l.fmtp.parameters["profile-level-id"]===G("H264_PROFILE_LEVEL_ID")})),!Array.isArray(o)||o.length===0){let l=[];const u=[],h=[],m=[];if(n.videoCodecs.forEach(g=>{const E=g.rtpMap&&g.rtpMap.encodingName.toLowerCase()||"";Te(E).call(E,r)?l.push(g):Te(E).call(E,"vp9")?u.push(g):Te(E).call(E,"vp8")?h.push(g):Te(E).call(E,"h264")&&m.push(g)}),l.length===0){let g="";u.length!==0?(l=u,g="vp9"):h.length!==0?(l=h,g="vp8"):m.length!==0&&(l=m,g="h264"),A.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(g))}l.length!==0&&(o=t.videoCodecs.filter(g=>l.some(E=>E.payloadType===g.payloadType)))}if(o.length===0&&(A.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),o=t.videoCodecs),G("USE_PUB_RTX")||G("USE_SUB_RTX")){const l=OO(o,t.videoCodecs);o=[...o,...l]}}else o=t.audioCodecs.filter(l=>{var u;return Te(u=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(u,r)}),o.length===0&&(A.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),o=t.audioCodecs.filter(l=>{var u;return Te(u=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(u,"opus")}));return o}function OO(e,t){const n=e.map(r=>r.payloadType.toString());return t.filter(r=>r.rtpMap&&r.rtpMap.encodingName==="rtx"&&r.fmtp&&r.fmtp.parameters.apt&&Te(n).call(n,r.fmtp&&r.fmtp.parameters.apt))}async function Ry(e,t,n){const r=t.toString(),o=YF(r,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:r});const l=await e.createAnswer();if(!l.sdp)throw new Error("cannot get answer sdp");let u=l.sdp;u=qF(u,n||{}),o==null||o(u||""),await e.setLocalDescription({type:"answer",sdp:u})}function qF(e,t,n){const r=Qr(e),{useXR:o}=t;return r.mediaDescriptions.forEach(l=>{var u;l.attributes.mid&&(Array.isArray(n)&&!Te(n).call(n,l.attributes.mid)||(l.media.mediaType==="audio"&&ug(l),o&&Te(u=["audio","video"]).call(u,l.media.mediaType)&&l.attributes.payloads.forEach(h=>{h.rtcpFeedbacks.findIndex(m=>m.type==="rrtr")===-1&&h.rtcpFeedbacks.push({type:"rrtr"})})))}),Ju(r)}function YF(e,t,n,r){if(G("SDP_LOGGING"))return A.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(r,`
`),e),t==="offer"?o=>{YF(o,"answer",n==="local"?"remote":"local",r)}:void 0}function XF(e){const t=G("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(n=>Te(e).call(e,n))}function JF(e,t){try{var n;return((n=e.fmtp)===null||n===void 0?void 0:n.parameters.apt)===t.payloadType.toString()}catch{return!1}}function $F(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function yo(e,t){return typeof G(e)===t?G(e):void 0}function OQ(){try{const e=G("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?$F(Object(r),!0).forEach(function(o){U(t,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):$F(Object(r)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(r,o))})}return t}({},e)}catch(e){return A.debug("handle gateway attributes failed: ",e),{}}}const QF={};function nd(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&A.debug("install service ".concat(e.name)),QF[e.name]=e}function Hl(e){const t=QF[e];if(!t)throw new oe(B.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function ZF(e,t){return Hl("DataStream").create(e,t)}function vw(){return Hl("InterceptFrame").create()}function eB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Kl(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?eB(Object(n),!0).forEach(function(r){U(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eB(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const NO=new Map;class NQ extends En{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(fi.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(fi.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){A.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){var r,o,l;super(),U(this,"store",void 0),U(this,"joinInfo",void 0),U(this,"key",void 0),U(this,"ntpOffset",0),U(this,"signal",void 0),U(this,"role",void 0),U(this,"inChannelInfo",{joinAt:null,duration:0}),U(this,"spec",void 0),U(this,"_state","DISCONNECTED"),U(this,"_statsCollector",void 0),U(this,"_disconnectedReason",void 0),U(this,"isSignalRecover",!1),U(this,"hasChangeBGPAddress",!1),U(this,"trafficStatsInterval",void 0),U(this,"networkQualityInterval",void 0),U(this,"_joinGatewayStartTime",0),U(this,"_signalTimeout",!1),U(this,"_clientRoleOptions",void 0),U(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?(r={spec:Kl(Kl({},n),{},{retryConfig:n.websocketRetryConfig}),store:t},(o=(l=Hl("P2PChannel")).createSubmodule)===null||o===void 0?void 0:o.call(l,r)):new AQ(Kl(Kl({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(t,n,r){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const o=Date.now();let l=NO.get(t.cname);if(l||(l=new Map,NO.set(t.cname,l)),this._isProactiveJoin=!0,l.has(t.uid)){const g=new ie(B.UID_CONFLICT);throw xe.joinGateway(t.sid,{lts:o,succ:!1,ec:g.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),g}l.set(t.uid,!0),this.joinInfo=t,this.key=n;let u=0;this.joinGatewayStartTime=o;const h=t.proxyServer;try{A.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(u));const g=t.gatewayAddrs.map(E=>{let{address:S}=E;const[R,b]=S.split(":"),x={host:R,port:b};return t.proxyServer&&(x.proxy=t.proxyServer),x});u=(await this.signal.init(g)).uid,A.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(u," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(g){var m;throw A.error("[".concat(this.store.clientId,"] User join failed"),g.toString()),xe.joinGateway(t.sid,{lts:o,succ:!1,ec:((m=g.data)===null||m===void 0?void 0:m.desc)||g.code,errorMsg:g.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!h,signalChannel:"0",preload:t.preload}),l.delete(t.uid),this.signal.close(),g}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),A.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(g=>{A.warning("[".concat(this.store.clientId,"] get traffic stats error"),g.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(fi.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(fi.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(fi.NETWORK_QUALITY,{uplinkNetworkQuality:LF(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:LF(this._statsCollector.trafficStats.B_dnq)}):this.emit(fi.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),u}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==kt.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==Zt.CONNECTED||await function(r,o){return o===1/0?r:we.race([r,t$(o)])}(this.signal.request(Ye.LEAVE,void 0,!0),3e3)}catch(r){A.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(n),n!==kt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ie(B.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const o={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:G("PUB_EXTEND"),twcc:!!G("PUBLISH_TWCC"),rtx:!!G("USE_PUB_RTX")};try{return(await this.signal.request(Ye.PUBLISH,o,!0))._message}catch(l){if(r&&l.data&&l.data.code===We.ERR_PUBLISH_REQUEST_INVALID)return A.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),l.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw l}}async publishDataChannel(t,n,r){var o;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ie(B.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const l={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(o=n.maxRetransmits)!==null&&o!==void 0?o:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(Ye.PUBLISH_DATASTREAM,l,!0)}catch(u){if(r&&u.data&&u.data.code===We.ERR_PUBLISH_REQUEST_INVALID)return A.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),u.toString()),await this.tryUnpubDataChannelBeforeRepub(t,n),this.publishDataChannel(t,n,!1);throw u}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ie(B.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Ye.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(r){A.warning("[".concat(this.store.clientId,"] unpublish warning: "),r)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ie(B.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await we.all(t.map(n=>this.signal.request(Ye.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){A.warning("unpublish datachannels warning: ",n)}}async presubscribe(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ie(B.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const o={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!G("SUBSCRIBE_TWCC"),rtx:!!G("USE_SUB_RTX")||void 0,extend:G("SUB_EXTEND"),svc:Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0};try{return await this.signal.request(Ye.PRE_SUBSCRIBE,o,!0)}catch(l){if(r&&l.data&&l.data.code===We.ERR_SUBSCRIBE_REQUEST_INVALID)return A.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),l.toString()),this.presubscribe(t,n,!1);throw l}}async subscribe(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ie(B.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const o={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!G("SUBSCRIBE_TWCC"),rtx:!!G("USE_SUB_RTX"),extend:G("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0};try{return(await this.signal.request(Ye.SUBSCRIBE,o,!0))._message}catch(l){if(r&&l.data&&l.data.code===We.ERR_SUBSCRIBE_REQUEST_INVALID)return A.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),l.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw l}}async subscribeDataChannel(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ie(B.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const o={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(Ye.SUBSCRIBE_DATASTREAM,o,!0)}catch(l){if(r&&l.data&&l.data.code===We.ERR_SUBSCRIBE_REQUEST_INVALID)return A.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),l.toString()),await this.tryUnsubDataChannelBeforeResub(t,n),await this.subscribeDataChannel(t,n,!1);throw l}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ie(B.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const r={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!G("USE_SUB_RTX"),twcc:!!G("SUBSCRIBE_TWCC"),svc:Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0};try{return await this.signal.request(Ye.SUBSCRIBE_STREAMS,r,!0)}catch(o){if(n&&o.data&&o.data.code===We.ERR_SUBSCRIBE_REQUEST_INVALID)return A.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),o.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw o}}async setVideoProfile(t){const n=function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let o=r.frameRate,l=r.width,u=r.height,h=!0;return typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,o||(h=!1)),typeof l!="number"&&(l=l.exact||l.ideal||l.max||l.min||0,l||(h=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,o||(h=!1)),h?{stream_type:0,width:l,height:u,fps:o,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0}(t);if(n)return this.signal.request(Ye.SET_VIDEO_PROFILE,n);A.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(Ye.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(r){A.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r)}}async unsubscribeDataChannel(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ie(B.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await we.all(t.map(r=>this.signal.request(Ye.UNSUBSCRIBE_DATASTREAM,{stream_id:r,uid:n},!0)))}catch(r){A.warning("unsubscribeDataChannel warning: ",r)}}async massUnsubscribe(t){try{await this.signal.request(Ye.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){A.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:r,rtpCapabilities:o}=t;return{gatewayEstablishParams:await this.signal.request(Ye.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:o}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Ye.GATEWAY_INFO)}async renewToken(t){await this.signal.request(Ye.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,n){n&&(this._clientRoleOptions=Object.assign({},n)),G("CLIENT_ROLE_OPTIONS")&&(A.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(G("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},G("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),G("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},G("CLIENT_ROLE_OPTIONS")),A.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(G("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let r,o=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,o=1):o=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:o=0,await this.signal.request(Ye.SET_CLIENT_ROLE,{role:t,level:o,delay:r,client_ts:Date.now()}),this.role=t}async setRemoteVideoStreamType(t,n){await this.signal.request(Ye.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(Ye.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(Ye.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(Ye.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(t){await this.signal.request(Ye.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,n,r){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,n,r)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Kl({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Ye.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=NO.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){let r;return r=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),r?{username:Ui.username,password:Ui.password,turnServerURL:r[2],tcpport:parseInt(r[3])+30,udpport:parseInt(r[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Kl(Kl({},Ui),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(Ye.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(n=>{const r=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(o=>o.peer_uid===n.peer_uid);r&&r.B_st!==n.B_st&&BR(()=>{this.emit(fi.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){if(!this.joinInfo||!this.key)throw new ie(B.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let r=G("REPORT_APP_SCENARIO");if(typeof r!="string")try{r=JSON.stringify(r)}catch{r=void 0}var o;r&&r.length>128&&(r=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(fi.UPDATE_GATEWAY_CONFIG),o=this.store.clientId,Te(ig).call(ig,o)||ig.push(o);const l=!(vn()||E2(87)||aU())&&typeof G("ENABLE_PRE_SUB")=="boolean"&&G("ENABLE_PRE_SUB"),u=!aU()&&yo("ENABLE_PREALLOC_PC","boolean"),h=OQ(),m=ry(87)||function(){const E=Tt();if(E.name!==Ot.SAFARI||!E.browserVersion)return!1;const S=E.browserVersion.split(".");return Number(S[0])>15||Number(S[0])===15&&Number(S[1])>=4}(),g=Kl({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:mo,browser:navigator.userAgent,process_id:G("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:G("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:r,attributes:{userAttributes:Kl({enableEncodedTransform:!!G("ENABLE_AUDIO_METADATA")&&m||!!G("ENABLE_AUDIO_TOPN")&&RI(Ot.CHROME,87,116)||void 0,enableAudioMetadata:!!G("ENABLE_AUDIO_METADATA")&&m,enableAudioPts:!!G("ENABLE_AUDIO_PTS_METADATA")&&m,topnSmoothLevel:G("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:G("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:G("TOPN_SWITCH_HOLD_MS"),topnAudioGain:G("TOPN_AUDIO_GAIN"),enablePublishedUserList:G("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:G("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:yo("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:yo("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:yo("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:G("USE_PUB_RTX")===!0||G("USE_SUB_RTX")===!0||void 0,disableFEC:G("DISABLE_FEC"),enableNTPReport:!!G("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!G("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!G("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:yo("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!G("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!G("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:yo("USE_XR","boolean"),enableLossbasedBwe:yo("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!G("ENABLE_AUT_CC")||void 0,enableCCFallback:yo("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:u,preSubNum:l?yo("PRE_SUB_NUM","number"):void 0,enablePubTWCC:yo("PUBLISH_TWCC","boolean"),enableSubTWCC:yo("SUBSCRIBE_TWCC","boolean"),enablePubRTX:yo("USE_PUB_RTX","boolean"),enableSubRTX:yo("USE_SUB_RTX","boolean"),enableSubSVC:G("ENABLE_SVC")?G("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0,enableSvcExtended:G("ENABLE_SVC")&&Array.isArray(G("SVC_EXTENDED"))&&G("SVC_EXTENDED").length!==0?G("SVC_EXTENDED"):void 0},h)},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(g.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(g.aes_mode=this.joinInfo.aesmode,G("ENCRYPT_AES")?(g.aes_secret=this.joinInfo.aespassword,g.aes_encrypt=!0):g.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(g.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(g.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),this.joinInfo.defaultVideoStream!==void 0&&(g.default_video_stream=this.joinInfo.defaultVideoStream),g}getRejoinMessage(){if(!this.joinInfo)throw new ie(B.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Je.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Je.WS_RECONNECTING,t=>{this.joinInfo&&xe.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||xi.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",xe.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Je.WS_CLOSED,t=>{let n;switch(t){case kt.LEAVE:n=xi.LEAVE;break;case kt.UID_BANNED:case kt.IP_BANNED:case kt.CHANNEL_BANNED:case kt.SERVER_ERROR:n=xi.SERVER_ERROR;break;case kt.FALLBACK:n=xi.FALLBACK;break;case kt.LICENSE_MISSING:case kt.LICENSE_EXPIRED:case kt.LICENSE_MINUTES_EXCEEDED:case kt.LICENSE_PERIOD_INVALID:case kt.LICENSE_MULTIPLE_SDK_SERVICE:case kt.LICENSE_ILLEGAL:case kt.TOKEN_EXPIRE:n=t;break;default:n=xi.NETWORK_ERROR}A.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+xi.NETWORK_ERROR)),this.joinInfo&&xe.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===kt.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==kt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Je.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=G("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(A.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(xe.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void A.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));Vt("EVENT_REPORT_DOMAIN",t[1]),Vt("EVENT_REPORT_BACKUP_DOMAIN",t[1]),Vt("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(mt.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(Je.REQUEST_RECOVER,(t,n,r)=>{if(!this.joinInfo)return r(new ie(B.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Mi(this,fi.REQUEST_NEW_GATEWAY_LIST).then(n).catch(r)}),this.signal.on(Je.REQUEST_JOIN_INFO,async(t,n,r)=>{var o;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const l=Rn((o=this.joinInfo)===null||o===void 0?void 0:o.turnServer);if(G("NEW_TURN_MODE")&&l){let g=l.servers,E=l.serversFromGateway;const S=this.signal.currentURLIndex;g.length>0&&(g=[g[S%g.length]],l.servers=g),Array.isArray(E)&&E.length>0&&(E=[E[0]],l.serversFromGateway=E),A.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(S))}const{iceParameters:u,dtlsParameters:h,rtpCapabilities:m}=await Mi(this,fi.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:l});try{t(this.getJoinMessage({ortc:{iceParameters:u,dtlsParameters:h,rtpCapabilities:m,version:"2"}}))}catch(g){n(g)}}),this.signal.on(Je.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(Je.REPORT_JOIN_GATEWAY,(t,n)=>{if(!this.joinInfo)return;let r,o="";var l;t instanceof ie?(r=((l=t.data)===null||l===void 0?void 0:l.desc)||t.code,o=t.message):r=t,xe.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,errorMsg:o,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Je.IS_P2P_DISCONNECTED,t=>{t(ly(this,fi.IS_P2P_DISCONNECTED))}),this.signal.on(Je.DISCONNECT_P2P,()=>{this.emit(fi.DISCONNECT_P2P)}),this.signal.on(Je.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Je.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Je.JOIN_RESPONSE,t=>{const n=this.getCurrentGatewayAddress();this.emit(fi.JOIN_RESPONSE,t,n)}),this.signal.on(Je.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const t=this.getCurrentGatewayAddress(),n=G("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(t&&n){const r=GF(t);this.emit(fi.PRE_CONNECT_PC,{candidates:r,fingerprint:n})}}}),this.signal.on(Je.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof G("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(G("AP_REQUEST_DETAIL"),";").concat(t))})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(Ye.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(r){throw A.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r),r}}async tryUnsubDataChannelBeforeResub(t,n){try{await this.signal.request(Ye.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(r){throw A.warning("unsubscribe datachannel warning",r),r}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(Ye.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(r){throw A.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}}async tryUnpubDataChannelBeforeRepub(t,n){try{await this.signal.request(Ye.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(r){throw A.warning("unpublish datastream warning: ",r),r}}async tryMassUnsubBeforeResub(t){const n={users:t.map(r=>({stream_id:r.stream_id,stream_type:r.stream_type}))};try{await this.signal.request(Ye.UNSUBSCRIBE_STREAMS,n,!0)}catch(r){throw A.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}}async muteLocal(t,n){const r={action:t.find(o=>o.stream_type===Mt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(Ye.CONTROL,r,!0,!0)}catch(o){throw A.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),o),o}}async unmuteLocal(t,n){const r={action:t.find(o=>o.stream_type===Mt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(Ye.CONTROL,r,!0,!0)}catch(o){throw A.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),o),o}}async muteRemote(t,n){const r={action:t===Pe.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Ye.CONTROL,r,!0,!0)}catch(o){throw A.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),o),o}}async unmuteRemote(t,n){const r={action:t===Pe.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Ye.CONTROL,r,!0,!0)}catch(o){throw A.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),o),o}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(Ye.RESTART_ICE,n,!0)}catch(r){throw A.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r),r}}reconnect(t,n){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,n||xi.P2P_FAILED)}getCurrentGatewayAddress(){var t,n;if(!G("GATEWAY_WSS_ADDRESS"))return G("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(A.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(Ye.SET_PARAMETER,{enablePublishAudioFilter:t})}}let Sw=0,PO=0;function xa(e,t,n,r){return new we((o,l)=>{t.timeout=t.timeout||G("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),Sw+=Tc(t.data)):n&&(t.data.size?Sw+=t.data.size:t.data instanceof FormData?Sw+=M2(t.data):Sw+=Tc(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Pr.request(t).then(u=>{typeof u.data=="string"?PO+=Tc(u.data):u.data instanceof ArrayBuffer||u.data instanceof Uint8Array?PO+=u.data.byteLength:PO+=Tc(JSON.stringify(u.data)),r&&o({data:u.data,headers:u.headers}),o(u.data)}).catch(u=>{Pr.isCancel(u)?l(new ie(B.OPERATION_ABORTED,"cancel token canceled")):u.code==="ECONNABORTED"?l(new ie(B.NETWORK_TIMEOUT,u.message)):u.response?l(new ie(B.NETWORK_RESPONSE_ERROR,u.response.status)):l(new ie(B.NETWORK_ERROR,u.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(le){var Se=0;return function(){return Se<le.length?{done:!1,value:le[Se++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(le,Se,Le){return le==Array.prototype||le==Object.prototype||(le[Se]=Le.value),le},r,o=function(le){le=[typeof globalThis=="object"&&globalThis,le,typeof window=="object"&&window,typeof self=="object"&&self,typeof c=="object"&&c];for(var Se=0;Se<le.length;++Se){var Le=le[Se];if(Le&&Le.Math==Math)return Le}throw Error("Cannot find global object")}(this);function l(le,Se){if(Se)e:{var Le=o;le=le.split(".");for(var ue=0;ue<le.length-1;ue++){var O=le[ue];if(!(O in Le))break e;Le=Le[O]}(Se=Se(ue=Le[le=le[le.length-1]]))!=ue&&Se!=null&&n(Le,le,{configurable:!0,writable:!0,value:Se})}}function u(le){return(le={next:le})[Symbol.iterator]=function(){return this},le}function h(le){var Se=typeof Symbol<"u"&&Symbol.iterator&&le[Symbol.iterator];return Se?Se.call(le):{next:t(le)}}if(l("Symbol",function(le){function Se(O,W){this.A=O,n(this,"description",{configurable:!0,writable:!0,value:W})}if(le)return le;Se.prototype.toString=function(){return this.A};var Le="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ue=0;return function O(W){if(this instanceof O)throw new TypeError("Symbol is not a constructor");return new Se(Le+(W||"")+"_"+ue++,W)}}),l("Symbol.iterator",function(le){if(le)return le;le=Symbol("Symbol.iterator");for(var Se="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Le=0;Le<Se.length;Le++){var ue=o[Se[Le]];typeof ue=="function"&&typeof ue.prototype[le]!="function"&&n(ue.prototype,le,{configurable:!0,writable:!0,value:function(){return u(t(this))}})}return le}),typeof Object.setPrototypeOf=="function")r=Object.setPrototypeOf;else{var m;e:{var g={};try{g.__proto__={a:!0},m=g.a;break e}catch{}m=!1}r=m?function(le,Se){if(le.__proto__=Se,le.__proto__!==Se)throw new TypeError(le+" is not extensible");return le}:null}var E=r;function S(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function R(le){if(le.m)throw new TypeError("Generator is already running");le.m=!0}function b(le,Se){return le.h=3,{value:Se}}function x(le){this.g=new S,this.G=le}function P(le,Se,Le,ue){try{var O=Se.call(le.g.j,Le);if(!(O instanceof Object))throw new TypeError("Iterator result "+O+" is not an object");if(!O.done)return le.g.m=!1,O;var W=O.value}catch(q){return le.g.j=null,le.g.s(q),k(le)}return le.g.j=null,ue.call(le.g,W),k(le)}function k(le){for(;le.g.h;)try{var Se=le.G(le.g);if(Se)return le.g.m=!1,{value:Se.value,done:!1}}catch(Le){le.g.v=void 0,le.g.s(Le)}if(le.g.m=!1,le.g.l){if(Se=le.g.l,le.g.l=null,Se.F)throw Se.D;return{value:Se.return,done:!0}}return{value:void 0,done:!0}}function V(le){this.next=function(Se){return le.o(Se)},this.throw=function(Se){return le.s(Se)},this.return=function(Se){return function(Le,ue){R(Le.g);var O=Le.g.j;return O?P(Le,"return"in O?O.return:function(W){return{value:W,done:!0}},ue,Le.g.return):(Le.g.return(ue),k(Le))}(le,Se)},this[Symbol.iterator]=function(){return this}}function F(le,Se){return Se=new V(new x(Se)),E&&le.prototype&&E(Se,le.prototype),Se}if(S.prototype.o=function(le){this.v=le},S.prototype.s=function(le){this.l={D:le,F:!0},this.h=this.C||this.u},S.prototype.return=function(le){this.l={return:le},this.h=this.u},x.prototype.o=function(le){return R(this.g),this.g.j?P(this,this.g.j.next,le,this.g.o):(this.g.o(le),k(this))},x.prototype.s=function(le){return R(this.g),this.g.j?P(this,this.g.j.throw,le,this.g.o):(this.g.s(le),k(this))},l("Array.prototype.entries",function(le){return le||function(){return function(Se,Le){Se instanceof String&&(Se+="");var ue=0,O=!1,W={next:function(){if(!O&&ue<Se.length){var q=ue++;return{value:Le(q,Se[q]),done:!1}}return O=!0,{done:!0,value:void 0}}};return W[Symbol.iterator]=function(){return W},W}(this,function(Se,Le){return[Se,Le]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var K=function(le,Se){for(var Le=0;Le<le.length;Le++)Se(le[Le])},$=function(le){return le.replace(/\r?\n|\r/g,`\r
`)},Z=function(le,Se,Le){return Se instanceof Blob?(Le=Le!==void 0?Le+"":typeof Se.name=="string"?Se.name:"blob",Se.name===Le&&Object.prototype.toString.call(Se)!=="[object Blob]"||(Se=new File([Se],Le)),[String(le),Se]):[String(le),String(Se)]},J=function(le,Se){if(le.length<Se)throw new TypeError(Se+" argument required, but only "+le.length+" present.")},re=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,pe=re.FormData,Ce=re.XMLHttpRequest&&re.XMLHttpRequest.prototype.send,Ie=re.Request&&re.fetch,_t=re.navigator&&re.navigator.sendBeacon,Et=re.Element&&re.Element.prototype,Qt=re.Symbol&&Symbol.toStringTag;Qt&&(Blob.prototype[Qt]||(Blob.prototype[Qt]="Blob"),"File"in re&&!File.prototype[Qt]&&(File.prototype[Qt]="File"));try{new File([],"")}catch{re.File=function(Se,Le,ue){return Se=new Blob(Se,ue||{}),Object.defineProperties(Se,{name:{value:Le},lastModified:{value:+(ue&&ue.lastModified!==void 0?new Date(ue.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Qt&&Object.defineProperty(Se,Qt,{value:"File"}),Se}}var kn=function(le){return le.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},An=function(le){this.i=[];var Se=this;le&&K(le.elements,function(Le){if(Le.name&&!Le.disabled&&Le.type!=="submit"&&Le.type!=="button"&&!Le.matches("form fieldset[disabled] *"))if(Le.type==="file"){var ue=Le.files&&Le.files.length?Le.files:[new File([],"",{type:"application/octet-stream"})];K(ue,function(O){Se.append(Le.name,O)})}else Le.type==="select-multiple"||Le.type==="select-one"?K(Le.options,function(O){!O.disabled&&O.selected&&Se.append(Le.name,O.value)}):Le.type==="checkbox"||Le.type==="radio"?Le.checked&&Se.append(Le.name,Le.value):(ue=Le.type==="textarea"?$(Le.value):Le.value,Se.append(Le.name,ue))})};if((e=An.prototype).append=function(le,Se,Le){J(arguments,2),this.i.push(Z(le,Se,Le))},e.delete=function(le){J(arguments,1);var Se=[];le=String(le),K(this.i,function(Le){Le[0]!==le&&Se.push(Le)}),this.i=Se},e.entries=function le(){var Se,Le=this;return F(le,function(ue){if(ue.h==1&&(Se=0),ue.h!=3)return Se<Le.i.length?ue=b(ue,Le.i[Se]):(ue.h=0,ue=void 0),ue;Se++,ue.h=2})},e.forEach=function(le,Se){J(arguments,1);for(var Le=h(this),ue=Le.next();!ue.done;ue=Le.next()){var O=h(ue.value);ue=O.next().value,O=O.next().value,le.call(Se,O,ue,this)}},e.get=function(le){J(arguments,1);var Se=this.i;le=String(le);for(var Le=0;Le<Se.length;Le++)if(Se[Le][0]===le)return Se[Le][1];return null},e.getAll=function(le){J(arguments,1);var Se=[];return le=String(le),K(this.i,function(Le){Le[0]===le&&Se.push(Le[1])}),Se},e.has=function(le){J(arguments,1),le=String(le);for(var Se=0;Se<this.i.length;Se++)if(this.i[Se][0]===le)return!0;return!1},e.keys=function le(){var Se,Le,ue,O,W=this;return F(le,function(q){if(q.h==1&&(Se=h(W),Le=Se.next()),q.h!=3)return Le.done?void(q.h=0):(ue=Le.value,O=h(ue),b(q,O.next().value));Le=Se.next(),q.h=2})},e.set=function(le,Se,Le){J(arguments,2),le=String(le);var ue=[],O=Z(le,Se,Le),W=!0;K(this.i,function(q){q[0]===le?W&&(W=!ue.push(O)):ue.push(q)}),W&&ue.push(O),this.i=ue},e.values=function le(){var Se,Le,ue,O,W=this;return F(le,function(q){if(q.h==1&&(Se=h(W),Le=Se.next()),q.h!=3)return Le.done?void(q.h=0):(ue=Le.value,(O=h(ue)).next(),b(q,O.next().value));Le=Se.next(),q.h=2})},An.prototype._asNative=function(){for(var le=new pe,Se=h(this),Le=Se.next();!Le.done;Le=Se.next()){var ue=h(Le.value);Le=ue.next().value,ue=ue.next().value,le.append(Le,ue)}return le},An.prototype._blob=function(){var le="----formdata-polyfill-"+Math.random(),Se=[],Le="--"+le+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(ue,O){return typeof ue=="string"?Se.push(Le+kn($(O))+`"\r
\r
`+$(ue)+`\r
`):Se.push(Le+kn($(O))+'"; filename="'+kn(ue.name)+`"\r
Content-Type: `+(ue.type||"application/octet-stream")+`\r
\r
`,ue,`\r
`)}),Se.push("--"+le+"--"),new Blob(Se,{type:"multipart/form-data; boundary="+le})},An.prototype[Symbol.iterator]=function(){return this.entries()},An.prototype.toString=function(){return"[object FormData]"},Et&&!Et.matches&&(Et.matches=Et.matchesSelector||Et.mozMatchesSelector||Et.msMatchesSelector||Et.oMatchesSelector||Et.webkitMatchesSelector||function(le){for(var Se=(le=(this.document||this.ownerDocument).querySelectorAll(le)).length;0<=--Se&&le.item(Se)!==this;);return-1<Se}),Qt&&(An.prototype[Qt]="FormData"),Ce){var Ur=re.XMLHttpRequest.prototype.setRequestHeader;re.XMLHttpRequest.prototype.setRequestHeader=function(le,Se){Ur.call(this,le,Se),le.toLowerCase()==="content-type"&&(this.B=!0)},re.XMLHttpRequest.prototype.send=function(le){le instanceof An?(le=le._blob(),this.B||this.setRequestHeader("Content-Type",le.type),Ce.call(this,le)):Ce.call(this,le)}}Ie&&(re.fetch=function(le,Se){return Se&&Se.body&&Se.body instanceof An&&(Se.body=Se.body._blob()),Ie.call(this,le,Se)}),_t&&(re.navigator.sendBeacon=function(le,Se){return Se instanceof An&&(Se=Se._asNative()),_t.call(this,le,Se)}),re.FormData=An}})();const wy=()=>{const e=G("AREAS");return e.length===0&&e.push(Nt.GLOBAL),ms(e).call(e,(t,n,r)=>{const o=tB(n);return o?r===0?o:"".concat(t,",").concat(o):t},"")},tB=e=>e===Nt.OVERSEA?"".concat(Wi.ASIA,",").concat(Wi.EUROPE,",").concat(Wi.AFRICA,",").concat(Wi.NORTH_AMERICA,",").concat(Wi.SOUTH_AMERICA,",").concat(Wi.OCEANIA):Wi[e],PQ=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{const r=pw[n],o=Object.keys(r);o&&o.map(l=>{l!=="CODE"&&(t[l]=t[l].concat(r[l]))})}),t},Tw={GLOBAL:{ASIA:[Nt.CHINA,Nt.JAPAN,Nt.INDIA,Nt.KOREA,Nt.HKMC],EUROPE:[],NORTH_AMERICA:[Nt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Rw=Object.keys(Tw[Nt.GLOBAL]),DO=[Nt.CHINA,Nt.NORTH_AMERICA,Nt.EUROPE,Nt.ASIA,Nt.JAPAN,Nt.INDIA,Nt.OCEANIA,Nt.SOUTH_AMERICA,Nt.AFRICA,Nt.KOREA,Nt.HKMC,Nt.US],DQ=function(e,t){let n=[];if(Te(e).call(e,Nt.GLOBAL)){const l=[Nt.GLOBAL,Nt.OVERSEA],u=Object.keys(pw);if(t===Nt.GLOBAL)throw new ie(B.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===Nt.CHINA)n=[Nt.OVERSEA];else if(o=t,Te(Rw).call(Rw,o)){const h=(r=t,Tw[Nt.GLOBAL][r]||[]),m=[...l,t,...h];n=u.filter(g=>!Te(m).call(m,g))}else if(function(h){let m=!1;return Rw.forEach(g=>{var E;Te(E=Tw[Nt.GLOBAL][g]).call(E,h)&&(m=!0)}),m}(t)){const h=function(g){let E;return Rw.forEach(S=>{var R;Te(R=Tw[Nt.GLOBAL][S]).call(R,g)&&(E=S)}),E}(t),m=[...l,h,t];n=u.filter(g=>!Te(m).call(m,g))}else n=e;n=function(h){const m=[];return DO.forEach(g=>{Te(h).call(h,g)&&m.push(g)}),m.concat(h.filter(g=>!Te(DO).call(DO,g)))}(n)}else n=e;var r,o;return n};function nB(e){var t,n;if(!e&&Te(t=G("AREAS")).call(t,Nt.EXTENSIONS))return A.debug("update area from ap : reset"),void kO(j$,!0);if(!Te(n=G("AREAS")).call(n,Nt.GLOBAL)||!e)return;let r=pw.EXTENSIONS;r&&(r={CODE:tB(Nt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},A.debug("update area from ap success: ".concat(e,",config is "),r),Vt("AREAS",[Nt.EXTENSIONS],!0),Object.keys(r).map(o=>{o==="LOG_UPLOAD_SERVER"||o==="EVENT_REPORT_DOMAIN"||o==="EVENT_REPORT_BACKUP_DOMAIN"||o==="PROXY_SERVER_TYPE3"?Vt(o,r[o][0]):Vt(o,r[o])}))}function kO(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=xe.reportApiInvoke(null,{name:Hn.SET_AREA,options:e,tag:Tn.TRACER});try{let r=[];if(typeof e=="string"&&(r=[e]),Array.isArray(e)&&(e.forEach(l=>{if(!Te(TF).call(TF,l))throw new ie(B.INVALID_PARAMS,"invalid area code")}),r=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:l,excludedArea:u}=e;if(!l)throw new ie(B.INVALID_PARAMS,"area code is needed");let h=l;typeof l=="string"&&(h=[l]),r=u?DQ(h,u):h}if(!t){if(Pa.AREAS){const l=new ie(B.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(l),void A.warning("setArea is prohibited because of config-distribute")}if(Te(r).call(r,Nt.GLOBAL)&&G("AREAS")===Nt.EXTENSIONS){const l=new ie(B.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(l),void A.warning("setArea is prohibited because of ap extensions")}}Vt("AREAS",r,t);const o=PQ(r);Object.keys(o).map(l=>{l==="LOG_UPLOAD_SERVER"||l==="EVENT_REPORT_DOMAIN"||l==="EVENT_REPORT_BACKUP_DOMAIN"||l==="PROXY_SERVER_TYPE3"?Vt(l,o[l][0]):Vt(l,o[l])}),A.debug("set area success:",r.join(","))}catch(r){throw n.onError(r),r}n.onSuccess()}function iB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Ic(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?iB(Object(n),!0).forEach(function(r){U(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iB(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let LO=1;function kQ(e,t,n,r,o){LO+=1;const l={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:LO,requestId:LO,version:mo,cname:n.cname},u={service_name:t,json_body:JSON.stringify(l)};let h,m,g=e[0];return Na(async()=>{h=Date.now();const E=await xa(g,{data:u,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(m=Date.now()-h,E.code!==0){const b=new ie(B.UNEXPECTED_RESPONSE,"live streaming ap error, code"+E.code,{retry:!0,responseTime:m});throw A.error(b.toString()),b}const S=JSON.parse(E.json_body);if(S.code!==200){const b=new ie(B.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(S.code,", reason: ").concat(S.reason),{code:S.code,responseTime:m});throw A.error(b.toString()),b}if(!S.servers||S.servers.length===0){const b=new ie(B.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:S.code,responseTime:m});throw A.error(b.toString()),b}const R=function(b,x){return{addressList:b.servers.map(P=>"wss://".concat(P.address.replace(/\./g,"-"),".").concat(G("WORKER_DOMAIN"),":").concat(P.wss,"?serviceName=").concat(encodeURIComponent(x))),workerToken:b.workerToken,vid:b.vid}}(S,t);return G("LIVE_STREAMING_ADDRESS")&&(R.addressList=G("LIVE_STREAMING_ADDRESS")instanceof Array?G("LIVE_STREAMING_ADDRESS"):[G("LIVE_STREAMING_ADDRESS")]),Ic(Ic({},R),{},{responseTime:m})},(E,S)=>(xe.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(E.addressList),firstSuccess:S===0,responseTime:m,serverIp:e[S%e.length]}),!1),(E,S)=>(xe.apworkerEvent(n.sid,{success:!1,sc:E.data&&E.data.code||200,serviceName:t,responseTime:m,serverIp:e[S%e.length]}),!!(E.code!==B.OPERATION_ABORTED&&E.code!==B.UNEXPECTED_RESPONSE||E.data&&E.data.retry)&&(g=e[(S+1)%e.length],!0)),o)}let xO=1;function rB(e,t,n,r){let{url:o,areaCode:l}=e;const{clientId:u,sid:h}=t,m=Date.now();let g;const E=t.role,[S,R]=UO(t,l,[Vn.CHOOSE_SERVER]);let b=Un.networkState;return Na(async()=>{b&&Un.networkState===Ts.OFFLINE&&Un.onlineWaiter&&await we.race([Un.onlineWaiter,Si(r&&r.maxRetryTimeout||Kn.maxRetryTimeout)]),b=Un.networkState;const{data:x,headers:P}=await xa(o,{data:S,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);g=P.http3==="1"?1:-1,xe.reportResourceTiming(o,h),oB(x,o,t,m,[Vn.CHOOSE_SERVER],g);const k=vy(x,Vn.CHOOSE_SERVER);return MO(k),CO(k,o)},x=>(x&&xe.joinChooseServer(h,{role:E,lts:m,succ:!0,csAddr:o,opid:R,serverList:x.gatewayAddrs.map(P=>P.address),ec:null,cid:x.cid.toString(),uid:x.uid.toString(),csIp:x.csIp,unilbsServerIds:[Vn.CHOOSE_SERVER].toString(),isHttp3:g,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:x.res.detail&&x.res.detail[38]}),!1),x=>x.code!==B.OPERATION_ABORTED&&(x.code===B.CAN_NOT_GET_GATEWAY_SERVER?x.data.retry:(xe.joinChooseServer(h,{role:E,lts:m,succ:!1,csAddr:o,serverList:null,opid:R,ec:x.code,csIp:x.data&&x.data.csIp,unilbsServerIds:[Vn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:b}),isHttp3:g,corssRegionTagReq:t.apRequestDetail}),A.warning("[".concat(u||"sid-".concat(h.slice(0,6)),"] Choose server network error, retry"),x),!0)),r)}function sB(e,t,n,r){let o,{url:l,areaCode:u,serviceIds:h}=e;const m=Date.now(),g=t.role,[E,S]=UO(t,u,h);let R;return Na(async()=>{R&&Un.networkState===Ts.OFFLINE&&Un.onlineWaiter&&await we.race([Un.onlineWaiter,Si(r&&r.maxRetryTimeout||Kn.maxRetryTimeout)]),R=Un.networkState;const{data:b,headers:x}=await xa(l,{data:E,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);o=x.http3==="1"?1:-1,xe.reportResourceTiming(l,t.sid),oB(b,l,t,m,h,o);const P=vy(b,Vn.CHOOSE_SERVER),k=vy(b,t.cloudProxyServer==="proxy5"?Vn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Vn.CLOUD_PROXY:Vn.CLOUD_PROXY_FALLBACK);return MO(P),{gatewayInfo:CO(P,l),proxyInfo:k,url:l}},b=>(b.gatewayInfo&&xe.joinChooseServer(t.sid,{role:g,lts:m,succ:!0,csAddr:l,serverList:b.gatewayInfo.gatewayAddrs.map(x=>x.address),ec:null,opid:S,cid:b.gatewayInfo.cid.toString(),uid:b.gatewayInfo.uid.toString(),csIp:b.gatewayInfo.csIp,unilbsServerIds:h.toString(),isHttp3:o,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:b.gatewayInfo.res.detail&&b.gatewayInfo.res.detail[38]}),b.proxyInfo&&xe.joinWebProxyAP(t.sid,{lts:m,sucess:1,apServerAddr:l,turnServerAddrList:b.proxyInfo.addresses.map(x=>x.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:h.toString()}),!1),b=>b.code!==B.OPERATION_ABORTED&&(b.code===B.CAN_NOT_GET_GATEWAY_SERVER?b.data.retry:(xe.joinWebProxyAP(t.sid,{lts:m,sucess:0,apServerAddr:l,turnServerAddrList:null,errorCode:b.code,eventType:t.cloudProxyServer,unilbsServerIds:h.toString(),extend:JSON.stringify({networkState:R})}),A.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),b),!0)),r)}const oB=(e,t,n,r,o,l)=>{const{sid:u,clientId:h,cloudProxyServer:m}=n,g=[],E=S=>{S.flag===4096?xe.joinChooseServer(u,{role:n.role,lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:S.error.message,csIp:S.error.data&&S.error.data.csIp,unilbsServerIds:o.toString(),isHttp3:l,corssRegionTagReq:n.apRequestDetail}):S.flag!==1048576&&S.flag!==4194304&&S.flag!==4194310||xe.joinWebProxyAP(u,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:S.error.code,eventType:m,unilbsServerIds:o.toString()})};if(e.response_body.forEach(S=>{const R=S.buffer.code;if(S.uri===23&&R===0&&!S.buffer.edges_services)if(S.buffer.flag===4194310)A.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),S.buffer.edges_services=[];else{const b={error:new ie(B.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:S.buffer.flag};g.push(b),E(b)}if(R!==0){const b=ag(R),x={error:new ie(B.CAN_NOT_GET_GATEWAY_SERVER,b.desc,{desc:b.desc,retry:b.retry,csIp:e.detail[502]}),flag:S.buffer.flag};S.buffer.flag===4194310?A.warning(x.error.toString()):g.push(x),E(x)}}),g.length)throw A.warning("[".concat(h||"sid-".concat(u.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(g.map(S=>"flag: ".concat(S.flag,", message: ").concat(S.error.message,", retry: ").concat(S.error.data.retry)).join(" | "))),new ie(B.CAN_NOT_GET_GATEWAY_SERVER,g.map(S=>"flag: ".concat(S.flag,", message: ").concat(S.error.message)).join(" | "),{retry:!!g.find(S=>S.error.data.retry),csIp:e.detail[502],desc:[...new Set(g.map(S=>{var R;return S==null||(R=S.error)===null||R===void 0||(R=R.data)===null||R===void 0?void 0:R.desc}).filter(S=>!!S))]})},MO=e=>{var t,n,r,o;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new ie(B.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(G("AP_AREA")&&((r=e.detail)!==null&&r!==void 0&&r[23]&&typeof((o=e.detail)===null||o===void 0?void 0:o[23])=="string"?nB(e.detail[23].toLowerCase()):nB()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const u=e.detail[19],h=u==null?void 0:u.split(";");for(let m=0;m<h.length;m++){var l;const g=ir(l=h[m]).call(l);e.addresses[m]&&h&&(e.addresses[m].fingerprint=g)}}if(G("GATEWAY_ADDRESS")&&G("GATEWAY_ADDRESS").length>0){A.debug("assign gateway address to",G("GATEWAY_ADDRESS"));const u=G("GATEWAY_ADDRESS").map(h=>{var m,g;const E=(m=(g=e.addresses.find(S=>S.ip===h.ip&&S.port===h.port))===null||g===void 0?void 0:g.fingerprint)!==null&&m!==void 0?m:"";return{ip:h.ip,port:h.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:E}});e.addresses=u}},LQ=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const r=ag(n.buffer.code);throw new ie(B.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return n.buffer.ticket}throw A.debug("update ticket request received ap response without response body:",t),new ie(B.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},UO=(e,t,n)=>{const r=Math.floor(Math.random()*1e12),o=e.role==="host"?"1":e.role==="audience"?"2":void 0,l={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Ic(Ic(Ic({6:e.stringUid,11:t,12:G("USE_NEW_TOKEN")?"1":void 0},o?{17:o}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};l.request_bodies.forEach(h=>{e.multiIP&&e.multiIP.gateway_ip&&(h.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const u=new FormData;return u.append("request",JSON.stringify(l)),[u,r]},xQ=(e,t)=>{const n=Math.floor(Math.random()*1e12),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(l=>({ip:l.ip,port:l.port}))}}]},o=new FormData;return o.append("request",JSON.stringify(r)),[o,n]};let dg=0;function hg(e){return we.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}const Cy=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:r,allFailedhandler:o,promisesCollector:l}=e,u=0;const h=t;let m,g=0;const E=async()=>{const S=(()=>{const R=u*h,b=R+h;return n.slice(R,b).map(r)})();l&&l.push(...S);try{m=await hg(S)}catch(R){if(g+=h,u++,!(g>=n.length))return void await E();o(R)}S.forEach(R=>R.cancel())};return await E(),m},aB=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:r}=e;const o=t.length;let l=0;const u=async()=>{const h=n(t.shift());try{return await h}catch(m){if(l++,l>=o||r!=null&&r(m))throw m;return u()}};return u()};async function VO(e,t,n,r){return{gatewayInfo:await async function(l,u,h,m){let g=null;const E=[],S=async()=>{const b=G("WEBCS_DOMAIN").slice(0,G("AJAX_REQUEST_CONCURRENT")).map(k=>({url:l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(k+"/api/v2/transpond/webrtc?v=2"):"https://".concat(k,"/api/v2/transpond/webrtc?v=2"),areaCode:wy()})),x=m.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:b.map(k=>k.url)}),P=await Cy({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:b,asyncMapHandler:k=>(A.debug("[".concat(l.clientId,"] Connect to choose_server:"),k.url),rB(k,l,u,h)),allFailedhandler:k=>{throw m.recordJoinChannelService({endTs:Date.now(),status:"error",errors:k},x),k[0]},promisesCollector:E});return m.recordJoinChannelService({endTs:Date.now(),status:"success"},x),P},R=async()=>{if(await Si(1e3),g!==null)return g;const b=G("WEBCS_DOMAIN_BACKUP_LIST").map(k=>({url:l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(k+"/api/v2/transpond/webrtc?v=2"):"https://".concat(k,"/api/v2/transpond/webrtc?v=2"),areaCode:wy()})),x=m.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:b.map(k=>k.url)}),P=await Cy({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:b,asyncMapHandler:k=>(A.debug("[".concat(l.clientId,"] Connect to backup choose_server:"),k.url),rB(k,l,u,h)),allFailedhandler:k=>{throw m.recordJoinChannelService({endTs:Date.now(),status:"error",errors:k},x),k[0]},promisesCollector:E});return m.recordJoinChannelService({endTs:Date.now(),status:"success"},x),P};try{return g=await hg([S(),R()]),E.length&&E.forEach(b=>b.cancel&&typeof b.cancel=="function"&&b.cancel()),g}catch(b){throw b[0]}}(e,t,n,r)}}async function cB(e,t,n,r,o){const l=e.cloudProxyServer;if(l==="disabled"){if(e.useLocalAccessPoint)return await VO(e,t,n,o);if(G("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:R,proxyInfo:b}=await dB(e,t,n,o);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:R};const x=b.map(P=>({turnServerURL:P.address,tcpport:P.tcpport||Ui.tcpport,udpport:P.udpport||Ui.udpport,username:P.username||Ui.username,password:P.password||Ui.password,forceturn:!1,security:!0}));if(o.useP2P){var u;const P=(u=e.uid)!==null&&u!==void 0?u:R.uid,k="glb:".concat(P.toString()),V=await PI(k),F=b.map(K=>({turnServerURL:K.address,tcpport:K.tcpport||Ui.tcpport,udpport:K.udpport||Ui.udpport,username:k,password:V,forceturn:!1,security:!0}));x.push(...F)}return e.turnServer={mode:"manual",servers:x},{gatewayInfo:R}}return await VO(e,t,n,o)}const{proxyInfo:h,gatewayInfo:m}=await dB(e,t,n,o),g={gatewayInfo:m},E=h.map(R=>({turnServerURL:R.address,tcpport:l==="proxy3"?void 0:R.tcpport?R.tcpport:Ui.tcpport,udpport:l==="proxy4"?void 0:R.udpport?R.udpport:Ui.udpport,username:R.username||Ui.username,password:R.password||Ui.password,forceturn:l!=="proxy4",security:l==="proxy5"}));if(o.useP2P){var S;const R=(S=e.uid)!==null&&S!==void 0?S:m.uid,b="glb:".concat(R.toString()),x=await PI(b),P=h.map(k=>({turnServerURL:k.address,tcpport:l==="proxy3"?void 0:k.tcpport||Ui.tcpport,udpport:l==="proxy4"?void 0:k.udpport||Ui.udpport,username:b,password:x,forceturn:l!=="proxy4",security:l==="proxy5"}));E.push(...P)}return e.turnServer={mode:"manual",servers:E},A.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(l)),g}async function lB(e,t,n,r,o){const l=G("ACCOUNT_REGISTER").slice(0,G("AJAX_REQUEST_CONCURRENT"));let u=[];u=t.proxyServer?l.map(m=>"https://".concat(t.proxyServer,"/ap/?url=").concat(m+"/api/v1")):l.map(m=>"https://".concat(m,"/api/v1"));const h=o==null?void 0:o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:u});try{const m=await async function(g,E,S,R,b){const x=Date.now(),P={sid:S.sid,opid:10,appid:S.appId,string_uid:E};let k=g[0];const V=await Na(()=>xa(k+"".concat(k.indexOf("?")===-1?"?":"&","action=stringuid"),{data:P,cancelToken:R,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(F,K)=>{if(F.code===0){if(F.uid<=0||F.uid>=Math.pow(2,32))throw A.error("Invalid Uint Uid ".concat(E," => ").concat(F.uid),F),xe.reqUserAccount(P.sid,{lts:x,success:!1,serverAddr:k,stringUid:P.string_uid,uid:F.uid,errorCode:B.INVALID_UINT_UID_FROM_STRING_UID,extend:P}),new ie(B.INVALID_UINT_UID_FROM_STRING_UID);return xe.reqUserAccount(P.sid,{lts:x,success:!0,serverAddr:k,stringUid:P.string_uid,uid:F.uid,errorCode:null,extend:P}),!1}const $=ag(F.code);return $.retry&&(k=g[(K+1)%g.length]),xe.reqUserAccount(P.sid,{lts:x,success:!1,serverAddr:k,stringUid:P.string_uid,uid:F.uid,errorCode:$.desc,extend:P}),$.retry},(F,K)=>F.code!==B.OPERATION_ABORTED&&(xe.reqUserAccount(P.sid,{lts:x,success:!1,serverAddr:k,stringUid:P.string_uid,uid:null,errorCode:F.code,extend:P}),k=g[(K+1)%g.length],!0),b);if(V.code!==0){const F=ag(V.code);throw new ie(B.UNEXPECTED_RESPONSE,F.desc)}return V}(u,e,t,n,r);return o==null||o.recordJoinChannelService({status:"success",endTs:Date.now()},h),m.uid}catch(m){throw o==null||o.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[m]},h),m}}async function MQ(e,t,n){const r=G("ACCOUNT_REGISTER");let o=[];o=t.proxyServer?r.map(l=>"https://".concat(t.proxyServer,"/ap/?url=").concat(l+"/api/v1")):r.map(l=>"https://".concat(l,"/api/v1"));try{return await aB({referenceList:o,asyncMapHandler:u=>async function(h,m,g,E){const S=Date.now(),R={sid:g.sid,opid:10,appid:g.appId,string_uid:m};try{const b=await xa(h+"".concat(h.indexOf("?")===-1?"?":"&","action=stringuid"),{data:R,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(b.code!==0){const x=ag(b.code);throw new ie(B.UNEXPECTED_RESPONSE,"preload sua error:".concat(x.desc),x)}if(b.uid<=0||b.uid>=Math.pow(2,32))throw new ie(B.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:S,url:h,req:R,uid:b.uid,elapse:Date.now()-S}}catch(b){throw b}}(u,e,t,n),closeFn:u=>u.code===B.OPERATION_ABORTED||u.code===B.UNEXPECTED_RESPONSE&&!u.data.retry})}catch(l){throw l}}async function UQ(e,t,n){const r=G("CDS_AP").slice(0,G("AJAX_REQUEST_CONCURRENT")).map(m=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(m+"/api/v1"):"https://".concat(m,"/api/v1?action=config")),o=r.map(m=>function(g,E,S,R){const b=Tt(),x={flag:64,cipher_method:0,features:Ic(Ic(Ic(Ic(Ic({install_id:GI(),device:b.name,system:b.os,system_general:navigator.userAgent,vendor:E.appId,version:mo,cname:E.cname,session_id:E.sid,proxyServer:E.proxyServer,sdk_type:IQ.WEB_RTC,browser_name:b.name,browser_version:b.version,user_agent:navigator.userAgent,channel_name:E.cname},E.stringUid&&{string_uid:E.stringUid}),E.uid&&{uid:E.uid+""}),b.os&&{os_name:b.os}),b.osVersion&&{os_version:b.osVersion}),{},{detail:""})};return Na(()=>xa(g,{data:x,timeout:1e3,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,P=>P.code!==B.OPERATION_ABORTED,R)}(m,e,t,n));let l=null,u=null,h={};try{l=await hg(o)}catch(m){if(m.code===B.OPERATION_ABORTED)throw m;u=m}if(o.forEach(m=>m.cancel()),xe.reportApiInvoke(e.sid,{name:Hn.REQUEST_CONFIG_DISTRIBUTE,options:{error:u,res:l}}).onSuccess(),l&&l.test_tags)try{h=function(m){if(!m.test_tags)return{};const g=m.test_tags,E=Object.keys(g),S={};return E.forEach(R=>{var b;const x=ir(b=R.slice(4)).call(b),P=JSON.parse(g[R]),k=P[1];S[x]={tag:P[0]||"",value:k}}),S}(l)}catch{}return h}async function uB(e,t){const n=G("WEBCS_DOMAIN").concat(G("WEBCS_DOMAIN_BACKUP_LIST")).map(r=>({url:"https://".concat(r,"/api/v2/transpond/webrtc?v=2"),areaCode:wy(),serviceIds:[Vn.CHOOSE_SERVER,Vn.CLOUD_PROXY_FALLBACK]}));try{return await aB({referenceList:n,asyncMapHandler:o=>async function(l,u,h){let m,{url:g,areaCode:E,serviceIds:S}=l;const R=Date.now(),[b,x]=UO(u,E,S);let P=Un.networkState;try{P&&Un.networkState===Ts.OFFLINE&&Un.onlineWaiter&&await we.race([Un.onlineWaiter,Si(Kn.maxRetryTimeout)]),P=Un.networkState;const{data:k,headers:V}=await xa(g,{data:b,cancelToken:h,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);m=V.http3==="1"?1:-1,(Z=>{const J=[];if(Z.response_body.forEach(re=>{const pe=re.buffer.code;if(re.uri===23&&pe===0&&!re.buffer.edges_services)if(re.buffer.flag===4194310)re.buffer.edges_services=[];else{const Ce={error:new ie(B.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:Z.detail[502]}),flag:re.buffer.flag};J.push(Ce)}if(pe!==0){const Ce=ag(pe),Ie={error:new ie(B.CAN_NOT_GET_GATEWAY_SERVER,Ce.desc,{desc:Ce.desc,retry:Ce.retry,csIp:Z.detail[502]}),flag:re.buffer.flag};re.buffer.flag===4194310?A.warning(Ie.error.toString()):J.push(Ie)}}),J.length)throw new ie(B.CAN_NOT_GET_GATEWAY_SERVER,J.map(re=>"flag: ".concat(re.flag,", message: ").concat(re.error.message)).join(" | "),{retry:!!J.find(re=>re.error.data.retry),csIp:Z.detail[502],desc:[...new Set(J.map(re=>{var pe;return re==null||(pe=re.error)===null||pe===void 0||(pe=pe.data)===null||pe===void 0?void 0:pe.desc}).filter(re=>!!re))]})})(k);const K=vy(k,Vn.CHOOSE_SERVER),$=vy(k,Vn.CLOUD_PROXY_FALLBACK);return MO(K),{gatewayInfo:CO(K,g),proxyInfo:$,opid:x,requestTime:R,url:g,isHttp3:m,elapse:Date.now()-R}}catch(k){throw k}}(o,e,t),closeFn:o=>o.code===B.OPERATION_ABORTED||o.code===B.CAN_NOT_GET_GATEWAY_SERVER&&!o.data.retry})}catch(r){throw r}}async function dB(e,t,n,r){const o=G("PROXY_SERVER_TYPE3"),l=(b,x,P)=>{let k=P||o;return Array.isArray(k)&&(k=x%2==0?o[1]:o[0]),"https://".concat(k,"/ap/?url=").concat(b)};let u=null;const h=[],m=async()=>{const b=G("WEBCS_DOMAIN").slice(0,G("AJAX_REQUEST_CONCURRENT")).map((k,V)=>{let F;return F=e.cloudProxyServer==="disabled"&&e.proxyServer?l("".concat(k,"/api/v2/transpond/webrtc?v=2"),V,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(k,"/api/v2/transpond/webrtc?v=2"):l("".concat(k,"/api/v2/transpond/webrtc?v=2"),V),{url:F,areaCode:wy(),serviceIds:[Vn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Vn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Vn.CLOUD_PROXY:Vn.CLOUD_PROXY_FALLBACK]}}),x=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:b.map(k=>k.url)}),P=await Cy({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:b,asyncMapHandler:k=>(A.debug("[".concat(e.clientId,"] Connect to choose_server:"),k.url),sB(k,e,t,n)),allFailedhandler:k=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:k},x),k[0]},promisesCollector:h});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},x),P},g=async()=>{if(await Si(1e3),u!==null)return u;const b=G("WEBCS_DOMAIN_BACKUP_LIST").map((k,V)=>{let F;return F=e.cloudProxyServer==="disabled"&&e.proxyServer?l("".concat(k,"/api/v2/transpond/webrtc?v=2"),V,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(k,"/api/v2/transpond/webrtc?v=2"):l("".concat(k,"/api/v2/transpond/webrtc?v=2"),V),{url:F,areaCode:wy(),serviceIds:[Vn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Vn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Vn.CLOUD_PROXY:Vn.CLOUD_PROXY_FALLBACK]}}),x=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:b.map(k=>k.url)}),P=await Cy({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:b,asyncMapHandler:k=>(A.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),k.url),sB(k,e,t,n)),allFailedhandler:k=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:k},x),k[0]},promisesCollector:h});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},x),P};let E,S,R;try{({gatewayInfo:E,proxyInfo:S,url:R}=await hg([m(),g()]))}catch(b){throw b[0]}if(h.length&&h.forEach(b=>b.cancel&&typeof b.cancel=="function"&&b.cancel()),!E||!S)throw new ie(B.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=R,e.cloudProxyServer!=="disabled"&&Array.isArray(o)&&R){const b=/^https?:\/\/(.+?)(\/.*)?$/.exec(R)[1];Te(o).call(o,b)&&(e.proxyServer=b,A.setProxyServer(b),xe.setProxyServer(b))}return u={gatewayInfo:E,proxyInfo:await xF(S,E.uid)},u}async function VQ(e,t,n){const r=G("UAP_AP").slice(0,G("AJAX_REQUEST_CONCURRENT")).map(l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v1?action=uap"):"https://".concat(l,"/api/v1?action=uap")),o=r.map(l=>function(u,h,m,g){const E={command:"convergeAllocateEdge",sid:h.sid,appId:h.appId,token:h.token,ts:Date.now(),version:mo,cname:h.cname,uid:h.uid.toString(),requestId:xO,seq:xO};xO+=1;const S={service_name:"tele_channel",json_body:JSON.stringify(E)};return Na(async()=>{const R=await xa(u,{data:S,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(R.code!==0){const x=new ie(B.UNEXPECTED_RESPONSE,"cross channel ap error, code"+R.code,{retry:!0});throw A.error(x.toString()),x}const b=JSON.parse(R.json_body);if(b.code!==200){const x=new ie(B.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(b.code,", reason: ").concat(b.reason));throw A.error(x.toString()),x}if(!b.servers||b.servers.length===0){const x=new ie(B.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw A.error(x.toString()),x}return{vid:b.vid,workerToken:b.workerToken,addressList:(G("CHANNEL_MEDIA_RELAY_SERVERS")||b.servers).map(x=>"wss://".concat(x.address.replace(/\./g,"-"),".").concat(G("WORKER_DOMAIN"),":").concat(x.wss))}},void 0,R=>!!(R.code!==B.OPERATION_ABORTED&&R.code!==B.UNEXPECTED_RESPONSE||R.data&&R.data.retry),g)}(l,e,t,n));try{const l=await hg(o);return o.forEach(u=>u.cancel()),l}catch(l){throw l[0]}}async function FQ(e,t,n){let r=null;const o=[],l=async u=>{const h=G(u?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(m=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(m+"/api/v2/transpond/webrtc?v=2"):"https://".concat(m,"/api/v2/transpond/webrtc?v=2"));return u&&(await Si(1e3),r!==null)?r:await Cy({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:h,asyncMapHandler:m=>(A.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(u?"backup":""," choose_server:"),m),function(g,E,S,R){const[b]=xQ(E,[Vn.CHOOSE_SERVER]);let x=Un.networkState;return Na(async()=>{x&&Un.networkState===Ts.OFFLINE&&Un.onlineWaiter&&await we.race([Un.onlineWaiter,Si(R&&R.maxRetryTimeout||Kn.maxRetryTimeout)]),x=Un.networkState;const P=await xa(g,{data:b,cancelToken:S,headers:{"Content-Type":"multipart/form-data;"}},!0);return LQ(P,g)},()=>!1,P=>P.code!==B.OPERATION_ABORTED&&(P.code===B.UPDATE_TICKET_FAILED?P.data.retry:(A.warning("[".concat(E.clientId,"] update ticket network error, retry"),P),!0)),R)}(m,e,t,n)),allFailedhandler:m=>{throw m[0]},promisesCollector:o})};try{return r=await hg([l(!1),l(!0)]),o.length&&o.forEach(u=>u.cancel&&typeof u.cancel=="function"&&u.cancel()),r}catch(u){throw u[0]}}function hB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function FO(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?hB(Object(n),!0).forEach(function(r){U(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hB(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class BQ extends En{get isSuccess(){return!!this.configs}constructor(t,n){super(),U(this,"configs",void 0),U(this,"store",void 0),U(this,"joinInfo",void 0),U(this,"cancelToken",void 0),U(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),U(this,"interval",void 0),U(this,"mutex",void 0),U(this,"mutableParamsRead",!1),U(this,"configCache",{}),U(this,"limit_bitrate",void 0),this.mutex=new Gi("config-distribute",t),this.store=n}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),G("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},G("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,xe.reportApiInvoke(null,{options:void 0,name:Hn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Tn.TRACER}).onSuccess(JSON.stringify(Pa))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void A.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await UQ(this.joinInfo,this.cancelToken,this.retryConfig),A.debug("[config-distribute] get config distribute",JSON.stringify(t));const r=function(o){var l;const u=KE(l=Object.keys(o).filter(g=>/^webrtc_ng_global_parameter/.test(g))).call(l);for(let g=0;g<u.length;g++)for(let E=u.length-1;E>g;E--){const S=u[E],R=o[S].value;if(typeof R.__priority=="number"){const b=R.__priority,x=u[E-1],P=o[x].value;if(typeof P.__priority=="number"){if(!(b>P.__priority))continue;{const k=S;u[E]=u[E-1],u[E-1]=k}}else{const k=S;u[E]=u[E-1],u[E-1]=k}}}const h=Date.now();let m={};return u.forEach(g=>{const E=o[g].value.__expires;E&&E<=h||(m[g]=o[g])}),m}(t);this.cacheGlobalParameterConfig(r),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=r}catch(r){const o=new ie(B.NETWORK_RESPONSE_ERROR,r);A.warning("[config-distribute] ".concat(o.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){RF(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(_y.UPDATE_BITRATE_LIMIT,t):this.emit(_y.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&FO({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const n={},r=Object.keys(t),o=[];r.forEach(l=>{const u=t[l].value;n[l]=u;const h=u.__id;if(h&&this.configCache[l]&&this.configCache[l].__id===h)return;const m=u.__type,g=t[l].value,E=t[l].tag;let S=0;m?m===Q2.REALTIME&&(S=1):Object.keys(g).some(R=>Object.prototype.hasOwnProperty.call(KI,R)||!mO()&&Object.prototype.hasOwnProperty.call(HR,R)?(S=1,!0):void 0),o.push({tag:E,isApplied:S,feature:l,params:JSON.stringify(u)})}),o.forEach(l=>{let{tag:u,feature:h,params:m,isApplied:g}=l;this.store.sessionId&&xe.abTest(this.store.sessionId,{intSucc:1,isApplied:g,tag:u,feature:h,params:m,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){A.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(t){const n=function(o){const l={};return Object.keys(o).forEach(u=>{const h=o[u].value,m=h.__expires,g=h.__type;Object.keys(h).forEach(E=>{E==="__id"||E==="__type"||E==="__priority"||E==="__expires"||Object.prototype.hasOwnProperty.call(l,E)||(l[E]=FO(FO({value:h[E]},m&&{expires:m}),g&&{type:g}))})}),l}(t);try{var r;const o=(r=n.LIMIT_BITRATE)===null||r===void 0?void 0:r.value;delete n.LIMIT_BITRATE,o&&RF(o)&&this.handleBitrateLimit(o),this.limit_bitrate=o,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(t),function(h){try{const m=Date.now();Object.keys(h).forEach(g=>{const{value:E,type:S,expires:R}=h[g];R&&R<=m||((S===Q2.REALTIME||Object.prototype.hasOwnProperty.call(KI,g))&&(Pa[g]=E,on[g]=E,A.debug("Update realtime parameters from config distribute",g,E)),S||mO()||!Object.prototype.hasOwnProperty.call(HR,g)||(Pa[g]=E,on[g]=E,A.debug("Update gateway parameters from config distribute",g,E)))})}catch(m){A.error("Error update config immediately: ".concat(h),m.message)}}(n);const l=JSON.stringify(n),u=window.btoa(l);window.localStorage.setItem("websdk_ng_global_parameter",u),A.debug("Caching global parameters ".concat(l))}catch(o){A.error("Error caching global parameters:",o.message)}}handleGlobalParameterConfig(t){try{const n=Date.now();Object.keys(t).forEach(r=>{if(r==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(on,r)){const{value:o,expires:l}=t[r];if(l&&l<=n)return;(function(u,h){try{return typeof u=="object"&&typeof h=="object"&&JSON.stringify(u)===JSON.stringify(h)}catch{return!1}})(on[r],o)||(Pa[r]=o,on[r]=o,this.emit(_y.UPDATE_CLIENT_ROLE_OPTIONS,o),A.debug("Updating client role options: ".concat(JSON.stringify(o))))}})}catch(n){A.error("Error handling global parameter config:",n.message)}}}class jQ extends En{constructor(){super(...arguments),U(this,"resultStorage",new Map)}setLocalAudioStats(t,n,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(r,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(r,n))}setLocalVideoStats(t,n,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(r,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(r,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(r))}setRemoteAudioStats(t,n){const r=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const r=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(n))}record(t,n,r){if(G("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const o=this.resultStorage.get(t);if(o&&(o.result.push(r),o.result.length>=5)){var l;const u=Te(l=o.result).call(l,!0);o.isPrevNormal&&!u&&this.emit("exception",pB[t],t,n),!o.isPrevNormal&&u&&this.emit("exception",pB[t]+2e3,t+"_RECOVER",n),o.isPrevNormal=u,o.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof $n&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let r=null;n._encoderConfig&&n._encoderConfig.frameRate&&(r=Rs(n._encoderConfig.frameRate));const o=t.captureFrameRate;return!r||!o||!(r>10&&o<5||r<10&&r>=5&&o<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof $n&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const pB={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Hi=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}};function fB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function tp(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?fB(Object(n),!0).forEach(function(r){U(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fB(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class by{constructor(t){U(this,"store",void 0),U(this,"onStatsException",void 0),U(this,"onUploadPublishDuration",void 0),U(this,"onStatsChanged",void 0),U(this,"localStats",new Map),U(this,"remoteStats",new Map),U(this,"updateStatsInterval",void 0),U(this,"trafficStats",void 0),U(this,"trafficStatsPeerList",[]),U(this,"uplinkStats",void 0),U(this,"exceptionMonitor",void 0),U(this,"p2pChannel",void 0),U(this,"scalabilityMode",zR.L1T1),U(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new jQ,this.exceptionMonitor.on("exception",(n,r,o)=>{this.onStatsException&&this.onStatsException(n,r,o)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(he.LocalAudioTrack)||tp({},$I)}getLocalVideoTrackStats(){return this.localStats.get(he.LocalVideoTrack)||tp({},QI)}getRemoteAudioTrackStats(t){const n=(l,u)=>{if(!this.trafficStats)return u;const h=this.trafficStats.peer_delay.find(m=>m.peer_uid===l);return h&&(u.publishDuration=h.B_ppad+(Date.now()-this.trafficStats.timestamp)),u},r={};if(t){var o;const l=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.audioStats;l&&(r[t]=n(t,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[u,{audioStats:h}]=l;h&&(r[u]=n(u,h))});return r}getRemoteNetworkQualityStats(t){const n={};if(t){var r;const o=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.networkStats;o&&(n[t]=o)}else Array.from(this.remoteStats.entries()).forEach(o=>{let[l,{networkStats:u}]=o;u&&(n[l]=u)});return n}getRemoteVideoTrackStats(t){const n=(l,u)=>{if(!this.trafficStats)return u;const h=this.trafficStats.peer_delay.find(m=>m.peer_uid===l);return h&&(u.publishDuration=h.B_ppvd+(Date.now()-this.trafficStats.timestamp)),u},r={};if(t){var o;const l=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.videoStats;l&&(r[t]=n(t,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[u,{videoStats:h}]=l;h&&(r[u]=n(u,h))});return r}getRTCStats(){let t=0,n=0,r=0,o=0;const l=this.localStats.get(he.LocalAudioTrack);l&&(t+=l.sendBytes,n+=l.sendBitrate);const u=this.localStats.get(he.LocalVideoTrack);u&&(t+=u.sendBytes,n+=u.sendBitrate);const h=this.localStats.get(he.LocalVideoLowTrack);h&&(t+=h.sendBytes,n+=h.sendBitrate),this.remoteStats.forEach(g=>{let{audioStats:E,videoStats:S}=g;E&&(r+=E.receiveBytes,o+=E.receiveBitrate),S&&(r+=S.receiveBytes,o+=S.receiveBitrate)});let m=1;return this.trafficStats&&(m+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:m,SendBitrate:n,SendBytes:t,RecvBytes:r,RecvBitrate:o,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var r;const o=(r=this.p2pChannel)===null||r===void 0?void 0:r.getRemoteMedia(n.peer_uid),l=o!=null&&o.videoSSRC?Hi.measureFromSubscribeStart(this.store.clientId,o.videoSSRC):0,u=o!=null&&o.audioSSRC?Hi.measureFromSubscribeStart(this.store.clientId,o.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,l>u?l:u),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&A.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,r){if(!t)return!1;const o=!!r&&n.framesDecodeFreezeTime>r.framesDecodeFreezeTime,l=!r||n.framesDecodeCount>r.framesDecodeCount;return o||!l}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[r,o]=n;switch(r){case he.LocalVideoTrack:case he.LocalVideoLowTrack:{const u=o,h=tp({},QI),m=t.getStats(),g=t.getLocalMedia(r);if(m){const E=m.videoSend.find(S=>S.ssrc===(g==null?void 0:g.ssrcs[0].ssrcId));if(E){const S=t.getLocalVideoSize(),R=t.getEncoderConfig(he.LocalVideoTrack);E.codec!=="H264"&&E.codec!=="H265"&&E.codec!=="VP8"&&E.codec!=="VP9"&&E.codec!=="AV1X"&&E.codec!=="AV1"||(h.codecType=E.codec),h.sendBytes=E.bytes,h.sendBitrate=u?8*Math.max(0,h.sendBytes-u.sendBytes):0,E.inputFrame?(h.captureFrameRate=E.inputFrame.frameRate,h.captureResolutionHeight=E.inputFrame.height,h.captureResolutionWidth=E.inputFrame.width):S&&(h.captureResolutionWidth=S.width,h.captureResolutionHeight=S.height),E.sentFrame?(h.sendFrameRate=E.sentFrame.frameRate,h.sendResolutionHeight=E.sentFrame.height,h.sendResolutionWidth=E.sentFrame.width):S&&(h.sendResolutionWidth=S.width,h.sendResolutionHeight=S.height),E.avgEncodeMs&&(h.encodeDelay=E.avgEncodeMs),R&&R.bitrateMax&&(h.targetSendBitrate=1e3*R.bitrateMax),h.sendPackets=E.packets,h.sendPacketsLost=E.packetsLost,h.sendJitterMs=E.jitterMs,h.sendRttMs=E.rttMs,h.totalDuration=u?u.totalDuration+1:1,h.totalFreezeTime=u?u.totalFreezeTime:0,this.isLocalVideoFreeze(E)&&(h.totalFreezeTime+=1),E.scalabilityMode&&this.scalabilityMode!==E.scalabilityMode&&(A.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(E.scalabilityMode)),this.scalabilityMode=E.scalabilityMode)}this.trafficStats&&(h.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var l;this.localStats.set(r,h),((u==null?void 0:u.sendResolutionWidth)!==h.sendResolutionWidth||(u==null?void 0:u.sendResolutionHeight)!==h.sendResolutionHeight)&&((l=this.onStatsChanged)===null||l===void 0||l.call(this,"resolution",{width:h.sendResolutionWidth,height:h.sendResolutionHeight})),h&&g&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,g.track,h);break}case he.LocalAudioTrack:{const u=o,h=tp({},$I),m=t.getStats(),g=t.getLocalMedia(r);if(m){const E=m.audioSend.find(S=>S.ssrc===(g==null?void 0:g.ssrcs[0].ssrcId));if(E){if(E.codec!=="opus"&&E.codec!=="aac"&&E.codec!=="PCMU"&&E.codec!=="PCMA"&&E.codec!=="G722"||(h.codecType=E.codec),E.inputLevel)h.sendVolumeLevel=Math.round(32767*E.inputLevel);else{const S=t.getLocalAudioVolume();S&&(h.sendVolumeLevel=Math.round(32767*S))}h.sendBytes=E.bytes,h.sendPackets=E.packets,h.sendPacketsLost=E.packetsLost,h.sendJitterMs=E.jitterMs,h.sendRttMs=E.rttMs,h.sendBitrate=u?8*Math.max(0,h.sendBytes-u.sendBytes):0}}this.trafficStats&&(h.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(he.LocalAudioTrack,h),h&&g&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,g.track,h);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{var r,o;let[l,{videoStats:u,audioStats:h,videoPcStats:m}]=n;const g=h,E=u,S=m,R=tp({},lU),b=tp({},uU),x=tp({},C$),{audioTrack:P,videoTrack:k,audioSSRC:V,videoSSRC:F}=t.getRemoteMedia(l);let K;K=this.store.useP2P?t.getStats(!0):t.getStats();const $=(r=K)===null||r===void 0?void 0:r.audioRecv.find(pe=>pe.ssrc===V),Z=(o=K)===null||o===void 0?void 0:o.videoRecv.find(pe=>pe.ssrc===F),J=this.trafficStats&&this.trafficStats.peer_delay.find(pe=>pe.peer_uid===l);if($&&($.codec!=="opus"&&$.codec!=="aac"&&$.codec!=="PCMU"&&$.codec!=="PCMA"&&$.codec!=="G722"||(R.codecType=$.codec),$.outputLevel?R.receiveLevel=Math.round(32767*$.outputLevel):P&&(R.receiveLevel=Math.round(32767*P.getVolumeLevel())),R.receiveBytes=$.bytes,R.receivePackets=$.packets,R.receivePacketsLost=$.packetsLost,R.receivePacketsDiscarded=$.packetsDiscarded,R.packetLossRate=R.receivePacketsLost/(R.receivePackets+R.receivePacketsLost),R.receiveBitrate=g?8*Math.max(0,R.receiveBytes-g.receiveBytes):0,R.totalDuration=g?g.totalDuration+1:1,R.totalFreezeTime=g?g.totalFreezeTime:0,R.freezeRate=R.totalFreezeTime/R.totalDuration,R.receiveDelay=$.jitterBufferMs,R.totalDuration>10&&by.isRemoteAudioFreeze(P)&&(R.totalFreezeTime+=1)),Z){var re;Z.codec!=="H264"&&Z.codec!=="H265"&&Z.codec!=="VP8"&&Z.codec!=="VP9"&&Z.codec!=="AV1X"&&Z.codec!=="AV1"||(b.codecType=Z.codec),b.receiveBytes=Z.bytes,b.receiveBitrate=E?8*Math.max(0,b.receiveBytes-E.receiveBytes):0,b.decodeFrameRate=Z.decodeFrameRate<0?0:Z.decodeFrameRate,b.renderFrameRate=Z.decodeFrameRate<0?0:Z.decodeFrameRate,Z.outputFrame&&(b.renderFrameRate=Z.outputFrame.frameRate),Z.receivedFrame?(b.receiveFrameRate=Z.receivedFrame.frameRate,b.receiveResolutionHeight=Z.receivedFrame.height,b.receiveResolutionWidth=Z.receivedFrame.width):k&&(b.receiveResolutionHeight=k._videoHeight||0,b.receiveResolutionWidth=k._videoWidth||0),Z.framesRateFirefox!==void 0&&(b.receiveFrameRate=Math.round(Z.framesRateFirefox)),b.receivePackets=Z.packets,b.receivePacketsLost=Z.packetsLost,b.packetLossRate=b.receivePacketsLost/(b.receivePackets+b.receivePacketsLost);const pe=E?E.totalFreezeTime:0,Ce=E?E.totalDuration:0;b.totalDuration=E?E.totalDuration+1:1,b.totalFreezeTime=(re=Z.totalFreezesDuration)!==null&&re!==void 0?re:pe||0,b.receiveDelay=Z.jitterBufferMs||0;const Ie=!!F&&t.getRemoteVideoIsReady(F);Z.totalFreezesDuration===void 0&&k&&Ie&&by.isRemoteVideoFreeze(k,Z,S)&&(b.totalFreezeTime+=1),b.freezeRate=Math.max(0,Math.min((b.totalFreezeTime-pe)/(b.totalDuration-Ce),1))}J&&(R.end2EndDelay=J.B_ad,b.end2EndDelay=J.B_vd,R.transportDelay=J.B_ed,b.transportDelay=J.B_ed,R.currentPacketLossRate=J.B_ealr4/100,b.currentPacketLossRate=J.B_evlr4/100,x.uplinkNetworkQuality=J.B_punq?J.B_punq:0,x.downlinkNetworkQuality=J.B_pdnq?J.B_pdnq:0),this.remoteStats.set(l,{audioStats:R,videoStats:b,videoPcStats:Z,networkStats:x}),P&&this.exceptionMonitor.setRemoteAudioStats(P,R),k&&this.exceptionMonitor.setRemoteVideoStats(k,b)})}}class mB{constructor(){U(this,"destChannelMediaInfos",new Map),U(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){SF(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){SF(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){uw(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function gB(e){if(!(e instanceof mB))return new ie(B.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new ie(B.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new ie(B.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class id{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){U(this,"uid",void 0),U(this,"_uintid",void 0),U(this,"_trust_in_room_",!0),U(this,"_trust_audio_enabled_state_",!0),U(this,"_trust_video_enabled_state_",!0),U(this,"_trust_audio_mute_state_",!0),U(this,"_trust_video_mute_state_",!0),U(this,"_audio_muted_",!1),U(this,"_video_muted_",!1),U(this,"_audio_enabled_",!0),U(this,"_video_enabled_",!0),U(this,"_audio_added_",!1),U(this,"_video_added_",!1),U(this,"_is_pre_created",!1),U(this,"_video_pre_subscribed",!1),U(this,"_audio_pre_subscribed",!1),U(this,"_trust_video_stream_added_state_",!0),U(this,"_trust_audio_stream_added_state_",!0),U(this,"_audioTrack",void 0),U(this,"_videoTrack",void 0),U(this,"_dataChannels",[]),U(this,"_audioSSRC",void 0),U(this,"_videoSSRC",void 0),U(this,"_audioOrtc",void 0),U(this,"_videoOrtc",void 0),U(this,"_cname",void 0),U(this,"_rtxSsrcId",void 0),U(this,"_videoMid",void 0),U(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}function _B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function EB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?_B(Object(n),!0).forEach(function(r){U(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_B(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const Ay="9",yB=4e4;function vB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function ql(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?vB(Object(n),!0).forEach(function(r){U(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vB(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var pg=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(pg||{});const ww=new Map;function SB(e,t,n,r){let{scale:o}=e;if(o===0&&r===pg.UP||o>=t.length-1&&r===pg.DOWN)return e;let l=ql(ql({},e),{},{scale:r===pg.DOWN?++o:--o});switch(n){case"maintain-framerate":l=ql(ql({},l),t[o].motion);break;case"maintain-resolution":l=ql(ql({},l),t[o].detail);break;case"balanced":l=ql(ql({},l),t[o].balanced)}return l}function TB(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:RB(t)};ww.set(e,n)}else ww.delete(e)}function RB(e){const t=ql({},e),{bitrateMax:n,frameRate:r,scaleResolutionDownBy:o,bitrateMin:l}=t,{MIN_FRAME_RATE:u,MAX_THRESHOLD_FRAMERATE:h,MAX_SCALE:m,BITRATE_MIN_THRESHOLD:g,BITRATE_MAX_THRESHOLD:E,BWE_SCALE_UP_THRESHOLD:S,BWE_SCALE_DOWN_THRESHOLD:R,PERF_SCALE_DOWN_THRESHOLD:b,PERF_SCALE_UP_THRESHOLD:x,BALANCE_BITRATE_FACTOR:P,BALANCE_FRAMERATE_FACTOR:k,BALANCE_RESOLUTION_FACTOR:V,MOTION_RESOLUTION_FACTOR:F,MOTION_BITRATE_FACTOR:K,DETAIL_FRAMERATE_FACTOR:$,DETAIL_BITRATE_FACTOR:Z}=zI,J=Math.min(t.frameRate,h),re=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(R,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(b,1)*J),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:l},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:l},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:l}}];for(let pe=1;pe<=m;pe++){const Ce={bwe_up:Math.round(Math.pow(S,pe)*n),bwe_down:Math.round(Math.pow(R,pe+1)*n),fps_up:Math.round(Math.pow(x,pe)*J),fps_down:Math.round(Math.pow(b,pe+1)*J)},Ie={scaleResolutionDownBy:o/Math.pow(V,pe),frameRate:Math.max(Math.round(Math.pow(k,pe)*r),u),bitrateMax:Math.max(Math.round(Math.pow(P,pe)*n),E),bitrateMin:Math.max(Math.round(Math.pow(P,pe)*l),g)},_t={scaleResolutionDownBy:o/Math.pow(F,pe),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(K,pe)*n),E),bitrateMin:Math.max(Math.round(Math.pow(K,pe)*l),g)},Et={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow($,pe)*r),u),bitrateMax:Math.max(Math.round(Math.pow(Z,pe)*n),E),bitrateMin:Math.max(Math.round(Math.pow(Z,pe)*l),g)};re.push({scale:pe,threshold:Ce,balanced:Ie,motion:_t,detail:Et})}return re}function GQ(e,t,n,r,o,l){const u=ww.get(e)||{overUse:0,underUse:0,adaptationList:RB(o)},{adaptationList:h}=u;ww.set(e,u);const{OVERUSE_TIMES_THRESHOLD:m,UNDERUSE_TIMES_THRESHOLD:g}=zI,{scale:E}=r;let S,R;return typeof t=="number"&&t>0&&function(b,x,P,k){if(x>=P.length)return!1;let{threshold:{fps_down:V}}=P[x];return G("FORCE_AG_HIGH_FRAMERATE")&&k==="maintain-framerate"&&(V=P[0].threshold.fps_down),b<V}(t,E,h,l)&&(u.overUse++,R=dy.CPU,u.overUse>m)||typeof n=="number"&&n>0&&function(b,x,P){if(x>=P.length)return!1;const{threshold:{bwe_down:k}}=P[x];return b<k}(n,E,h)&&(u.overUse++,R=dy.BANDWIDTH,u.overUse>m)?(u.overUse=0,u.underUse=0,S=SB(r,h,l,pg.DOWN),[S,R]):(typeof t=="number"&&t>0&&typeof n=="number"&&n>0&&function(b,x,P,k){if(x===0)return;let{threshold:{fps_up:V}}=P[x];return G("FORCE_AG_HIGH_FRAMERATE")&&k==="maintain-framerate"&&(V=P[1].threshold.fps_up),b>V}(t,E,h,l)&&function(b,x,P){if(x===0)return;const{threshold:{bwe_up:k}}=P[x];return b>k}(n,E,h)&&(u.underUse++,u.underUse>g&&(u.overUse=0,u.underUse=0,S=SB(r,h,l,pg.UP),S.scale===0&&(R=dy.NONE))),[S,R])}function wB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function BO(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?wB(Object(n),!0).forEach(function(r){U(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wB(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function WQ(e){var t;return!!G("ENABLE_AG_ADAPTATION")&&!!(e instanceof aO||Te(t=e._hints).call(t,$t.CUSTOM_TRACK))&&(!!G("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(n){const r=Tt();if(r.os!==oi.IOS||!r.osVersion)return!1;const o=r.osVersion.split(".");return Number(o[0])>=n}(14)&&v2(17,4)||y2(14)&&S2(17,4,!0)))}const Cw=new Map;function bw(e,t){const n=Cw.get(e);if(n){const{timer:r}=n;window.clearTimeout(r),Cw.delete(e)}t.qualityLimitationReason=dy.NONE,TB(e)}function zQ(e,t){var n;let r;switch(t){case he.LocalAudioTrack:r=Mt.Audio;break;case he.LocalVideoTrack:r=Te(n=e._hints).call(n,$t.SCREEN_TRACK)?Mt.Screen:Mt.High;break;case he.LocalVideoLowTrack:r=Mt.Low}return r}function jO(e){const t=bt();if(e.some(n=>n._bypassWebAudio))throw new oe(B.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new oe(B.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function GO(e,t){jO(e);const n=new $n;return e.forEach(r=>n.addAudioTrack(r)),n}const HQ=!bt().supportUnifiedPlan||G("CHROME_FORCE_PLAN_B")&&Ul();function Aw(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return HQ?(n={spec:t,store:e},Hl("PlanBConnection").create(n)):new Oc(t,e)}function WO(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function CB(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(cy(e.turnServer.servers))return!1;if(G("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var vt;function bB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Ma(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?bB(Object(n),!0).forEach(function(r){U(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bB(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Oc=(vt=class Cp extends CF{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return Te(n=Object.keys(KR)).call(n,t)}))]}constructor(t,n){super(t,n),U(this,"id",Jt(5,"connection-")),U(this,"store",void 0),U(this,"peerConnection",void 0),U(this,"forceTurn",!1),U(this,"remoteSDP",void 0),U(this,"initialOffer",void 0),U(this,"transportEventReceiver",void 0),U(this,"statsFilter",void 0),U(this,"extension",{useXR:G("USE_XR")}),U(this,"localCapabilities",void 0),U(this,"remoteCodecs",void 0),U(this,"localCandidateCount",0),U(this,"allCandidatesReceived",!1),U(this,"isPreallocation",!1),U(this,"preSSRCMap",new Map),U(this,"dataStreamChannelMap",new Map),U(this,"establishPromise",void 0),U(this,"recoveredDataChannelIds",[]),U(this,"currentDataChannelId",1),U(this,"supportAV1RtpSpec",!1),U(this,"mutex",void 0),U(this,"qualityLimitationReason",dy.NONE),U(this,"isFirstConnected",!1),this.store=n,this.forceTurn=CB(t),this.mutex=new Gi("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Cp.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=jI(this.peerConnection,G("STATS_UPDATE_INTERVAL"),void 0,vn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(t){const n=this.preSSRCMap.get(t);if(n!==void 0){const r=this.peerConnection.getTransceivers().find(o=>o.mid===n);if(r)return{transceiver:r,track:r.receiver.track,id:n}}}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void A.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const r=await this.peerConnection.createOffer(),o=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);const l=this.remoteSDP.toString();o==null||o(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}else A.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const o=td(r.sdp),l=await HF({filterRTX:!G("USE_PUB_RTX")&&!G("USE_SUB_RTX"),filterVideoFec:G("FILTER_VIDEO_FEC"),filterAudioFec:G("FILTER_AUDIO_FEC"),filterVideoCodec:G("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=yw(l),this.initialOffer=r,G("ENABLE_SVC")&&this.store.codec=="av1"){const h=await async function(){try{const m=new RTCPeerConnection;m.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:zR.L1T3}]});const g=await m.createOffer();if(!g.sdp)return void m.close();const E=Qr(g.sdp).mediaDescriptions[0];if(!E)return;const S=E.attributes.extmaps.find(R=>R.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return m.close(),S}catch{return}}();var t;h&&(this.supportAV1RtpSpec=!0,(t=l.send)===null||t===void 0||t.videoExtensions.push(h))}let u;return r.sdp&&XF(r.sdp)&&(u=Rn(l),(n=u).send&&(cg(Pe.VIDEO,n.send.videoExtensions),cg(Pe.AUDIO,n.send.audioExtensions)),n.recv&&(cg(Pe.VIDEO,n.recv.videoExtensions),cg(Pe.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(cg(Pe.VIDEO,n.sendrecv.videoExtensions),cg(Pe.AUDIO,n.sendrecv.audioExtensions))),Ma(Ma({},o),{},{rtpCapabilities:u||l,offerSDP:r.sdp})}catch(r){throw new oe(B.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}var n}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&XF(this.initialOffer.sdp)&&(n=t.rtpCapabilities,r=this.localCapabilities,n.send&&(gw(Pe.VIDEO,n.send.videoExtensions,r.send.videoExtensions),gw(Pe.AUDIO,n.send.audioExtensions,r.send.audioExtensions)),n.recv&&(gw(Pe.VIDEO,n.recv.videoExtensions,r.recv.videoExtensions),gw(Pe.AUDIO,n.recv.audioExtensions,r.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Rn(this._localCapabilities)}get rtpCapabilities(){return Rn(this._rtpCapabilities)}get candidates(){return Rn(this._candidates)}get iceParameters(){return Rn(this._iceParameters)}get dtlsParameters(){return Rn(this._dtlsParameters)}constructor(g){let E=arguments.length>1&&arguments[1]!==void 0&&arguments[1];U(this,"sessionDesc",void 0),U(this,"_localCapabilities",void 0),U(this,"_rtpCapabilities",void 0),U(this,"_candidates",void 0),U(this,"_originCandidates",void 0),U(this,"_iceParameters",void 0),U(this,"_isUseExtmapAllowMixed",void 0),U(this,"_dtlsParameters",void 0),U(this,"setup",void 0),U(this,"currentMidIndex",void 0),U(this,"cname",void 0),U(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=E,g=Rn(g);const{iceParameters:S,dtlsParameters:R,candidates:b,rtpCapabilities:x,setup:P,localCapabilities:k,cname:V}=g;this._rtpCapabilities=x,this._candidates=b,this._originCandidates=Rn(b),this._iceParameters=S,this._dtlsParameters=R,this._localCapabilities=k,this.setup=P,this.cname=V,this.sessionDesc=this.updateRemoteRTPCapabilities(x),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(g){const E=this.candidates,S=this.dtlsParameters,R=this.iceParameters,b=this.rtpCapabilities.send;let x=this.sessionDesc.mediaDescriptions.length-1;for(let P=1;P<g;P++){const k=2*P+2e4,V=2*P+yB,{ssrcs:F,ssrcGroups:K}=ep([{ssrcId:k}],this.cname),{ssrcs:$,ssrcGroups:Z}=ep([{ssrcId:V,rtx:G("USE_SUB_RTX")?V+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Ay,protos:["UDP","TLS","RTP","SAVPF"],fmts:b.videoCodecs.map(J=>J.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:R.iceUfrag,icePwd:R.icePwd,unrecognized:[],candidates:E,extmaps:b.videoExtensions,fingerprints:S.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:$,ssrcGroups:Z,rtcpFeedbackWildcards:[],payloads:b.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++x)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Ay,protos:["UDP","TLS","RTP","SAVPF"],fmts:b.audioCodecs.map(J=>J.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:R.iceUfrag,icePwd:R.icePwd,unrecognized:[],candidates:E,extmaps:b.audioExtensions,fingerprints:S.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:F,ssrcGroups:K,rtcpFeedbackWildcards:[],payloads:b.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++x)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Ju(this.sessionDesc)}send(g,E,S,R){const{ssrcs:b,ssrcGroups:x}=ep(E,this.cname,G("SYNC_GROUP")?S:void 0),P=this.findPreloadMediaDesc(b);if(P){if(vn()&&this.firefoxSsrcMidMap.set(b[0].ssrcId,P.attributes.mid),R&&(R.twcc||R.remb)){const k=this.sessionDesc.mediaDescriptions.indexOf(P);return this.sessionDesc.mediaDescriptions[k]=this.mungSendMediaDesc(P,R),{mid:P.attributes.mid,needExchangeSDP:!0}}return{mid:P.attributes.mid,needExchangeSDP:!1}}{const k=this.findAvailableMediaIndex(g,b);let V;return k===-1||k===1&&(Li()||function(){const F=Tt();return!(F.name!==Ot.CHROME||!F.osVersion)&&Number(F.version)<=90}()||G("ENABLE_ENCODED_TRANSFORM")&&Ml())||k===0&&G("USE_SUB_RTX")||T2()?(V=this.createOrRecycleSendMedia(g,b,x,"sendonly",R),this.updateBundleMids()):(V=Rn(this.sessionDesc.mediaDescriptions[k]),V.attributes.direction="sendonly",V.attributes.ssrcs=b,V.attributes.ssrcGroups=x,this.sessionDesc.mediaDescriptions[k]=this.mungSendMediaDesc(V,R)),vn()&&this.firefoxSsrcMidMap.set(b[0].ssrcId,V.attributes.mid),{mid:V.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:g,needExchangeSDP:E}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:g.attributes.mid,needExchangeSDP:E}}batchSend(g){const E=g.map(b=>{let{kind:x,ssrcMsg:P,mslabel:k}=b;return this.send(x,P,k)}),S=[];let R=!1;return E.forEach(b=>{let{mid:x,needExchangeSDP:P}=b;P&&(R=!0),S.push(x)}),{mids:S,needExchangeSDP:R}}stopSending(g){const E=this.sessionDesc.mediaDescriptions.filter(S=>S.attributes.mid&&g.indexOf(S.attributes.mid)!==-1);if(E.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");E.forEach(S=>{S.attributes.mid==="0"||vn()||T2()?S.attributes.ssrcs=[]:(S.attributes.ssrcs=[],S.attributes.direction="inactive",S.media.port="0")}),this.updateBundleMids()}mute(g){const E=this.sessionDesc.mediaDescriptions.find(S=>S.attributes.mid===g);if(!E)throw new Error("mediaDescription not found with ".concat(g," in remote SDP when calling RemoteSDP.mute."));E.attributes.direction="inactive"}unmute(g){const E=this.sessionDesc.mediaDescriptions.find(S=>S.attributes.mid===g);if(!E)throw new Error("mediaDescription not found with ".concat(g," in remote SDP when calling RemoteSDP.unmute."));E.attributes.direction="sendonly"}muteRemote(g){const E=this.sessionDesc.mediaDescriptions.filter(S=>Te(g).call(g,S.attributes.mid||""));if(E.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");E.forEach(S=>{S.attributes.direction="inactive"})}unmuteRemote(g){const E=this.sessionDesc.mediaDescriptions.filter(S=>Te(g).call(g,S.attributes.mid||""));if(E.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");E.forEach(S=>{S.attributes.direction="recvonly"})}receive(g,E,S,R){g.forEach((b,x)=>{this.createOrRecycleRecvMedia(b,[],"recvonly",E,S,R[x])}),this.updateBundleMids()}stopReceiving(g){const E=this.sessionDesc.mediaDescriptions.filter(S=>g.indexOf(S.attributes.mid)!==-1);if(E.length!==g.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");E.forEach(S=>{S.media.port="0",S.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(g){const E=this.sessionDesc||Qr((S=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(S?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var S;this._rtpCapabilities=g;const R=this.rtpCapabilities.send,b=this.localCapabilities.send;for(const x of E.mediaDescriptions){if(x.attributes.iceUfrag=this._iceParameters.iceUfrag,x.attributes.icePwd=this._iceParameters.icePwd,x.attributes.fingerprints=this._dtlsParameters.fingerprints,x.attributes.candidates=this._candidates,x.attributes.setup=this.setup,x.media.mediaType==="application"&&(x.attributes.sctpPort="5000"),x.media.mediaType==="video"){if(R.videoCodecs.length===0){const P=b.videoCodecs.filter(k=>{var V,F;return(V=k.rtpMap)===null||V===void 0?void 0:Te(F=V.encodingName.toLowerCase()).call(F,"vp8")})||[b.videoCodecs[0]];x.media.fmts=P.map(k=>k.payloadType.toString(10)),x.attributes.payloads=P,x.attributes.extmaps=[]}else if(x.media.fmts=R.videoCodecs.map(P=>P.payloadType.toString(10)),x.attributes.payloads=R.videoCodecs,x.attributes.extmaps=R.videoExtensions,G("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:P,ssrcGroups:k}=ep([{ssrcId:yB,rtx:G("USE_SUB_RTX")?40001:void 0}],this.cname);x.attributes.ssrcs=P,x.attributes.ssrcGroups=k}}if(x.media.mediaType==="audio"){if(R.audioCodecs.length===0){const P=b.audioCodecs.filter(k=>{var V,F;return(V=k.rtpMap)===null||V===void 0?void 0:Te(F=V.encodingName.toLowerCase()).call(F,"opus")})||[b.audioCodecs[0]];x.media.fmts=P.map(k=>k.payloadType.toString(10)),x.attributes.payloads=P,x.attributes.extmaps=[]}else if(x.media.fmts=R.audioCodecs.map(P=>P.payloadType.toString(10)),x.attributes.payloads=R.audioCodecs,x.attributes.extmaps=R.audioExtensions,ug(x),G("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:P,ssrcGroups:k}=ep([{ssrcId:2e4}],this.cname);x.attributes.ssrcs=P,x.attributes.ssrcGroups=k}}}return this.sessionDesc=E,this.currentMidIndex=E.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(g){const E=this._originCandidates.filter(R=>R.transport==="udp"),S=[];if(E.forEach(R=>{S.push(EB(EB({},R),{},{foundation:"tcpcandidate",priority:Number(R.priority)-1+"",transport:"tcp",port:Number(R.port)+90+""}))}),E.length!==0){switch(g){case zi.TCP_RELAY:this._candidates=S;break;case zi.UDP_TCP_RELAY:case zi.RELAY:this._candidates=[...E,...S];break;default:this._candidates=E}for(const R of this.sessionDesc.mediaDescriptions)R.attributes.candidates=this.candidates}}restartICE(g){g=Rn(g),this._iceParameters=g,this.sessionDesc.mediaDescriptions.forEach(E=>{E.attributes.iceUfrag=g.iceUfrag,E.attributes.icePwd=g.icePwd})}predictReceivingMids(g){const E=[];for(let S=0;S<g;S++)E.push((this.currentMidIndex+S+1).toString(10));return E}findAvailableMediaIndex(g,E){return this.sessionDesc.mediaDescriptions.findIndex(S=>{const R=S.media.mediaType===g&&S.media.port!=="0"&&(S.attributes.direction==="sendonly"||S.attributes.direction==="sendrecv")&&S.attributes.ssrcs.length===0;if(vn()){if(R){const b=this.firefoxSsrcMidMap.get(E[0].ssrcId);return!(b||S.attributes.mid!=="0"&&S.attributes.mid!=="1")||!(!b||b!==S.attributes.mid)}return!1}return R})}createOrRecycleDataChannel(){for(const S of this.sessionDesc.mediaDescriptions)if(S.media.mediaType==="application")return{mediaDesc:S,needExchangeSDP:!1};this.currentMidIndex+=1;const g="".concat(this.currentMidIndex),E={media:{mediaType:"application",port:Ay,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(g),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(E),{mediaDesc:E,needExchangeSDP:!0}}createOrRecycleRecvMedia(g,E,S,R,b,x){const P=g._mediaStreamTrack.kind,k=this.rtpCapabilities.recv,V=Ty(P,k,this.localCapabilities.send,P===Pe.VIDEO?R:b),F=P===Pe.VIDEO?k.videoExtensions:k.audioExtensions;this.currentMidIndex+=1;const K="".concat(this.currentMidIndex);let $={media:{mediaType:P,port:Ay,protos:["UDP","TLS","RTP","SAVPF"],fmts:V.map(J=>J.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:F,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:E,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:V,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:S,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(K)}};$=this.mungRecvMediaDsec($,g,x);const Z=this.findFirstClosedMedia(P);if(Z){const J=this.sessionDesc.mediaDescriptions.indexOf(Z);this.sessionDesc.mediaDescriptions[J]=$}else this.sessionDesc.mediaDescriptions.push($);return $}updateRemoteCodec(g,E,S){const R=[...new Set(this._rtpCapabilities.recv.videoCodecs.map($=>$.rtpMap&&$.rtpMap.encodingName.toLowerCase()||"").filter($=>{var Z;return Te(Z=Object.keys(KR)).call(Z,$)}))],b=new Set(E);if(R.every($=>b.has($)))return A.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(E)),!1;const x=this._rtpCapabilities.recv.videoCodecs.filter($=>E.some(Z=>{var J;return Te(J=$.rtpMap&&$.rtpMap.encodingName.toLowerCase()||"").call(J,Z)}));if(x.length===0)return A.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(R," codecs: ").concat(E)),!1;const P=[...new Set(x.map($=>$.rtpMap&&$.rtpMap.encodingName.toLowerCase()||""))];let k;if(A.debug("updateRemoteCodec, from ".concat(R," to ").concat(P)),g.length===0)k=this.sessionDesc.mediaDescriptions.filter($=>$.media.mediaType==="video"&&$.attributes.direction==="recvonly");else if(k=this.sessionDesc.mediaDescriptions.filter($=>$.attributes.mid&&Te(g).call(g,$.attributes.mid)&&$.attributes.direction==="recvonly"),k.length!==g.length)return A.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(g,", codecs: ").concat(E)),!1;if(G("USE_PUB_RTX")||G("USE_SUB_RTX")){const $=OO(x,this.rtpCapabilities.recv.videoCodecs);x.push(...$)}this._rtpCapabilities.recv.videoCodecs=x;const V=this.localCapabilities.send,F=this.rtpCapabilities.recv,K=Ty(Pe.VIDEO,F,V,S);return k.forEach($=>{const Z=K.map(J=>J.payloadType.toString(10));A.debug("updateRemoteCodec mid: ".concat($.attributes.mid,", from"),$.attributes.payloads,"to",K),$.attributes.payloads=K,$.media.fmts=Z}),!0}createOrRecycleSendMedia(g,E,S,R,b){const x=this.rtpCapabilities.send,P=g===Pe.VIDEO?x.videoCodecs:x.audioCodecs,k=g===Pe.VIDEO?x.videoExtensions:x.audioExtensions;this.currentMidIndex+=1;const V="".concat(this.currentMidIndex);let F={media:{mediaType:g,port:Ay,protos:["UDP","TLS","RTP","SAVPF"],fmts:P.map($=>$.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:k,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:E,ssrcGroups:S,rtcpFeedbackWildcards:[],payloads:P,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:R,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(V)}};F=this.mungSendMediaDesc(F,b);const K=this.findFirstClosedMedia(g);if(K){const $=this.sessionDesc.mediaDescriptions.indexOf(K);this.sessionDesc.mediaDescriptions[$]=F}else this.sessionDesc.mediaDescriptions.push(F);return F}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(g=>g.media.port!=="0").map(g=>g.attributes.mid)}mungRecvMediaDsec(g,E,S){const R=Rn(g);return AO(R),lg(R,E),IO(R,E),WF(R),Ew(R,S,this.localCapabilities.send),R}mungSendMediaDesc(g,E){const S=Rn(g);return Ew(S,E,this.localCapabilities.recv),ug(S),S}updateRecvMedia(g,E){const S=this.sessionDesc.mediaDescriptions.findIndex(R=>R.attributes.mid===g);if(S!==-1){const R=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[S],E);this.sessionDesc.mediaDescriptions[S]=R}}bumpMid(g){this.currentMidIndex+=g}findFirstClosedMedia(g){return this.sessionDesc.mediaDescriptions.find(E=>vn()?E.media.port==="0"&&E.media.mediaType===g:E.media.port==="0")}findPreloadMediaDesc(g){return this.sessionDesc.mediaDescriptions.find(E=>{var S;return((S=E.attributes)===null||S===void 0||(S=S.ssrcs[0])===null||S===void 0?void 0:S.ssrcId)===g[0].ssrcId})}getSSRC(g){var E;return(E=this.sessionDesc.mediaDescriptions.find(S=>S.attributes.mid===g))===null||E===void 0?void 0:E.attributes.ssrcs}}(Ma(Ma({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const o=this.remoteSDP.toString(),l=qF(this.initialOffer.sdp,this.extension),u=this.logSDPExchange(l||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:l}),u==null||u(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o});const h=this.peerConnection.getTransceivers()[0];if(h!=null&&h.receiver&&this.tryBindTransportEvents(h.receiver),G("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(G("PRELOAD_MEDIA_COUNT"));const g=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:g});const E=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(E)}const{preSSRCs:m}=t;if(Array.isArray(m)&&m.length>0){const{mids:g}=this.remoteSDP.batchSend(m.map(E=>({kind:E.kind,ssrcMsg:[{ssrcId:E.ssrcId,rtx:E.rtx}],mslabel:E.mslabel})));g.forEach((E,S)=>{this.preSSRCMap.set(m[S].ssrcId,E)}),await Ry(this.peerConnection,this.remoteSDP,this.extension),A.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(o){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(o.toString()))}var n,r}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:n}=t;this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:r}=t;if(Array.isArray(r)&&r.length>0){const{mids:o}=this.remoteSDP.batchSend(r.map(l=>Object.assign({},{kind:l.kind,ssrcMsg:[{ssrcId:l.ssrcId,rtx:l.rtx}],mslabel:l.mslabel})));o.forEach((l,u)=>{this.preSSRCMap.set(r[u].ssrcId,l)})}await Ry(this.peerConnection,this.remoteSDP,this.extension),A.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(n){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,r){var o=this;return fo(function*(){const l=yield St(o.mutex.lock("From P2PConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=[],h=mw();t.forEach(k=>{const V=o.peerConnection.addTransceiver(k._mediaStreamTrack,Ma({direction:"sendonly"},k.trackMediaType==="video"&&o.supportAV1RtpSpec&&h?{sendEncodings:[{scalabilityMode:h}]}:{}));u.push(V),k._updateRtpTransceiver(V)}),vn()&&G("SIMULCAST")===!0&&(yield St(o.applySimulcastForFirefox(u,t)));const m=yield St(o.peerConnection.createOffer()),g=o.remoteSDP.predictReceivingMids(t.length),E=o.mungSendOfferSDP(m.sdp,t,g),S=Qr(E),R=g.map(k=>{const V=S.mediaDescriptions.find(F=>F.attributes.mid===k);if(!V)throw new Error("Cannot extract ssrc from mediaDescription.");return BF(V,G("USE_PUB_RTX"))});let b;try{b=yield R}catch(k){b=[],o.remoteSDP.receive(t,n,r,b);const V=o.remoteSDP.toString();throw yield St(o.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield St(o.peerConnection.setRemoteDescription({type:"answer",sdp:V})),yield St(o.stopSending(g,!0)),k}o.remoteSDP.receive(t,n,r,b);const x=o.remoteSDP.toString(),P=o.logSDPExchange(E,"offer","local","send");return yield St(o.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield St(o.applySimulcastEncodings(u,t)),yield St(o.applySendEncodings(u,t)),P==null||P(x),yield St(o.peerConnection.setRemoteDescription({type:"answer",sdp:x})),u.map((k,V)=>{const F=g[V];return{localSSRC:R[V],id:F,transceiver:k}})}catch(u){throw u instanceof oe?u:new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{l()}})()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);if(r&&r.readyState==="open")A.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const l=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof l!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:l,negotiated:!0,ordered:!1,maxRetransmits:G("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)}n.forEach(l=>{l._updateOriginDataChannel(r)});const{needExchangeSDP:o}=this.remoteSDP.sendDataChannel();if(o){const l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const u=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(u),A.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else A.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof oe?r:new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof oe?n:new oe(B.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const o=this.peerConnection.getTransceivers().filter(m=>t.indexOf(m.mid)!==-1);if(o.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");o.map(m=>{var g;bw(this.id+m.mid,this),m.direction="inactive",(g=m.stop)===null||g===void 0||g.call(m)});const l=await this.peerConnection.createOffer(),u=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);const h=this.remoteSDP.toString();u==null||u(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(o){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}finally{r&&r()}}async receive(t,n,r,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:u}=this.remoteSDP.send(t,n,r,o);u&&(await Ry(this.peerConnection,this.remoteSDP,this.extension),A.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const h=this.peerConnection.getTransceivers().find(m=>m.mid===l);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:l,transceiver:h}}catch(l){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:r}=this.remoteSDP.batchSend(t);return r&&(await Ry(this.peerConnection,this.remoteSDP,this.extension),A.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(o=>{const l=this.peerConnection.getTransceivers().find(u=>u.mid===o);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:o,transceiver:l}})}catch(n){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(l=>{Array.from(this.preSSRCMap.entries()).some(u=>{let[h,m]=u;if(m===l)return this.preSSRCMap.delete(h),!0})}),this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();r==null||r(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();r==null||r(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();r==null||r(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(u=>u.mid&&t.indexOf(u.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(u=>{u.direction="inactive"});const r=await this.peerConnection.createOffer(),o=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const l=this.remoteSDP.toString();o==null||o(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(u=>u.mid&&t.indexOf(u.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(u,h)=>{u.direction="sendonly"});const r=await this.peerConnection.createOffer(),o=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const l=this.remoteSDP.toString();o==null||o(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return fo(function*(){const r=yield St(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const o=bt().supportPCSetConfiguration,l=G("FORCE_TURN_TCP")||n.forceTurn;if(t===zi.RELAY&&!o)return;if(o&&!l){const S=t===zi.RELAY?"relay":"all",R=n.peerConnection.getConfiguration();R.iceTransportPolicy!==S&&(A.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(R.iceTransportPolicy,"] to [").concat(S,"]")),R.iceTransportPolicy=S,n.peerConnection.setConfiguration(R))}n.remoteSDP.updateCandidates(t);const u=yield St(n.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=td(u.sdp),{remoteIceParameters:m}=yield h.iceParameters;n.remoteSDP.restartICE(m);const g=n.remoteSDP.toString(),E=n.logSDPExchange(u.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield St(n.peerConnection.setLocalDescription(u)),E==null||E(g),yield St(n.peerConnection.setRemoteDescription({type:"answer",sdp:g}))}catch(o){A.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),o)}finally{r()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(zi.TCP_RELAY),await Ry(this.peerConnection,this.remoteSDP,this.extension)}catch(n){A.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{bw(this.id+n.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Ma(Ma({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const l=this.remoteSDP.toString(),u=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),u==null||u(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new oe(B.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter(o=>o.mid===t);r.length===1&&(this.isVP8Simulcast(n)?vn()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find(o=>o.mid===n);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:r,remote:o}=n.getSelectedCandidatePair();return{local:Ma(Ma({},Rc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Ma(Ma({},Rc),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;const r="code: ".concat(t.errorCode,", message: ").concat(t.errorText),o=t.port?"local: ".concat(t.port):"";A.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(r,"), url: ").concat(t.url||"",", host_candidate:").concat(o)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,r)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&A.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,A.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,A.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},G("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(cy(t.turnServer.servers)?n.iceServers=t.turnServer.servers:G("NEW_TURN_MODE")&&n.iceServers?(G("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...Cp.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...Cp.newTurnServerConfigToIceServers(t.turnServer.servers)),G("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...Cp.turnServerConfigToIceServers(t.turnServer.servers)),G("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Cp.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),G("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),G("ENABLE_ENCODED_TRANSFORM")&&bt().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Zu(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!G("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{const o=G("NEW_TURN_MODE");o===1?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}):o===2?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}):o===3?n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Zu(r.turnServerURL),":443?transport=tcp")}):o===4&&(n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=udp")}),n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":3478?transport=tcp")}),n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Zu(r.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var o;n!=null&&n.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,n.state))},n.onerror=o=>{var l;(l=this.onDTLSTransportError)===null||l===void 0||l.call(this,"error"in o?o.error:o)};const r=n.iceTransport;r&&(r.onstatechange=()=>{const o=n==null?void 0:n.iceTransport.state;var l;o&&((l=this.onICETransportStateChange)===null||l===void 0||l.call(this,o))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:o,remote:l}=r.getSelectedCandidatePair();A.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var r,o;if(n||(n=this.peerConnection.getSenders().find(k=>k.track===t._mediaStreamTrack)),!n)return A.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return A.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!bt().supportSetRtpSenderParameters)return A.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const l={},u={};switch(t._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;case"balanced":l.degradationPreference="balanced"}const h=function(P,k){return P.getTransceivers().find(V=>V.sender.track===k||V.receiver.track===k)}(this.peerConnection,t._mediaStreamTrack),m=N$(t);if(WQ(t)&&h&&n&&m&&this.getLocalVideoStats&&Te(r=["vp8","vp9"]).call(r,this.store.codec)){var g;const P=l.degradationPreference||(Te(g=t._hints).call(g,$t.CUSTOM_TRACK)?G("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(k,V,F,K,$,Z){if(bw(k,F),$(V),K!=="balanced"&&K!=="maintain-framerate"&&K!=="maintain-resolution")return;let J=-1;TB(k,V);const re=window.setInterval(()=>{const Ce=Cw.get(k);if(!G("ENABLE_AG_ADAPTATION")||!Ce)return bw(k,F),void $(V);const Ie=Z();if(Ie.sendPackets>0&&Ie.OutgoingAvailableBandwidth>0){if(J===-1)return void(J=Date.now());if(Date.now()-J<1e3)return;const _t=Ie.sendFrameRate,Et=Ie.OutgoingAvailableBandwidth,[Qt,kn]=GQ(k,_t,Et,Ce.adaptationConfig,V,K);kn&&(F.qualityLimitationReason=kn),Qt&&Ce.adaptationConfig.scale!==Qt.scale&&(A.debug("[".concat(k,"] applyAdaptation: ").concat(F.qualityLimitationReason,`
           sendFps `).concat(_t,", bwe ").concat(Et,", switch from ").concat(Ce.adaptationConfig.scale," to ").concat(Qt.scale," ")),Ce.adaptationConfig=BO(BO({},Ce.adaptationConfig),Qt),$(Qt))}},G("CHECK_LOCAL_STATS_INTERVAL")),pe=BO({},V);Cw.set(k,{timer:re,adaptationConfig:pe,originConfig:V,adaptationFunc:$}),A.debug("[".concat(k,"] start adaptation, originConfig: ").concat(JSON.stringify(V),", degradationPreference: ").concat(K))})(this.id+h.mid,m,this,P,k=>{n&&this.updateAdaptation(n,k)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var E;const{bitrateMax:P,frameRate:k,scaleResolutionDownBy:V}=t._encoderConfig;P&&(u.maxBitrate=1e3*P),(Te(E=t._hints).call(E,$t.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(k&&(u.maxFramerate=Rs(k)),V&&V>=1&&(u.scaleResolutionDownBy=V))}const{maxFramerate:S}=G("ENCODER_CONFIG_LIMIT");if(S&&typeof S=="number"&&(u.maxFramerate=u.maxFramerate?Math.min(u.maxFramerate,S):S),G("DSCP_TYPE")&&Ul()){var R;const P=G("DSCP_TYPE");Te(R=["very-low","low","medium","high"]).call(R,P)&&(u.networkPriority=P)}const b=n.getParameters(),x=(o=b.encodings)===null||o===void 0?void 0:o[0];vn()&&!x&&(l.encodings=[u]),x&&Object.assign(x,u),Object.assign(b,l),A.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(b.encodings))),await n.setParameters(b),await async function(P,k,V){try{var F;if(!bt().supportSetRtpSenderParameters||!function(re){return re==="vp9"||re==="av1"}(P)||!G("ENABLE_SVC"))return;const K={},$={},Z=k.getParameters(),J=(F=Z.encodings)===null||F===void 0?void 0:F[0];$.scalabilityMode=mw(V),J&&Object.assign(J,$),Object.assign(Z,K),await k.setParameters(Z),A.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(Z.encodings)))}catch(K){A.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",K)}}(this.store.codec,n,G("SVC_MODE"))}async updateAdaptation(t,n){var r,o;if(!t)return A.debug("[updateAdaptation] no rtpSender found");if(!bt().supportSetRtpSenderParameters)return A.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const l={},{bitrateMax:u,frameRate:h,scaleResolutionDownBy:m}=n;u&&(l.maxBitrate=1e3*u),h&&(l.maxFramerate=Rs(h)),m&&m>=1&&Te(r=["vp8","vp9"]).call(r,this.store.codec)&&(l.scaleResolutionDownBy=m);const g=t.getParameters(),E=(o=g.encodings)===null||o===void 0?void 0:o[0];E&&Object.assign(E,l),Object.assign(g,{});try{await t.setParameters(g),A.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(g.encodings)))}catch(S){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?A.debug("[updateAdaptation] peerConnection not connected}"):A.debug("[updateAdaptation] updateRtpSenderEncodings failed",S):A.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!bt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const o=t[r],l=n[r];l instanceof an&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,o.sender)}}catch{A.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,r){const o=Qr(t);return n.forEach((l,u)=>{const h=r[u],m=o.mediaDescriptions.find(g=>g.attributes.mid===h);m&&(lg(m,l),zF(m,l,this.store.codec))}),Ju(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let m=0;m<t.length;m++){var r,o,l,u,h;const g=t[m],E=n[m];if(E instanceof an&&!Te(r=E._hints).call(r,$t.LOW_STREAM)&&(o=E._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((l=E._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(u=E._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=E._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1&&this.store.codec==="vp8"){const S={},R={high:1e3*(E._encoderConfig.bitrateMax-50),medium:5e4};S.encodings=[{rid:"m",active:!0,maxBitrate:R.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:R.high}];const b=g.sender.getParameters();await g.sender.setParameters(Object.assign(b,S))}}}async applySimulcastEncodings(t,n){if(!vn()&&t.length===n.length)for(let r=0;r<t.length;r++){const o=n[r];if(o instanceof an&&this.isVP8Simulcast(o)){const l=t[r],u={},h={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};u.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:h.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:h.medium,scaleResolutionDownBy:4}];const m=l.sender.getParameters();await l.sender.setParameters(Object.assign(m,u))}}}isVP8Simulcast(t){var n,r,o,l,u;return!!(t instanceof an&&G("SIMULCAST")&&this.store.codec==="vp8"&&!Te(n=t._hints).call(n,$t.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((o=t._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=t._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1)}logSDPExchange(t,n,r,o){if(G("SDP_LOGGING"))return A.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(o,`
`),t),n==="offer"?l=>{this.logSDPExchange(l,"answer",r==="local"?"remote":"local",o)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(bt().supportPCSetConfiguration){const n=Cp.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},ke(vt.prototype,"updateRemoteRTPCapabilities",[kr],Object.getOwnPropertyDescriptor(vt.prototype,"updateRemoteRTPCapabilities"),vt.prototype),ke(vt.prototype,"connect",[kr],Object.getOwnPropertyDescriptor(vt.prototype,"connect"),vt.prototype),ke(vt.prototype,"updateRemoteConnect",[kr],Object.getOwnPropertyDescriptor(vt.prototype,"updateRemoteConnect"),vt.prototype),ke(vt.prototype,"createDataChannels",[kr],Object.getOwnPropertyDescriptor(vt.prototype,"createDataChannels"),vt.prototype),ke(vt.prototype,"receive",[kr],Object.getOwnPropertyDescriptor(vt.prototype,"receive"),vt.prototype),ke(vt.prototype,"batchReceive",[kr],Object.getOwnPropertyDescriptor(vt.prototype,"batchReceive"),vt.prototype),ke(vt.prototype,"stopReceiving",[kr],Object.getOwnPropertyDescriptor(vt.prototype,"stopReceiving"),vt.prototype),ke(vt.prototype,"muteRemote",[kr],Object.getOwnPropertyDescriptor(vt.prototype,"muteRemote"),vt.prototype),ke(vt.prototype,"unmuteRemote",[kr],Object.getOwnPropertyDescriptor(vt.prototype,"unmuteRemote"),vt.prototype),ke(vt.prototype,"muteLocal",[kr],Object.getOwnPropertyDescriptor(vt.prototype,"muteLocal"),vt.prototype),ke(vt.prototype,"unmuteLocal",[kr],Object.getOwnPropertyDescriptor(vt.prototype,"unmuteLocal"),vt.prototype),ke(vt.prototype,"close",[kr],Object.getOwnPropertyDescriptor(vt.prototype,"close"),vt.prototype),ke(vt.prototype,"updateEncoderConfig",[kr],Object.getOwnPropertyDescriptor(vt.prototype,"updateEncoderConfig"),vt.prototype),ke(vt.prototype,"updateSendParameters",[kr],Object.getOwnPropertyDescriptor(vt.prototype,"updateSendParameters"),vt.prototype),ke(vt.prototype,"replaceTrack",[kr],Object.getOwnPropertyDescriptor(vt.prototype,"replaceTrack"),vt.prototype),ke(vt.prototype,"updateAdaptation",[kr],Object.getOwnPropertyDescriptor(vt.prototype,"updateAdaptation"),vt.prototype),ke(vt.prototype,"getRemoteSSRC",[kr],Object.getOwnPropertyDescriptor(vt.prototype,"getRemoteSSRC"),vt.prototype),vt);function kr(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,l=await o.lock("From P2PConnection.".concat(t));try{for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return await r.apply(this,h)}finally{l()}},n}function zO(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=Rs(t.width),r.height=Rs(t.height);const o=Rs(t.framerate||15);document.body.append(n),document.body.append(r);let l=e._mediaStreamTrack;n.srcObject=new MediaStream([l]),n.play();const u=r.getContext("2d");if(!u)throw new ie(B.UNEXPECTED_ERROR,"can not get canvas context");const h=bt(),m=r.captureStream(h.supportRequestFrame?0:o).getVideoTracks()[0];m.canvas||(m.canvas=r),r.startCapture=()=>{if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const E=n.videoWidth,S=n.videoHeight/E,R=r.width*S;Math.abs(R-r.height)>=2&&(A.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(R)),r.height=R)}u.drawImage(n,0,0,r.width,r.height),m.requestFrame&&m.requestFrame(),l!==e._mediaStreamTrack&&(l=e._mediaStreamTrack,n.srcObject=new MediaStream([l]))},r.stopCapture=tO(()=>r.startCapture&&r.startCapture(),o);const g=m.stop;return m.stop=()=>{g.call(m),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),A.debug("clean low stream renderer")},m}var Iw=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(Iw||{}),Fn=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e[e.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",e[e.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",e[e.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",e}(Fn||{}),np=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(np||{}),Bn=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e[e.FRAMES_DROPPED=2181]="FRAMES_DROPPED",e[e.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",e[e.AVG_DECODE=2200]="AVG_DECODE",e[e.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",e[e.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",e[e.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",e[e.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",e}(Bn||{}),ip=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(ip||{}),AB=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(AB||{}),Nc=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e[e.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",e}(Nc||{}),Lr=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e[e.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",e[e.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",e[e.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",e}(Lr||{}),IB=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(IB||{}),xr=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(xr||{}),Ow=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(Ow||{});const rp=1e3,sp=6,Nw=3,KQ=Math.max(sp,Nw);function qe(e,t,n){n!=null&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function OB(e){const t={[xr.CONN_TYPE]:0,[xr.RTT]:e.rtt,[xr.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(t[xr.CONN_TYPE]=1),n==="tcp"&&(t[xr.CONN_TYPE]=3),n==="tls"&&(t[xr.CONN_TYPE]=4);break}case"srflx":t[xr.CONN_TYPE]=2;break;case"unknown":t[xr.CONN_TYPE]=5;break;default:t[xr.CONN_TYPE]=0}return t}function NB(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class PB extends En{constructor(t){super(),U(this,"store",void 0),U(this,"uploadWRTCStatsTimer",void 0),U(this,"uploadOutboundDenoiserStatsTimer",void 0),U(this,"uploadExtStatsTimer",void 0),U(this,"uploadExtUsageStatsTimer",void 0),U(this,"uploadInboundExtStatsTimer",void 0),U(this,"requestStats",void 0),U(this,"requestTransportStats",void 0),U(this,"requestLocalMedia",void 0),U(this,"requestRemoteMedia",void 0),U(this,"requestAllTracks",void 0),U(this,"requestVideoIsReady",void 0),U(this,"requestUploadStats",void 0),U(this,"requestUpload",void 0),U(this,"uploadOutboundStarted",!1),U(this,"uploadInboundStarted",!1),U(this,"uploadTransportStarted",!1),U(this,"uploadBaseStatsStarted",!1),U(this,"uploadExtensionUsageStarted",!1),U(this,"lastRecvStats",void 0),U(this,"lastSendStats",void 0),U(this,"lastRefRecvStats",void 0),U(this,"lastRefSendStats",void 0),U(this,"lastFullRecvStats",void 0),U(this,"lastFullSendStats",void 0),U(this,"needUploadRenderFreezeTime",!0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const n=t%Nw==0,r=t%sp==0;let o,l;if(this.uploadTransportStarted&&(o=this.requestStats(),this.store.useP2P&&(l=this.requestStats(!0))),!o&&this.uploadOutboundStarted&&(o=this.requestStats()),!l&&this.uploadInboundStarted&&(l=this.requestStats(!0)),o||l){var u;const h={};if(this.uploadTransportStarted&&o){const g=this.getTransportStats(o,l,n);g&&(h.misc=[g])}if(this.uploadOutboundStarted&&o){const g=this.getOutboundStats(o,r?this.lastFullSendStats:n?this.lastRefSendStats:this.lastSendStats,n,r);g&&(h.outbound=[g])}if(this.uploadInboundStarted&&l){const g=this.getInboundStats(l,r?this.lastFullRecvStats:n?this.lastRefRecvStats:this.lastRecvStats,n,r);g&&(h.inbound=g)}const m=(u=this.requestTransportStats)===null||u===void 0?void 0:u.call(this).connectState;m&&(Array.isArray(h.misc)?h.misc[0]&&h.misc[0].addition&&(h.misc[0].addition[Ow.RTC_PEER_CONNECTION_STATE]=BI[m]):h.misc=[{addition:{[Ow.RTC_PEER_CONNECTION_STATE]:BI[m]}}]),this.requestUploadStats(h)}this.lastRecvStats=l,this.lastSendStats=o,r&&(this.lastFullRecvStats=l,this.lastFullSendStats=o),n&&(this.lastRefRecvStats=l,this.lastRefSendStats=o)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,r;const o=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(o&&((r=this.requestUploadStats)===null||r===void 0||r.call(this,{misc:[{addition:{[Ow.RTC_PEER_CONNECTION_STATE]:BI[o.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===KQ+1&&(t=1)},rp)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(t,n,r){if(!this.requestStats)return;if(!r)return t.rtt==null?void 0:{addition:{[xr.RTT]:t.rtt,[xr.CONN_TYPE]:void 0,[xr.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const o=OB(t);if(this.store.useP2P){if(n){const l=OB(n);o[xr.CONN_TYPE]+=l[xr.CONN_TYPE]<<3}o[xr.CONN_TYPE]+=110}else o[xr.CONN_TYPE]+=100;return{addition:o}}getOutboundStats(t,n,r,o){if(!this.requestUploadStats||!this.requestLocalMedia)return;const l=this.requestLocalMedia();if(!l||l.length===0)return;let u,h,m;return l.forEach(g=>{let[E,{track:S,ssrcs:R}]=g;switch(E){case he.LocalVideoLowTrack:case he.LocalVideoTrack:if(E===he.LocalVideoTrack){const b=function(k,V,F,K,$,Z){const J=V.videoSend.find(Ie=>Ie.ssrc===k);if(!J)return;const re={},{sentFrame:pe,inputFrame:Ce}=J;if(Z&&(qe(re,Fn.QP_SUM,J.qpSumPerFrame),Ce&&pe)){const Ie=Ce.frameRate,_t=pe.frameRate;re[Fn.FREEZE]=function(Et,Qt){let kn=!0;return kn=!(Et<=5)&&(Et<=10?Qt<3:Et<=20?Qt<4:Qt<5),kn}(Ie,_t)?1:0}if($){switch(pe&&(qe(re,Fn.HEIGHT,pe.height),qe(re,Fn.WIDTH,pe.width),qe(re,Fn.FRAME_RATE,pe.frameRate)),re[Fn.DISABLED]=K._originMediaStreamTrack&&!K._originMediaStreamTrack.enabled||K._mediaStreamTrack&&!K._mediaStreamTrack.enabled?1:0,J.adaptionChangeReason){case"none":re[Fn.ADAPTATION]=0;break;case"cpu":re[Fn.ADAPTATION]=1;break;case"bandwidth":re[Fn.ADAPTATION]=2;break;case"other":re[Fn.ADAPTATION]=3}let Ie=0;J.adaptionChangeReason&&(Ie+=NB(J.adaptionChangeReason)),V.qualityLimitationReason&&(Ie+=NB(V.qualityLimitationReason)<<3),re[Fn.ADAPTATION]=Ie,re[Fn.PLAYER_STATUS]=ZI[K._player?K._player.videoElementStatus:"uninit"],qe(re,Fn.NACKS,J.nacksCount),qe(re,Fn.PLIS,J.plisCount),qe(re,Fn.FIRS,J.firsCount),qe(re,Fn.AVG_ENCODE,J.avgEncodeMs),qe(re,Fn.HUGE_FRAME_SENT,J.hugeFramesSent),qe(re,Fn.BYTES_RETRANSMIT,J.retransmittedBytesSent),qe(re,Fn.PACKAGES_RETRANSMIT,J.retransmittedPacketsSent),qe(re,Fn.KEY_FRAMES_ENCODED,J.keyFramesEncoded);const _t=F&&F.videoSend.find(Et=>Et.ssrc===k);if(_t){let Et=$?rp:rp*sp;_t.timestamp&&J.timestamp&&(Et=J.timestamp-_t.timestamp),_t.packets!=null&&J.packets!=null&&qe(re,Fn.PACKAGE_RATE,1e3*(J.packets-_t.packets)/Et),J.packetsLost!=null&&_t.packetsLost!=null&&qe(re,Fn.PACKAGE_LOST,J.packetsLost-_t.packetsLost),_t.bytes!=null&&J.bytes!=null&&qe(re,Fn.BITRATE,8*(J.bytes-_t.bytes)/Et)}}return re}(R[0].ssrcId,t,n,S,r,o),x=S&&function(k,V,F,K){const $=V.videoSend.find(J=>J.ssrc===k);if(!$)return null;const Z={};if(K){const J=$.inputFrame,re=J&&J.height||F.videoHeight||0,pe=J&&J.width||F.videoWidth||0,Ce=J&&J.frameRate||0;qe(Z,Iw.HEIGHT,re),qe(Z,Iw.WIDTH,pe),qe(Z,Iw.FRAME_RATE,Ce)}return Z}(R[0].ssrcId,t,S,r),P=function(k,V){const F={};return V&&(qe(F,Fn.RETRANSMIT,k.bitrate.retransmit),qe(F,Fn.TARGET_ENCODED,k.bitrate.targetEncoded),qe(F,Fn.ACTUAL_ENCODED,k.bitrate.actualEncoded),qe(F,Fn.TRANSMIT,k.bitrate.transmit),qe(F,Fn.BANDWIDTH,k.sendBandwidth)),F}(t,r);h=Object.assign({},b,x,P)}else m=function(b,x,P,k){const V=x.videoSend.find(K=>K.ssrc===b);if(!V)return;const F={};if(k){const K=V.sentFrame;if(K&&(qe(F,np.HEIGHT,K.height),qe(F,np.WIDTH,K.width),qe(F,np.FRAME_RATE,K.frameRate)),P){const $=P.videoSend.find(Z=>Z.ssrc===b);if($){let Z=rp*sp;$.timestamp&&V.timestamp&&(Z=V.timestamp-$.timestamp),$.packets!=null&&V.packets!=null&&qe(F,np.PACKAGE_RATE,1e3*(V.packets-$.packets)/Z),V.packetsLost!=null&&$.packetsLost!=null&&qe(F,np.PACKAGE_LOST,V.packetsLost-$.packetsLost),$.bytes!=null&&V.bytes!=null&&qe(F,np.BITRATE,8*(V.bytes-$.bytes)/Z)}}}return F}(R[0].ssrcId,t,n,r);break;case he.LocalAudioTrack:u=S&&function(b,x,P,k,V){const F=x.audioSend.find($=>$.ssrc===b);if(!F)return;const K={};if(V){K[Nc.DISABLED]=k._originMediaStreamTrack&&!k._originMediaStreamTrack.enabled||k._mediaStreamTrack&&!k._mediaStreamTrack.enabled?1:0;const $=100*k._source.getAccurateVolumeLevel(),Z=F.inputLevel;if(Z!=null){const re=Math.ceil(50*Math.log10(100*Z+1));qe(K,Nc.LEVEL,re)}qe(K,AB.PCM_LEVEL,$),qe(K,Nc.AEC_RETURN_LOSS,F.aecReturnLoss),qe(K,Nc.AEC_RETURN_LOSS_ENH,F.aecReturnLossEnhancement),qe(K,Nc.BYTES_RETRANSMIT,F.retransmittedBytesSent),qe(K,Nc.PACKAGES_RETRANSMIT,F.retransmittedPacketsSent),K[Nc.FREEZE]=0;const J=P&&P.audioSend.find(re=>re.ssrc===b);if(J){let re=rp*sp;J.timestamp&&F.timestamp&&(re=F.timestamp-J.timestamp),J.bytes!=null&&F.bytes!=null&&qe(K,Nc.BITRATE,8*(F.bytes-J.bytes)/re),J.packets!=null&&F.packets!=null&&qe(K,Nc.PACKAGE_RATE,1e3*(F.packets-J.packets)/re)}}return K}(R[0].ssrcId,t,n,S,r)}}),{high:h,low:m,audio:u}}getInboundStats(t,n,r,o){if(!this.requestRemoteMedia)return;const l=this.requestRemoteMedia()||[],u=[];return l.forEach(h=>{let[m,g]=h;const E={peer:m.uid};if(g.has(Pe.VIDEO)&&m.videoTrack){const S=m._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(m._videoSSRC)||!1,R=m.videoTrack?function(b,x,P,k,V,F,K,$){const Z=x.videoRecv.find(Et=>Et.ssrc===b);if(!Z)return;const J={},{receivedFrame:re,outputFrame:pe,decodeFrameRate:Ce}=Z,Ie=P&&P.videoRecv.find(Et=>Et.ssrc===b);if(qe(J,ip.FRAME_RATE_DECODE,Ce),Z.framesRateFirefox&&qe(J,Bn.FRAME_RATE,Z.framesRateFirefox),re&&qe(J,Bn.FRAME_RATE,re.frameRate),qe(J,Bn.FRAMES_DROPPED,Z.framesDroppedCount),qe(J,Bn.BYTES_RETRANSMIT,Z.retransmittedBytesReceived),qe(J,Bn.PACKAGES_RETRANSMIT,Z.retransmittedPacketsReceived),qe(J,Bn.PACKAGES_DISCARDED,Z.packetsDiscarded),qe(J,Bn.AVG_DECODE,Z.avgDecodeMs),qe(J,Bn.AVG_PROCESSING_DELAY,Z.avgProcessingDelayMs),qe(J,Bn.AVG_ASSEMBLY_TIME,Z.avgFramesAssembledFromMultiplePacketsMs),qe(J,Bn.AVG_INTER_FRAME_DELAY,Z.avgInterFrameDelayMs),qe(J,Bn.KEY_FRAMES_DECODED,Z.keyFramesDecoded),Ie){const Et=x.timestamp-P.timestamp||rp*($?sp:K?Nw:1);Z.packetsLost!=null&&Ie.packetsLost!=null&&qe(J,Bn.PACKAGE_LOST,Z.packetsLost-Ie.packetsLost),Ie.bytes!=null&&Z.bytes!=null&&qe(J,Bn.BITRATE,8*(Z.bytes-Ie.bytes)/Et),Ie.packets!=null&&Z.packets!=null&&qe(J,Bn.PACKAGE_RATE,1e3*(Z.packets-Ie.packets)/Et)}if($&&(qe(J,Bn.QP_SUM,Z.qpSumPerFrame),J[Bn.FREEZE]=V&&by.isRemoteVideoFreeze(k,Z,Ie)?1:0),K){var _t;re?(qe(J,Bn.HEIGHT,re.height),qe(J,Bn.WIDTH,re.width)):k&&(qe(J,Bn.HEIGHT,k._videoHeight||0),qe(J,Bn.WIDTH,k._videoWidth||0)),pe&&qe(J,ip.FRAME_RATE_OUTPUT,pe.frameRate);const Et=(_t=k._player)===null||_t===void 0?void 0:_t.rendFrameRate.toFixed(0);if(Et&&qe(J,ip.FRAME_RATE_RENDER,+Et),qe(J,Bn.JITTER_BUFFER,Z.jitterBufferMs),qe(J,Bn.CURRENT_DELAY,Z.currentDelayMs),qe(J,Bn.FIRS,Z.firsCount),qe(J,Bn.NACKS,Z.nacksCount),qe(J,Bn.PLIS,Z.plisCount),k){J[Bn.DISABLED]=k._originMediaStreamTrack.enabled&&k._mediaStreamTrack.enabled?0:1;const Qt=k._player;if(Qt){const{freezeTimeCounterList:kn,renderFreezeAccTime:An,videoElementStatus:Ur}=Qt;if(kn&&kn.length>0&&qe(J,ip.FREEZE_TIME,kn.splice(0,1)[0]),F&&Bl.visibility==="visible"&&Ur===rr.PLAYING&&bt().supportRequestVideoFrameCallback){const le=Math.min(6e3,An);Qt.renderFreezeAccTime=Math.max(0,An-le),qe(J,ip.FREEZE_TIME_RENDER,le)}if(typeof Z.totalFreezesDuration=="number"){const le=Ie&&Ie.totalFreezesDuration?Z.totalFreezesDuration-Ie.totalFreezesDuration:Z.totalFreezesDuration;qe(J,ip.FREEZE_DURATION,1e3*le)}}}if(J[Bn.PLAYER_STATUS]=ZI[k._player?k._player.videoElementStatus:"uninit"],Ie&&Z.totalInterFrameDelay!==void 0&&Z.totalSquaredInterFrameDelay!==void 0&&Ie.totalInterFrameDelay!==void 0&&Ie.totalSquaredInterFrameDelay!==void 0){const Qt=Z.totalInterFrameDelay-Ie.totalInterFrameDelay,kn=Z.totalSquaredInterFrameDelay-Ie.totalSquaredInterFrameDelay,An=Z.framesDecodeCount-Ie.framesDecodeCount,Ur=Qt/An*1e3,le=Math.round(1e3*Math.sqrt((kn-Math.pow(Qt,2)/An)/An));!isNaN(le)&&Ur+le>Math.max(3*Ur,Ur+150)&&(J[Bn.I_FRAME_DELAY]=le)}}return J}(m._videoSSRC,t,n,m.videoTrack,S===!0,this.needUploadRenderFreezeTime,r,o):void 0;R&&(E.video=R)}if(g.has(Pe.AUDIO)&&m.audioTrack){const S=m.audioTrack?function(R,b,x,P,k,V){const F=b.audioRecv.find(J=>J.ssrc===R);if(!F)return;const K={},$=x&&x.audioRecv.find(J=>J.ssrc===R);if(qe(K,Lr.JITTER,F.jitterMs),qe(K,Lr.BYTES_RETRANSMIT,F.retransmittedBytesReceived),qe(K,Lr.PACKAGES_RETRANSMIT,F.retransmittedPacketsReceived),qe(K,Lr.PACKAGES_DISCARDED,F.packetsDiscarded),qe(K,Lr.AVG_PROCESSING_DELAY,F.avgProcessingDelayMs),$){const J=b.timestamp-x.timestamp||rp*(V?sp:k?Nw:1);F.packets!=null&&$.packets!=null&&qe(K,Lr.PACKAGE_RATE,1e3*(F.packets-$.packets)/J),k&&$.bytes!=null&&F.bytes!=null&&qe(K,Lr.BITRATE,8*(F.bytes-$.bytes)/J),F.packetsLost!=null&&$.packetsLost!=null&&qe(K,Lr.PACKAGE_LOST,F.packetsLost-$.packetsLost)}if(V){const{receivedFrames:J,droppedFrames:re}=F;J!=null&&re!=null&&(K[Lr.FREEZE]=(Z=J)===0||100*re/Z>20?1:0)}var Z;if(k){const J=100*P._source.getAccurateVolumeLevel(),re=F.outputLevel;if(re!=null){const pe=Math.ceil(50*Math.log10(100*re+1));qe(K,IB.LEVEL,pe)}if(qe(K,Lr.PCM_LEVEL,J),P&&(K[Lr.DISABLED]=P._originMediaStreamTrack.enabled&&P._mediaStreamTrack.enabled?0:1),qe(K,Lr.JITTER_BUFFER,F.jitterBufferMs),qe(K,Lr.CURRENT_DELAY,F.jitterBufferMs),K[Lr.PLAYER_STATUS]=ZI[Dr.getPlayerState(P.getTrackId())],$){const pe=F.concealedSamples-$.concealedSamples;pe>0&&qe(K,Lr.CONCEALED_SAMPLES,pe);const Ce=F.totalSamplesReceived-$.totalSamplesReceived;Ce>0&&qe(K,Lr.TOTAL_SAMPLES_RECEIVED,Ce)}}return K}(m._audioSSRC,t,n,m.audioTrack,r,o):void 0;S&&(E.audio=S)}(E.video||E.audio)&&u.push(E)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,u}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(n=>n instanceof ZR);if(t&&t._external.getDenoiserStats){const n=t._external.getDenoiserStats();n&&this.requestUpload(gy.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[n,r]=t;r.has(Pe.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(o=>{this.requestUpload&&this.requestUpload(o.type,o.stats)}),r.has(Pe.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(o=>{this.requestUpload&&this.requestUpload(o.type,o.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),r={connectionInterval:G("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let o=[];const l=this.requestAllTracks&&this.requestAllTracks()||[];for(const g of l)!g.muted&&g.enabled&&(o=o.concat(await g.getProcessorUsage()));const u=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[g,E]of u)E.has(Pe.VIDEO)&&g.videoTrack&&(o=o.concat(await g.videoTrack.getProcessorUsage())),E.has(Pe.AUDIO)&&g.audioTrack&&(o=o.concat(await g.audioTrack.getProcessorUsage()));if(o.length===0)return;r.details=function(g,E){const S={};for(const{id:P,value:k,level:V,direction:F}of g){var R;const K=(R=E.get(P))!==null&&R!==void 0?R:0,$=k===2?K+G("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:K;var b,x;E.set(P,$),S[P]?(k===2&&(S[P].value=k),V>S[P].level&&(S[P].level=V),F==="remote"&&(S[P].remoteUidCount+=1),S[P].totalTs=(b=E.get(P))!==null&&b!==void 0?b:0):S[P]={value:k,level:V,remoteUidCount:F==="local"?0:1,totalTs:(x=E.get(P))!==null&&x!==void 0?x:0}}return Object.keys(S).map(P=>{const{level:k,value:V,totalTs:F}=S[P];return{id:P,level:k,value:V,totalTs:F}})}(o,t);const h=Date.now(),m=h>n?h:n+1;this.requestUpload&&this.requestUpload(gy.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:m})},G("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const qQ=G("ICE_RESTART_INTERVAL");let Pw=new Map,fg=new Map,rd=[zi.UDP_TCP_RELAY,zi.TCP_RELAY,zi.RELAY],HO=G("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&bt().supportPCSetConfiguration;function DB(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Pw.get(e.id);n&&(window.clearTimeout(n),Pw.delete(e.id));const r=fg.get(e.id);t&&r&&r.index===rd.length-1&&(A.debug("[".concat(e.id,"] reset ICE restart policy")),fg.delete(e.id))}function kB(e,t,n){if(Pw.size===0&&fg.size===0&&(Array.isArray(G("RESTART_SEQUENCE"))&&G("RESTART_SEQUENCE").length>0&&!function(h,m){if(h.length!==m.length)return!1;for(let g=0;g<h.length;g+=1){const E=h[g];if(h.filter(S=>S===E).length!==m.filter(S=>S===E).length)return!1}return!0}(rd,G("RESTART_SEQUENCE"))&&(rd=G("RESTART_SEQUENCE").filter(h=>{var m;if(Te(m=Object.values(zi)).call(m,h))return!0}),A.debug("use reconnection policy from config distribution, queues: ".concat(rd.join(" => ")))),HO=G("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&bt().supportPCSetConfiguration),rd.length===0)return void n();let r,{index:o=0,type:l}=fg.get(e.id)||{};if(HO&&l===zi.RELAY)return void n();let u=l&&o>=rd.length-1;if(HO)l=zi.RELAY;else{if(u)return void n();l?(o++,l=rd[o]):(l=rd[0],o=0)}A.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(l,", index: ").concat(o)),t(l),fg.set(e.id,{index:o,type:l}),r=window.setTimeout(()=>kB(e,t,n),qQ),Pw.set(e.id,r)}var dt;function LB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Pc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?LB(Object(n),!0).forEach(function(r){U(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):LB(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function xB(e){var t,n,r,o=2;for(typeof Symbol<"u"&&(n=mI,r=Symbol.iterator);o--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new Dw(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function Dw(e){function t(n){if(Object(n)!==n)return we.reject(new TypeError(n+" is not an object."));var r=n.done;return we.resolve(n.value).then(function(o){return{value:o,done:r}})}return Dw=function(n){this.s=n,this.n=n.next},Dw.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?we.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?we.reject(n):t(r.apply(this.s,arguments))}},new Dw(e)}let Iy=(dt=class extends En{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(je.StateChange,t,this._state)}constructor(e,t){super(),U(this,"isPlanB",void 0),U(this,"store",void 0),U(this,"statsUploader",void 0),U(this,"connection",void 0),U(this,"localTrackMap",new Map),U(this,"remoteUserMap",new Map),U(this,"localDataChannels",[]),U(this,"remoteDataChannelMap",new Map),U(this,"pendingLocalTracks",[]),U(this,"pendingRemoteTracks",[]),U(this,"pendingLocalDataChannels",[]),U(this,"pendingRemoteDataChannels",[]),U(this,"statsCollector",void 0),U(this,"shouldForwardP2PCreation",void 0),U(this,"iceFailedCount",0),U(this,"dtlsFailedCount",0),U(this,"mutex",void 0),U(this,"_state",Lt.Disconnected),U(this,"_pcStatsUploadType",G("NEW_ICE_RESTART")?zl.FIRST_CONNECTION:zl.OLD_FIRST_CONNECTION),U(this,"_isStartRestartIce",!1),U(this,"_restartTimer",void 0),U(this,"_isTryConnecting",!1),U(this,"_iceError",null),U(this,"_forceTurn",!1),U(this,"_isWaitPcToRePub",!1),U(this,"handleMuteLocalTrack",async(n,r,o)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Lt.Connected)return void o(new oe(B.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const u=this.filterTobeMutedTracks(n);if(u.length===0)return void r();const h=u.find(g=>g[0]==="videoLowTrack");h&&h[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(u.map(g=>{let[,{id:E}]=g;return E}));const m=this.createMuteMessage(u);await Xt(this,je.RequestMuteLocal,m),r()}catch(u){o(u)}finally{l()}}),U(this,"handleUnmuteLocalTrack",async(n,r,o)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Lt.Connected)return void o(new oe(B.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const u=this.filterTobeUnmutedTracks(n);if(u.length===0)return void r();const h=u.find(g=>g[0]==="videoLowTrack");if(h){const g=h[1];if(g.track._originMediaStreamTrack.stop(),!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&bt().supportDualStreamEncoding){const E=n._mediaStreamTrack.clone();g.track._mediaStreamTrack=E,g.track._originMediaStreamTrack=E}else{const E=zO(n,ly(this,je.RequestLowStreamParameter));g.track._mediaStreamTrack=E,g.track._originMediaStreamTrack=E}await new we((E,S)=>{this.handleReplaceTrack(g.track,E,S,!0)})}await this.connection.unmuteLocal(u.map(g=>{let[,{id:E}]=g;return E}));const m=this.createUnmuteMessage(u);await Xt(this,je.RequestUnmuteLocal,m),r()}catch(u){o(u)}finally{l()}}),U(this,"handleUpdateVideoEncoder",async(n,r,o,l)=>{let u;l||(u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const m=this.localTrackMap.get(he.LocalVideoTrack);if(!this.connection||!m||m.track!==n||this.state!==Lt.Connected)return void r();const{id:g,track:E}=m;await this.connection.updateSendParameters(g,E),await this.connection.updateEncoderConfig(g,E),this.emit(je.UpdateVideoEncoder,E),r()}catch(m){o(m)}finally{var h;(h=u)===null||h===void 0||h()}}),U(this,"handleUpdateVideoSendParameters",async(n,r,o)=>{const l=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const u=this.localTrackMap.get(he.LocalVideoTrack);if(!this.connection||!u||u.track!==n||this.state!==Lt.Connected)return void r();const{id:h,track:m}=u;await this.connection.updateSendParameters(h,m),r()}catch(u){o(u)}finally{l()}}),U(this,"handleReplaceMixingTrack",async(n,r,o,l)=>{if(!this.connection||this.state!==Lt.Connected)return void r();const u=GO([n]);let h;A.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(u.getTrackId(),"]")),typeof l=="boolean"&&l||(h=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,u),r()}catch(g){o(g)}finally{var m;(m=h)===null||m===void 0||m()}}),U(this,"handleReplaceTrack",async(n,r,o,l)=>{let u;A.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof l=="boolean"&&l||(u=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var h;const g=Array.from(this.localTrackMap.entries()).find(E=>{let[,{track:S}]=E;return n===S});if(!this.connection||!g||this.state!==Lt.Connected)return void r();if(await((h=this.connection)===null||h===void 0?void 0:h.replaceTrack(n,g[1].id)),this.isPlanB){const E=g[1];E.id=n._mediaStreamTrack.id,this.localTrackMap.set(g[0],E)}if(g[0]===he.LocalVideoTrack&&!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&bt().supportDualStreamEncoding){const E=this.localTrackMap.get(he.LocalVideoLowTrack);if(E){const S=n._mediaStreamTrack.clone();E.track._originMediaStreamTrack.stop(),E.track._mediaStreamTrack=S,E.track._originMediaStreamTrack=S,await new we((R,b)=>{this.handleReplaceTrack(E.track,R,b,!0)})}}r()}catch(g){o(g)}finally{var m;(m=u)===null||m===void 0||m()}}),U(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),U(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),U(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),U(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),U(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new PB(this.store),this.bindStatsUploaderEvents(),this.mutex=new Gi("P2PChannel-mutex",this.store.clientId),this.isPlanB=!bt().supportUnifiedPlan||G("CHROME_FORCE_PLAN_B")&&Ul(),this.shouldForwardP2PCreation=G("FORWARD_P2P_CREATION")&&bt().supportPCSetConfiguration&&AI(),this.shouldForwardP2PCreation&&(this.connection=Aw(this.store),this.emit(je.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var t;this.state=Lt.New,this._forceTurn=CB(e),A.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const n=this.shouldForwardP2PCreation&&((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!n||(n&&this.connection&&(A.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=Aw(this.store,e),this.emit(je.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new oe(B.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=G("NEW_ICE_RESTART")?zl.FIRST_CONNECTION:zl.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new oe(B.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");G("ENABLE_PREALLOC_PC")&&this.state===Lt.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Lt.Connected)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(o=>{var l;let[u]=o;return Te(l=[he.LocalVideoLowTrack,he.LocalVideoTrack]).call(l,u)}),n=t.map(o=>{let[,{id:l}]=o;return l}),r=t.map(o=>{let[l]=o;return l});if(this.connection instanceof Oc){if(xe.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Te(e).call(e,this.store.codec)){const o=["vp9","vp8","h264"].find(l=>Te(e).call(e,l));o&&(this.store.codec=o,A.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(o,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;if(this.connection instanceof Oc&&this.connection.peerConnectionState!=="closed"&&Te(e=[Lt.New,Lt.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Lt.Connected){if(this.state===Lt.Disconnected)throw new oe(B.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(n=>{var r;Te(r=this.pendingLocalDataChannels).call(r,n)||this.pendingLocalDataChannels.push(n)}),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(n=>{const r=Date.now();this.store.publish(n.id.toString(),"datachannel",r)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(n=>{this.localDataChannels.push(n);const r=Date.now();this.store.publish(n.id+"","datachannel",void 0,r)}),e.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(e,t,n){var r=this;return fo(function*(){const o=yield St(r.mutex.lock("From P2PChannel.publish"));try{var l;const u=r.connection&&Te(l=["disconnected","failed"]).call(l,r.connection.peerConnectionState);if(!r.connection||r.state!==Lt.Connected||u){if(r.state===Lt.Disconnected)throw new oe(B.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);const m=e.filter(g=>r.pendingLocalTracks.indexOf(g)===-1);return r.pendingLocalTracks=r.pendingLocalTracks.concat(m),void(u&&(r._isWaitPcToRePub=!0))}r.store.pubId=r.store.pubId+1,Hi.markPublishStart(r.store.clientId,r.store.pubId);const h=r.filterTobePublishedTracks(e,t,n);if(h.length===0)return void(yield St(r.tryToUnmuteAudio(e)));yield*bR(xB(r.doPublish(r.connection,h)))}finally{o()}})()}doPublish(e,t){var n=this;return fo(function*(){t.forEach(R=>{let{track:b,type:x}=R;const P=Date.now();n.store.publish(b.getTrackId(),x===he.LocalAudioTrack?"audio":"video",P)}),n.bindLocalTrackEvents(t);const r=t.map(R=>{let{track:b}=R;return b}),o=yield St(e.send(r,n.store.codec,n.store.audioCodec)),l=(yield St(o.next())).value,u=n.createGatewayPublishMessage(t,l);let h;try{h=yield u}catch(R){throw o.throw(R),(R==null?void 0:R.code)===B.WS_ABORT&&t.forEach(b=>{let{track:x}=b;n.pendingLocalTracks.indexOf(x)===-1&&n.pendingLocalTracks.push(x)}),n.unbindLocalTrackEvents(t),R}const m=n.mapPubResToRemoteConfig(u,h,r),g=(yield St(o.next(m))).value;if(n.state===Lt.Disconnected)throw new oe(B.UNEXPECTED_ERROR,"PeerConnection already disconnected.");G("ENABLE_VIDEO_SEI");const E=G("ENABLE_ENCODED_TRANSFORM"),S=G("ENABLE_AUDIO_METADATA");r.forEach(async R=>{const b=R.getRTCRtpTransceiver();if(!b||!E)return;const{interceptLocalVideoFrame:x,interceptLocalAudioFrame:P}=vw();R.trackMediaType===Pe.VIDEO?await x(b.sender,R):R.trackMediaType===Pe.AUDIO&&await P(b.sender,{metadata:S?()=>{const k=R.metadata.shift();return k&&k.value}:void 0})}),t.forEach(R=>{let{type:b}=R;n.statsCollector.addLocalStats(b)}),n.assignLocalTracks(t,g),n.statsUploader.startUploadOutboundStats(),t.forEach(R=>{let{track:b,type:x}=R;const P=Date.now();n.store.publish(b.getTrackId(),x===he.LocalAudioTrack?"audio":"video",void 0,P)})})()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof an))return A.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:r}=n,o=function(l,u){const h={};return l.height&&l.width&&(h.scaleResolutionDownBy=bO(l,u)),h.maxFramerate=l.framerate?Rs(l.framerate):void 0,h.maxBitrate=l.bitrate?1e3*l.bitrate:void 0,h}(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==he.LocalVideoLowTrack||!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&bt().supportDualStreamEncoding)o.scaleResolutionDownBy!=null&&(r._encoderConfig.scaleResolutionDownBy=o.scaleResolutionDownBy);else{const l=r._originMediaStreamTrack;if(!l.canvas)return A.warn("[".concat(r.getTrackId(),"] no canvas on track"));(function(u,h){const m=u.canvas;h.width&&(m.width=Rs(h.width)),h.height&&(m.height=Rs(h.height)),h.framerate&&(m.stopCapture&&m.stopCapture(),m.stopCapture=tO(()=>{!m.startCapture&&m.stopCapture&&m.stopCapture(),m.startCapture&&m.startCapture()},Rs(h.framerate)))})(l,e)}o.maxBitrate!=null&&(r._encoderConfig.bitrateMax=o.maxBitrate/1e3),o.maxFramerate!=null&&(r._encoderConfig.frameRate&&typeof r._encoderConfig.frameRate=="object"?r._encoderConfig.frameRate.max=o.maxFramerate:r._encoderConfig.frameRate={max:o.maxFramerate}),A.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return fo(function*(){if(!t.connection||t.state!==Lt.Connected)return;const n=yield St(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const o=t.localTrackMap.get(he.LocalVideoTrack);if(!o)throw new oe(B.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(he.LocalVideoLowTrack))throw new oe(B.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const l=[{track:t.getLowVideoTrack(o.track,e),type:he.LocalVideoLowTrack}];if(yield*bR(xB(t.doPublish(t.connection,l))),o.track.muted||!o.track.enabled){var r;const u=(r=t.localTrackMap.get(he.LocalVideoLowTrack))===null||r===void 0?void 0:r.id;u!==void 0&&(yield St(t.connection.muteLocal([u])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(A.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Mi(this,je.RequestRePublish,this.pendingLocalTracks),this.emit(je.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(A.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Mi(this,je.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:r}=this.pendingRemoteTracks[t];(r!==Pe.AUDIO||n._audio_added_&&n._audioSSRC)&&(r!==Pe.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await Mi(this,je.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===Pe.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(je.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Lt.Connected)return void e.forEach(r=>{const o=this.pendingLocalTracks.indexOf(r);o!==-1&&this.pendingLocalTracks.splice(o,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(r=>r[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==Lt.Connected)return void e.forEach(n=>{const r=this.pendingLocalDataChannels.indexOf(n);r!==-1&&this.pendingLocalDataChannels.splice(r,1)});const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(n=>{const r=this.localDataChannels.indexOf(n);r!==-1&&this.localDataChannels.splice(r,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Lt.Connected)return;const e=this.localTrackMap.get(he.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[he.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(r=>{let[,{id:o}]=r;return o})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(r=>{let[o,{track:l}]=r;return{type:o,track:l}})),t.forEach(r=>{let[o]=r;this.statsCollector.removeLocalStats(o)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==Lt.Connected)throw new oe(B.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter(r=>{var o;return!((o=this.remoteDataChannelMap.get(e))!==null&&o!==void 0&&o.get(r.id))});if(n.length!==0)return await this.connection.createDataChannels(e.uid,n),n.forEach(r=>{var o;this.remoteDataChannelMap.has(e)?(o=this.remoteDataChannelMap.get(e))===null||o===void 0||o.set(r.id,r):this.remoteDataChannelMap.set(e,new Map([[r.id,r]]));const l=this.pendingRemoteDataChannels.findIndex(u=>{let{user:h,id:m}=u;return h.uid===e.uid&&m===r.id});l!==-1&&this.pendingRemoteDataChannels.splice(l,1)}),n.map(r=>r.id)}async subscribe(e,t,n,r,o){var l;if(!this.connection||this.state!==Lt.Connected)throw new oe(B.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((l=this.remoteUserMap.get(e))!==null&&l!==void 0&&l.has(t))return;let u,h,m;const g=this.connection.getPreMedia(n);if(g)A.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),m=g.transceiver,u=g.track,h=g.id;else if(o){const R=o.find(x=>{let{stream_type:P}=x;return P===t});if(!R)throw new oe(B.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const b=await this.connection.receive(t,R.ssrcs,String(e._uintid),R.attributes);this.connection instanceof Oc&&(m=b.transceiver),u=b.track,h=b.id}else{const R=await this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);this.connection instanceof Oc&&(m=R.transceiver),u=R.track,h=R.id}if(t===Pe.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(u):(e._audioTrack=new tg(u,e.uid,e._uintid,this.store),A.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),m&&e._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(u):(e._videoTrack=new eg(u,e.uid,e._uintid,this.store),A.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),m&&e._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._videoTrack)),m&&G("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:R,interceptRemoteAudioFrame:b}=vw();t==Pe.VIDEO?await R(m.receiver,{onSei:G("ENABLE_VIDEO_SEI")&&(x=>{var P;return(P=e._videoTrack)===null||P===void 0?void 0:P._onSei(x)})}):t==Pe.AUDIO&&await b(m.receiver,{enableTopn:!!G("ENABLE_AUDIO_TOPN"),enableMetadata:!!G("ENABLE_AUDIO_METADATA"),onMetadata:x=>{this.safeEmit(je.AudioMetadata,x)}})}const E=this.remoteUserMap.get(e);E?E.set(t,h):this.remoteUserMap.set(e,new Map([[t,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const S=this.pendingRemoteTracks.findIndex(R=>{let{user:b,kind:x}=R;return b.uid===e.uid&&t===x});S!==-1&&(this.pendingRemoteTracks.splice(S,1),this.emit(je.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Lt.Connected)throw new oe(B.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(o=>{var l;let{user:u,mediaType:h}=o;return!((l=this.remoteUserMap.get(u))!==null&&l!==void 0&&l.has(h))});const t=[],n=new Map;e.forEach(o=>{if(!this.connection)return;const l=this.connection.getPreMedia(o.ssrcId);l?n.set(o.ssrcId,l):t.push(o)});const r=await this.connection.batchReceive(t.map(o=>{let{user:l,mediaType:u,ssrcId:h,rtxSsrcId:m}=o;return{kind:u,ssrcMsg:[{ssrcId:h,rtx:m}],mslabel:String(l._uintid)}}));t.forEach((o,l)=>{n.set(o.ssrcId,r[l])});for(const{user:o,mediaType:l,ssrcId:u}of e){const h=n.get(u);if(!h)return void A.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(o.uid," subscribe data,").concat(l,", ").concat(u));const{track:m,id:g,transceiver:E}=h;if(E&&G("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:b,interceptRemoteAudioFrame:x}=vw();l==Pe.VIDEO?await b(E.receiver,{onSei:G("ENABLE_VIDEO_SEI")&&(P=>{var k;return(k=o._videoTrack)===null||k===void 0?void 0:k._onSei(P)})}):l==Pe.AUDIO&&await x(E.receiver,{enableTopn:!!G("ENABLE_AUDIO_TOPN"),enableMetadata:!!G("ENABLE_AUDIO_METADATA"),onMetadata:P=>{this.safeEmit(je.AudioMetadata,P)}})}if(l===Pe.AUDIO?(o._audioTrack?o._audioTrack._updateOriginMediaStreamTrack(m):(o._audioTrack=new tg(m,o.uid,o._uintid,this.store),A.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(o._audioTrack.getTrackId()))),E&&o._audioTrack._updateRtpTransceiver(E),this.bindRemoteTrackEvents(o,o._audioTrack)):(o._videoTrack?o._videoTrack._updateOriginMediaStreamTrack(m):(o._videoTrack=new eg(m,o.uid,o._uintid,this.store),A.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(o._videoTrack.getTrackId()))),E&&o._videoTrack._updateRtpTransceiver(E),this.bindRemoteTrackEvents(o,o._videoTrack)),G("ENABLE_VIDEO_SEI")&&E){const{interceptRemoteVideoFrame:b,interceptRemoteAudioFrame:x}=vw();l==Pe.VIDEO?await b(E.receiver,{onSei:P=>{var k;(k=o._videoTrack)===null||k===void 0||k._onSei(P)}}):l==Pe.AUDIO&&await x(E.receiver)}const S=this.remoteUserMap.get(o);S?S.set(l,g):this.remoteUserMap.set(o,new Map([[l,g]])),this.statsCollector.addRemoteStats(o.uid),this.statsUploader.startUploadInboundStats();const R=this.pendingRemoteTracks.findIndex(b=>{let{user:x,kind:P}=b;return x.uid===o.uid&&l===P});R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(je.MediaReconnectEnd,o.uid))}}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:m}=u;return t!==void 0?h.uid===e.uid&&t===m:h.uid===e.uid});if(r.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.connection&&this.state===Lt.Connected||n||r.forEach(u=>{let{kind:h}=u;var m;if(h===Pe.AUDIO)(m=e._audioTrack)===null||m===void 0||m._destroy(),e._audioTrack=void 0;else if(h===Pe.VIDEO){var g;(g=e._videoTrack)===null||g===void 0||g._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Lt.Connected)return;const o=this.filterTobeUnSubscribedTracks(e,t);if(o.length===0)return;await this.connection.stopReceiving(o.map(u=>{let[,{id:h}]=u;return h}));const l=this.createUnsubscribeMessage(o);return this.withdrawRemoteTracks(o),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),o.forEach(u=>{let[h,{kind:m}]=u;var g,E;if(m===Pe.VIDEO&&h._videoSSRC&&((g=this.connection)===null||g===void 0||g.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===Pe.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),n||((E=h._videoTrack)===null||E===void 0||E._destroy(),h._videoTrack=void 0);else if(m===Pe.AUDIO){var S;this.unbindRemoteTrackEvents(h._audioTrack),!n&&((S=h._audioTrack)===null||S===void 0||S._destroy(),h._audioTrack=void 0)}}),l}async unsubscribeDataChannel(e,t){if(t.forEach(o=>{const l=this.pendingRemoteDataChannels.findIndex(u=>u.id===o.id);l!==-1&&this.pendingRemoteDataChannels.splice(l,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(n.length===0)return;t.forEach(o=>{o._close()});const r=this.remoteDataChannelMap.get(e);return n.forEach(o=>{r&&r.delete(o.id)}),r&&r.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map(o=>o.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:o,mediaType:l}of e){const u=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:g}=h;return l!==void 0?m.uid===o.uid&&l===g:m.uid===o.uid});u.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),t=t.concat(u)}if(!this.connection||this.state!==Lt.Connected)return void t.forEach(o=>{let{user:l,kind:u}=o;var h;if(u===Pe.AUDIO)(h=l._audioTrack)===null||h===void 0||h._destroy(),l._audioTrack=void 0;else if(u===Pe.VIDEO){var m;(m=l._videoTrack)===null||m===void 0||m._destroy(),l._videoTrack=void 0}});const n=ms(e).call(e,(o,l)=>{let{user:u,mediaType:h}=l;const m=this.filterTobeUnSubscribedTracks(u,h);return o.concat(m)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(o=>{let[,{id:l}]=o;return l}));const r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(o=>{let[l,{kind:u}]=o;var h,m;if(u===Pe.VIDEO&&l._videoSSRC&&((h=this.connection)===null||h===void 0||h.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),u===Pe.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),(m=l._videoTrack)===null||m===void 0||m._destroy(),l._videoTrack=void 0;else if(u===Pe.AUDIO){var g;this.unbindRemoteTrackEvents(l._audioTrack),(g=l._audioTrack)===null||g===void 0||g._destroy(),l._audioTrack=void 0}}),r}isPreSubScribe(e){return!this.connection||this.state!==Lt.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void A.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void A.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===Pe.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void A.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||A.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(he.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(he.LocalAudioTrack);if((t==null?void 0:t.track)instanceof $n){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[o]=r;return o!==he.LocalAudioTrack}).filter(r=>{let[o]=r;return!(e&&o===he.LocalVideoLowTrack)}).map(r=>{let[,{track:o}]=r;return o}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(e&&r===he.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,r,o){if(e){const u=this.localTrackMap.get(he.LocalAudioTrack),h=r?this.localTrackMap.get(he.LocalVideoLowTrack):this.localTrackMap.get(he.LocalVideoTrack);xe.publish(this.store.sessionId,{eventElapse:Hi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:u==null?void 0:u.track.getTrackLabel(),videoName:h==null?void 0:h.track.getTrackLabel(),screenshare:(h==null?void 0:h.track._hints.indexOf($t.SCREEN_TRACK))!==-1,audio:!!u,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}else{var l;n||(n=[]);const u=n.find(m=>m instanceof bn),h=r?(l=this.localTrackMap.get(he.LocalVideoTrack))===null||l===void 0?void 0:l.track:n.find(m=>m instanceof an);xe.publish(this.store.sessionId,{eventElapse:Hi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:u==null?void 0:u.getTrackLabel(),videoName:h==null?void 0:h.getTrackLabel(),screenshare:(h==null?void 0:h._hints.indexOf($t.SCREEN_TRACK))!==-1,audio:!!u,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}}reportSubscribeEvent(e,t,n,r){const o=r===Pe.VIDEO?n._videoSSRC:n._audioSSRC;o&&xe.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Pe.VIDEO,audio:r===Pe.AUDIO,peerid:n.uid,subscribeRequestid:o,p2pid:this.store.p2pId,eventElapse:Hi.measureFromSubscribeStart(this.store.clientId,o),preSsrc:this.isPreSubScribe(o)})}reset(){A.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Gi("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=Aw(this.store),this.emit(je.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(he.LocalAudioTrack);if((e==null?void 0:e.track)instanceof $n){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Lt.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(he.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(he.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof an||t&&t.track instanceof bn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(Ks(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(he.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=KE(e).call(e,(n,r)=>n.level-r.level),e}async disconnectForReconnect(){this.connection&&(A.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Lt.Reconnecting,G("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=Aw(this.store),this.emit(je.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case he.LocalVideoTrack:Te(t=r._hints).call(t,$t.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case he.LocalAudioTrack:r instanceof $n?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case he.LocalVideoLowTrack:}}),this.emit(je.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Ks(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(je.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Ks(n).call(n)).forEach(r=>{this.setPendingRemoteDataChannel(t,r)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),A.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:r,id:o}=n;if((e instanceof id?e.uid:e)===r.uid&&o===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:o}=n;if((e instanceof id?e.uid:e)===r.uid&&t===o)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return fo(function*(){if(!t.connection||t.state!==Lt.Connected)return;const n=yield St(t.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield St(t.connection.restartICE(e));const l=yield St(r.next());if(l.done)return;const u=l.value,h=yield u;switch(WO(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case zi.UDP_TCP_RELAY:t._pcStatsUploadType=zl.UDP_TCP_RESTART;break;case zi.TCP_RELAY:t._pcStatsUploadType=zl.TCP_RESTART;break;case zi.RELAY:t._pcStatsUploadType=zl.RELAY_RESTART;break;default:t._pcStatsUploadType=zl.OLD_RESTART}t._isTryConnecting=!0,r.next(h)}catch(l){var o;(o=r)===null||o===void 0||o.throw(l)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(he.LocalVideoTrack),n=this.localTrackMap.get(he.LocalAudioTrack),r=e.videoSend.find(b=>b.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),o=e.audioSend.find(b=>b.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!r||!o)return 1;const l=zs(this,je.NeedSignalRTT),u=r?r.rttMs:void 0,h=o?o.rttMs:void 0,m=u&&h?(u+h)/2:u||h,g=(m&&l?(m+l)/2:m||l)||0,E=100*e.sendPacketLossRate*.7/50+.3*g/1500,S=E<.17?1:E<.36?2:E<.59?3:E<.1?4:5,R=t==null?void 0:t.track;if(R&&R._encoderConfig&&R._hints.indexOf($t.SCREEN_TRACK)===-1){const b=R._encoderConfig.bitrateMax,x=e.bitrate.actualEncoded;if(b&&x){const P=(1e3*b-x)/(1e3*b);return mF[P<.15?0:P<.3?1:P<.45?2:P<.6?3:4][S]}}return S}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const o=r._audioSSRC,l=r._videoSSRC,u=e.audioRecv.find(x=>x.ssrc===o),h=e.videoRecv.find(x=>x.ssrc===l);if(!u&&!h)return void(t+=1);const m=zs(this,je.NeedSignalRTT),g=e.rtt,E=(g&&m?(g+m)/2:g||m)||0,S=u?u.jitterMs:void 0,R=e.recvPacketLossRate;let b=.7*R*100/50+.3*E/1500;S&&(b=.6*R*100/50+.2*E/1500+.2*S/400),t+=b<.1?1:b<.17?2:b<.36?3:b<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new we((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}async replaceTrack(e,t){var n;if(A.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==Lt.Connected)return;const r=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:u}]=l;return e===u});if(!r)return;const o=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:o}]),this.bindLocalTrackEvents([{track:t,type:o}]),r[1].track=t),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(t,r[1].id)),this.isPlanB){const l=r[1];l.id=t._mediaStreamTrack.id,this.localTrackMap.set(o,l)}if(o===he.LocalVideoTrack&&!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&bt().supportDualStreamEncoding){const l=this.localTrackMap.get(he.LocalVideoLowTrack);if(l){const u=e._mediaStreamTrack.clone();l.track._originMediaStreamTrack.stop(),l.track._mediaStreamTrack=u,l.track._originMediaStreamTrack=u,await new we((h,m)=>{this.handleReplaceTrack(l.track,h,m,!0)})}}}filterTobePublishedTracks(e,t,n){const r=[],o=this.getAllTracks();e=jm(e=e.filter(m=>o.indexOf(m)===-1));let l,u=!1;const h=this.localTrackMap.get(he.LocalAudioTrack);for(const m of e){if(m instanceof an&&(this.localTrackMap.has(he.LocalVideoTrack)||u?new oe(B.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:m,type:he.LocalVideoTrack}),u=!0),t)){const g=this.getLowVideoTrack(m,n);r.push({track:g,type:he.LocalVideoLowTrack})}if(m instanceof bn)if(h){const g=h.track;if(g instanceof $n)jO([m]),g.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0);else{const E=GO([g,m]);A.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(E.getTrackId(),"]")),this.replaceTrack(g,E)}}else l instanceof $n?(jO([m]),l.addAudioTrack(m)):l||!m._useAudioElement&&bt().webAudioMediaStreamDest&&!m._bypassWebAudio?l=GO(l?[m,l]:[m]):l=m}return l&&(A.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(l.getTrackId(),"]")),r.push({track:l,type:he.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=jm(e=e.filter(r=>n.indexOf(r)!==-1));for(const r of e){if(r instanceof bn){const o=this.localTrackMap.get(he.LocalAudioTrack);if(!o)continue;o.track instanceof $n?(o.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),o.track.trackList.length===0&&(t.push([he.LocalAudioTrack,o]),o.track.close())):t.push([he.LocalAudioTrack,o])}if(r instanceof an){const o=this.localTrackMap.get(he.LocalVideoTrack);if(!o)continue;t.push([he.LocalVideoTrack,o]);const l=this.localTrackMap.get(he.LocalVideoLowTrack);l&&t.push([he.LocalVideoLowTrack,l])}}return t}filterTobePublishedDataChannels(e){return e=(e=jm(e)).filter(t=>this.localDataChannels.findIndex(n=>n.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=jm(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:r}=t;switch(r){case he.LocalVideoTrack:n.addListener(De.GET_STATS,this.handleGetLocalVideoStats),n.addListener(De.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(De.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(De.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(De.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(De.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(De.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(De.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(De.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case he.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case he.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof $n?e.trackList.forEach(n=>{n.addListener(De.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(De.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(De.GET_STATS,this.handleGetLocalAudioStats),n.addListener(De.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(De.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(De.GET_STATS,this.handleGetLocalAudioStats),e.addListener(De.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(De.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(De.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(De.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(De.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(De.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:r}]=t;return{track:r,type:n}})),e.forEach(t=>{let{track:n,type:r}=t;switch(r){case he.LocalVideoTrack:n.off(De.GET_STATS,this.handleGetLocalVideoStats),n.off(De.GET_RTC_STATS,this.handleGetRTCStats),n.off(De.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(De.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(De.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(De.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(De.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(De.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(De.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case he.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case he.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof $n?e.trackList.forEach(t=>{t.off(De.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(De.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(De.GET_STATS,this.handleGetLocalAudioStats),t.off(De.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(De.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(De.GET_STATS,this.handleGetLocalAudioStats),e.off(De.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(De.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(De.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(De.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(De.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(De.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof eg&&t.addListener(De.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof tg&&t.addListener(De.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(De.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(Pe.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Pe.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,r)=>{var o;let l,u,{track:h,type:m}=n;switch(m){case he.LocalAudioTrack:l=Mt.Audio,u={dtx:h instanceof ZR&&h._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case he.LocalVideoTrack:l=Te(o=h._hints).call(o,$t.SCREEN_TRACK)?Mt.Screen:Mt.High,u=Pc(Pc({},kF(h)),{},{codec:this.store.codec,svc_mode:mw()});break;case he.LocalVideoLowTrack:l=Mt.Low,u=Pc(Pc({},kF(h)),{},{codec:this.store.codec,svc_mode:mw()})}return{stream_type:l,attributes:u,ssrcs:t[r]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let r,[o,{track:l,ssrcs:u,id:h}]=t;switch(o){case he.LocalVideoTrack:r=Te(n=l._hints).call(n,$t.SCREEN_TRACK)?Mt.Screen:Mt.High;break;case he.LocalAudioTrack:r=Mt.Audio;break;case he.LocalVideoLowTrack:r=Mt.Low}return{stream_type:r,ssrcs:u,mid:h}})}assignLocalTracks(e,t){e.forEach((n,r)=>{let{track:o,type:l}=n;this.localTrackMap.set(l,{track:o,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(je.PeerConnectionStateChange,t),t==="connecting"&&e instanceof Oc&&!vn()&&G("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},G("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Oc&&DB(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=zl.DISCONNECTED_OR_FAILED,zs(this,je.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(o=>o.getTrackId()),r=this.pendingLocalDataChannels.map(o=>"dc_".concat(o.id));xe.reportApiInvoke(this.store.sessionId,{name:Hn.REPUB_AFTER_PC_CONNECTED,options:n.concat(r),tag:Tn.TRACER}).onSuccess(),this.republish()}if(G("NEW_ICE_RESTART")&&e instanceof Oc&&!vn()&&!this._forceTurn){if(Te(bF).call(bF,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=o=>{WO(e)&&(A.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(o)),zs(this,je.QueryClientConnectionState)==="CONNECTED"&&this.emit(je.RequestRestartICE,o))},r=()=>{WO(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),A.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(je.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{kB(e,n,r)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&G("ICE_RESTART")&&zs(this,je.QueryClientConnectionState)==="CONNECTED"&&this.emit(je.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(A.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(je.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(A.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(je.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),xe.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Tn.TRACER}).onSuccess(),this.emit(je.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const r=Array.from(Ks(n=this.remoteUserMap).call(n)).find(l=>l._audioSSRC===t);var o;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(o=r.audioTrack)===null||o===void 0||o.emit(Xm.FIRST_FRAME_DECODED),xe.firstRemoteFrame(this.store.sessionId,ai.FIRST_AUDIO_DECODE,pn.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Hi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const r=Array.from(Ks(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===t);r&&xe.firstRemoteFrame(this.store.sessionId,ai.FIRST_AUDIO_RECEIVED,pn.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Hi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoReceived=t=>{var n;const r=Array.from(Ks(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===t);r&&xe.firstRemoteFrame(this.store.sessionId,ai.FIRST_VIDEO_RECEIVED,pn.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Hi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const r=t.candidateType==="relay",o=n.candidateType==="relay";n.candidateType!=="unknown"&&r===o||this.emit(je.ConnectionTypeChange,r),A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(ed(n))," -> ").concat(JSON.stringify(ed(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(ed(n))," -> ").concat(JSON.stringify(ed(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return Pc(Pc({},t),n)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof Oc&&function(t){fg.delete(t.id),DB(t)}(e),e.close(),this.emit(je.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(he.LocalAudioTrack);if(e instanceof bn&&(n==null?void 0:n.track)instanceof $n)return n.track.isActive||t.push([he.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:l}]=o;return e===l});if(r&&(t.push(r),r[0]===he.LocalVideoTrack)){const o=this.localTrackMap.get(he.LocalVideoLowTrack);o&&t.push([he.LocalVideoLowTrack,o])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(he.LocalAudioTrack);if(e instanceof bn&&(n==null?void 0:n.track)instanceof $n)return n.track.isActive&&t.push([he.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:l}]=o;return e===l});if(r)if(r[0]===he.LocalVideoTrack){t.push(r);const o=this.localTrackMap.get(he.LocalVideoLowTrack);o&&t.push([he.LocalVideoLowTrack,o])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var n;let r,[o,{track:l,ssrcs:u,id:h}]=t;switch(o){case he.LocalAudioTrack:r=Mt.Audio;break;case he.LocalVideoTrack:r=Te(n=l._hints).call(n,$t.SCREEN_TRACK)?Mt.Screen:Mt.High;break;case he.LocalVideoLowTrack:r=Mt.Low}return{stream_type:r,ssrcs:u,mid:h}})}createUnmuteMessage(e){return e.map(t=>{var n;let r,[o,{track:l,ssrcs:u,id:h}]=t;switch(o){case he.LocalAudioTrack:r=Mt.Audio;break;case he.LocalVideoTrack:r=Te(n=l._hints).call(n,$t.SCREEN_TRACK)?Mt.Screen:Mt.High;break;case he.LocalVideoLowTrack:r=Mt.Low}return{stream_type:r,ssrcs:u,mid:h}})}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const o=r.get(t);if(!o)return n;n.push([e,{kind:t,id:o}])}else Array.from(r.entries()).forEach(o=>{let[l,u]=o;n.push([e,{kind:l,id:u}])});return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach(r=>{var o;(o=this.remoteDataChannelMap.get(e))!==null&&o!==void 0&&o.has(r.id)&&n.push(r)}),n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[r,{kind:o,id:l}]=n;switch(o){case Pe.VIDEO:return void(r._videoSSRC&&t.push({stream_type:Pe.VIDEO,ssrcId:r._videoSSRC}));case Pe.AUDIO:return void(r._audioSSRC&&t.push({stream_type:Pe.AUDIO,ssrcId:r._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(n=>{let[r,{kind:o}]=n;if(t.has(r)){let l=t.get(r);o===Pe.VIDEO?l|=ci.Video:l|=ci.Audio,t.set(r,l)}else o===Pe.VIDEO?t.set(r,ci.Video):t.set(r,ci.Audio)}),{users:Array.from(t.entries()).map(n=>{let[r,o]=n;return{stream_id:r.uid,stream_type:o}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:r}]=t;const o=this.remoteUserMap.get(n);o&&(o.delete(r),Array.from(o.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(he.LocalVideoTrack),n=this.localTrackMap.get(he.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new we((r,o)=>{this.handleUpdateVideoEncoder(t.track,r,o,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new we((r,o)=>{this.handleUpdateVideoEncoder(n.track,r,o,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t,n){return e.map((r,o)=>{var l;let{stream_type:u}=r;const h=(l=t.find(m=>{let{stream_type:g}=m;return u===g}))===null||l===void 0?void 0:l.attributes;if(h&&G("DISABLE_SCREEN_SHARE_REMB")){const m=n[o]._hints;(Te(m).call(m,$t.SCREEN_TRACK)||Te(m).call(m,$t.SCREEN_LOW_TRACK))&&(h.remb=!1,A.debug("disable remb for screen share, hints:",m))}return h})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof bn){var t;const r=this.filterTobeUnmutedTracks(e[n]);if(r.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(r.map(l=>{let[,{id:u}]=l;return u})));const o=this.createUnmuteMessage(r);return void await Xt(this,je.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(je.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(je.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Si(xI(this.dtlsFailedCount,Kn)),this.emit(je.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Mi(this,je.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(je.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(he.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof an)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof an).length>1)throw new oe(B.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof bn).length>1&&(e.some(t=>t instanceof bn&&t._bypassWebAudio)||!bt().webAudioMediaStreamDest))throw new oe(B.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof an&&this.pendingLocalTracks.some(n=>n instanceof an))throw new oe(B.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof bn&&this.pendingLocalTracks.some(n=>n instanceof bn)&&(!bt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof bn&&n._bypassWebAudio)))throw new oe(B.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const r=!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&bt().supportDualStreamEncoding,o=Pc(Pc({},{width:160,height:120,framerate:15,bitrate:50}),t);let l;l=r?e._mediaStreamTrack.clone():zO(e,o);const u=Jt(8,"track-low-"),h=new an(l,Pc(Pc({},r&&{scaleResolutionDownBy:bO(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,u);return h.on(qh.TRANSCEIVER_UPDATED,m=>{e._updateRtpTransceiver(m,qm.LOW_STREAM)}),h._hints.push($t.LOW_STREAM),Te(n=e._hints).call(n,$t.SCREEN_TRACK)&&h._hints.push($t.SCREEN_LOW_TRACK),e.on("sei-to-send",m=>{h.emit("sei-to-send",m)}),e.addListener(De.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Oc){var o,l,u,h;const m=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:g,dtlsTransportState:E,peerConnectionState:S}=this.connection,{local:R,remote:b}=await this.connection.getSelectedCandidatePair();xe.pcStats(this.store.sessionId,{startTime:m,eventElapse:e-m||0,iceconnectionsate:g,dtlsstate:E,connectionstate:S,intSucc:t?1:2,error:this._iceError||r||"",selectedLocalCandidateProtocol:(o=R==null?void 0:R.protocol)!==null&&o!==void 0?o:"",selectedLocalCandidateType:(l=R.candidateType)!==null&&l!==void 0?l:"",selectedLocalCandidateAddress:"".concat(R.address,":").concat(R.port),selectedRemoteCandidateProtocol:(u=b.protocol)!==null&&u!==void 0?u:"",selectedRemoteCandidateType:(h=b.candidateType)!==null&&h!==void 0?h:"",selectedRemoteCandidateAddress:"".concat(b.address,":").concat(b.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,t,n,r){var o;const l=Array.from(Ks(o=this.remoteUserMap).call(o)).find(u=>u._videoSSRC===e);if(l){r||this.store.subscribe(l.uid,"video",void 0,void 0,void 0,void 0,Date.now());const u=this.store.keyMetrics,h=u.subscribe.find(m=>m.userId===l.uid&&m.type==="video");xe.firstRemoteVideoDecode(this.store.sessionId,ai.FIRST_VIDEO_DECODE,pn.FIRST_VIDEO_DECODE,{peer:l._uintid,videowidth:t,videoheight:n,subscribeElapse:Hi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:u.requestAPEnd||0,apStart:u.requestAPStart||0,joinGwEnd:u.joinGatewayEnd||0,joinGwStart:u.joinGatewayStart||0,pcEnd:u.peerConnectionEnd||0,pcStart:u.peerConnectionStart||0,subscriberEnd:(h==null?void 0:h.subscribeEnd)||0,subscriberStart:(h==null?void 0:h.subscribeStart)||0,videoAddNotify:(h==null?void 0:h.streamAdded)||0,state:r?1:0,firstFrame:(h==null?void 0:h.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const o=r.get(t);if(!o)return!1;const l=await this.connection.getRemoteSSRC(o);return l!==void 0&&l!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===he.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,qm.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},ke(dt.prototype,"startP2PConnection",[or],Object.getOwnPropertyDescriptor(dt.prototype,"startP2PConnection"),dt.prototype),ke(dt.prototype,"connect",[or],Object.getOwnPropertyDescriptor(dt.prototype,"connect"),dt.prototype),ke(dt.prototype,"updateRemoteRTPCapabilities",[or],Object.getOwnPropertyDescriptor(dt.prototype,"updateRemoteRTPCapabilities"),dt.prototype),ke(dt.prototype,"publishDataChannel",[or],Object.getOwnPropertyDescriptor(dt.prototype,"publishDataChannel"),dt.prototype),ke(dt.prototype,"unpublish",[or],Object.getOwnPropertyDescriptor(dt.prototype,"unpublish"),dt.prototype),ke(dt.prototype,"unpublishDataChannel",[or],Object.getOwnPropertyDescriptor(dt.prototype,"unpublishDataChannel"),dt.prototype),ke(dt.prototype,"unpublishLowStream",[or],Object.getOwnPropertyDescriptor(dt.prototype,"unpublishLowStream"),dt.prototype),ke(dt.prototype,"subscribeDataChannel",[or],Object.getOwnPropertyDescriptor(dt.prototype,"subscribeDataChannel"),dt.prototype),ke(dt.prototype,"subscribe",[or],Object.getOwnPropertyDescriptor(dt.prototype,"subscribe"),dt.prototype),ke(dt.prototype,"massSubscribe",[or],Object.getOwnPropertyDescriptor(dt.prototype,"massSubscribe"),dt.prototype),ke(dt.prototype,"unsubscribe",[or],Object.getOwnPropertyDescriptor(dt.prototype,"unsubscribe"),dt.prototype),ke(dt.prototype,"unsubscribeDataChannel",[or],Object.getOwnPropertyDescriptor(dt.prototype,"unsubscribeDataChannel"),dt.prototype),ke(dt.prototype,"massUnsubscribe",[or],Object.getOwnPropertyDescriptor(dt.prototype,"massUnsubscribe"),dt.prototype),ke(dt.prototype,"muteRemote",[or],Object.getOwnPropertyDescriptor(dt.prototype,"muteRemote"),dt.prototype),ke(dt.prototype,"unmuteRemote",[or],Object.getOwnPropertyDescriptor(dt.prototype,"unmuteRemote"),dt.prototype),ke(dt.prototype,"hasRemoteMediaWithLock",[or],Object.getOwnPropertyDescriptor(dt.prototype,"hasRemoteMediaWithLock"),dt.prototype),ke(dt.prototype,"disconnectForReconnect",[or],Object.getOwnPropertyDescriptor(dt.prototype,"disconnectForReconnect"),dt.prototype),ke(dt.prototype,"updateBitrateLimit",[or],Object.getOwnPropertyDescriptor(dt.prototype,"updateBitrateLimit"),dt.prototype),ke(dt.prototype,"remoteMediaSsrcChanged",[or],Object.getOwnPropertyDescriptor(dt.prototype,"remoteMediaSsrcChanged"),dt.prototype),dt);function or(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,l=await o.lock("From P2PChannel.".concat(t));try{for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return await r.apply(this,h)}finally{l()}},n}function MB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function UB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?MB(Object(n),!0).forEach(function(r){U(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):MB(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const YQ=Date.now(),XQ=20,KO=new Map,kw=new Map;async function VB(e){const t=KO.get(e),n=Array.isArray(t)&&t[t.length-1],r=kw.get(e);if(!n)return void(r.isSyncing=!1);const o={uid:n.uid,payload:n.payload};r.firstRecvTs===0&&(r.firstRecvTs=n.recvTs,r.firstSendTs=n.sendTs);const l=n.sendTs-r.firstSendTs,u=l-(Date.now()-r.firstRecvTs);u>0&&(r.firstRecvTs=Date.now()-l);let h=n.mediaDelay+u;h<=0?(t.pop(),FB(n.context,o),h=0):h=Math.min(h,XQ),setTimeout(()=>t.length&&VB(e),h)}function FB(e,t){e.safeEmit(pt.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function JQ(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return FB(n,{uid:e.uid,payload:e.payload});const r="".concat(n.id,"-").concat(e.uid),o=KO.get(r)||[],l=o.findIndex(g=>e.sendTs>=g.sendTs),u=UB(UB({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});l===-1?o.push(u):o.splice(l,0,u),KO.set(r,o);let h=!1;var m;kw.has(r)?h=!((m=kw.get(r))===null||m===void 0||!m.isSyncing):kw.set(r,{isSyncing:h,firstRecvTs:0,firstSendTs:0}),h||VB(r)}const $Q=Tt().name;function BB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function jB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?BB(Object(n),!0).forEach(function(r){U(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):BB(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const mg="websdk_ng_cache_parameter",QQ=G("MAX_PRELOAD_ASYNC_LENGTH"),ZQ=1e4,op=new Map,ap=[];let qO=null,YO=0,XO=0;const Lw=new Map,eZ=function(e,t){const n=[];let r=0;const o=async()=>{const l=n.shift();l&&await l(),n.length>0&&r<t?o():r--};return async function(){for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return new we(async(m,g)=>{n.push(async()=>{try{const E=await e(...u);m(E)}catch(E){g(E)}}),r<t&&(r++,o())})}}(GB,QQ),JO=Pr.CancelToken.source();async function GB(e,t,n,r,o,l){try{if(!G("ENABLE_PRELOAD"))return;if(!bt().supportWebCrypto)return void Yu(()=>{A.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new oe(B.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&vi(n,"token",1,2047),vi(e,"appid",1,2047),uw(t),r&&dw(r);const u=Hh();A.debug("preload channel ".concat(t,", uid is ").concat(r));const h={appId:e,cname:t,token:n||e,uid:typeof r!="string"?r:null,sid:u,proxyServer:o};let m,g;typeof r=="string"?(h.stringUid=r,[g,m]=await we.all([MQ(r,{sid:u,appId:e},JO.token),uB(jB(jB({},h),{},{token:n||e,uid:0}),JO.token)]),h.uid=g.uid,m.gatewayInfo.uid=h.uid,m.gatewayInfo.res.uid=h.uid):(l&&(h.stringUid=l),m=await uB(h,JO.token));const E={sid:u,appId:e,cname:t,token:n||e,uid:h.stringUid||r,intUid:h.uid||m.gatewayInfo.uid,stringUid:h.stringUid,ts:Date.now(),sua:g,ap:m};await async function(S){let R;try{S.uid&&zB({appId:S.appId,cname:S.cname,token:S.token,uid:S.uid,stringUid:S.stringUid});const b=YB(S),x=await async function(k,V){try{const F=await window.crypto.subtle.importKey("raw",L2(V),"AES-GCM",!1,["encrypt"]),K=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},F,zh(window.btoa(JSON.stringify(k))));return Xu(new Uint8Array(K))}catch{return}}(S,S.token||S.appId);if(!x)return;R=qB(mg);const P=R?JSON.parse(R):[];P.push({[b]:x}),P.length>G("AP_CACHE_NUM")&&P.shift(),xw(mg,JSON.stringify(P))}catch(b){A.warn("Error caching server parameters:",b.message),xw(mg,"")}}(E),YO++}catch(u){throw XO++,function(h){qO||(qO=window.setTimeout(()=>{let g="";Lw.forEach((E,S)=>{g+="".concat(S,": ").concat(E," ;")}),xe.reportApiInvoke(null,{name:Hn.PRELOAD,options:{success:YO,failed:XO,err:g}}).onError(h),YO=0,XO=0,Lw.clear(),qO=null},ZQ));const m=Lw.get(h.code)||0;Lw.set(h.code,m+1)}(u),u}}async function WB(e){try{if(G("AP_REQUEST_DETAIL")||G("ENABLE_ROLE_SELECT_EDGE"))return;const t=zB(e);if(!t||e.cloudProxyServer!=="disabled")return;const n=await async function(r,o){try{const l=await window.crypto.subtle.importKey("raw",L2(o),"AES-GCM",!1,["decrypt"]),u=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},l,zh(r));return JSON.parse(window.atob(Xu(new Uint8Array(u))))}catch{return}}(t,e.token||e.appId);if(!n||!function(r,o){return r.cname===o.cname&&r.appId===o.appId&&r.token===o.token?o.stringUid?r.stringUid===o.stringUid:typeof o.uid=="number"?r.uid===o.uid:r.uid==o.uid:!1}(n,e))return;if(n&&Date.now()-n.ts<G("AP_CACHE_LIFETIME"))return n}catch(t){A.warn("Error get preloadInfo",t.message)}}function zB(e){let t;try{if(t=qB(mg),!t)return;const n=JSON.parse(t),r=YB(e),o=function(u,h){for(let m=u.length-1;m>=0;m--)if(h(u[m]))return m;return-1}(n,u=>r in u);if(o===-1)return;const l=n.splice(o,1)[0];return xw(mg,JSON.stringify(n)),l[r]}catch(n){A.warn("Error delete preload info: ".concat(t),n.message),xw(mg,"")}}function $O(e){if(e){let t=op.get(e);t&&(window.clearTimeout(t),t=null,op.delete(e)),Te(ap).call(ap,e)||e.cloudProxyServer!=="disabled"||ap.push(e)}if(op.size<G("AP_CACHE_NUM")&&ap.length>0){const t=ap.shift();op.set(t,window.setTimeout(async()=>{const{appId:n,cname:r,token:o,stringUid:l,uid:u,proxyServer:h}=t;try{await eZ(n,r,o,u,h,l),op.has(t)&&$O(t)}catch(m){A.warn("update preload failed",m.message),HB(t)}},G("AP_UPDATE_INTERVAL")))}}function HB(e){const t=ap.indexOf(e);t!==-1&&ap.splice(t,1);let n=op.get(e);n&&(window.clearTimeout(n),n=null,op.delete(e),$O())}function KB(e,t){const n=e.sua,r=e.ap;t&&n&&xe.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),xe.reportResourceTiming(e.ap.url,e.sid),xe.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map(o=>o.ip).join(","),eventType:"disabled",unilbsServerIds:[Vn.CHOOSE_SERVER,Vn.CLOUD_PROXY_FALLBACK].toString()}),xe.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map(o=>o.address),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[Vn.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function qB(e){return window.atob(window.localStorage.getItem(e)||"")}function xw(e,t){window.localStorage.setItem(e,window.btoa(t))}function YB(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),j2(t)}function tZ(e){let t=function(){const n=rZ.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,r){let o=n.appId;o!==void 0&&(jn(r,10),sd(r,o));let l=n.cid;l!==void 0&&(jn(r,16),jn(r,l));let u=n.cname;u!==void 0&&(jn(r,26),sd(r,u));let h=n.deviceId;h!==void 0&&(jn(r,34),sd(r,h));let m=n.elapse;m!==void 0&&(jn(r,40),od(r,m));let g=n.fileSize;g!==void 0&&(jn(r,48),od(r,gg(g)));let E=n.height;E!==void 0&&(jn(r,56),od(r,gg(E)));let S=n.jpg;S!==void 0&&(jn(r,66),jn(r,S.length),JB(r,S));let R=n.networkType;R!==void 0&&(jn(r,72),od(r,gg(R)));let b=n.osType;b!==void 0&&(jn(r,80),od(r,gg(b)));let x=n.requestId;x!==void 0&&(jn(r,90),sd(r,x));let P=n.sdkVersion;P!==void 0&&(jn(r,98),sd(r,P));let k=n.sequence;k!==void 0&&(jn(r,104),od(r,gg(k)));let V=n.sid;V!==void 0&&(jn(r,114),sd(r,V));let F=n.timestamp;F!==void 0&&(jn(r,120),od(r,F));let K=n.uid;K!==void 0&&(jn(r,128),jn(r,K));let $=n.vid;$!==void 0&&(jn(r,136),jn(r,$));let Z=n.width;Z!==void 0&&(jn(r,144),od(r,gg(Z)));let J=n.service;J!==void 0&&(jn(r,152),jn(r,J));let re=n.callbackData;re!==void 0&&(jn(r,162),jn(r,re.length),JB(r,re));let pe=n.ticket;pe!==void 0&&(jn(r,170),sd(r,pe));let Ce=n.vendorConfigs;Ce!==void 0&&(jn(r,178),sd(r,Ce))}(e,t),function(n){let r=n.bytes,o=n.limit;return r.length===o?r:r.subarray(0,o)}(t)}function nZ(e){return function(n){let r={};e:for(;!sZ(n);){let o=Oy(n);switch(o>>>3){case 0:break e;case 1:r.code=Oy(n);break;case 2:r.msg=$B(n,Oy(n));break;case 3:r.requestId=$B(n,Oy(n));break;case 4:r.timestamp=oZ(n,!1);break;default:iZ(n,7&o)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function iZ(e,t){switch(t){case 0:for(;128&Xo(e););break;case 2:QO(e,Oy(e));break;case 5:QO(e,4);break;case 1:QO(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function gg(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let rZ=[];function QO(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function sZ(e){return e.offset>=e.limit}function Mw(e,t){let n=e.bytes,r=e.offset,o=e.limit,l=r+t;if(l>n.length){let u=new Uint8Array(2*l);u.set(n),e.bytes=u}return e.offset=l,l>o&&(e.limit=l),r}function XB(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function JB(e,t){let n=Mw(e,t.length);e.bytes.set(t,n)}function $B(e,t){let n=XB(e,t),r=String.fromCharCode,o=e.bytes,l="",u="";for(let h=0;h<t;h++){let m,g,E,S,R=o[h+n];(128&R)==0?u+=r(R):(224&R)==192?h+1>=t?u+=l:(m=o[h+n+1],(192&m)!=128?u+=l:(S=(31&R)<<6|63&m,S<128?u+=l:(u+=r(S),h++))):(240&R)==224?h+2>=t?u+=l:(m=o[h+n+1],g=o[h+n+2],(49344&(m|g<<8))!=32896?u+=l:(S=(15&R)<<12|(63&m)<<6|63&g,S<2048||S>=55296&&S<=57343?u+=l:(u+=r(S),h+=2))):(248&R)==240?h+3>=t?u+=l:(m=o[h+n+1],g=o[h+n+2],E=o[h+n+3],(12632256&(m|g<<8|E<<16))!=8421504?u+=l:(S=(7&R)<<18|(63&m)<<12|(63&g)<<6|63&E,S<65536||S>1114111?u+=l:(S-=65536,u+=r(55296+(S>>10),56320+(1023&S)),h+=3))):u+=l}return u}function sd(e,t){let n=t.length,r=0;for(let u=0;u<n;u++){let h=t.charCodeAt(u);h>=55296&&h<=56319&&u+1<n&&(h=(h<<10)+t.charCodeAt(++u)-56613888),r+=h<128?1:h<2048?2:h<65536?3:4}jn(e,r);let o=Mw(e,r),l=e.bytes;for(let u=0;u<n;u++){let h=t.charCodeAt(u);h>=55296&&h<=56319&&u+1<n&&(h=(h<<10)+t.charCodeAt(++u)-56613888),h<128?l[o++]=h:(h<2048?l[o++]=h>>6&31|192:(h<65536?l[o++]=h>>12&15|224:(l[o++]=h>>18&7|240,l[o++]=h>>12&63|128),l[o++]=h>>6&63|128),l[o++]=63&h|128)}}function Xo(e){return e.bytes[XB(e,1)]}function QB(e,t){let n=Mw(e,1);e.bytes[n]=t}function Oy(e){let t,n=0,r=0;do t=Xo(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function jn(e,t){for(t>>>=0;t>=128;)QB(e,127&t|128),t>>>=7;QB(e,t)}function oZ(e,t){let n,r=0,o=0,l=0;return n=Xo(e),r=127&n,128&n&&(n=Xo(e),r|=(127&n)<<7,128&n&&(n=Xo(e),r|=(127&n)<<14,128&n&&(n=Xo(e),r|=(127&n)<<21,128&n&&(n=Xo(e),o=127&n,128&n&&(n=Xo(e),o|=(127&n)<<7,128&n&&(n=Xo(e),o|=(127&n)<<14,128&n&&(n=Xo(e),o|=(127&n)<<21,128&n&&(n=Xo(e),l=127&n,128&n&&(n=Xo(e),l|=(127&n)<<7))))))))),{low:r|o<<28,high:o>>>4|l<<24,unsigned:t}}function od(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,o=t.high>>>24,l=o===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:o<128?9:10,u=Mw(e,l),h=e.bytes;switch(l){case 10:h[u+9]=o>>>7&1;case 9:h[u+8]=l!==9?128|o:127&o;case 8:h[u+7]=l!==8?r>>>21|128:r>>>21&127;case 7:h[u+6]=l!==7?r>>>14|128:r>>>14&127;case 6:h[u+5]=l!==6?r>>>7|128:r>>>7&127;case 5:h[u+4]=l!==5?128|r:127&r;case 4:h[u+3]=l!==4?n>>>21|128:n>>>21&127;case 3:h[u+2]=l!==3?n>>>14|128:n>>>14&127;case 2:h[u+1]=l!==2?n>>>7|128:n>>>7&127;case 1:h[u]=l!==1?128|n:127&n}}const ZB={},ej={},Uw=4294967296,aZ=Uw*Uw,cZ=aZ/2;nj(0,!0);const tj=nj(0),lZ=Ny(0,-2147483648,!1),uZ=Ny(-1,2147483647,!1);function nj(e,t){let n,r,o;return t?(o=0<=(e>>>=0)&&e<256)&&(r=ej[e],r)?r:(n=Ny(e,0,!0),o&&(ej[e]=n),n):(o=-128<=(e|=0)&&e<128)&&(r=ZB[e],r)?r:(n=Ny(e,e<0?-1:0,!1),o&&(ZB[e]=n),n)}function Ny(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function ij(e,t){if(isNaN(e))return tj;{if(e<=-9223372036854776e3)return lZ;if(e+1>=cZ)return uZ}return e<0?tj:Ny(e%Uw|0,e/Uw|0,t)}function rj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}class ZO extends En{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(La.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),U(this,"name","AgoraRTCImageModeration"),U(this,"_connectionState",Eo.CONNECTING),U(this,"_sequence",0),U(this,"_moderationStartTime",void 0),U(this,"_workerConnection",void 0),U(this,"_workerMessageLengthLimit",void 0),U(this,"_qualityRatio",void 0),U(this,"_connectInfo",void 0),U(this,"_cancelTokenSource",Pr.CancelToken.source()),U(this,"_retryConfig",void 0),U(this,"_moderationInterval",void 0),U(this,"_moderationTimer",null),U(this,"_moderationMode",1),U(this,"_quality",1),U(this,"_qualityTimer",null),U(this,"_ticket",void 0),U(this,"_moderationIntervalMinimum",void 0),U(this,"_uploadFailedNum",0),U(this,"_uploadNum",0),U(this,"_uploadTimer",null),U(this,"_extraInfo",void 0),U(this,"_vendor",""),U(this,"_encoder",new TextEncoder),U(this,"_moderationId",void 0),U(this,"inspectImage",()=>{if(this.connectionState!==Eo.CONNECTED)throw new ie(B.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Eo.CONNECTED?this.requestToInspectImage():A.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Jt(5,"image-moderation-"),this._workerMessageLengthLimit=G("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=G("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=G("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new yy("worker-"+this._moderationId,Kn),this.on(La.STATE_CHANGE,(r,o)=>{A.debug("[".concat(this._moderationId,"] Moderation operation :").concat(sg[r]," ").concat(o||""))}),this.handleWorkerEvents()}async init(t,n){this.emit(La.STATE_CHANGE,sg.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new we((o,l)=>{this.on(La.CONNECTION_STATE_CHANGE,(u,h)=>{u===Eo.CONNECTED&&o()}),this.requestAP(t,r,n).then(u=>{this.connectWorker(u)}).catch(u=>{l(u)})})}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),A.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===Eo.CONNECTED&&this.inspectImage()}async requestAP(t,n,r){const o=G("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),l=await function(m,g,E,S){let{appId:R,areaCode:b,cname:x,sid:P,token:k,uid:V}=g;dg++;const F="moderation_plugin",K={service_name:F,json_body:JSON.stringify({appId:R,areaCode:b,cname:x,command:"allocateEdge",requestId:dg,seq:dg,sid:P,appToken:k,ts:Date.now(),uid:V+""})};let $,Z,J=m[0];return Na(async()=>{$=Date.now();const re=await xa(J,{data:K,cancelToken:E,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Z=Date.now()-$,re.code!==0){const Ie=new ie(B.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+re.code,{retry:!0,responseTime:Z});throw A.error(Ie.toString()),Ie}const pe=JSON.parse(re.json_body);if(pe.code!==200){const Ie=new ie(B.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(pe.code,", reason: ").concat(pe.reason),{code:pe.code,responseTime:Z});throw A.error(Ie.toString()),Ie}if(!pe.servers||!Array.isArray(pe.servers)||pe.servers.length===0){const Ie=new ie(B.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:pe.code,responseTime:Z});throw A.error(Ie.toString()),Ie}if(!pe.servers.some(Ie=>!!Ie.wss)){const Ie=new ie(B.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:pe.code,responseTime:Z});throw A.error(Ie.toString()),Ie}const Ce=G("IMAGE_MODERATION_WORKER_HOST");return{addressList:pe.servers.map(Ie=>{let{address:_t,wss:Et}=Ie;if(_t&&Et)return"wss://".concat(_t.replace(/\./g,"-"),".").concat(Ce,":").concat(Et,"/moderation")}).filter(Ie=>!!Ie),workerToken:pe.workerToken,vid:pe.vid,ticket:pe.appTicket,responseTime:Z}},(re,pe)=>(xe.apworkerEvent(P,{success:!0,sc:200,serviceName:F,responseDetail:JSON.stringify(re.addressList),firstSuccess:pe===0,responseTime:Z,serverIp:m[pe%m.length]}),!1),(re,pe)=>(xe.apworkerEvent(P,{success:!1,sc:re.data&&re.data.code||200,serviceName:F,responseTime:Z,serverIp:m[pe%m.length]}),!!(re.code!==B.OPERATION_ABORTED&&re.code!==B.UNEXPECTED_RESPONSE||re.data&&re.data.retry)&&(J=m[(pe+1)%m.length],!0)),S)}(o,t,n,r);this.emit(La.STATE_CHANGE,sg.AP_CONNECTED);const{addressList:u,ticket:h}=l;return this._ticket=h,u}async connectWorker(t){this.emit(La.STATE_CHANGE,sg.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(it.CONNECTED,async()=>{this.emit(La.STATE_CHANGE,sg.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Eo.CONNECTED}),this._workerConnection.on(it.CLOSED,()=>{this.connectionState=Eo.CLOSED}),this._workerConnection.on(it.FAILED,()=>{this.connectionState=Eo.CLOSED}),this._workerConnection.on(it.RECONNECTING,()=>{this.connectionState=this.connectionState===Eo.CONNECTED?Eo.RECONNECTING:Eo.CONNECTING}),this._workerConnection.on(it.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const n=nZ(new Uint8Array(t.data));G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&A.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,A.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{xe.reportApiInvoke(this._connectInfo.sid||null,{name:Hn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:Tn.TRACER}).onError(new ie(B.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},G("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else A.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(it.WILL_RECONNECT,(t,n,r)=>{t==="recover"&&r(t),r("tryNext")}),this._workerConnection.on(it.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=zs(this,La.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&A.debug("Only the track being played can be inspected"));this._sequence++;const r=await this.generateRequestData(t,n);this._workerConnection.sendMessage(r,!0,!0)}else G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&A.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:r,cname:o,cid:l,vid:u,sid:h,uid:m}=n;const g=Date.now(),E=await t.getCurrentFrameImage("image/jpeg",this.quality),S=await NU(E,r,o),R=this._sequence+"-"+l+"-"+m+"-"+g+"-"+Jt(12,""),b={appId:r,cid:l,cname:o,deviceId:"",elapse:ZO.intToLong(Number(g-this._moderationStartTime)),fileSize:E.buffer.byteLength,height:E.height,width:E.width,jpg:S,networkType:6,osType:7,requestId:R,sdkVersion:"4.23.2",sequence:this._sequence,sid:h,timestamp:ij(g),uid:m,vid:u,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete b.callbackData;const x=tZ(b);if(x.byteLength<this._workerMessageLengthLimit){if(G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const P=function(k){for(var V=1;V<arguments.length;V++){var F=arguments[V]!=null?arguments[V]:{};V%2?rj(Object(F),!0).forEach(function(K){U(k,K,F[K])}):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(F)):rj(Object(F)).forEach(function(K){Object.defineProperty(k,K,Object.getOwnPropertyDescriptor(F,K))})}return k}({},b);delete P.jpg,A.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(P))}return x}{const P=this.quality*this._qualityRatio;return this.quality=P,await this.generateRequestData(t,{appId:r,cname:o,cid:l,vid:u,sid:h,uid:m})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Pr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Eo.CLOSED,this.emit(La.STATE_CHANGE,sg.CLOSED)}}function sj(e){if(jt(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new ie(B.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new ie(B.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const dZ={name:"ImageModeration",create:function(e){let{config:t}=e;return sj(t),new ZO(t)}};var oj,aj,cj,lj,uj,dj,hj,pj,fj,mj,gj,_j,Ej,yj,vj,Sj,Tj,Rj,wj,Cj,bj,Aj,Ij,Oj,Nj,Pj,Dj,kj,Lj,xj,Mj,Uj,Vj,Fj,Bj,jj,Gj,Wj,zj,Hj,Kj,Ae;function qj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Jo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?qj(Object(n),!0).forEach(function(r){U(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qj(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}Gi.setLogger(A);let hZ=(oj=He(),aj=He({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof $m))return[t];t=[t]}return t.map(n=>n?Object(n).toString():"null")}}),cj=He({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==Jm.DATA?(Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId())):[t.getChannelId()])}),lj=He({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),uj=He({argsMap:(e,t,n)=>[t,n]}),dj=He({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:o}=n;return[r==null?void 0:r.uid,o]})}),hj=He({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),pj=He({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:o}=n;return{uid:r==null?void 0:r.uid,mediaType:o}})}),fj=He(),mj=He(),gj=He(),_j=He(),Ej=He(),yj=He(),vj=He(),Sj=He(),Tj=He(),Rj=He(),wj=He(),Cj=He(),bj=He(),Aj=He(),Ij=He(),Oj=He({argsMap:(e,t)=>[t]}),Nj=He(),Pj=He(),Dj=He(),kj=He(),Lj=He(),xj=He(),Mj=He(),Uj=He(),Vj=He({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),Fj=He(),Bj=He(),jj=He(),Gj=He(),Wj=He(),zj=He(),Hj=He({reportResult:!0}),Kj=He(),Ae=class extends En{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),U(this,"store",void 0),U(this,"_uid",void 0),U(this,"_channelName",void 0),U(this,"_uintUid",void 0),U(this,"_users",[]),U(this,"_config",void 0),U(this,"_clientId",void 0),U(this,"_appId",void 0),U(this,"_sessionId",null),U(this,"_key",void 0),U(this,"_rtmConfig",{}),U(this,"_joinInfo",void 0),U(this,"_gateway",void 0),U(this,"_statsCollector",void 0),U(this,"_configDistribute",void 0),U(this,"_leaveMutex",void 0),U(this,"_publishMutex",void 0),U(this,"_renewTokenMutex",void 0),U(this,"_subscribeMutex",void 0),U(this,"_encryptionMode","none"),U(this,"_encryptionSecret",null),U(this,"_encryptionSalt",null),U(this,"_encryptDataStream",!1),U(this,"_encryptDataStreamKey",null),U(this,"_encryptDataStreamIv",null),U(this,"_proxyServer",void 0),U(this,"_turnServer",{servers:[],mode:"auto"}),U(this,"_cloudProxyServerMode","disabled"),U(this,"_isDualStreamEnabled",!1),U(this,"_defaultStreamFallbackType",void 0),U(this,"_lowStreamParameter",void 0),U(this,"_streamFallbackTypeCacheMap",new Map),U(this,"_remoteStreamTypeCacheMap",new Map),U(this,"_axiosCancelSource",Pr.CancelToken.source()),U(this,"_audioVolumeIndicationInterval",void 0),U(this,"_networkQualityInterval",void 0),U(this,"_userOfflineTimeout",void 0),U(this,"_streamRemovedTimeout",void 0),U(this,"_liveTranscodeStreamingClient",void 0),U(this,"_liveRawStreamingClient",void 0),U(this,"_channelMediaRelayClient",void 0),U(this,"_networkQualitySensitivity","normal"),U(this,"_p2pChannel",void 0),U(this,"_useLocalAccessPoint",!1),U(this,"_setLocalAPVersion",void 0),U(this,"_joinAndNotLeaveYet",!1),U(this,"_numberOfJoinCount",0),U(this,"_remoteDefaultVideoStreamType",void 0),U(this,"_inspect",void 0),U(this,"_moderation",void 0),U(this,"_license",void 0),U(this,"_pendingPublishedUsers",[]),U(this,"ntpAlignErrorCount",0),U(this,"remoteInboundOffset",0),U(this,"_peerConnectionState",void 0),U(this,"_handleLocalTrackEnable",(o,l,u)=>{this.publish(o,!1).then(l).catch(u)}),U(this,"_handleLocalTrackDisable",(o,l,u)=>{this.unpublish(o).then(l).catch(u)}),U(this,"_handleUserOnline",o=>{if(G("BLOCK_LOCAL_CLIENT")&&Zh(o.uid,this.channelName))return void A.debug("[".concat(o.uid,"] will be ignored in local"));this.isStringUID&&typeof o.uid!="string"&&A.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const l=this._users.find(u=>u.uid===o.uid);if(l)l._trust_in_room_=!0,l._is_pre_created&&(l._is_pre_created=!1,this.safeEmit(pt.USER_JOINED,l));else{const u=new id(o.uid,o.uint_id||o.uid);this._users.push(u),A.debug("[".concat(this._clientId,"] user online"),o.uid),this.safeEmit(pt.USER_JOINED,u)}}),U(this,"_handleUserOffline",o=>{if(G("BLOCK_LOCAL_CLIENT")&&Zh(o.uid,this.channelName))return;const l=this._users.find(u=>u.uid===o.uid);l&&(this._handleRemoveStream(o),this._handleRemoveDataChannels(o),l._audio_pre_subscribed||l._video_pre_subscribed?l._is_pre_created=!0:FR(this._users,l),this._remoteStreamTypeCacheMap.delete(l.uid),this._streamFallbackTypeCacheMap.delete(l.uid),A.debug("[".concat(this._clientId,"] user offline"),o.uid,"reason:",o.reason),this.safeEmit(pt.USER_LEAVED,l,o.reason))}),U(this,"_handleAddAudioOrVideoStream",(o,l,u,h,m,g,E)=>{if(G("BLOCK_LOCAL_CLIENT")&&Zh(l,this.channelName))return;const S=this._users.find(b=>b.uid===l);if(!S)return void A.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));A.debug("[".concat(this._clientId,"] stream added with uid ").concat(l,", type ").concat(o)),this.store.subscribe(S.uid,o,void 0,void 0,void 0,Date.now());const R=o==="audio"?S.hasAudio:S.hasVideo;S._uintid||(S._uintid=m||l),o==="audio"?S._trust_audio_stream_added_state_=!0:S._trust_video_stream_added_state_=!0,o==="audio"?(S._audio_added_=!0,u!==void 0&&(S._audioSSRC=u),h!==void 0&&(S._cname=h),g&&(S._audioOrtc=g)):(S._video_added_=!0,u!==void 0&&(S._videoSSRC=u),h!==void 0&&(S._cname=h),E!==void 0&&(S._rtxSsrcId=E),g&&(S._videoOrtc=g)),(o==="audio"?S.hasAudio:S.hasVideo)&&!R&&(A.info("[".concat(this._clientId,"] remote user ").concat(S.uid," published ").concat(o)),this.safeEmit(pt.USER_PUBLISHED,S,o)),o==="video"?xe.onGatewayStream(this._sessionId,ai.ON_ADD_VIDEO_STREAM,pn.ON_ADD_VIDEO_STREAM,{peer:m||l,ssrc:S._videoSSRC}):xe.onGatewayStream(this._sessionId,ai.ON_ADD_AUDIO_STREAM,pn.ON_ADD_AUDIO_STREAM,{peer:m||l,ssrc:S._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(S,o,u).then(b=>{if(b&&(A.debug("[".concat(this._clientId,"] resubscribe ").concat(o," for user ").concat(S.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Iy))return this._p2pChannel.unsubscribe(S,o,!0).then(()=>this._subscribe(S,o,!0).catch(x=>{A.error("[".concat(this._clientId,"] resubscribe error"),x.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(S,o)&&(A.debug("[".concat(this._clientId,"] resubscribe ").concat(o," for user ").concat(S.uid," after reconnect.")),this._subscribe(S,o,!0).catch(b=>{A.error("[".concat(this._clientId,"] resubscribe error"),b.toString())}))}),U(this,"_handleRemoveStream",o=>{if(G("BLOCK_LOCAL_CLIENT")&&Zh(o.uid,this.channelName))return;const l=this._users.find(h=>h.uid===o.uid);if(!l)return void A.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));A.debug("[".concat(this._clientId,"] stream removed with uid ").concat(o.uid));let u=()=>{};l.hasAudio&&l.hasVideo?u=()=>{A.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished audio track")),this.safeEmit(pt.USER_UNPUBLISHED,l,"audio"),A.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished video track")),this.safeEmit(pt.USER_UNPUBLISHED,l,"video")}:l.hasVideo?u=()=>{A.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished video track")),this.safeEmit(pt.USER_UNPUBLISHED,l,"video")}:l.hasAudio&&(u=()=>{A.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished audio track")),this.safeEmit(pt.USER_UNPUBLISHED,l,"audio")}),l._video_pre_subscribed||l._audio_pre_subscribed||(l._trust_audio_stream_added_state_=!0,l._trust_video_stream_added_state_=!0,l._audio_added_=!1,l._video_added_=!1,this._p2pChannel instanceof Iy&&this._p2pChannel.unsubscribe(l).then(h=>{if(h)return this._gateway.unsubscribe(h,l.uid)}),l._audioSSRC=void 0,l._videoSSRC=void 0,l._audioOrtc=void 0,l._videoOrtc=void 0,l._rtxSsrcId=void 0),xe.onGatewayStream(this._sessionId,ai.ON_REMOVE_STREAM,pn.ON_REMOVE_STREAM,{peer:o.uint_id||o.uid}),u()}),U(this,"_handleSetStreamLocalEnable",(o,l,u)=>{if(G("BLOCK_LOCAL_CLIENT")&&Zh(l,this.channelName))return;const h=this._users.find(E=>E.uid===l);if(!h)return void A.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));A.debug("[".concat(this._clientId,"] local ").concat(o," ").concat(u?"enabled":"disabled"," with uid ").concat(l));const m=o==="audio"?h.hasAudio:h.hasVideo;if(o==="audio"){h._trust_audio_enabled_state_=!0;const E=h._audio_enabled_;if(h._audio_enabled_=u,h._audio_enabled_===E)return;{const S=h._audio_enabled_?"enable-local-audio":"disable-local-audio";A.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(l,", msg: ").concat(S)),this.safeEmit(pt.USER_INFO_UPDATED,l,S)}}else{h._trust_video_enabled_state_=!0;const E=h._video_enabled_;if(h._video_enabled_=u,h._video_enabled_===E)return;{const S=h._video_enabled_?"enable-local-video":"disable-local-video";A.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(S)),this.safeEmit(pt.USER_INFO_UPDATED,l,S)}}const g=o==="audio"?h.hasAudio:h.hasVideo;return m!==g?!m&&g?(A.info("[".concat(this._clientId,"] remote user ").concat(l," published ").concat(o)),void this.safeEmit(pt.USER_PUBLISHED,h,o)):(o==="video"&&h._videoTrack&&h._videoTrack._destroy(),o==="audio"&&h._audioTrack,this._p2pChannel.muteRemote(h,o),A.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished ").concat(o)),void this.safeEmit(pt.USER_UNPUBLISHED,h,o)):void 0}),U(this,"_handleMuteStream",(o,l,u)=>{if(G("BLOCK_LOCAL_CLIENT")&&Zh(o,this.channelName))return;A.debug("[".concat(this._clientId,"] receive mute message"),o,l,u);const h=this._users.find(E=>E.uid===o);if(!h)return void A.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(o));const m=l==="audio"?h.hasAudio:h.hasVideo;if(l==="audio"){h._trust_audio_mute_state_=!0;const E=h._audio_muted_;if(h._audio_muted_=u,h._audio_muted_===E)return;{const S=h._audio_muted_?"mute-audio":"unmute-audio";A.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(S)),this.safeEmit(pt.USER_INFO_UPDATED,o,S)}}else{h._trust_video_mute_state_=!0;const E=h._video_muted_;if(h._video_muted_=u,h._video_muted_===E)return;{const S=h._video_muted_?"mute-video":"unmute-video";A.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(S)),this.safeEmit(pt.USER_INFO_UPDATED,o,S)}}const g=l==="audio"?h.hasAudio:h.hasVideo;if(m!==g){if(!m&&g)return(l==="audio"?h._audioSSRC:h._videoSSRC)?(A.info("[".concat(this._clientId,"] remote user ").concat(o," published ").concat(l)),void this.safeEmit(pt.USER_PUBLISHED,h,l)):void A.warning("[".concat(this._clientId,"] remote user ").concat(o," receive ").concat(l," unmute message  before add stream message, ").concat(l," SSRC doesn't exist yet."));l==="video"&&h._videoTrack&&!h._video_pre_subscribed&&h._videoTrack._destroy(),l==="audio"&&h._audioTrack,this._p2pChannel.muteRemote(h,l),A.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished ").concat(l)),this.safeEmit(pt.USER_UNPUBLISHED,h,l)}}),U(this,"_handleP2PLost",async o=>{A.debug("[".concat(this._clientId,"] receive p2p lost"),o),parseInt(o.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():A.warning("[".concat(this._clientId,"] P2PLost stream not found"),o)}),U(this,"_handleTokenWillExpire",()=>{A.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(pt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),U(this,"_handleBeforeUnload",o=>{o.type==="beforeunload"&&o.returnValue!==void 0&&o.returnValue!==""||(this.leave(),A.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),U(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(pt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const o={downlinkNetworkQuality:0,uplinkNetworkQuality:0};o.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),o.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(pt.NETWORK_QUALITY,o)}),U(this,"_handleP2PAddAudioOrVideoStream",(o,l,u,h)=>{const m=this._users.find(E=>E.uid===l);if(!m)return void A.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));A.debug("[".concat(this._clientId,"] stream added with uid ").concat(l,", type ").concat(o)),this.store.subscribe(m.uid,o,void 0,void 0,void 0,Date.now());const g=o==="audio"?m.hasAudio:m.hasVideo;o==="audio"?m._trust_audio_stream_added_state_=!0:m._trust_video_stream_added_state_=!0,o==="audio"?(m._audio_added_=!0,u!==void 0&&(m._audioSSRC=u),h!==void 0&&(m._audioMid=h)):(m._video_added_=!0,u!==void 0&&(m._videoSSRC=u),h!==void 0&&(m._videoMid=h)),(o==="audio"?m.hasAudio:m.hasVideo)&&!g&&(A.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published ").concat(o)),this.safeEmit(pt.USER_PUBLISHED,m,o)),this._p2pChannel.hasPendingRemoteMedia(m,o)&&(A.debug("[".concat(this._clientId,"] resubscribe ").concat(o," for user ").concat(m.uid," after reconnect.")),this._subscribe(m,o,!0).catch(E=>{A.error("[".concat(this._clientId,"] resubscribe error"),E.toString())}))}),this._config=e,this._clientId=t||Jt(5,"client-"),this.store=new class{constructor(o,l,u,h){Qe(this,"state",void 0),this.state={codec:o,audioCodec:l,mode:u,clientId:h,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Kh.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(o){this.state=function(l,u){switch(u.type){case ft.SET_SESSION_ID:return Ne(Ne({},l),{},{sessionId:u.sessionId});case ft.SET_P2P_ID:return Ne(Ne({},l),{},{p2pId:u.p2pId});case ft.SET_UID:return Ne(Ne({},l),{},{uid:u.uid});case ft.SET_INT_UID:return Ne(Ne({},l),{},{intUid:u.intUid});case ft.SET_PUB_ID:return Ne(Ne({},l),{},{pubId:u.pubId});case ft.KEY_METRIC_CLIENT_CREATED:return Ne(Ne({},l),{},{keyMetrics:Ne(Ne({},l.keyMetrics),{},{clientCreated:u.metric})});case ft.KEY_METRIC_JOIN_START:return Ne(Ne({},l),{},{keyMetrics:Ne(Ne({},l.keyMetrics),{},{joinStart:u.metric})});case ft.AVOID_JOIN_START:return Ne(Ne({},l),{},{avoidJoinStart:u.avoidJoinStart});case ft.KEY_METRIC_JOIN_END:return Ne(Ne({},l),{},{keyMetrics:Ne(Ne({},l.keyMetrics),{},{joinEnd:u.metric})});case ft.KEY_METRIC_REQUEST_AP_START:return Ne(Ne({},l),{},{keyMetrics:Ne(Ne({},l.keyMetrics),{},{requestAPStart:u.metric})});case ft.KEY_METRIC_REQUEST_AP_END:return Ne(Ne({},l),{},{keyMetrics:Ne(Ne({},l.keyMetrics),{},{requestAPEnd:u.metric})});case ft.KEY_METRIC_JOIN_GATEWAY_START:return Ne(Ne({},l),{},{keyMetrics:Ne(Ne({},l.keyMetrics),{},{joinGatewayStart:u.metric})});case ft.KEY_METRIC_JOIN_GATEWAY_END:return Ne(Ne({},l),{},{keyMetrics:Ne(Ne({},l.keyMetrics),{},{joinGatewayEnd:u.metric})});case ft.KEY_METRIC_PEER_CONNECTION_START:return Ne(Ne({},l),{},{keyMetrics:Ne(Ne({},l.keyMetrics),{},{peerConnectionStart:u.metric})});case ft.KEY_METRIC_PEER_CONNECTION_END:return Ne(Ne({},l),{},{keyMetrics:Ne(Ne({},l.keyMetrics),{},{peerConnectionEnd:u.metric})});case ft.KEY_METRIC_DESCRIPTION_START:return Ne(Ne({},l),{},{keyMetrics:Ne(Ne({},l.keyMetrics),{},{descriptionStart:u.metric})});case ft.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Ne(Ne({},l),{},{keyMetrics:Ne(Ne({},l.keyMetrics),{},{signalChannelOpen:u.metric})});case ft.KEY_METRIC_ICE_CONNECTION_END:return Ne(Ne({},l),{},{keyMetrics:Ne(Ne({},l.keyMetrics),{},{iceConnectionEnd:u.metric})});case ft.KEY_METRIC_PUBLISH:{const h=l.keyMetrics.publish,m=h.findIndex(g=>g.trackId===u.metric.trackId);return m!==-1?(h[m]=Ne(Ne({},h[m]),u.metric),Ne(Ne({},l),{},{keyMetrics:Ne(Ne({},l.keyMetrics),{},{publish:[...h]})})):Ne(Ne({},l),{},{keyMetrics:Ne(Ne({},l.keyMetrics),{},{publish:[...l.keyMetrics.publish,u.metric]})})}case ft.KEY_METRIC_SUBSCRIBE:{const h=l.keyMetrics.subscribe,m=h.findIndex(g=>g.userId===u.metric.userId&&g.type===u.metric.type);return m!==-1?(h[m]=Ne(Ne({},h[m]),u.metric),Ne(Ne({},l),{},{keyMetrics:Ne(Ne({},l.keyMetrics),{},{subscribe:[...h]})})):Ne(Ne({},l),{},{keyMetrics:Ne(Ne({},l.keyMetrics),{},{subscribe:[...l.keyMetrics.subscribe,u.metric]})})}case ft.SET_CLOUD_PROXY_SERVER_MODE:return l.cloudProxyServerMode=u.mode,l;case ft.RECORD_JOIN_CHANNEL_SERVICE:return typeof u.index!="number"?l.joinChannelServiceRecords=[...l.joinChannelServiceRecords,u.record]:(l.joinChannelServiceRecords[u.index]=Ne(Ne({},l.joinChannelServiceRecords[u.index]),u.record),l.joinChannelServiceRecords=[...l.joinChannelServiceRecords]),l;case ft.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return l.joinChannelServiceRecords=[],l;case ft.RESET_KEY_METRICS:return l.keyMetrics={publish:[],subscribe:[]},l;case ft.SET_USE_P2P:return Ne(Ne({},l),{},{useP2P:u.val});case ft.SET_TRANSPORT_TYPE:return Ne(Ne({},l),{},{p2pTransport:u.val});default:return l}}(this.state,o)}set sessionId(o){this.dispatch({type:ft.SET_SESSION_ID,sessionId:o})}get sessionId(){return this.state.sessionId}set cid(o){this.state.cid=o}get cid(){return this.state.cid}set codec(o){this.state.codec=o}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(o){this.dispatch({type:ft.SET_P2P_ID,p2pId:o})}get p2pId(){return this.state.p2pId}set dcId(o){this.dispatch({type:ft.SET_DC_ID,dcId:o})}get dcId(){return this.state.dcId}set uid(o){this.dispatch({type:ft.SET_UID,uid:o})}get uid(){return this.state.uid}set intUid(o){this.dispatch({type:ft.SET_INT_UID,intUid:o})}get intUid(){return this.state.intUid}set pubId(o){this.dispatch({type:ft.SET_PUB_ID,pubId:o})}get pubId(){return this.state.pubId}set cloudProxyServerMode(o){this.dispatch({type:ft.SET_CLOUD_PROXY_SERVER_MODE,mode:o})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(o){this.dispatch({type:ft.SET_USE_P2P,val:o})}get useP2P(){return this.state.useP2P}set p2pTransport(o){this.dispatch({type:ft.SET_TRANSPORT_TYPE,val:o})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(o){this.state.hasStartJoinChannel=o}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(o){this.state.isABTestSuccess=o}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:ft.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ft.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:ft.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ft.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ft.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ft.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ft.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ft.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ft.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:ft.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ft.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ft.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(o,l,u,h){this.dispatch({type:ft.KEY_METRIC_PUBLISH,metric:Ne(Ne({trackId:o,type:l},u&&{publishStart:u}),h&&{publishEnd:h})})}subscribe(o,l,u,h,m,g,E){this.dispatch({type:ft.KEY_METRIC_SUBSCRIBE,metric:Ne(Ne(Ne(Ne(Ne({userId:o,type:l},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),m&&{firstFrame:m}),g&&{streamAdded:g}),E&&{firstDecoded:E})})}massSubscribe(o,l,u,h){o.forEach(m=>{this.dispatch({type:ft.KEY_METRIC_SUBSCRIBE,metric:Ne(Ne(Ne({userId:m.userId,type:m.type},l&&{subscribeStart:l}),u&&{subscribeEnd:u}),h&&{firstFrame:h})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(o,l){o.service==="gateway"&&Array.isArray(o.urls)&&(o.urls=o.urls.map(u=>u.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof l!="number"?(this.dispatch({type:ft.RECORD_JOIN_CHANNEL_SERVICE,record:Ne(Ne({},o),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(l<0||l>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ft.RECORD_JOIN_CHANNEL_SERVICE,record:o,index:l}),l)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ft.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ft.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(o){this.dispatch({type:ft.AVOID_JOIN_START,avoidJoinStart:o})}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Gi("client-leave",this._clientId),this._publishMutex=new Gi("client-publish",this._clientId),this._renewTokenMutex=new Gi("client-renewtoken",this._clientId),this._subscribeMutex=new Gi("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),A.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(mo," build: ").concat(HI,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{DI(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(o){A.warning("[".concat(this._clientId,"] ").concat(o.toString()))}var r;this._statsCollector=new by(this.store),this._statsCollector.onStatsException=(o,l,u)=>{A.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(o,", msg: ").concat(l,", uid: ").concat(u)),this.safeEmit(pt.EXCEPTION,{code:o,msg:l,uid:u})},this._statsCollector.onUploadPublishDuration=(o,l,u,h)=>{const m=this._users.find(g=>g.uid===o);m&&xe.peerPublishStatus(this._sessionId,{subscribeElapse:h,audioPublishDuration:l,videoPublishDuration:u,peer:m._uintid})},this.store.useP2P=e.mode==="p2p",this._gateway=new NQ(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Kn,httpRetryConfig:e.httpRetryConfig||Kn,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new BQ(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(r={store:this.store,statsCollector:this._statsCollector},Hl("P2PChannel").create(r)),this._handleP2PEvents()):this._p2pChannel=new Iy(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,r,o){let l=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],u=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Vt("JOIN_GATEWAY_USE_443PORT_ONLY",l),Vt("JOIN_GATEWAY_USE_DUAL_DOMAIN",u);const h=this._gateway.signal.websocket;return h instanceof wO&&(h.use443PortOnly=l,h.tryDoubleDomain=u),async function(m,g,E){LR.get(m)||LR.set(m,[]),xR.get(m)||xR.set(m,g),Sc.get(m)||Sc.set(m,0);const S=LR.get(m),R=xR.get(m);if(!S||!R)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Sc.get(m)===R){const V=iy();S.push(V),await V.promise}Sc.set(m,Sc.get(m)+1);for(var b=arguments.length,x=new Array(b>3?b-3:0),P=3;P<b;P++)x[P-3]=arguments[P];const k=await E(...x);return Sc.set(m,Sc.get(m)-1),Sc.get(m)===R-1&&S.length>0&&(S[0].resolve(),S.shift()),Sc.get(m)===0&&(LR.set(m,[]),xR.set(m,0),Sc.set(m,0)),k}("client.join",G("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,r,o)}async join(e,t,n,r,o){const l=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const u=(GR||GR||(GR=(window.location.protocol.split(":")[0]||"").toUpperCase(),GR))==="HTTPS",h=z2()?window.isSecureContext:"Browser Not Support";(!z2()&&!u||!window.isSecureContext)&&A.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),A.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),xe.setAppId(e);try{if(!n&&n!==null)throw new ie(B.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&vi(n,"token",1,2047),vi(e,"appid",1,2047),uw(t),r&&dw(r),o&&vi(o,"optionalInfo",1,2047)}catch(P){throw xe.reportApiInvoke(Hh(),{name:Hn.JOIN,options:[e,t,n,r],states:{isHttps:u,isSecureContext:h},tag:Tn.TRACER}).onError(P),P}if(this._leaveMutex.isLocked&&(A.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),A.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const P=new ie(B.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw xe.reportApiInvoke(Hh(),{name:Hn.JOIN,options:[e,t,n,r],states:{isHttps:u,isSecureContext:h},tag:Tn.TRACER}).onError(P),P}this._gateway.state="CONNECTING";const m=await WB({appId:e,cname:t,uid:r,stringUid:typeof r=="string"?r:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new ie(B.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const g=(m==null?void 0:m.sid)||Hh();A.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(l)),this._sessionId||(this._sessionId=g,this.store.sessionId=this._sessionId);const E=xe.reportApiInvoke(g,{id:this._clientId,name:Hn.JOIN,options:[e,t,n,r],states:{isHttps:u,isSecureContext:h},tag:Tn.TRACER}),S=Jo(Jo(Jo({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof r!="string"?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:o,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!m},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:G("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(S.setLocalAPVersion=this._setLocalAPVersion),typeof r=="string"&&(S.stringUid=r,this._uintUid?(S.uid=this._uintUid,this._uintUid=void 0):S.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(S.aesmode=this._encryptionMode,S.aespassword=await(async P=>{const k=function($){const Z=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),J=new Uint8Array(new ArrayBuffer(Z.length));for(let re=0;re<Z.length;re+=1)J[re]=Z.charCodeAt(re);return J}(),V=await window.crypto.subtle.importKey("spki",k,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),F=NI(P),K=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},V,F);return function($){let Z="";for(let J=0;J<$.length;J+=1)Z+=String.fromCharCode($[J]);return window.btoa(Z)}(new Uint8Array(K))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new ie(B.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(S.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const P=new TextEncoder,k=G("USE_PURE_ENCRYPTION_MASTER_KEY")?P.encode(S.appId+this._encryptionSecret+this._encryptionSecret):P.encode(S.appId+S.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(V,F,K){const $=await window.crypto.subtle.importKey("raw",F,"PBKDF2",!1,["deriveBits","deriveKey"]),Z=V==="aes-128-gcm2"?128:256,J=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:eU,hash:"SHA-256",salt:K},$,Z+o$);return new Uint8Array(J).subarray(Z/8)}(this._encryptionMode,k,zh(this._encryptionSalt)),this._encryptDataStreamKey=await async function(V,F,K){const $=await window.crypto.subtle.importKey("raw",F,"PBKDF2",!1,["deriveBits","deriveKey"]),Z=V==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:eU,hash:"SHA-256",salt:K},$,{name:"AES-GCM",length:Z},!0,["encrypt","decrypt"])}(this._encryptionMode,k,zh(this._encryptionSalt))}else h?A.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):A.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,A.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:S.stringUid});const R=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&R===this._sessionId&&xe.joinChannelTimeout(this._sessionId,5)},5e3);try{var b;let P;const k=S.cloudProxyServer;if(Te(b=["proxy3","proxy4","proxy5"]).call(b,k)){const Z=G("PROXY_SERVER_TYPE3");Array.isArray(Z)?S.proxyServer=Z[0]:S.proxyServer=Z}if(xe.setProxyServer(S.proxyServer),A.setProxyServer(S.proxyServer),this.store.requestAPStart(),m){if(A.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(S.stringUid?", ".concat(S.stringUid," => ").concat(m.intUid):""," ")),S.stringUid&&!S.uid&&(S.uid=m.intUid),P={gatewayInfo:m.ap.gatewayInfo},G("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&S.turnServer.mode==="auto")if(m.ap.proxyInfo.addresses.length===0)A.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const Z=(await xF(m.ap.proxyInfo,m.ap.gatewayInfo.uid)).map(J=>({turnServerURL:J.address,tcpport:J.tcpport||Ui.tcpport,udpport:J.udpport||Ui.udpport,username:J.username||Ui.username,password:J.password||Ui.password,forceturn:!1,security:!0}));S.turnServer={mode:"manual",servers:Z}}KB(m,S.stringUid)}else{if(S.stringUid&&!S.uid){let Z;[Z,P]=await we.all([lB(S.stringUid,S,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn,this.store),cB(S,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn,!0,this.store)]),A.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(S.stringUid," => ").concat(Z)),S.uid=Z,P.gatewayInfo.uid=Z,P.gatewayInfo.res.uid=Z}else P=await cB(S,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new ie(B.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(S,this._axiosCancelSource.token),this._configDistribute.on(_y.UPDATE_BITRATE_LIMIT,Z=>{this._p2pChannel.updateBitrateLimit(Z)}),this._configDistribute.on(_y.UPDATE_CLIENT_ROLE_OPTIONS,Z=>{this._setClientRoleOptions(Z)})},0),this._key=n||e;const V=P.gatewayInfo,F=S.uid?S.uid:V.uid;this._joinInfo=Jo(Jo({},S),{},{cid:V.cid,uid:F,vid:V.vid,apResponse:V.res,apGatewayAddress:V.apGatewayAddress,uni_lbs_ip:V.uni_lbs_ip,gatewayAddrs:V.gatewayAddrs}),this.store.intUid=F,this.store.cid=V.cid;const K=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new ie(B.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));E.onSuccess(K),this._appId=e,this._channelName=S.cname,this._uid=K,this.store.uid=K,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Li()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const $=S.stringUid?"string uid: ".concat(S.stringUid,",uid: ").concat(S.uid):"uid: ".concat(this._uid);return A.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat($)),setTimeout(()=>{A.startUpload()},5e3),this.store.joinEnd(),x=this,Te(Qh).call(Qh,x)||Qh.push(x),this._cloudProxyServerMode==="disabled"&&bt().supportWebCrypto&&G("ENABLE_PRELOAD")&&$O(this._joinInfo),K}catch(P){const k=Array.isArray(P)?P[0]:P;throw k&&k.code===B.OPERATION_ABORTED?A.warning("[".concat(this._clientId,"] join number: ").concat(l,", Joining channel failed, rollback"),k):A.error("[".concat(this._clientId,"] join number: ").concat(l,", Joining channel failed, rollback"),k),k.code!==B.OPERATION_ABORTED&&this._numberOfJoinCount===l&&(this._gateway.state="DISCONNECTED",this._reset()),E.onError(k),k}var x}_joinGateway(){if(!this._joinInfo||!this._key)throw new ie(B.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!G("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){A.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Li()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const n=Qh.indexOf(t);n!==-1&&Qh.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return A.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",kt.LEAVE),A.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof $m))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new ie(B.INVALID_PARAMS,"param list is empty");const n=e;if(this._gateway.role==="audience")throw new ie(B.INVALID_OPERATION,"audience can not publish stream");for(const o of n){if(!(o instanceof $m))throw new ie(B.INVALID_PARAMS,"parameter is not local track");if(!o._enabled&&t)throw new ie(B.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(o.getTrackId()))}A.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(o=>"".concat(o.getTrackId()," "))));const r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach(o=>{const l=this._configDistribute.getBitrateLimit();o instanceof an&&l&&o.setBitrateLimit(l.uplink)});try{await this._publishHighStream(n),A.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(o=>"".concat(o.getTrackId()," "))))}catch(o){throw A.error("[".concat(this._clientId,"] publish error"),o.toString()),o}finally{r()}}async _publishDataChannel(e){jt(e.id,"id",0,65535,!0),Vl(e.ordered,"ordered"),vi(e.metadata,"metadata",0,512),A.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(o=>o.id===e.id)!==-1)throw new ie(B.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new ie(B.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ie(B.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&G("FORCE_TURN")&&!G("TURN_ENABLE_TCP")&&!G("TURN_ENABLE_UDP"))throw new ie(B.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(o){return ZF(o,!1)}(e),r=await this._p2pChannel.publishDataChannel([n]);if(r.length>0){if(typeof n._originDataChannelId!="number")throw A.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new ie(B.CREATE_DATACHANNEL_ERROR);try{await we.all(r.map(o=>this._uid&&this._gateway.publishDataChannel(this._uid,o,!0))),await n._waitTillOpen()}catch(o){if(o.code!==B.DISCONNECT_P2P)throw o}}return A.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw A.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new ie(B.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof $m))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);A.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(r=>"".concat(r.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.sendExtensionMessage(Dn.UNPUBLISH,{unpubMsg:r},!0)}else{const r=await this._p2pChannel.unpublish(t);r&&await this._gateway.unpublish(r,this._uid),A.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(o=>"".concat(o.getTrackId()))))}}catch(r){throw A.error("[".concat(this._clientId,"] unpublish error"),r.toString()),r}finally{n&&n()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),A.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(n=>"".concat(n.id," "))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(e);n&&await this._gateway.unpublishDataChannel(n),A.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(r=>"".concat(r.id))))}catch(n){throw A.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof id)){const r=this.remoteUsers.find(o=>o.uid===e);if(!r)throw new ie(B.INVALID_REMOTE_USER,"user is not in the channel");e=r}return t==="datachannel"?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(ei(t,"mediaType",["audio","video"]),this.store.useP2P)throw new ie(B.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new ie(B.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ie(B.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===Pe.AUDIO,r=t===Pe.VIDEO,o=await this._subscribeMutex.lock();try{const{ssrcId:l,ortc:u,rtxSsrcId:h,cname:m,uint_id:g}=await this._gateway.presubscribe(e,t,!0);if(l==null)throw new ie(B.UNEXPECTED_RESPONSE,"no ssrc id");let E=this._users.find(R=>R.uid===e);E||(E=new id(e,g||e),E._is_pre_created=!0,this._users.push(E)),m&&(E._cname=m),E._uintid||(E._uintid=g||e),n&&(E._audioSSRC=l,E._audio_pre_subscribed=!0,u&&(E._audioOrtc=u)),r&&(E._videoSSRC=l,E._video_pre_subscribed=!0,u&&(E._videoOrtc=u),h!=null&&(E._rtxSsrcId=h)),A.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(l)),await this._p2pChannel.subscribe(E,t,l,h,u);const S=n?E._audioTrack:E._videoTrack;if(!S)throw new ie(B.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(E._trust_audio_stream_added_state_=!0,E._audio_added_=!0),r&&(E._trust_video_stream_added_state_=!0,E._video_added_=!0),S}catch(l){throw A.error("[".concat(this._clientId,"] presub user ").concat(e," error"),l),l}finally{o()}}async _subscribeDataChannel(e,t){var n;if(jt(t,"channelId",0,65535,!0),!this._joinInfo)throw new ie(B.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ie(B.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(h=>h===e))throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new ie(B.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new ie(B.INVALID_REMOTE_USER,"user is not published");const o=(n=e._dataChannels)===null||n===void 0?void 0:n.find(h=>h.id===t);if(!o)throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new ie(B.REMOTE_USER_IS_NOT_PUBLISHED);const l=await this._subscribeMutex.lock();A.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const h=await this._p2pChannel.subscribeDataChannel(e,[o]);if(h&&Te(h).call(h,o.id))try{var u;if(typeof o._originDataChannelId!="number")throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new ie(B.CREATE_DATACHANNEL_ERROR);const m={id:o.id,datachannelId:o._originDataChannelId,ordered:o.ordered,maxRetransmits:o.maxRetransmits,metadata:(u=o.metadata)!==null&&u!==void 0?u:""};await this._gateway.subscribeDataChannel(e.uid,m,!0),await o._waitTillOpen()}catch(m){if((m==null?void 0:m.code)!==B.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[o]),m;await this._p2pChannel.unsubscribeDataChannel(e,[o]),this._p2pChannel.setPendingRemoteDataChannel(e,o.id)}return A.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),o}finally{l()}}async _p2pSubscribe(e,t,n){if(ei(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ie(B.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ie(B.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(l=>l===e)){const l=new ie(B.INVALID_REMOTE_USER,"user is not in the channel");throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),l}if(!e.hasAudio&&!e.hasVideo){const l=new ie(B.INVALID_REMOTE_USER,"user is not published");throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),l}if(!n&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const l=new ie(B.REMOTE_USER_IS_NOT_PUBLISHED);throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),l}const o=await this._subscribeMutex.lock();A.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const u=t==="audio"?e._audioSSRC:e._videoSSRC,h=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,u,h)}catch(u){throw u}A.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(u=>{A.warning("[".concat(this._clientId,"] auto set fallback failed"),u)});const l=t==="audio"?e._audioTrack:e._videoTrack;if(!l)throw new ie(B.UNEXPECTED_ERROR,"can not find remote track in user object");return l}catch(l){throw A.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),l),l}finally{o()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(ei(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ie(B.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ie(B.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(g=>g===e)){const g=new ie(B.INVALID_REMOTE_USER,"user is not in the channel");throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),g}if(!e.hasAudio&&!e.hasVideo){const g=new ie(B.INVALID_REMOTE_USER,"user is not published");throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),g}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const g=new ie(B.REMOTE_USER_IS_NOT_PUBLISHED);throw A.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),g}let o=t==="audio"?e._audioSSRC:e._videoSSRC,l=t==="audio"?e._audioOrtc:e._videoOrtc,u=t==="video"?e._rtxSsrcId:void 0,h={stream_type:t==="audio"?Pe.AUDIO:Pe.VIDEO,ssrcId:o};const m=await this._subscribeMutex.lock();A.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const E=t==="audio"?e._audioSSRC:e._videoSSRC;E!==void 0&&E!==o&&(o=E,l=t==="audio"?e._audioOrtc:e._videoOrtc,u=t==="video"?e._rtxSsrcId:void 0,h={stream_type:t==="audio"?Pe.AUDIO:Pe.VIDEO,ssrcId:o}),Hi.markSubscribeStart(this.store.clientId,o),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,o,u,l);try{this._p2pChannel.isPreSubScribe(o)||await this._gateway.subscribe(e.uid,h,!0)}catch(S){if((S==null?void 0:S.code)!==B.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),S;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(E){throw this._p2pChannel.reportSubscribeEvent(!1,E==null?void 0:E.code,e,t),E}A.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(E=>{A.warning("[".concat(this._clientId,"] auto set fallback failed"),E)});const g=t==="audio"?e._audioTrack:e._videoTrack;if(!g)throw new ie(B.UNEXPECTED_ERROR,"can not find remote track in user object");return g}catch(g){throw A.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),g),g}finally{m()}}async massSubscribe(e){if(Fl(e,"subscribeList"),!this._joinInfo)throw new ie(B.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ie(B.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,r=await this._subscribeMutex.lock();A.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(h=>{let{user:m,mediaType:g}=h;return"user: ".concat(m==null?void 0:m.uid,", mediaType: ").concat(g)}).join("; ")));const o=(e=[...e]).map(h=>{let{user:m,mediaType:g}=h;return{user:m,mediaType:g}}),l=await this._p2pChannel.globalLock();try{var u;for(let m=e.length-1;m>=0;m--){const g=e[m],{user:E,mediaType:S}=g;if(ei(S,"mediaType",["audio","video"]),!E){const P=new ie(B.INVALID_PARAMS,"user property does not exist in subscribeList item");throw A.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),P}if(!this._users.find(P=>P===E)){const P=new ie(B.INVALID_REMOTE_USER,"user is not in the channel");A.error("[".concat(this._clientId,"] can not massSubscribe ").concat(E.uid,", this user is not in the channel")),o[m].error=P,e.splice(m,1);continue}if(S==="audio"&&(!E.hasAudio||E._audioSSRC===void 0)||S==="video"&&(!E.hasVideo||E._videoSSRC===void 0)){const P=new ie(B.REMOTE_USER_IS_NOT_PUBLISHED);A.error("[".concat(this._clientId,"] can not subscribe ").concat(E.uid," with mediaType ").concat(S,", remote user is not published")),o[m].error=P,e.splice(m,1);continue}const b=ci.Video|ci.LwoVideo,x=n.get(E);if(x){if(S==="video"?x&b:x&ci.Audio){e.splice(m,1),A.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(E.uid,", mediaType:").concat(S," twice"));continue}n.set(E,x|(S==="video"?b:ci.Audio))}else n.set(E,S==="video"?b:ci.Audio)}for(let m=e.length-1;m>=0;m--){const g=e[m],{user:E,mediaType:S}=g,R=ci.Video|ci.LwoVideo;if(this._p2pChannel.hasRemoteMedia(E,S)){await this._p2pChannel.unmuteRemoteNoLock(E,S);const b=n.get(E);n.set(E,S==="video"?b^R:b^ci.Audio),e.splice(m,1)}}this.store.massSubscribe(e.map(m=>({userId:m.user.uid,type:m.mediaType})),t);let h=ms(u=Array.from(n.entries())).call(u,(m,g)=>{let[E,S]=g;if(S===0)return m;const R={stream_id:E.uid,stream_type:S};return S&ci.Audio&&(R.audio_ssrc=E._audioSSRC),S&ci.Video&&(R.video_ssrc=E._videoSSRC),m.push(R),m},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(g=>{let{user:E,mediaType:S}=g;return{user:E,mediaType:S,ssrcId:S===Pe.VIDEO?E._videoSSRC:E._audioSSRC,rtxSsrcId:S===Pe.VIDEO?E._rtxSsrcId:void 0}}));const m=new Map;if(h=h.filter(g=>g.video_ssrc&&!this._p2pChannel.isPreSubScribe(g.video_ssrc)||g.audio_ssrc&&!this._p2pChannel.isPreSubScribe(g.audio_ssrc)||!g.video_ssrc&&!g.audio_ssrc),h.length>0){const g=await this._gateway.subscribeAll(h,!0);((g==null?void 0:g.users)||[]).forEach(E=>{let{stream_id:S,video_error_code:R,audio_error_code:b,error_code:x}=E;(R||b||x)&&m.set(S,{video_error_code:R,audio_error_code:b,error_code:x})})}if(Array.from(m.entries()).length>0){const g=[];Array.from(m.entries()).forEach(E=>{let[S,R]=E;const b=this.remoteUsers.find(x=>x.uid===S);if(b){let x;R.error_code||R.video_error_code&&R.audio_error_code?x=void 0:R.video_error_code?x=Pe.VIDEO:R.audio_error_code&&(x=Pe.AUDIO),g.push({user:b,mediaType:x})}}),g.length>0&&await this._p2pChannel.massUnsubscribeNoLock(g)}for(const g of o){const E=m.get(g.user.uid);if(E){const S=E.error_code||g.mediaType==="audio"&&E.audio_error_code||g.mediaType==="video"&&E.video_error_code;if(S){const R=Ey(S);A.error("user:".concat(g.user.uid," mediaType:").concat(g.mediaType," has massSubscribe error ").concat(R.desc)),g.error=new ie(B.SUBSCRIBE_FAILED,"code ".concat(S,": ").concat(R.desc))}}g.error||(g.mediaType==="video"?g.track=g.user.videoTrack:g.track=g.user.audioTrack)}return this.store.massSubscribe(o.filter(g=>!g.error).map(g=>({userId:g.user.uid,type:g.mediaType})),void 0,Date.now()),o.forEach(g=>{var E;xe.subscribe(this.store.sessionId,{succ:!!g.error,ec:((E=g.error)===null||E===void 0?void 0:E.code)||null,video:g.mediaType===Pe.VIDEO,audio:g.mediaType===Pe.AUDIO,peerid:g.user.uid,subscribeRequestid:g.mediaType===Pe.VIDEO?g.user._videoSSRC:g.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(g.user._videoSSRC)},!0)}),A.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(g=>{let{user:E,mediaType:S}=g;return"user: ".concat(E==null?void 0:E.uid,", mediaType: ").concat(S)}).join("; "))),o}catch(m){throw await this._p2pChannel.massUnsubscribeNoLock(e),m}}finally{l(),r()}}async unsubscribe(e,t,n){if(!(e instanceof id)){const l=this.remoteUsers.find(u=>u.uid===e);if(!l)throw new ie(B.INVALID_REMOTE_USER,"user is not in the channel");e=l}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&ei(t,"mediaType",["audio","video"]),!this._joinInfo)throw new ie(B.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(l=>l===e)){const l=new ie(B.INVALID_REMOTE_USER,"user is not in the channel");throw A.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),l}A.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const o=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const l=await this._p2pChannel.unsubscribe(e,t);l&&await this._gateway.unsubscribe(l,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&FR(this._users,e),A.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(l){if(l.code===B.DISCONNECT_P2P)return void A.warning("disconnecting p2p, abort unsubscribe request.");throw A.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),l.toString()),l}finally{o()}}async _unsubscribeDataChannel(e,t){if(t&&jt(t,"id",0,65535,!0),!this._joinInfo)throw new ie(B.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(o=>o===e)){const o=new ie(B.INVALID_REMOTE_USER,"user is not in the channel");throw A.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),o}let r;if(typeof t=="number"){const o=e._dataChannels.find(l=>l.id===t);o&&(r=[o])}else r=e._dataChannels;if(r===void 0){const o=new ie(B.REMOTE_USER_IS_NOT_PUBLISHED);throw A.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),o}A.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map(o=>o.id)));try{const o=await this._p2pChannel.unsubscribeDataChannel(e,r);o&&await this._gateway.unsubscribeDataChannel(o,e.uid),A.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o))}catch(o){if(o.code===B.DISCONNECT_P2P)return void A.warning("disconnecting p2p, abort unsubscribe request.");throw A.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),o.toString()),o}}async massUnsubscribe(e){if(Fl(e,"unsubscribeList"),!this._joinInfo)throw new ie(B.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");A.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:r,mediaType:o}=n;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(o,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:r,mediaType:o}=e[n];if(!r){const h=new ie(B.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw A.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),h}if(ei(o,"mediaType",["video","audio",void 0]),!this._users.find(h=>h===r)){A.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(n,1);continue}const u=ci.Video|ci.LwoVideo;if(t.has(r)){const h=t.get(r);let m;switch(o){case"video":m=h&u;break;case"audio":m=h&ci.Audio;break;default:m=h&(ci.Audio|u)}if(m){A.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(o," twice.")),e.splice(n,1);continue}o?o==="audio"?t.set(r,h|ci.Audio):o==="video"&&t.set(r,h|u):t.set(r,h|ci.Audio|u)}else o?o==="audio"?t.set(r,ci.Audio):o==="video"&&t.set(r,u):t.set(r,ci.Audio|u)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),A.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(r=>{let{user:o,mediaType:l}=r;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(l,";")}).join()))}catch(n){if(n.code===B.DISCONNECT_P2P)return void A.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw A.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(e){(function(n){if(!n)throw new oe(B.INVALID_PARAMS);Sn(n.width)||II(n.width,"streamParameter.width"),Sn(n.height)||II(n.height,"streamParameter.height"),Sn(n.framerate)||II(n.framerate,"streamParameter.framerate"),Sn(n.bitrate)||jt(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&A.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),A.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,he.LocalVideoLowTrack)}async enableDualStream(){if(!bt().supportDualStream)throw xe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new ie(B.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new ie(B.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw xe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,xe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),A.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new ie(B.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(he.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw xe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,xe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),A.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(r){ei(r,"role",["audience","host"])}(e),t&&DI(t),this.mode==="rtc"||this.mode==="p2p")throw A.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new ie(B.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new ie(B.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new ie(B.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==n&&G("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",xi.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),A.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&DI(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{A.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(vi(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new ie(B.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ie(B.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,xe.setProxyServer(this._proxyServer),A.setProxyServer(this._proxyServer),A.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new ie(B.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ie(B.INVALID_OPERATION,"You have already set the proxy")}if(cy(e))return this._turnServer={servers:e,mode:"original-manual"},void A.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>D2(n)),this._turnServer={servers:e,mode:"manual"},A.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new ie(B.INVALID_OPERATION,"you should set license before join channel");if(vi(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new ie(B.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,A.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new ie(B.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new ie(B.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new ie(B.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new ie(B.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,A.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new ie(B.INVALID_OPERATION,"Stop proxy server after leave channel");xe.setProxyServer(),A.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",A.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new ie(B.INVALID_PARAMS,"accessPoints is required.");Fl(e.accessPoints.serverList,"accessPoints.serverList"),vi(e.accessPoints.domain,"accessPoints.domain");const t=(R,b)=>{jt(R,b,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ie(B.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");G("CLOSE_AFB_FOR_LOCAL_AP")&&(Vt("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Vt("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,o=e.accessPoints.domain,l=e.accessPoints.serverList.map(R=>r.test(R)?"".concat(R.replace(/\./g,"-"),".").concat(o):R),u=l.map(R=>"".concat(R,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Vt("WEBCS_DOMAIN",u),Vt("WEBCS_DOMAIN_BACKUP_LIST",u),Vt("GATEWAY_DOMAINS",[o]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Fl(e.report.hostname,"report.hostname"),Vt("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Vt("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Vt("EVENT_REPORT_DOMAIN",l[0]),Vt("EVENT_REPORT_BACKUP_DOMAIN",l[1]||l[0]));let h=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),h=e.report.port),Vt("STATS_COLLECTOR_PORT",h),e.report?Vt("ENABLE_EVENT_REPORT",!0):Vt("ENABLE_EVENT_REPORT",!1);let m="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Fl(e.log.hostname,"log.hostname"),m=e.log.hostname[0]):m=l[0];let g=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),g=e.log.port),Vt("LOG_UPLOAD_SERVER","".concat(m,":").concat(g));let E=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Fl(e.cds.hostname,"cds.hostname"),E=e.cds.hostname):E=l;let S=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),S=e.cds.port),Vt("CDS_AP",E.map(R=>"".concat(R,":").concat(S))),e.cds?Vt("ENABLE_CONFIG_DISTRIBUTE",!0):Vt("ENABLE_CONFIG_DISTRIBUTE",!1),A.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Fl(e,"serverList"),vi(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ie(B.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(r=>n.test(r)?"".concat(r.replace(/\./g,"-"),".").concat(t):r),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Vt("WEBCS_DOMAIN",e),Vt("WEBCS_DOMAIN_BACKUP_LIST",e),Vt("GATEWAY_DOMAINS",[t]),Vt("EVENT_REPORT_DOMAIN",e[0]),Vt("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Vt("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),A.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(ei(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw A.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else A.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){ei(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const n=this._users.find(r=>r.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw A.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}A.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){ei(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw A.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}A.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,r){(function(l){ei(l,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),vi(t,"secret");const o=["aes-128-gcm2","aes-256-gcm2"];if(Te(o).call(o,e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new ie(B.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new ie(B.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(Vl(r,"encryptDataStream"),!Te(o).call(o,e))throw new ie(B.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||A.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=Xu(n))}async renewToken(e){if(vi(e,"token",1,2047),!this._key||!this._joinInfo)throw new ie(B.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(G("USE_NEW_TOKEN")){A.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const r=await FQ(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn);A.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:r})}else A.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});A.debug("[".concat(this._clientId,"] renewToken success"))}catch(r){throw this._key=t,this._joinInfo.token=t,A.error("[".concat(this._clientId,"] renewToken failed"),r.toString()),r}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?A.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(pt.VOLUME_INDICATOR,e)},G("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new ie(B.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new ie(B.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new ie(B.LIVE_STREAMING_TASK_CONFLICT);const n=t?Gl.TRANSCODE:Gl.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(Gl.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new ie(B.INVALID_PARAMS,"can not find live streaming url to stop");await we.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){gB(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){gB(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof Iy&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new ie(B.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const o=new TextEncoder;e.payload=o.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Te(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(r=!0,e.payload=await async function(o,l,u){var h;const m=ms(h=Array.from(u)).call(h,(P,k)=>P+k,0),g={serverTs:0,seq:a$++,length:u.length,checkSum:m},E=new Uint8Array(B2(m,2)),S=new ArrayBuffer(zm),R=new DataView(S);R.setUint32(0,g.serverTs),R.setUint16(4,g.seq),R.setUint16(6,g.length),R.setUint16(8,g.checkSum);const b=16-u.length%16;u=x2(u,new Uint8Array(b));const x=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:o,tagLength:Z2,additionalData:E},l,u);return x2(new Uint8Array(S),new Uint8Array(x))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new ie(B.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Ye.DATA_STREAM,{payload:Xu(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-YQ},!n)}sendMetadata(e){if(!this._joinInfo)throw new ie(B.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new ie(B.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Ye.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Xu(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(g$),!this._joinInfo)throw new ie(B.INVALID_OPERATION,"can not send custom report, not joined");await xe.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){ei(t.spatialLayer,"spatialLayer",[0,1,2,3]),ei(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw A.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(Vl(t,"apRTM"),jt(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,A.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(A.debug("[".concat(this._clientId,"] reset client")),function(e){const t=ig.indexOf(e);t!==-1&&ig.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Pr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&HB(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&xe.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Gi("client-publish",this._clientId),this._subscribeMutex=new Gi("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;const r=e||Hh();e?A.debug("[".concat(this._clientId,"] new Session ").concat(r)):A.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));const o=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r,xe.addSid(r);const l={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:o,clientRole:this.role==="audience"?2:1};xe.sessionInit(this._sessionId,Jo({cname:t.channel,appid:t.appId},l)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new ie(B.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ie(B.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&G("FORCE_TURN")&&!G("TURN_ENABLE_TCP")&&!G("TURN_ENABLE_UDP"))throw new ie(B.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");A.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const r=(await n.next()).value;if(r){try{await this._gateway.sendExtensionMessage(Dn.PUBLISH,r,!0)}catch(o){throw n.throw(o),o}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const r=(await n.next()).value;if(r){var t;let o;try{o=await this._gateway.publish(this._uid,r,!0)}catch(l){if(l.code!==B.DISCONNECT_P2P)throw n.throw(l),l}await n.next(((t=o)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const o of e)o instanceof an&&o._encoderConfig&&this._gateway.setVideoProfile(o._encoderConfig).catch(l=>{A.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!o.muted&&o.enabled||await this._p2pChannel.muteLocalTrack(o)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,e),(n==null?void 0:n.code)===B.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new ie(B.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ie(B.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));A.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(await n.next()).value;if(r){var t;let o;try{o=await this._gateway.publish(this._uid,r,!0)}catch(l){if(l.code!==B.DISCONNECT_P2P)throw n.throw(l),l}n.next(((t=o)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===B.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new ie(B.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(r={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Hl("LiveStreaming").create(r));var r;return n.onLiveStreamError=(o,l)=>{xe.reportApiInvoke(this._sessionId,{name:Hn.ON_LIVE_STREAM_ERROR,options:[o,l],tag:Tn.TRACER}).onSuccess(),this.safeEmit(pt.LIVE_STREAMING_ERROR,o,l)},n.onLiveStreamWarning=(o,l)=>{xe.reportApiInvoke(this._sessionId,{name:Hn.ON_LIVE_STREAM_WARNING,options:[o,l],tag:Tn.TRACER}).onSuccess(),this.safeEmit(pt.LIVE_STREAMING_WARNING,o,l)},n.on(TO.REQUEST_WORKER_MANAGER_LIST,(o,l,u)=>{if(!this._joinInfo)return u(new ie(B.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(h,m,g,E){const S=G("UAP_AP").slice(0,G("AJAX_REQUEST_CONCURRENT")).map(R=>m.proxyServer?"https://".concat(m.proxyServer,"/ap/?url=").concat(R+"/api/v1?action=uap"):"https://".concat(R,"/api/v1?action=uap"));return await kQ(S,h,m,g,E)})(o,this._joinInfo,this._axiosCancelSource.token,Kn).then(l).catch(u)}),n};return e===Gl.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new ie(B.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),r=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},Hl("ChannelMediaRelay").create(e));r.on("state",o=>{o===Zr.RELAY_STATE_FAILURE&&r&&r.dispose(),this.safeEmit(pt.CHANNEL_MEDIA_RELAY_STATE,o)}),r.on("event",o=>{this.safeEmit(pt.CHANNEL_MEDIA_RELAY_EVENT,o)}),this._channelMediaRelayClient=r,this._statsCollector.onStatsChanged=(o,l)=>{var u;o==="resolution"&&((u=this._channelMediaRelayClient)===null||u===void 0||u.setVideoProfile(l))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:r}=e,o=[];if(t){const l=[];this._users.forEach(u=>{u._dataChannels.forEach(h=>{n.every(m=>m.uid!==u._uintid||m.stream_id!==h.id)&&l.push({uid:u._uintid,stream_id:h.id,ordered:h.ordered,max_retrans_times:h.maxRetransmits,metadata:h.metadata})})}),l.length>0&&this._handleUpdateDataChannel({added:[],deleted:l})}Array.isArray(n)&&n.length>0&&n.forEach(l=>{const{uid:u,stream_id:h,ordered:m,max_retrans_times:g,metadata:E}=l,S=this._users.find(R=>R._uintid===u);if(!S)return void A.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(A.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(u)),Te(o).call(o,S)||o.push(S),S._uintid||(S._uintid=u),S._dataChannels.findIndex(R=>R.id===l.stream_id)===-1){const R={id:h,ordered:!!m,maxRetransmits:g,metadata:E},b=function(x){return ZF(x,!0)}(R);S._dataChannels.push(b),A.info("[".concat(this._clientId,"] remote user ").concat(S.uid," published datachannel")),t||this.safeEmit(pt.USER_PUBLISHED,S,"datachannel",R)}this._p2pChannel.hasPendingRemoteDataChannel(S,l.stream_id)&&(A.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(S.uid," after reconnect.")),this._subscribeDataChannel(S,l.stream_id).catch(R=>{A.error("[".concat(this._clientId,"] resubscribe datachannel error"),R.toString())}))}),t&&(this.safeEmit(pt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach(l=>{const{uid:u,stream_id:h}=l,m=this._users.find(E=>E._uintid===u);if(!m)return void A.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const g=m._dataChannels.find(E=>E.id===l.stream_id);g&&(A.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(u)),this._p2pChannel.unsubscribeDataChannel(m,[g]).then(E=>{if(m._dataChannels=m._dataChannels.filter(S=>S!==g),E)return this._gateway.unsubscribeDataChannel(E,m.uid)}),A.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished datachannel ,id:").concat(g.id)),this.safeEmit(pt.USER_UNPUBLISHED,m,"datachannel",g._config))})}_handleRemoveDataChannels(e){const t=this._users.find(n=>n.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){A.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{A.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(r=>{this.safeEmit(pt.USER_UNPUBLISHED,t,"datachannel",r._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(r=>{if(r)return this._gateway.unsubscribeDataChannel(r,t.uid)}),n()}}else A.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(fi.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void A.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach(r=>{const{value:o,type:l,expires:u}=t[r];u&&u<=n||l||mO()||!Object.prototype.hasOwnProperty.call(HR,r)||(Pa[r]=o,on[r]=o,A.debug("Update gateway parameters from config distribute",r,o))})}catch(t){A.error("Error update config from local cache",t.message)}})()}),this._gateway.on(fi.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(fi.CONNECTION_STATE_CHANGE,(e,t,n)=>{var r;if(n===kt.FALLBACK)return;const o=()=>{this.safeEmit(pt.CONNECTION_STATE_CHANGE,e,t,n)};if(xe.reportApiInvoke(this._sessionId||((r=this._gateway.joinInfo)===null||r===void 0?void 0:r.sid)||null,{name:Hn.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:Tn.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),A.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void o();if(e==="RECONNECTING")this._users.forEach(u=>{u._trust_in_room_=!1,u._trust_audio_enabled_state_=!1,u._trust_video_enabled_state_=!1,u._trust_audio_mute_state_=!1,u._trust_video_mute_state_=!1,u._trust_audio_stream_added_state_=!1,u._trust_video_stream_added_state_=!1,u._is_pre_created||(u._audio_pre_subscribed||(u._audioSSRC=void 0,u._audioOrtc=void 0),u._video_pre_subscribed||(u._videoSSRC=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),u._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var l;this._streamFallbackTypeCacheMap.forEach((u,h)=>{this._gateway.setStreamFallbackOption(h,u).catch(m=>{A.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),m)})}),this._remoteStreamTypeCacheMap.forEach((u,h)=>{this._gateway.setRemoteVideoStreamType(h,u).catch(m=>{A.warning("[".concat(this._clientId,"] auto set remote stream type failed"),m)})}),this._remoteDefaultVideoStreamType!==void 0&&((l=this._joinInfo)===null||l===void 0?void 0:l.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{A.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(u=>{A.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(u))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(u=>!u._trust_in_room_).forEach(u=>{A.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(u.uid)),this._handleUserOffline({uid:u.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(u=>{u._trust_audio_mute_state_||(A.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(u.uid)),this._handleMuteStream(u.uid,Pe.AUDIO,!1)),u._trust_video_mute_state_||(A.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(u.uid)),this._handleMuteStream(u.uid,Pe.VIDEO,!1)),u._trust_audio_enabled_state_||(A.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(u.uid)),this._handleSetStreamLocalEnable("audio",u.uid,!0)),u._trust_video_enabled_state_||(A.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(u.uid)),this._handleSetStreamLocalEnable("video",u.uid,!0)),u._trust_video_stream_added_state_||(A.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(u.uid)),this._handleResetAddStream(u,"video")),u._trust_audio_stream_added_state_||(A.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(u.uid)),this._handleResetAddStream(u,"audio")),u._video_added_||u._audio_added_||(A.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(u.uid)),this._handleRemoveStream({uid:u.uid,uint_id:u._uintid}))}))},1e3))}o()}),this._gateway.on(fi.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new ie(B.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const r=await WB(Jo(Jo({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));r?(n=r.ap,KB(r),this._joinInfo.preload=!0):(n=await VO(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const o=[];n.gatewayInfo.gatewayAddrs.forEach(l=>{let{address:u}=l;const[h,m]=u.split(":");this._joinInfo&&this._joinInfo.proxyServer?o.push({proxy:this._joinInfo.proxyServer,host:h,port:m}):o.push({host:h,port:m})}),e(o)}catch(n){t(n)}}),this._gateway.on(fi.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(pt.NETWORK_QUALITY,e)}),this._gateway.on(fi.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(pt.STREAM_TYPE_CHANGED,e,t),xe.reportApiInvoke(this._sessionId,{name:Hn.STREAM_TYPE_CHANGE,options:[e,t],tag:Tn.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(fi.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(fi.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{let r=await this._p2pChannel.getEstablishParams();G("ENABLE_PREALLOC_PC")&&r||(r=await this._p2pChannel.startP2PConnection(e)),t(r)}catch(r){n(r)}}),this._gateway.on(fi.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let n;e.attributes?n=e.attributes.userAttributes.preSubSsrcs:A.debug("no attributes in joinResponse");const r=jF(e.ortc,t,n);this._p2pChannel.connect(r)}),this._gateway.on(fi.PRE_CONNECT_PC,async e=>{const{candidates:t,fingerprint:n}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){var r;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:o,cid:l}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(l,"_").concat(o),icePwd:"".concat(l,"_").concat(o)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(r=G("FINGERPRINT"))!==null&&r!==void 0?r:n}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(mt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(mt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(mt.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(mt.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(mt.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(mt.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(mt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(mt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(mt.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,Pe.AUDIO,!0)),this._gateway.signal.on(mt.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,Pe.AUDIO,!1)),this._gateway.signal.on(mt.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,Pe.VIDEO,!0)),this._gateway.signal.on(mt.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,Pe.VIDEO,!1)),this._gateway.signal.on(mt.RECEIVE_METADATA,e=>{const t=zh(e.metadata);this.safeEmit(pt.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(mt.ON_DATA_STREAM,async e=>{var t;if(!e)return;let n=zh(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Te(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<zm)throw new ie(B.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(zm));n=await async function(l,u,h){const m=h.subarray(0,zm),g=m.slice(8,zm),E=(g[0]<<8)+g[1],S=(m[6]<<8)+m[7],R=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:l,tagLength:Z2,additionalData:new Uint8Array(B2(E,2))},u,h.subarray(zm));return new Uint8Array(R).subarray(0,S)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let r=0;if(e.ordered||e.syncWithAudio){const o=this._p2pChannel.getStats(),l=this.remoteUsers.find(h=>h.uid===e.uid),u=o==null?void 0:o.audioRecv.find(h=>h.ssrc===(l==null?void 0:l._audioSSRC));r=u==null?void 0:u.jitterBufferMs}(r==null||Number.isNaN(r))&&(r=0),JQ(Jo(Jo({},e),{},{payload:n}),r,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(mt.ON_CRYPT_ERROR,()=>{Yu(()=>{A.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(pt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(mt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(mt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{A.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,kt.TOKEN_EXPIRE),this.safeEmit(pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(mt.ON_STREAM_FALLBACK_UPDATE,e=>{A.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(pt.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(mt.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),A.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(mt.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(mt.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Je.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case Ye.PUBLISH:{if(!t)return;const o=t.ortc;if(o){var n,r;const l=o.some(m=>{let{stream_type:g}=m;return g===Mt.Audio}),u=o.some(m=>{let{stream_type:g}=m;return g!==Mt.Audio}),h=o.some(m=>{let{stream_type:g}=m;return g===Mt.Screen||g===Mt.ScreenLow});t.state==="offer"&&xe.publish(this._joinInfo.sid,{eventElapse:Hi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:B.TIMEOUT,audio:l,video:u,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:h,audioName:l?(n=o.find(m=>{let{stream_type:g}=m;return g===Mt.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:u?(r=o.find(m=>{let{stream_type:g}=m;return g!==Mt.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0})}break}case Ye.SUBSCRIBE:t&&xe.subscribe(this._joinInfo.sid,{succ:!1,ec:B.TIMEOUT,audio:t.stream_type===Pe.AUDIO,video:t.stream_type===Pe.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Hi.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(mt.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(mt.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;G("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(r=>!Zh(r.string_id||r.stream_id,this.channelName)));const t=[],n=[];for(const r of e.users){let o=this._users.find(E=>E._uintid===r.stream_id);o?o._trust_in_room_=!0:(o=new id(r.string_id||r.stream_id,r.stream_id),this._users.push(o),this.getListeners(pt.PUBLISHED_USER_LIST).length===0&&(A.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(pt.USER_JOINED,o)));const l=ci.Audio&r.stream_type,u=(ci.Video|ci.LwoVideo)&r.stream_type,h=(65280&r.stream_type)!=0,m=l&&o.hasAudio,g=u&&o.hasVideo;u&&(o._trust_video_stream_added_state_=!0,o._video_added_=!0,o._videoSSRC=r.video_ssrc,o._rtxSsrcId=r.video_rtx),l&&(o._trust_audio_stream_added_state_=!0,o._audio_added_=!0,o._audioSSRC=r.audio_ssrc),l&&!m&&this.getListeners(pt.PUBLISHED_USER_LIST).length===0&&(A.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published audio")),this.safeEmit(pt.USER_PUBLISHED,o,"audio")),u&&!g&&this.getListeners(pt.PUBLISHED_USER_LIST).length===0&&(A.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published video")),this.safeEmit(pt.USER_PUBLISHED,o,"video")),(l&&!m||u&&!g||h)&&t.push(o),u&&this._p2pChannel.hasPendingRemoteMedia(o,"video")&&n.push({user:o,mediaType:"video"}),l&&this._p2pChannel.hasPendingRemoteMedia(o,"audio")&&n.push({user:o,mediaType:"audio"})}n.length>0&&(A.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(r=>"user: ".concat(r.user.uid,", mediaType: ").concat(r.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(r=>{A.error("[".concat(this._clientId,"] mass resubscribe error"),r.toString())})),this.getListeners(pt.PUBLISHED_USER_LIST).length>0?G("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(A.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(r=>r.uid).join(", "))),this.safeEmit(pt.PUBLISHED_USER_LIST,t)):A.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(r=>r.uid).join(", ")))}),this._gateway.signal.on(mt.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;this._p2pChannel instanceof Iy&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(n=>n.toLowerCase()).filter(n=>{var r;return Te(r=Object.keys(KR)).call(r,n)}))})}_handleP2PEvents(){this._gateway.signal.on(mt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Dn.PUBLISH,(e,t,n)=>{const{uid:r}=e;e.forEach(o=>{const{kind:l,ssrcs:u,mid:h,isMuted:m}=o;this._handleP2PAddAudioOrVideoStream(l,r,u[0].ssrcId,h);const g=this._users.find(E=>E.uid===r);return g&&this.store.useP2P?this._p2pChannel.mockSubscribe(g,l,u[0].ssrcId,h).then(()=>{t()}).catch(n):t(),this._handleMuteStream(r,l,!!m)})}),this._gateway.signal.on(Dn.CALL,async(e,t,n)=>{if(this.store.useP2P)try{var r;t(await this._p2pChannel.startP2P({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer},e))}catch(o){n(o)}}),this._gateway.signal.on(Je.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(Dn.UNPUBLISH,async(e,t,n)=>{if(this.store.useP2P){const{unpubMsg:r,uid:o}=e,l=this._users.find(u=>u.uid===o);if(!l)return A.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(o)),void t();try{r.forEach(async u=>{let{stream_type:h}=u;const m=h===Mt.Audio?Pe.AUDIO:Pe.VIDEO;await this._p2pChannel.unsubscribe(l,m),this._handleMuteStream(o,m,!0)}),t()}catch(u){n(u)}}}),this._gateway.signal.on(Dn.CONTROL,async(e,t)=>{const{action:n}=e;switch(n){case Qu.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,Pe.VIDEO,!0);break;case Qu.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,Pe.AUDIO,!0);break;case Qu.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,Pe.VIDEO,!1);break;case Qu.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,Pe.AUDIO,!1)}}),this._gateway.signal.on(Dn.RESTART_ICE,async(e,t,n)=>{if(this.store.useP2P)try{const{direction:r,iceParameter:o}=e;r!==_r.SEND_ONLY||o?t(await this._p2pChannel.restartICE(r,o)):(this._p2pChannel.handleDisconnect(r),t())}catch(r){n(r)}}),this._gateway.signal.on(Dn.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(je.RequestP2PRestartICE,async(e,t,n)=>{try{const{direction:r}=e;t(await this._gateway.sendExtensionMessage(Dn.RESTART_ICE,e,r===_r.SEND_ONLY))}catch(r){n(r)}}),this._p2pChannel.on(je.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Dn.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(je.RequestP2PMuteLocal,async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(Dn.CONTROL,e,!0),t()}catch(r){n(r)}}),this._p2pChannel.on(je.RequestP2PUnmuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===B.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(je.RequestP2PMuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===B.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(je.StateChange,(e,t)=>{t===Lt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(je.PeerConnectionStateChange,e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(pt.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(je.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===B.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(je.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===B.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(je.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(je.RequestRePublishDataChannel,(e,t,n)=>{we.all(e.map(async r=>{const o=await this._p2pChannel.publishDataChannel([r]);try{o.forEach(l=>{this._uid&&this._gateway.publishDataChannel(this._uid,l,!0)})}catch(l){if(l.code!==B.DISCONNECT_P2P)throw l}})).then(t).catch(n)}),this._p2pChannel.on(je.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:r,kind:o}of e)o===Pe.VIDEO?await this.subscribe(r,"video"):await this.subscribe(r,"audio");t()}catch(r){n(r)}}),this._p2pChannel.on(je.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(je.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(je.MediaReconnectStart,e=>{this.safeEmit(pt.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(je.MediaReconnectEnd,e=>{this.safeEmit(pt.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(je.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(je.RequestRestartICE,async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const r=n.value;let o;try{o=await this._gateway.restartICE({iceParameters:r})}catch(u){return void t.throw(u)}const{iceParameters:l}=function(u){const h=u.iceParameters;return{iceParameters:{iceUfrag:h.iceUfrag,icePwd:h.icePwd}}}(o);await t.next({remoteIceParameters:l})}),this._p2pChannel.on(je.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(je.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:o,gatewayAddress:l}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),u=jF(o,l);await this._p2pChannel.connect(u),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(je.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(je.P2PLost,()=>{this.safeEmit(pt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(je.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(je.ConnectionTypeChange,e=>{this.safeEmit(pt.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(je.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(je.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(je.AudioMetadata,e=>{this.safeEmit(pt.AUDIO_METADATA,e)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new ie(B.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new ie(B.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},Hl("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:r,cname:o,sid:l,token:u,uid:h,cid:m,vid:g}=this._joinInfo;await n.init({appId:r,areaCode:"",cname:o,sid:l,token:u,uid:h,cid:m,vid:g?Number(g):0},Kn)}catch(n){throw Array.isArray(n)?n[0]:n}var t}handleVideoInspectEvents(e){e.on(mi.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(pt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===Ko.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(pt.CONTENT_INSPECT_ERROR,new ie(B.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(mi.INSPECT_RESULT,(t,n)=>{var r;if((n==null?void 0:n.code)===B.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return A.debug("Stop inspect content because that has left channel"),this==null||(r=this._inspect)===null||r===void 0||r.close(),void(this._inspect=void 0);this.safeEmit(pt.CONTENT_INSPECT_RESULT,t,n)}),e.on(mi.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new ie(B.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Vl(e,"enabled"),e){if(!t)throw new ie(B.INVALID_PARAMS,"config is required");if(sj(t),!this._joinInfo)throw new ie(B.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const r=(n={config:t},Hl("ImageModeration").create(n));this._moderation=r,this.handleImageModerationEvents(r);const{appId:o,cname:l,sid:u,token:h,uid:m,cid:g,vid:E}=this._joinInfo;await r.init({appId:o,areaCode:"",cname:l,sid:u,token:h,uid:m,cid:g,vid:E?Number(E):0},Kn)}}catch(r){throw Array.isArray(r)?r[0]:r}}else{var n;if(!this._moderation)throw new ie(B.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(r){throw Array.isArray(r)?r[0]:r}}}handleImageModerationEvents(e){e.on(La.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(pt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===Eo.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new ie(B.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(La.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){ei(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new ie(B.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,A.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return A.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Vl(e,"enabled"),Vt("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},ke(Ae.prototype,"leave",[oj],Object.getOwnPropertyDescriptor(Ae.prototype,"leave"),Ae.prototype),ke(Ae.prototype,"publish",[aj],Object.getOwnPropertyDescriptor(Ae.prototype,"publish"),Ae.prototype),ke(Ae.prototype,"unpublish",[cj],Object.getOwnPropertyDescriptor(Ae.prototype,"unpublish"),Ae.prototype),ke(Ae.prototype,"subscribe",[lj],Object.getOwnPropertyDescriptor(Ae.prototype,"subscribe"),Ae.prototype),ke(Ae.prototype,"presubscribe",[uj],Object.getOwnPropertyDescriptor(Ae.prototype,"presubscribe"),Ae.prototype),ke(Ae.prototype,"massSubscribe",[dj],Object.getOwnPropertyDescriptor(Ae.prototype,"massSubscribe"),Ae.prototype),ke(Ae.prototype,"unsubscribe",[hj],Object.getOwnPropertyDescriptor(Ae.prototype,"unsubscribe"),Ae.prototype),ke(Ae.prototype,"massUnsubscribe",[pj],Object.getOwnPropertyDescriptor(Ae.prototype,"massUnsubscribe"),Ae.prototype),ke(Ae.prototype,"setLowStreamParameter",[fj],Object.getOwnPropertyDescriptor(Ae.prototype,"setLowStreamParameter"),Ae.prototype),ke(Ae.prototype,"enableDualStream",[mj],Object.getOwnPropertyDescriptor(Ae.prototype,"enableDualStream"),Ae.prototype),ke(Ae.prototype,"disableDualStream",[gj],Object.getOwnPropertyDescriptor(Ae.prototype,"disableDualStream"),Ae.prototype),ke(Ae.prototype,"setClientRole",[_j],Object.getOwnPropertyDescriptor(Ae.prototype,"setClientRole"),Ae.prototype),ke(Ae.prototype,"_setClientRoleOptions",[Ej],Object.getOwnPropertyDescriptor(Ae.prototype,"_setClientRoleOptions"),Ae.prototype),ke(Ae.prototype,"setProxyServer",[yj],Object.getOwnPropertyDescriptor(Ae.prototype,"setProxyServer"),Ae.prototype),ke(Ae.prototype,"setTurnServer",[vj],Object.getOwnPropertyDescriptor(Ae.prototype,"setTurnServer"),Ae.prototype),ke(Ae.prototype,"setLicense",[Sj],Object.getOwnPropertyDescriptor(Ae.prototype,"setLicense"),Ae.prototype),ke(Ae.prototype,"startProxyServer",[Tj],Object.getOwnPropertyDescriptor(Ae.prototype,"startProxyServer"),Ae.prototype),ke(Ae.prototype,"stopProxyServer",[Rj],Object.getOwnPropertyDescriptor(Ae.prototype,"stopProxyServer"),Ae.prototype),ke(Ae.prototype,"setLocalAccessPointsV2",[wj],Object.getOwnPropertyDescriptor(Ae.prototype,"setLocalAccessPointsV2"),Ae.prototype),ke(Ae.prototype,"setLocalAccessPoints",[Cj],Object.getOwnPropertyDescriptor(Ae.prototype,"setLocalAccessPoints"),Ae.prototype),ke(Ae.prototype,"setRemoteDefaultVideoStreamType",[bj],Object.getOwnPropertyDescriptor(Ae.prototype,"setRemoteDefaultVideoStreamType"),Ae.prototype),ke(Ae.prototype,"setRemoteVideoStreamType",[Aj],Object.getOwnPropertyDescriptor(Ae.prototype,"setRemoteVideoStreamType"),Ae.prototype),ke(Ae.prototype,"setStreamFallbackOption",[Ij],Object.getOwnPropertyDescriptor(Ae.prototype,"setStreamFallbackOption"),Ae.prototype),ke(Ae.prototype,"setEncryptionConfig",[Oj],Object.getOwnPropertyDescriptor(Ae.prototype,"setEncryptionConfig"),Ae.prototype),ke(Ae.prototype,"renewToken",[Nj],Object.getOwnPropertyDescriptor(Ae.prototype,"renewToken"),Ae.prototype),ke(Ae.prototype,"enableAudioVolumeIndicator",[Pj],Object.getOwnPropertyDescriptor(Ae.prototype,"enableAudioVolumeIndicator"),Ae.prototype),ke(Ae.prototype,"startLiveStreaming",[Dj],Object.getOwnPropertyDescriptor(Ae.prototype,"startLiveStreaming"),Ae.prototype),ke(Ae.prototype,"setLiveTranscoding",[kj],Object.getOwnPropertyDescriptor(Ae.prototype,"setLiveTranscoding"),Ae.prototype),ke(Ae.prototype,"stopLiveStreaming",[Lj],Object.getOwnPropertyDescriptor(Ae.prototype,"stopLiveStreaming"),Ae.prototype),ke(Ae.prototype,"startChannelMediaRelay",[xj],Object.getOwnPropertyDescriptor(Ae.prototype,"startChannelMediaRelay"),Ae.prototype),ke(Ae.prototype,"updateChannelMediaRelay",[Mj],Object.getOwnPropertyDescriptor(Ae.prototype,"updateChannelMediaRelay"),Ae.prototype),ke(Ae.prototype,"stopChannelMediaRelay",[Uj],Object.getOwnPropertyDescriptor(Ae.prototype,"stopChannelMediaRelay"),Ae.prototype),ke(Ae.prototype,"sendCustomReportMessage",[Vj],Object.getOwnPropertyDescriptor(Ae.prototype,"sendCustomReportMessage"),Ae.prototype),ke(Ae.prototype,"pickSVCLayer",[Fj],Object.getOwnPropertyDescriptor(Ae.prototype,"pickSVCLayer"),Ae.prototype),ke(Ae.prototype,"setRTMConfig",[Bj],Object.getOwnPropertyDescriptor(Ae.prototype,"setRTMConfig"),Ae.prototype),ke(Ae.prototype,"enableContentInspect",[jj],Object.getOwnPropertyDescriptor(Ae.prototype,"enableContentInspect"),Ae.prototype),ke(Ae.prototype,"disableContentInspect",[Gj],Object.getOwnPropertyDescriptor(Ae.prototype,"disableContentInspect"),Ae.prototype),ke(Ae.prototype,"setImageModeration",[Wj],Object.getOwnPropertyDescriptor(Ae.prototype,"setImageModeration"),Ae.prototype),ke(Ae.prototype,"setP2PTransport",[zj],Object.getOwnPropertyDescriptor(Ae.prototype,"setP2PTransport"),Ae.prototype),ke(Ae.prototype,"getJoinChannelServiceRecords",[Hj],Object.getOwnPropertyDescriptor(Ae.prototype,"getJoinChannelServiceRecords"),Ae.prototype),ke(Ae.prototype,"setPublishAudioFilterEnabled",[Kj],Object.getOwnPropertyDescriptor(Ae.prototype,"setPublishAudioFilterEnabled"),Ae.prototype),Ae);class Py{constructor(t,n){U(this,"id",0),U(this,"element",void 0),U(this,"peerPair",void 0),U(this,"context",void 0),U(this,"audioPlayerElement",void 0),U(this,"audioTrack",void 0),Py.count+=1,this.id=Py.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(r,o)=>{const l=o==="offer"?await r.createOffer():await r.createAnswer();return await r.setLocalDescription(l),r.iceGatheringState==="complete"?r.localDescription:new we(u=>{r.onicegatheringstatechange=()=>{r.iceGatheringState==="complete"&&u(r.localDescription)}})},n=async(r,o)=>await r.setRemoteDescription(o);try{const r=await t(this.peerPair[0],"offer");await n(this.peerPair[1],r);const o=await t(this.peerPair[1],"answer");await n(this.peerPair[0],o)}catch(r){throw new ie(B.LOCAL_AEC_ERROR,r.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(o){throw new ie(B.LOCAL_AEC_ERROR,o.toString()).print()}if(!n)throw new ie(B.LOCAL_AEC_ERROR,"no dest node when local aec").print();const r=n.stream.getAudioTracks()[0];return this.audioTrack=r,r}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){A.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var Yj,Vw;U(Py,"count",0);const pZ=window.AudioContext||window.webkitAudioContext,fZ=new(Yj=He({report:xe}),ke((Vw=class{constructor(){U(this,"units",[]),U(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return A.debug("the system does not need to process local aec"),-1;this.context||(this.context=new pZ);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new Py(e,this.context),this.units.push(t)),t.startEchoCancellation(),A.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return Tt().name!==Ot.SAFARI}}).prototype,"processExternalMediaAEC",[Yj],Object.getOwnPropertyDescriptor(Vw.prototype,"processExternalMediaAEC"),Vw.prototype),Vw);function Xj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Jj(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Xj(Object(n),!0).forEach(function(r){U(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xj(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const eN=window||document;function $j(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!eN)return;const n=qn._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const r=o=>{if(!(o&&o.blockedURI&&(qn.onSecurityPolicyViolation||qn.getListeners(Ac.SECURITY_POLICY_VIOLATION).length>0)))return;const l=o.blockedURI;G("CSP_DETECTED_HOSTNAME_LIST").some(u=>Te(l).call(l,u))&&(qn.onSecurityPolicyViolation&&typeof qn.onSecurityPolicyViolation=="function"&&qn.onSecurityPolicyViolation(o),qn.getListeners(Ac.SECURITY_POLICY_VIOLATION).length>0&&qn.safeEmit(Ac.SECURITY_POLICY_VIOLATION,o))};n&&eN.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||qn.getListeners(Ac.SECURITY_POLICY_VIOLATION).length>0)&&eN.addEventListener("securitypolicyviolation",r),qn._cspEventHandlerPointer=r}var mZ=j,gZ=LM,Qj=RegExp.prototype,_Z=function(e){return e===Qj||mZ(Qj,e)?gZ(e):e.flags},ar=p(_Z);function _g(e){let t=e.length;for(;--t>=0;)e[t]=0}const tN=256,Zj=286,Dy=30,ky=15,nN=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Fw=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),EZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),e3=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Yl=new Array(576);_g(Yl);const Ly=new Array(60);_g(Ly);const xy=new Array(512);_g(xy);const My=new Array(256);_g(My);const iN=new Array(29);_g(iN);const Bw=new Array(Dy);function rN(e,t,n,r,o){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=o,this.has_stree=e&&e.length}let t3,n3,i3;function sN(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}_g(Bw);const r3=e=>e<256?xy[e]:xy[256+(e>>>7)],Uy=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},eo=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,Uy(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},Dc=(e,t,n)=>{eo(e,n[2*t],n[2*t+1])},s3=(e,t)=>{let n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1},o3=(e,t,n)=>{const r=new Array(16);let o,l,u=0;for(o=1;o<=ky;o++)u=u+n[o-1]<<1,r[o]=u;for(l=0;l<=t;l++){let h=e[2*l+1];h!==0&&(e[2*l]=s3(r[h]++,h))}},a3=e=>{let t;for(t=0;t<Zj;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Dy;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},c3=e=>{e.bi_valid>8?Uy(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},l3=(e,t,n,r)=>{const o=2*t,l=2*n;return e[o]<e[l]||e[o]===e[l]&&r[t]<=r[n]},oN=(e,t,n)=>{const r=e.heap[n];let o=n<<1;for(;o<=e.heap_len&&(o<e.heap_len&&l3(t,e.heap[o+1],e.heap[o],e.depth)&&o++,!l3(t,r,e.heap[o],e.depth));)e.heap[n]=e.heap[o],n=o,o<<=1;e.heap[n]=r},u3=(e,t,n)=>{let r,o,l,u,h=0;if(e.sym_next!==0)do r=255&e.pending_buf[e.sym_buf+h++],r+=(255&e.pending_buf[e.sym_buf+h++])<<8,o=e.pending_buf[e.sym_buf+h++],r===0?Dc(e,o,t):(l=My[o],Dc(e,l+tN+1,t),u=nN[l],u!==0&&(o-=iN[l],eo(e,o,u)),r--,l=r3(r),Dc(e,l,n),u=Fw[l],u!==0&&(r-=Bw[l],eo(e,r,u)));while(h<e.sym_next);Dc(e,256,t)},aN=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,o=t.stat_desc.has_stree,l=t.stat_desc.elems;let u,h,m,g=-1;for(e.heap_len=0,e.heap_max=573,u=0;u<l;u++)n[2*u]!==0?(e.heap[++e.heap_len]=g=u,e.depth[u]=0):n[2*u+1]=0;for(;e.heap_len<2;)m=e.heap[++e.heap_len]=g<2?++g:0,n[2*m]=1,e.depth[m]=0,e.opt_len--,o&&(e.static_len-=r[2*m+1]);for(t.max_code=g,u=e.heap_len>>1;u>=1;u--)oN(e,n,u);m=l;do u=e.heap[1],e.heap[1]=e.heap[e.heap_len--],oN(e,n,1),h=e.heap[1],e.heap[--e.heap_max]=u,e.heap[--e.heap_max]=h,n[2*m]=n[2*u]+n[2*h],e.depth[m]=(e.depth[u]>=e.depth[h]?e.depth[u]:e.depth[h])+1,n[2*u+1]=n[2*h+1]=m,e.heap[1]=m++,oN(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((E,S)=>{const R=S.dyn_tree,b=S.max_code,x=S.stat_desc.static_tree,P=S.stat_desc.has_stree,k=S.stat_desc.extra_bits,V=S.stat_desc.extra_base,F=S.stat_desc.max_length;let K,$,Z,J,re,pe,Ce=0;for(J=0;J<=ky;J++)E.bl_count[J]=0;for(R[2*E.heap[E.heap_max]+1]=0,K=E.heap_max+1;K<573;K++)$=E.heap[K],J=R[2*R[2*$+1]+1]+1,J>F&&(J=F,Ce++),R[2*$+1]=J,$>b||(E.bl_count[J]++,re=0,$>=V&&(re=k[$-V]),pe=R[2*$],E.opt_len+=pe*(J+re),P&&(E.static_len+=pe*(x[2*$+1]+re)));if(Ce!==0){do{for(J=F-1;E.bl_count[J]===0;)J--;E.bl_count[J]--,E.bl_count[J+1]+=2,E.bl_count[F]--,Ce-=2}while(Ce>0);for(J=F;J!==0;J--)for($=E.bl_count[J];$!==0;)Z=E.heap[--K],Z>b||(R[2*Z+1]!==J&&(E.opt_len+=(J-R[2*Z+1])*R[2*Z],R[2*Z+1]=J),$--)}})(e,t),o3(n,g,e.bl_count)},d3=(e,t,n)=>{let r,o,l=-1,u=t[1],h=0,m=7,g=4;for(u===0&&(m=138,g=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)o=u,u=t[2*(r+1)+1],++h<m&&o===u||(h<g?e.bl_tree[2*o]+=h:o!==0?(o!==l&&e.bl_tree[2*o]++,e.bl_tree[32]++):h<=10?e.bl_tree[34]++:e.bl_tree[36]++,h=0,l=o,u===0?(m=138,g=3):o===u?(m=6,g=3):(m=7,g=4))},h3=(e,t,n)=>{let r,o,l=-1,u=t[1],h=0,m=7,g=4;for(u===0&&(m=138,g=3),r=0;r<=n;r++)if(o=u,u=t[2*(r+1)+1],!(++h<m&&o===u)){if(h<g)do Dc(e,o,e.bl_tree);while(--h!=0);else o!==0?(o!==l&&(Dc(e,o,e.bl_tree),h--),Dc(e,16,e.bl_tree),eo(e,h-3,2)):h<=10?(Dc(e,17,e.bl_tree),eo(e,h-3,3)):(Dc(e,18,e.bl_tree),eo(e,h-11,7));h=0,l=o,u===0?(m=138,g=3):o===u?(m=6,g=3):(m=7,g=4)}};let p3=!1;const f3=(e,t,n,r)=>{eo(e,0+(r?1:0),3),c3(e),Uy(e,n),Uy(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var yZ=e=>{p3||((()=>{let t,n,r,o,l;const u=new Array(16);for(r=0,o=0;o<28;o++)for(iN[o]=r,t=0;t<1<<nN[o];t++)My[r++]=o;for(My[r-1]=o,l=0,o=0;o<16;o++)for(Bw[o]=l,t=0;t<1<<Fw[o];t++)xy[l++]=o;for(l>>=7;o<Dy;o++)for(Bw[o]=l<<7,t=0;t<1<<Fw[o]-7;t++)xy[256+l++]=o;for(n=0;n<=ky;n++)u[n]=0;for(t=0;t<=143;)Yl[2*t+1]=8,t++,u[8]++;for(;t<=255;)Yl[2*t+1]=9,t++,u[9]++;for(;t<=279;)Yl[2*t+1]=7,t++,u[7]++;for(;t<=287;)Yl[2*t+1]=8,t++,u[8]++;for(o3(Yl,287,u),t=0;t<Dy;t++)Ly[2*t+1]=5,Ly[2*t]=s3(t,5);t3=new rN(Yl,nN,257,Zj,ky),n3=new rN(Ly,Fw,0,Dy,ky),i3=new rN(new Array(0),EZ,0,19,7)})(),p3=!0),e.l_desc=new sN(e.dyn_ltree,t3),e.d_desc=new sN(e.dyn_dtree,n3),e.bl_desc=new sN(e.bl_tree,i3),e.bi_buf=0,e.bi_valid=0,a3(e)},vZ=(e,t,n,r)=>{let o,l,u=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(h=>{let m,g=4093624447;for(m=0;m<=31;m++,g>>>=1)if(1&g&&h.dyn_ltree[2*m]!==0)return 0;if(h.dyn_ltree[18]!==0||h.dyn_ltree[20]!==0||h.dyn_ltree[26]!==0)return 1;for(m=32;m<tN;m++)if(h.dyn_ltree[2*m]!==0)return 1;return 0})(e)),aN(e,e.l_desc),aN(e,e.d_desc),u=(h=>{let m;for(d3(h,h.dyn_ltree,h.l_desc.max_code),d3(h,h.dyn_dtree,h.d_desc.max_code),aN(h,h.bl_desc),m=18;m>=3&&h.bl_tree[2*e3[m]+1]===0;m--);return h.opt_len+=3*(m+1)+5+5+4,m})(e),o=e.opt_len+3+7>>>3,l=e.static_len+3+7>>>3,l<=o&&(o=l)):o=l=n+5,n+4<=o&&t!==-1?f3(e,t,n,r):e.strategy===4||l===o?(eo(e,2+(r?1:0),3),u3(e,Yl,Ly)):(eo(e,4+(r?1:0),3),((h,m,g,E)=>{let S;for(eo(h,m-257,5),eo(h,g-1,5),eo(h,E-4,4),S=0;S<E;S++)eo(h,h.bl_tree[2*e3[S]+1],3);h3(h,h.dyn_ltree,m-1),h3(h,h.dyn_dtree,g-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,u+1),u3(e,e.dyn_ltree,e.dyn_dtree)),a3(e),r&&c3(e)},SZ=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(My[n]+tN+1)]++,e.dyn_dtree[2*r3(t)]++),e.sym_next===e.sym_end),TZ=e=>{eo(e,2,3),Dc(e,256,Yl),(t=>{t.bi_valid===16?(Uy(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},RZ={_tr_init:yZ,_tr_stored_block:f3,_tr_flush_block:vZ,_tr_tally:SZ,_tr_align:TZ},Vy=(e,t,n,r)=>{let o=65535&e|0,l=e>>>16&65535|0,u=0;for(;n!==0;){u=n>2e3?2e3:n,n-=u;do o=o+t[r++]|0,l=l+o|0;while(--u);o%=65521,l%=65521}return o|l<<16|0};const wZ=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var yr=(e,t,n,r)=>{const o=wZ,l=r+n;e^=-1;for(let u=r;u<l;u++)e=e>>>8^o[255&(e^t[u])];return-1^e},cp={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},jw={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:CZ,_tr_stored_block:cN,_tr_flush_block:bZ,_tr_tally:ad,_tr_align:AZ}=RZ,{Z_NO_FLUSH:cd,Z_PARTIAL_FLUSH:IZ,Z_FULL_FLUSH:OZ,Z_FINISH:$o,Z_BLOCK:m3,Z_OK:Mr,Z_STREAM_END:g3,Z_STREAM_ERROR:kc,Z_DATA_ERROR:NZ,Z_BUF_ERROR:lN,Z_DEFAULT_COMPRESSION:PZ,Z_FILTERED:DZ,Z_HUFFMAN_ONLY:Gw,Z_RLE:kZ,Z_FIXED:LZ,Z_DEFAULT_STRATEGY:xZ,Z_UNKNOWN:MZ,Z_DEFLATED:Ww}=jw,uN=286,UZ=30,VZ=19,FZ=2*uN+1,BZ=15,lp=258,Lc=262,Eg=42,up=113,Fy=666,dp=(e,t)=>(e.msg=cp[t],t),_3=e=>2*e-(e>4?9:0),ld=e=>{let t=e.length;for(;--t>=0;)e[t]=0},jZ=e=>{let t,n,r,o=e.w_size;t=e.hash_size,r=t;do n=e.head[--r],e.head[r]=n>=o?n-o:0;while(--t);t=o,r=t;do n=e.prev[--r],e.prev[r]=n>=o?n-o:0;while(--t)};let ud=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const vo=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},So=(e,t)=>{bZ(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,vo(e.strm)},Nn=(e,t)=>{e.pending_buf[e.pending++]=t},By=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},dN=(e,t,n,r)=>{let o=e.avail_in;return o>r&&(o=r),o===0?0:(e.avail_in-=o,t.set(e.input.subarray(e.next_in,e.next_in+o),n),e.state.wrap===1?e.adler=Vy(e.adler,t,o,n):e.state.wrap===2&&(e.adler=yr(e.adler,t,o,n)),e.next_in+=o,e.total_in+=o,o)},E3=(e,t)=>{let n,r,o=e.max_chain_length,l=e.strstart,u=e.prev_length,h=e.nice_match;const m=e.strstart>e.w_size-Lc?e.strstart-(e.w_size-Lc):0,g=e.window,E=e.w_mask,S=e.prev,R=e.strstart+lp;let b=g[l+u-1],x=g[l+u];e.prev_length>=e.good_match&&(o>>=2),h>e.lookahead&&(h=e.lookahead);do if(n=t,g[n+u]===x&&g[n+u-1]===b&&g[n]===g[l]&&g[++n]===g[l+1]){l+=2,n++;do;while(g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&g[++l]===g[++n]&&l<R);if(r=lp-(R-l),l=R-lp,r>u){if(e.match_start=t,u=r,r>=h)break;b=g[l+u-1],x=g[l+u]}}while((t=S[t&E])>m&&--o!=0);return u<=e.lookahead?u:e.lookahead},yg=e=>{const t=e.w_size;let n,r,o;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Lc)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),jZ(e),r+=t),e.strm.avail_in===0)break;if(n=dN(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=ud(e,e.ins_h,e.window[o+1]);e.insert&&(e.ins_h=ud(e,e.ins_h,e.window[o+3-1]),e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Lc&&e.strm.avail_in!==0)},y3=(e,t)=>{let n,r,o,l=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,u=0,h=e.strm.avail_in;do{if(n=65535,o=e.bi_valid+42>>3,e.strm.avail_out<o||(o=e.strm.avail_out-o,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>o&&(n=o),n<l&&(n===0&&t!==$o||t===cd||n!==r+e.strm.avail_in)))break;u=t===$o&&n===r+e.strm.avail_in?1:0,cN(e,0,0,u),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,vo(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(dN(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(u===0);return h-=e.strm.avail_in,h&&(h>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=h&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-h,e.strm.next_in),e.strstart),e.strstart+=h,e.insert+=h>e.w_size-e.insert?e.w_size-e.insert:h),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),u?4:t!==cd&&t!==$o&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(o=e.window_size-e.strstart,e.strm.avail_in>o&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,o+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),o>e.strm.avail_in&&(o=e.strm.avail_in),o&&(dN(e.strm,e.window,e.strstart,o),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.high_water<e.strstart&&(e.high_water=e.strstart),o=e.bi_valid+42>>3,o=e.pending_buf_size-o>65535?65535:e.pending_buf_size-o,l=o>e.w_size?e.w_size:o,r=e.strstart-e.block_start,(r>=l||(r||t===$o)&&t!==cd&&e.strm.avail_in===0&&r<=o)&&(n=r>o?o:r,u=t===$o&&e.strm.avail_in===0&&n===r?1:0,cN(e,e.block_start,n,u),e.block_start+=n,vo(e.strm)),u?3:1)},hN=(e,t)=>{let n,r;for(;;){if(e.lookahead<Lc){if(yg(e),e.lookahead<Lc&&t===cd)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=ud(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-Lc&&(e.match_length=E3(e,n)),e.match_length>=3)if(r=ad(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=ud(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=ud(e,e.ins_h,e.window[e.strstart+1]);else r=ad(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(So(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===$o?(So(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(So(e,!1),e.strm.avail_out===0)?1:2},vg=(e,t)=>{let n,r,o;for(;;){if(e.lookahead<Lc){if(yg(e),e.lookahead<Lc&&t===cd)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=ud(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Lc&&(e.match_length=E3(e,n),e.match_length<=5&&(e.strategy===DZ||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){o=e.strstart+e.lookahead-3,r=ad(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=o&&(e.ins_h=ud(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(So(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(r=ad(e,0,e.window[e.strstart-1]),r&&So(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=ad(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===$o?(So(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(So(e,!1),e.strm.avail_out===0)?1:2};function xc(e,t,n,r,o){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=o}const jy=[new xc(0,0,0,0,y3),new xc(4,4,8,4,hN),new xc(4,5,16,8,hN),new xc(4,6,32,32,hN),new xc(4,4,16,16,vg),new xc(8,16,32,32,vg),new xc(8,16,128,128,vg),new xc(8,32,128,256,vg),new xc(32,128,258,1024,vg),new xc(32,258,258,4096,vg)];function GZ(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Ww,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*FZ),this.dyn_dtree=new Uint16Array(2*(2*UZ+1)),this.bl_tree=new Uint16Array(2*(2*VZ+1)),ld(this.dyn_ltree),ld(this.dyn_dtree),ld(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(BZ+1),this.heap=new Uint16Array(2*uN+1),ld(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*uN+1),ld(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Gy=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Eg&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==up&&t.status!==Fy?1:0},v3=e=>{if(Gy(e))return dp(e,kc);e.total_in=e.total_out=0,e.data_type=MZ;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Eg:up,e.adler=t.wrap===2?0:1,t.last_flush=-2,CZ(t),Mr},S3=e=>{const t=v3(e);return t===Mr&&(n=>{n.window_size=2*n.w_size,ld(n.head),n.max_lazy_match=jy[n.level].max_lazy,n.good_match=jy[n.level].good_length,n.nice_match=jy[n.level].nice_length,n.max_chain_length=jy[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(e.state),t},T3=(e,t,n,r,o,l)=>{if(!e)return kc;let u=1;if(t===PZ&&(t=6),r<0?(u=0,r=-r):r>15&&(u=2,r-=16),o<1||o>9||n!==Ww||r<8||r>15||t<0||t>9||l<0||l>LZ||r===8&&u!==1)return dp(e,kc);r===8&&(r=9);const h=new GZ;return e.state=h,h.strm=e,h.status=Eg,h.wrap=u,h.gzhead=null,h.w_bits=r,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=o+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+3-1)/3),h.window=new Uint8Array(2*h.w_size),h.head=new Uint16Array(h.hash_size),h.prev=new Uint16Array(h.w_size),h.lit_bufsize=1<<o+6,h.pending_buf_size=4*h.lit_bufsize,h.pending_buf=new Uint8Array(h.pending_buf_size),h.sym_buf=h.lit_bufsize,h.sym_end=3*(h.lit_bufsize-1),h.level=t,h.strategy=l,h.method=n,S3(e)};var WZ=(e,t)=>{if(Gy(e)||t>m3||t<0)return e?dp(e,kc):kc;const n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===Fy&&t!==$o)return dp(e,e.avail_out===0?lN:kc);const r=n.last_flush;if(n.last_flush=t,n.pending!==0){if(vo(e),e.avail_out===0)return n.last_flush=-1,Mr}else if(e.avail_in===0&&_3(t)<=_3(r)&&t!==$o)return dp(e,lN);if(n.status===Fy&&e.avail_in!==0)return dp(e,lN);if(n.status===Eg&&n.wrap===0&&(n.status=up),n.status===Eg){let o=Ww+(n.w_bits-8<<4)<<8,l=-1;if(l=n.strategy>=Gw||n.level<2?0:n.level<6?1:n.level===6?2:3,o|=l<<6,n.strstart!==0&&(o|=32),o+=31-o%31,By(n,o),n.strstart!==0&&(By(n,e.adler>>>16),By(n,65535&e.adler)),e.adler=1,n.status=up,vo(e),n.pending!==0)return n.last_flush=-1,Mr}if(n.status===57){if(e.adler=0,Nn(n,31),Nn(n,139),Nn(n,8),n.gzhead)Nn(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Nn(n,255&n.gzhead.time),Nn(n,n.gzhead.time>>8&255),Nn(n,n.gzhead.time>>16&255),Nn(n,n.gzhead.time>>24&255),Nn(n,n.level===9?2:n.strategy>=Gw||n.level<2?4:0),Nn(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Nn(n,255&n.gzhead.extra.length),Nn(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=yr(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Nn(n,0),Nn(n,0),Nn(n,0),Nn(n,0),Nn(n,0),Nn(n,n.level===9?2:n.strategy>=Gw||n.level<2?4:0),Nn(n,3),n.status=up,vo(e),n.pending!==0)return n.last_flush=-1,Mr}if(n.status===69){if(n.gzhead.extra){let o=n.pending,l=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+l>n.pending_buf_size;){let h=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+h),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>o&&(e.adler=yr(e.adler,n.pending_buf,n.pending-o,o)),n.gzindex+=h,vo(e),n.pending!==0)return n.last_flush=-1,Mr;o=0,l-=h}let u=new Uint8Array(n.gzhead.extra);n.pending_buf.set(u.subarray(n.gzindex,n.gzindex+l),n.pending),n.pending+=l,n.gzhead.hcrc&&n.pending>o&&(e.adler=yr(e.adler,n.pending_buf,n.pending-o,o)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let o,l=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>l&&(e.adler=yr(e.adler,n.pending_buf,n.pending-l,l)),vo(e),n.pending!==0)return n.last_flush=-1,Mr;l=0}o=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Nn(n,o)}while(o!==0);n.gzhead.hcrc&&n.pending>l&&(e.adler=yr(e.adler,n.pending_buf,n.pending-l,l)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let o,l=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>l&&(e.adler=yr(e.adler,n.pending_buf,n.pending-l,l)),vo(e),n.pending!==0)return n.last_flush=-1,Mr;l=0}o=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Nn(n,o)}while(o!==0);n.gzhead.hcrc&&n.pending>l&&(e.adler=yr(e.adler,n.pending_buf,n.pending-l,l))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(vo(e),n.pending!==0))return n.last_flush=-1,Mr;Nn(n,255&e.adler),Nn(n,e.adler>>8&255),e.adler=0}if(n.status=up,vo(e),n.pending!==0)return n.last_flush=-1,Mr}if(e.avail_in!==0||n.lookahead!==0||t!==cd&&n.status!==Fy){let o=n.level===0?y3(n,t):n.strategy===Gw?((l,u)=>{let h;for(;;){if(l.lookahead===0&&(yg(l),l.lookahead===0)){if(u===cd)return 1;break}if(l.match_length=0,h=ad(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++,h&&(So(l,!1),l.strm.avail_out===0))return 1}return l.insert=0,u===$o?(So(l,!0),l.strm.avail_out===0?3:4):l.sym_next&&(So(l,!1),l.strm.avail_out===0)?1:2})(n,t):n.strategy===kZ?((l,u)=>{let h,m,g,E;const S=l.window;for(;;){if(l.lookahead<=lp){if(yg(l),l.lookahead<=lp&&u===cd)return 1;if(l.lookahead===0)break}if(l.match_length=0,l.lookahead>=3&&l.strstart>0&&(g=l.strstart-1,m=S[g],m===S[++g]&&m===S[++g]&&m===S[++g])){E=l.strstart+lp;do;while(m===S[++g]&&m===S[++g]&&m===S[++g]&&m===S[++g]&&m===S[++g]&&m===S[++g]&&m===S[++g]&&m===S[++g]&&g<E);l.match_length=lp-(E-g),l.match_length>l.lookahead&&(l.match_length=l.lookahead)}if(l.match_length>=3?(h=ad(l,1,l.match_length-3),l.lookahead-=l.match_length,l.strstart+=l.match_length,l.match_length=0):(h=ad(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++),h&&(So(l,!1),l.strm.avail_out===0))return 1}return l.insert=0,u===$o?(So(l,!0),l.strm.avail_out===0?3:4):l.sym_next&&(So(l,!1),l.strm.avail_out===0)?1:2})(n,t):jy[n.level].func(n,t);if(o!==3&&o!==4||(n.status=Fy),o===1||o===3)return e.avail_out===0&&(n.last_flush=-1),Mr;if(o===2&&(t===IZ?AZ(n):t!==m3&&(cN(n,0,0,!1),t===OZ&&(ld(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),vo(e),e.avail_out===0))return n.last_flush=-1,Mr}return t!==$o?Mr:n.wrap<=0?g3:(n.wrap===2?(Nn(n,255&e.adler),Nn(n,e.adler>>8&255),Nn(n,e.adler>>16&255),Nn(n,e.adler>>24&255),Nn(n,255&e.total_in),Nn(n,e.total_in>>8&255),Nn(n,e.total_in>>16&255),Nn(n,e.total_in>>24&255)):(By(n,e.adler>>>16),By(n,65535&e.adler)),vo(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Mr:g3)},zZ=(e,t)=>{let n=t.length;if(Gy(e))return kc;const r=e.state,o=r.wrap;if(o===2||o===1&&r.status!==Eg||r.lookahead)return kc;if(o===1&&(e.adler=Vy(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){o===0&&(ld(r.head),r.strstart=0,r.block_start=0,r.insert=0);let m=new Uint8Array(r.w_size);m.set(t.subarray(n-r.w_size,n),0),t=m,n=r.w_size}const l=e.avail_in,u=e.next_in,h=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,yg(r);r.lookahead>=3;){let m=r.strstart,g=r.lookahead-2;do r.ins_h=ud(r,r.ins_h,r.window[m+3-1]),r.prev[m&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=m,m++;while(--g);r.strstart=m,r.lookahead=2,yg(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=u,e.input=h,e.avail_in=l,r.wrap=o,Mr},Wy={deflateInit:(e,t)=>T3(e,t,Ww,15,8,xZ),deflateInit2:T3,deflateReset:S3,deflateResetKeep:v3,deflateSetHeader:(e,t)=>Gy(e)||e.state.wrap!==2?kc:(e.state.gzhead=t,Mr),deflate:WZ,deflateEnd:e=>{if(Gy(e))return kc;const t=e.state.status;return e.state=null,t===up?dp(e,NZ):Mr},deflateSetDictionary:zZ,deflateInfo:"pako deflate (from Nodeca project)"};const HZ=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var zw={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)HZ(n,r)&&(e[r]=n[r])}}return e},flattenChunks:e=>{let t=0;for(let r=0,o=e.length;r<o;r++)t+=e[r].length;const n=new Uint8Array(t);for(let r=0,o=0,l=e.length;r<l;r++){let u=e[r];n.set(u,o),o+=u.length}return n}};let R3=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{R3=!1}const zy=new Uint8Array(256);for(let e=0;e<256;e++)zy[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;zy[254]=zy[254]=1;var Hy={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,r,o,l,u=e.length,h=0;for(o=0;o<u;o++)n=e.charCodeAt(o),(64512&n)==55296&&o+1<u&&(r=e.charCodeAt(o+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),o++)),h+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(h),l=0,o=0;l<h;o++)n=e.charCodeAt(o),(64512&n)==55296&&o+1<u&&(r=e.charCodeAt(o+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),o++)),n<128?t[l++]=n:n<2048?(t[l++]=192|n>>>6,t[l++]=128|63&n):n<65536?(t[l++]=224|n>>>12,t[l++]=128|n>>>6&63,t[l++]=128|63&n):(t[l++]=240|n>>>18,t[l++]=128|n>>>12&63,t[l++]=128|n>>>6&63,t[l++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let r,o;const l=new Array(2*n);for(o=0,r=0;r<n;){let u=e[r++];if(u<128){l[o++]=u;continue}let h=zy[u];if(h>4)l[o++]=65533,r+=h-1;else{for(u&=h===2?31:h===3?15:7;h>1&&r<n;)u=u<<6|63&e[r++],h--;h>1?l[o++]=65533:u<65536?l[o++]=u:(u-=65536,l[o++]=55296|u>>10&1023,l[o++]=56320|1023&u)}}return((u,h)=>{if(h<65534&&u.subarray&&R3)return String.fromCharCode.apply(null,u.length===h?u:u.subarray(0,h));let m="";for(let g=0;g<h;g++)m+=String.fromCharCode(u[g]);return m})(l,o)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+zy[e[n]]>t?n:t}},w3=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const C3=Object.prototype.toString,{Z_NO_FLUSH:KZ,Z_SYNC_FLUSH:qZ,Z_FULL_FLUSH:YZ,Z_FINISH:XZ,Z_OK:Hw,Z_STREAM_END:JZ,Z_DEFAULT_COMPRESSION:$Z,Z_DEFAULT_STRATEGY:QZ,Z_DEFLATED:ZZ}=jw;function Kw(e){this.options=zw.assign({level:$Z,method:ZZ,chunkSize:16384,windowBits:15,memLevel:8,strategy:QZ},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new w3,this.strm.avail_out=0;let n=Wy.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==Hw)throw new Error(cp[n]);if(t.header&&Wy.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(r=typeof t.dictionary=="string"?Hy.string2buf(t.dictionary):C3.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,n=Wy.deflateSetDictionary(this.strm,r),n!==Hw)throw new Error(cp[n]);this._dict_set=!0}}function eee(e,t){const n=new Kw(t);if(n.push(e,!0),n.err)throw n.msg||cp[n.err];return n.result}Kw.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let o,l;if(this.ended)return!1;for(l=t===~~t?t:t===!0?XZ:KZ,typeof e=="string"?n.input=Hy.string2buf(e):C3.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(l===qZ||l===YZ)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(o=Wy.deflate(n,l),o===JZ)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),o=Wy.deflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===Hw;if(n.avail_out!==0){if(l>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},Kw.prototype.onData=function(e){this.chunks.push(e)},Kw.prototype.onEnd=function(e){e===Hw&&(this.result=zw.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var tee={deflate:eee};const qw=16209;var nee=function(e,t){let n,r,o,l,u,h,m,g,E,S,R,b,x,P,k,V,F,K,$,Z,J,re,pe,Ce;const Ie=e.state;n=e.next_in,pe=e.input,r=n+(e.avail_in-5),o=e.next_out,Ce=e.output,l=o-(t-e.avail_out),u=o+(e.avail_out-257),h=Ie.dmax,m=Ie.wsize,g=Ie.whave,E=Ie.wnext,S=Ie.window,R=Ie.hold,b=Ie.bits,x=Ie.lencode,P=Ie.distcode,k=(1<<Ie.lenbits)-1,V=(1<<Ie.distbits)-1;e:do{b<15&&(R+=pe[n++]<<b,b+=8,R+=pe[n++]<<b,b+=8),F=x[R&k];t:for(;;){if(K=F>>>24,R>>>=K,b-=K,K=F>>>16&255,K===0)Ce[o++]=65535&F;else{if(!(16&K)){if((64&K)==0){F=x[(65535&F)+(R&(1<<K)-1)];continue t}if(32&K){Ie.mode=16191;break e}e.msg="invalid literal/length code",Ie.mode=qw;break e}$=65535&F,K&=15,K&&(b<K&&(R+=pe[n++]<<b,b+=8),$+=R&(1<<K)-1,R>>>=K,b-=K),b<15&&(R+=pe[n++]<<b,b+=8,R+=pe[n++]<<b,b+=8),F=P[R&V];n:for(;;){if(K=F>>>24,R>>>=K,b-=K,K=F>>>16&255,!(16&K)){if((64&K)==0){F=P[(65535&F)+(R&(1<<K)-1)];continue n}e.msg="invalid distance code",Ie.mode=qw;break e}if(Z=65535&F,K&=15,b<K&&(R+=pe[n++]<<b,b+=8,b<K&&(R+=pe[n++]<<b,b+=8)),Z+=R&(1<<K)-1,Z>h){e.msg="invalid distance too far back",Ie.mode=qw;break e}if(R>>>=K,b-=K,K=o-l,Z>K){if(K=Z-K,K>g&&Ie.sane){e.msg="invalid distance too far back",Ie.mode=qw;break e}if(J=0,re=S,E===0){if(J+=m-K,K<$){$-=K;do Ce[o++]=S[J++];while(--K);J=o-Z,re=Ce}}else if(E<K){if(J+=m+E-K,K-=E,K<$){$-=K;do Ce[o++]=S[J++];while(--K);if(J=0,E<$){K=E,$-=K;do Ce[o++]=S[J++];while(--K);J=o-Z,re=Ce}}}else if(J+=E-K,K<$){$-=K;do Ce[o++]=S[J++];while(--K);J=o-Z,re=Ce}for(;$>2;)Ce[o++]=re[J++],Ce[o++]=re[J++],Ce[o++]=re[J++],$-=3;$&&(Ce[o++]=re[J++],$>1&&(Ce[o++]=re[J++]))}else{J=o-Z;do Ce[o++]=Ce[J++],Ce[o++]=Ce[J++],Ce[o++]=Ce[J++],$-=3;while($>2);$&&(Ce[o++]=Ce[J++],$>1&&(Ce[o++]=Ce[J++]))}break}}break}}while(n<r&&o<u);$=b>>3,n-=$,b-=$<<3,R&=(1<<b)-1,e.next_in=n,e.next_out=o,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=o<u?u-o+257:257-(o-u),Ie.hold=R,Ie.bits=b};const Yw=15,iee=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ree=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),see=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),oee=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Ky=(e,t,n,r,o,l,u,h)=>{const m=h.bits;let g,E,S,R,b,x,P=0,k=0,V=0,F=0,K=0,$=0,Z=0,J=0,re=0,pe=0,Ce=null;const Ie=new Uint16Array(16),_t=new Uint16Array(16);let Et,Qt,kn,An=null;for(P=0;P<=Yw;P++)Ie[P]=0;for(k=0;k<r;k++)Ie[t[n+k]]++;for(K=m,F=Yw;F>=1&&Ie[F]===0;F--);if(K>F&&(K=F),F===0)return o[l++]=20971520,o[l++]=20971520,h.bits=1,0;for(V=1;V<F&&Ie[V]===0;V++);for(K<V&&(K=V),J=1,P=1;P<=Yw;P++)if(J<<=1,J-=Ie[P],J<0)return-1;if(J>0&&(e===0||F!==1))return-1;for(_t[1]=0,P=1;P<Yw;P++)_t[P+1]=_t[P]+Ie[P];for(k=0;k<r;k++)t[n+k]!==0&&(u[_t[t[n+k]]++]=k);if(e===0?(Ce=An=u,x=20):e===1?(Ce=iee,An=ree,x=257):(Ce=see,An=oee,x=0),pe=0,k=0,P=V,b=l,$=K,Z=0,S=-1,re=1<<K,R=re-1,e===1&&re>852||e===2&&re>592)return 1;for(;;){Et=P-Z,u[k]+1<x?(Qt=0,kn=u[k]):u[k]>=x?(Qt=An[u[k]-x],kn=Ce[u[k]-x]):(Qt=96,kn=0),g=1<<P-Z,E=1<<$,V=E;do E-=g,o[b+(pe>>Z)+E]=Et<<24|Qt<<16|kn|0;while(E!==0);for(g=1<<P-1;pe&g;)g>>=1;if(g!==0?(pe&=g-1,pe+=g):pe=0,k++,--Ie[P]==0){if(P===F)break;P=t[n+u[k]]}if(P>K&&(pe&R)!==S){for(Z===0&&(Z=K),b+=V,$=P-Z,J=1<<$;$+Z<F&&(J-=Ie[$+Z],!(J<=0));)$++,J<<=1;if(re+=1<<$,e===1&&re>852||e===2&&re>592)return 1;S=pe&R,o[S]=K<<24|$<<16|b-l|0}}return pe!==0&&(o[b+pe]=P-Z<<24|64<<16|0),h.bits=K,0};const{Z_FINISH:b3,Z_BLOCK:aee,Z_TREES:Xw,Z_OK:hp,Z_STREAM_END:cee,Z_NEED_DICT:lee,Z_STREAM_ERROR:Qo,Z_DATA_ERROR:A3,Z_MEM_ERROR:I3,Z_BUF_ERROR:uee,Z_DEFLATED:O3}=jw,Jw=16180,$w=16190,Xl=16191,pN=16192,fN=16194,Qw=16199,Zw=16200,mN=16206,gi=16209,N3=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function dee(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const pp=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Jw||t.mode>16211?1:0},P3=e=>{if(pp(e))return Qo;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Jw,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,hp},D3=e=>{if(pp(e))return Qo;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,P3(e)},k3=(e,t)=>{let n;if(pp(e))return Qo;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Qo:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,D3(e))},L3=(e,t)=>{if(!e)return Qo;const n=new dee;e.state=n,n.strm=e,n.window=null,n.mode=Jw;const r=k3(e,t);return r!==hp&&(e.state=null),r};let gN,_N,x3=!0;const hee=e=>{if(x3){gN=new Int32Array(512),_N=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Ky(1,e.lens,0,288,gN,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Ky(2,e.lens,0,32,_N,0,e.work,{bits:5}),x3=!1}e.lencode=gN,e.lenbits=9,e.distcode=_N,e.distbits=5},M3=(e,t,n,r)=>{let o;const l=e.state;return l.window===null&&(l.wsize=1<<l.wbits,l.wnext=0,l.whave=0,l.window=new Uint8Array(l.wsize)),r>=l.wsize?(l.window.set(t.subarray(n-l.wsize,n),0),l.wnext=0,l.whave=l.wsize):(o=l.wsize-l.wnext,o>r&&(o=r),l.window.set(t.subarray(n-r,n-r+o),l.wnext),(r-=o)?(l.window.set(t.subarray(n-r,n),0),l.wnext=r,l.whave=l.wsize):(l.wnext+=o,l.wnext===l.wsize&&(l.wnext=0),l.whave<l.wsize&&(l.whave+=o))),0};var pee=(e,t)=>{let n,r,o,l,u,h,m,g,E,S,R,b,x,P,k,V,F,K,$,Z,J,re,pe=0;const Ce=new Uint8Array(4);let Ie,_t;const Et=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(pp(e)||!e.output||!e.input&&e.avail_in!==0)return Qo;n=e.state,n.mode===Xl&&(n.mode=pN),u=e.next_out,o=e.output,m=e.avail_out,l=e.next_in,r=e.input,h=e.avail_in,g=n.hold,E=n.bits,S=h,R=m,re=hp;e:for(;;)switch(n.mode){case Jw:if(n.wrap===0){n.mode=pN;break}for(;E<16;){if(h===0)break e;h--,g+=r[l++]<<E,E+=8}if(2&n.wrap&&g===35615){n.wbits===0&&(n.wbits=15),n.check=0,Ce[0]=255&g,Ce[1]=g>>>8&255,n.check=yr(n.check,Ce,2,0),g=0,E=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&g)<<8)+(g>>8))%31){e.msg="incorrect header check",n.mode=gi;break}if((15&g)!==O3){e.msg="unknown compression method",n.mode=gi;break}if(g>>>=4,E-=4,J=8+(15&g),n.wbits===0&&(n.wbits=J),J>15||J>n.wbits){e.msg="invalid window size",n.mode=gi;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&g?16189:Xl,g=0,E=0;break;case 16181:for(;E<16;){if(h===0)break e;h--,g+=r[l++]<<E,E+=8}if(n.flags=g,(255&ar(n))!==O3){e.msg="unknown compression method",n.mode=gi;break}if(57344&ar(n)){e.msg="unknown header flags set",n.mode=gi;break}n.head&&(n.head.text=g>>8&1),512&ar(n)&&4&n.wrap&&(Ce[0]=255&g,Ce[1]=g>>>8&255,n.check=yr(n.check,Ce,2,0)),g=0,E=0,n.mode=16182;case 16182:for(;E<32;){if(h===0)break e;h--,g+=r[l++]<<E,E+=8}n.head&&(n.head.time=g),512&ar(n)&&4&n.wrap&&(Ce[0]=255&g,Ce[1]=g>>>8&255,Ce[2]=g>>>16&255,Ce[3]=g>>>24&255,n.check=yr(n.check,Ce,4,0)),g=0,E=0,n.mode=16183;case 16183:for(;E<16;){if(h===0)break e;h--,g+=r[l++]<<E,E+=8}n.head&&(n.head.xflags=255&g,n.head.os=g>>8),512&ar(n)&&4&n.wrap&&(Ce[0]=255&g,Ce[1]=g>>>8&255,n.check=yr(n.check,Ce,2,0)),g=0,E=0,n.mode=16184;case 16184:if(1024&ar(n)){for(;E<16;){if(h===0)break e;h--,g+=r[l++]<<E,E+=8}n.length=g,n.head&&(n.head.extra_len=g),512&ar(n)&&4&n.wrap&&(Ce[0]=255&g,Ce[1]=g>>>8&255,n.check=yr(n.check,Ce,2,0)),g=0,E=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&ar(n)&&(b=n.length,b>h&&(b=h),b&&(n.head&&(J=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(l,l+b),J)),512&ar(n)&&4&n.wrap&&(n.check=yr(n.check,r,b,l)),h-=b,l+=b,n.length-=b),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&ar(n)){if(h===0)break e;b=0;do J=r[l+b++],n.head&&J&&n.length<65536&&(n.head.name+=String.fromCharCode(J));while(J&&b<h);if(512&ar(n)&&4&n.wrap&&(n.check=yr(n.check,r,b,l)),h-=b,l+=b,J)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&ar(n)){if(h===0)break e;b=0;do J=r[l+b++],n.head&&J&&n.length<65536&&(n.head.comment+=String.fromCharCode(J));while(J&&b<h);if(512&ar(n)&&4&n.wrap&&(n.check=yr(n.check,r,b,l)),h-=b,l+=b,J)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&ar(n)){for(;E<16;){if(h===0)break e;h--,g+=r[l++]<<E,E+=8}if(4&n.wrap&&g!==(65535&n.check)){e.msg="header crc mismatch",n.mode=gi;break}g=0,E=0}n.head&&(n.head.hcrc=ar(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Xl;break;case 16189:for(;E<32;){if(h===0)break e;h--,g+=r[l++]<<E,E+=8}e.adler=n.check=N3(g),g=0,E=0,n.mode=$w;case $w:if(n.havedict===0)return e.next_out=u,e.avail_out=m,e.next_in=l,e.avail_in=h,n.hold=g,n.bits=E,lee;e.adler=n.check=1,n.mode=Xl;case Xl:if(t===aee||t===Xw)break e;case pN:if(n.last){g>>>=7&E,E-=7&E,n.mode=mN;break}for(;E<3;){if(h===0)break e;h--,g+=r[l++]<<E,E+=8}switch(n.last=1&g,g>>>=1,E-=1,3&g){case 0:n.mode=16193;break;case 1:if(hee(n),n.mode=Qw,t===Xw){g>>>=2,E-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=gi}g>>>=2,E-=2;break;case 16193:for(g>>>=7&E,E-=7&E;E<32;){if(h===0)break e;h--,g+=r[l++]<<E,E+=8}if((65535&g)!=(g>>>16^65535)){e.msg="invalid stored block lengths",n.mode=gi;break}if(n.length=65535&g,g=0,E=0,n.mode=fN,t===Xw)break e;case fN:n.mode=16195;case 16195:if(b=n.length,b){if(b>h&&(b=h),b>m&&(b=m),b===0)break e;o.set(r.subarray(l,l+b),u),h-=b,l+=b,m-=b,u+=b,n.length-=b;break}n.mode=Xl;break;case 16196:for(;E<14;){if(h===0)break e;h--,g+=r[l++]<<E,E+=8}if(n.nlen=257+(31&g),g>>>=5,E-=5,n.ndist=1+(31&g),g>>>=5,E-=5,n.ncode=4+(15&g),g>>>=4,E-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=gi;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;E<3;){if(h===0)break e;h--,g+=r[l++]<<E,E+=8}n.lens[Et[n.have++]]=7&g,g>>>=3,E-=3}for(;n.have<19;)n.lens[Et[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Ie={bits:n.lenbits},re=Ky(0,n.lens,0,19,n.lencode,0,n.work,Ie),n.lenbits=Ie.bits,re){e.msg="invalid code lengths set",n.mode=gi;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;pe=n.lencode[g&(1<<n.lenbits)-1],k=pe>>>24,V=pe>>>16&255,F=65535&pe,!(k<=E);){if(h===0)break e;h--,g+=r[l++]<<E,E+=8}if(F<16)g>>>=k,E-=k,n.lens[n.have++]=F;else{if(F===16){for(_t=k+2;E<_t;){if(h===0)break e;h--,g+=r[l++]<<E,E+=8}if(g>>>=k,E-=k,n.have===0){e.msg="invalid bit length repeat",n.mode=gi;break}J=n.lens[n.have-1],b=3+(3&g),g>>>=2,E-=2}else if(F===17){for(_t=k+3;E<_t;){if(h===0)break e;h--,g+=r[l++]<<E,E+=8}g>>>=k,E-=k,J=0,b=3+(7&g),g>>>=3,E-=3}else{for(_t=k+7;E<_t;){if(h===0)break e;h--,g+=r[l++]<<E,E+=8}g>>>=k,E-=k,J=0,b=11+(127&g),g>>>=7,E-=7}if(n.have+b>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=gi;break}for(;b--;)n.lens[n.have++]=J}}if(n.mode===gi)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=gi;break}if(n.lenbits=9,Ie={bits:n.lenbits},re=Ky(1,n.lens,0,n.nlen,n.lencode,0,n.work,Ie),n.lenbits=Ie.bits,re){e.msg="invalid literal/lengths set",n.mode=gi;break}if(n.distbits=6,n.distcode=n.distdyn,Ie={bits:n.distbits},re=Ky(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Ie),n.distbits=Ie.bits,re){e.msg="invalid distances set",n.mode=gi;break}if(n.mode=Qw,t===Xw)break e;case Qw:n.mode=Zw;case Zw:if(h>=6&&m>=258){e.next_out=u,e.avail_out=m,e.next_in=l,e.avail_in=h,n.hold=g,n.bits=E,nee(e,R),u=e.next_out,o=e.output,m=e.avail_out,l=e.next_in,r=e.input,h=e.avail_in,g=n.hold,E=n.bits,n.mode===Xl&&(n.back=-1);break}for(n.back=0;pe=n.lencode[g&(1<<n.lenbits)-1],k=pe>>>24,V=pe>>>16&255,F=65535&pe,!(k<=E);){if(h===0)break e;h--,g+=r[l++]<<E,E+=8}if(V&&(240&V)==0){for(K=k,$=V,Z=F;pe=n.lencode[Z+((g&(1<<K+$)-1)>>K)],k=pe>>>24,V=pe>>>16&255,F=65535&pe,!(K+k<=E);){if(h===0)break e;h--,g+=r[l++]<<E,E+=8}g>>>=K,E-=K,n.back+=K}if(g>>>=k,E-=k,n.back+=k,n.length=F,V===0){n.mode=16205;break}if(32&V){n.back=-1,n.mode=Xl;break}if(64&V){e.msg="invalid literal/length code",n.mode=gi;break}n.extra=15&V,n.mode=16201;case 16201:if(n.extra){for(_t=n.extra;E<_t;){if(h===0)break e;h--,g+=r[l++]<<E,E+=8}n.length+=g&(1<<n.extra)-1,g>>>=n.extra,E-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;pe=n.distcode[g&(1<<n.distbits)-1],k=pe>>>24,V=pe>>>16&255,F=65535&pe,!(k<=E);){if(h===0)break e;h--,g+=r[l++]<<E,E+=8}if((240&V)==0){for(K=k,$=V,Z=F;pe=n.distcode[Z+((g&(1<<K+$)-1)>>K)],k=pe>>>24,V=pe>>>16&255,F=65535&pe,!(K+k<=E);){if(h===0)break e;h--,g+=r[l++]<<E,E+=8}g>>>=K,E-=K,n.back+=K}if(g>>>=k,E-=k,n.back+=k,64&V){e.msg="invalid distance code",n.mode=gi;break}n.offset=F,n.extra=15&V,n.mode=16203;case 16203:if(n.extra){for(_t=n.extra;E<_t;){if(h===0)break e;h--,g+=r[l++]<<E,E+=8}n.offset+=g&(1<<n.extra)-1,g>>>=n.extra,E-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=gi;break}n.mode=16204;case 16204:if(m===0)break e;if(b=R-m,n.offset>b){if(b=n.offset-b,b>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=gi;break}b>n.wnext?(b-=n.wnext,x=n.wsize-b):x=n.wnext-b,b>n.length&&(b=n.length),P=n.window}else P=o,x=u-n.offset,b=n.length;b>m&&(b=m),m-=b,n.length-=b;do o[u++]=P[x++];while(--b);n.length===0&&(n.mode=Zw);break;case 16205:if(m===0)break e;o[u++]=n.length,m--,n.mode=Zw;break;case mN:if(n.wrap){for(;E<32;){if(h===0)break e;h--,g|=r[l++]<<E,E+=8}if(R-=m,e.total_out+=R,n.total+=R,4&n.wrap&&R&&(e.adler=n.check=ar(n)?yr(n.check,o,R,u-R):Vy(n.check,o,R,u-R)),R=m,4&n.wrap&&(ar(n)?g:N3(g))!==n.check){e.msg="incorrect data check",n.mode=gi;break}g=0,E=0}n.mode=16207;case 16207:if(n.wrap&&ar(n)){for(;E<32;){if(h===0)break e;h--,g+=r[l++]<<E,E+=8}if(4&n.wrap&&g!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=gi;break}g=0,E=0}n.mode=16208;case 16208:re=cee;break e;case gi:re=A3;break e;case 16210:return I3;default:return Qo}return e.next_out=u,e.avail_out=m,e.next_in=l,e.avail_in=h,n.hold=g,n.bits=E,(n.wsize||R!==e.avail_out&&n.mode<gi&&(n.mode<mN||t!==b3))&&M3(e,e.output,e.next_out,R-e.avail_out),S-=e.avail_in,R-=e.avail_out,e.total_in+=S,e.total_out+=R,n.total+=R,4&n.wrap&&R&&(e.adler=n.check=ar(n)?yr(n.check,o,R,e.next_out-R):Vy(n.check,o,R,e.next_out-R)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Xl?128:0)+(n.mode===Qw||n.mode===fN?256:0),(S===0&&R===0||t===b3)&&re===hp&&(re=uee),re},Jl={inflateReset:D3,inflateReset2:k3,inflateResetKeep:P3,inflateInit:e=>L3(e,15),inflateInit2:L3,inflate:pee,inflateEnd:e=>{if(pp(e))return Qo;let t=e.state;return t.window&&(t.window=null),e.state=null,hp},inflateGetHeader:(e,t)=>{if(pp(e))return Qo;const n=e.state;return(2&n.wrap)==0?Qo:(n.head=t,t.done=!1,hp)},inflateSetDictionary:(e,t)=>{const n=t.length;let r,o,l;return pp(e)?Qo:(r=e.state,r.wrap!==0&&r.mode!==$w?Qo:r.mode===$w&&(o=1,o=Vy(o,t,n,0),o!==r.check)?A3:(l=M3(e,t,n,n),l?(r.mode=16210,I3):(r.havedict=1,hp)))},inflateInfo:"pako inflate (from Nodeca project)"},fee=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const U3=Object.prototype.toString,{Z_NO_FLUSH:mee,Z_FINISH:gee,Z_OK:qy,Z_STREAM_END:EN,Z_NEED_DICT:yN,Z_STREAM_ERROR:_ee,Z_DATA_ERROR:V3,Z_MEM_ERROR:Eee}=jw;function eC(e){this.options=zw.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits)==0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new w3,this.strm.avail_out=0;let n=Jl.inflateInit2(this.strm,t.windowBits);if(n!==qy)throw new Error(cp[n]);if(this.header=new fee,Jl.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=Hy.string2buf(t.dictionary):U3.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Jl.inflateSetDictionary(this.strm,t.dictionary),n!==qy)))throw new Error(cp[n])}function yee(e,t){const n=new eC(t);if(n.push(e),n.err)throw n.msg||cp[n.err];return n.result}eC.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,o=this.options.dictionary;let l,u,h;if(this.ended)return!1;for(u=t===~~t?t:t===!0?gee:mee,U3.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),l=Jl.inflate(n,u),l===yN&&o&&(l=Jl.inflateSetDictionary(n,o),l===qy?l=Jl.inflate(n,u):l===V3&&(l=yN));n.avail_in>0&&l===EN&&n.state.wrap>0&&e[n.next_in]!==0;)Jl.inflateReset(n),l=Jl.inflate(n,u);switch(l){case _ee:case V3:case yN:case Eee:return this.onEnd(l),this.ended=!0,!1}if(h=n.avail_out,n.next_out&&(n.avail_out===0||l===EN))if(this.options.to==="string"){let m=Hy.utf8border(n.output,n.next_out),g=n.next_out-m,E=Hy.buf2string(n.output,m);n.next_out=g,n.avail_out=r-g,g&&n.output.set(n.output.subarray(m,m+g),0),this.onData(E)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(l!==qy||h!==0){if(l===EN)return l=Jl.inflateEnd(this.strm),this.onEnd(l),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},eC.prototype.onData=function(e){this.chunks.push(e)},eC.prototype.onEnd=function(e){e===qy&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=zw.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var vee={inflate:yee};const{deflate:See}=tee,{inflate:Tee}=vee;var Ree=See,wee=Tee,F3=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(F3||{});class Cee{constructor(){U(this,"_sequence",0),U(this,"_startTime",Date.now()),U(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const h=new Uint8Array(4);h.set([1,0,0,0]);const m={id:0,length:4,data:h.buffer},g={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[m]};n.commonPacketHeader.extension=1,n.extension=g,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;G("SHOW_DATASTREAM2_LOG")&&A.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const r=new ArrayBuffer(n.commonPacketHeader.length),o=new Uint8Array(r),l=new DataView(r);let u=0;if(l.setUint16(u,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),u+=2,l.setUint32(u,n.commonPacketHeader.sequence,!0),u+=4,l.setUint16(u,n.commonStreamHeader,!0),u+=2,n.extension){const h=this.serializeExtension(n.extension);o.set(new Uint8Array(h),u),u+=h.byteLength}if(o.set(new Uint8Array(n.payload),u),u+=n.payload.byteLength,u!==n.commonPacketHeader.length)throw Error("serialize error!");return r}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const n=new DataView(t);let r=0;const o=n.getUint16(r,!0);r+=2;const l={length:16383&o,reserved:(16384&o)>>14,extension:(32768&o)>>15,sequence:n.getUint16(r+2,!0)<<16|n.getUint16(r,!0)};let u,h;if(r+=4,G("SHOW_DATASTREAM2_LOG")&&A.debug("receive data header: ".concat(JSON.stringify(l))),n.getUint16(r,!0),r+=2,l.extension){h=this.deserializeExtension(t.slice(r)),r+=2+h.length,u=t.slice(r);let m=!1;if(h.datas.length>0){const g=h.datas.find(E=>E.id===0);g&&(m=(1&new DataView(g.data).getUint32(0,!0))==1)}u=m?this.decompress(u):u}else u=t.slice(8);return u}serializeExtension(t){const{profile:n,length:r,datas:o}=t,l=new ArrayBuffer(r+2),u=new Uint8Array(l),h=new DataView(l);let m=0;if(h.setUint8(m++,n),h.setUint8(m++,r),o.forEach(g=>{n?(h.setUint8(m++,g.id),h.setUint8(m++,g.length),u.set(new Uint8Array(g.data),m),m+=g.data.byteLength):(h.setUint8(m++,g.id|g.length<<4),u.set(new Uint8Array(g.data),m),m+=g.data.byteLength)}),m!==r+2)throw Error("serialize extension error, is ".concat(m,"!==").concat(r+2));return l}deserializeExtension(t){const n=new DataView(t);let r=0;const o=n.getUint8(r);r++;const l=n.getUint8(r);r++;const u=o===F3.TWO_BYTE,h=[],m=new DataView(t,2);let g=0;for(;g<l;){let E=0,S=0,R=new ArrayBuffer(0);u?(E=m.getUint8(g),g++,S=m.getUint8(g),g++):(E=15&m.getUint8(g),S=m.getUint8(g)>>4,g++),S>0&&(R=m.buffer.slice(g+2,g+2+S),g+=R.byteLength),h.push({id:E,length:S,data:R})}if(g!==l)throw Error("parse error");return{profile:o,length:l,datas:h}}decompress(t){return wee(new Uint8Array(t))}compress(t){return Ree(new Uint8Array(t))}}const bee={name:"DataStream",create:(e,t)=>{const n=t?new k$(e):new L$(e);return n.useDataStream(new Cee),n}};class Aee extends En{constructor(t,n,r){super(),U(this,"ws",void 0),U(this,"requestId",1),U(this,"heartBeatTimer",void 0),U(this,"joinInfo",void 0),U(this,"clientId",void 0),U(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),U(this,"onClose",o=>{this.emit("close"),this.dispose()}),U(this,"onMessage",o=>{const l=JSON.parse(o.data);if(!l||l.command!=="serverResponse"||!l.requestId)return l&&l.command==="serverStatus"&&l.serverStatus&&l.serverStatus.command?(this.emit("status",l.serverStatus),void this.emit(l.serverStatus.command,l.serverStatus)):void 0;this.emit("req_".concat(l.requestId),l)}),this.joinInfo=t,this.clientId=n,this.ws=new yy("cross-channel-".concat(this.clientId),r),this.ws.on(it.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(it.CONNECTED,this.onOpen),this.ws.on(it.ON_MESSAGE,this.onMessage),this.ws.on(it.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new we((n,r)=>{const o=window.setTimeout(()=>{r(new ie(B.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,l=>{window.clearTimeout(o),l.state&&l.state!==0?r(new ie(B.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(o),r(new ie(B.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new ie(B.WS_DISCONNECT);const n=()=>new we((u,h)=>{this.ws.once(it.CLOSED,()=>h(new ie(B.WS_ABORT))),this.ws.once(it.CONNECTED,u)});this.ws.state!=="connected"&&await n();const r=this.sendMessage(t),o=new we((u,h)=>{const m=()=>{h(new ie(B.WS_ABORT))};this.ws.once(it.RECONNECTING,m),this.ws.once(it.CLOSED,m),this.once("req_".concat(r),u),Si(3e3).then(()=>{this.removeAllListeners("req_".concat(r)),this.ws.off(it.RECONNECTING,m),this.ws.off(it.CLOSED,m),h(new ie(B.TIMEOUT,"cross channel ws request timeout"))})}),l=await o;if(!l||l.code!==200)throw new ie(B.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(l)));return l}async connect(t){this.ws.removeAllListeners(it.REQUEST_NEW_URLS),this.ws.on(it.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Iee extends En{set state(t){t!==this._state&&(t!==Zr.RELAY_STATE_FAILURE&&(this.errorCode=rg.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,r,o,l){super(),U(this,"joinInfo",void 0),U(this,"sid",void 0),U(this,"clientId",void 0),U(this,"cancelToken",Pr.CancelToken.source()),U(this,"workerToken",void 0),U(this,"requestId",0),U(this,"signal",void 0),U(this,"prevChannelMediaConfig",void 0),U(this,"httpRetryConfig",void 0),U(this,"_resolution",void 0),U(this,"_state",Zr.RELAY_STATE_IDLE),U(this,"errorCode",rg.RELAY_OK),U(this,"onStatus",u=>{A.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(u))),u&&u.command&&(u.command==="onAudioPacketReceived"&&this.emit("event",Wl.PACKET_RECEIVED_AUDIO_FROM_SRC),u.command==="onVideoPacketReceived"&&this.emit("event",Wl.PACKET_RECEIVED_VIDEO_FROM_SRC),u.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=rg.SRC_TOKEN_EXPIRED,this.state=Zr.RELAY_STATE_FAILURE),u.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=rg.DEST_TOKEN_EXPIRED,this.state=Zr.RELAY_STATE_FAILURE))}),U(this,"onReconnect",async()=>{A.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Wl.NETWORK_DISCONNECTED),this.state=Zr.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(u=>{this.state!==Zr.RELAY_STATE_IDLE&&(A.error("auto restart channel media relay failed",u.toString()),this.errorCode=rg.SERVER_CONNECTION_LOST,this.state=Zr.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=n,this.sid=Hh(),this.signal=new Aee(this.joinInfo,this.clientId,r),this.httpRetryConfig=o,this._resolution=l}async startChannelMediaRelay(t){if(this.state!==Zr.RELAY_STATE_IDLE)throw new ie(B.INVALID_OPERATION);this.state=Zr.RELAY_STATE_CONNECTING,await this.connect(),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new ie(B.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new ie(B.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new ie(B.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Zr.RELAY_STATE_RUNNING)throw new ie(B.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==Zr.RELAY_STATE_RUNNING)throw new ie(B.INVALID_OPERATION);const n=this.genMessage(Er.SetVideoProfile);await this.signal.request(n),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),A.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Zr.RELAY_STATE_IDLE,this.dispose()}dispose(){A.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Pr.CancelToken.source(),this.state=Zr.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await VQ(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",Wl.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(Er.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const r=this.genMessage(Er.SetSdkProfile,t);await this.signal.request(r),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const o=this.genMessage(Er.SetSourceChannel,t);await this.signal.request(o),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Wl.PACKET_JOINED_SRC_CHANNEL),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const l=this.genMessage(Er.SetSourceUserId,t);await this.signal.request(l),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const u=this.genMessage(Er.SetDestChannel,t);await this.signal.request(u),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Wl.PACKET_JOINED_DEST_CHANNEL),A.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const h=this.genMessage(Er.StartPacketTransfer,t);await this.signal.request(h),this.emit("event",Wl.PACKET_SENT_TO_DEST_CHANNEL),this.state=Zr.RELAY_STATE_RUNNING,A.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(Er.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",Wl.PACKET_UPDATE_DEST_CHANNEL),A.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(Er.StopPacketTransfer);await this.signal.request(t),A.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const r=[],o=[],l=[];this.requestId+=1;const u={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:mo,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};u.sdkVersion==="4.23.2"&&(u.sdkVersion="0.0.1");let h=null,m=null;switch(t){case Er.SetSdkProfile:return u.clientRequest={command:"SetSdkProfile",type:"multi_channel"},u;case Er.SetSourceChannel:if(m=n&&n.getSrcChannelMediaInfo(),!m)throw new ie(B.UNEXPECTED_ERROR,"can not find source config");return u.clientRequest={command:"SetSourceChannel",uid:"0",channelName:m.channelName,token:m.token||this.joinInfo.appId},u;case Er.SetSourceUserId:if(m=n&&n.getSrcChannelMediaInfo(),!m)throw new ie(B.UNEXPECTED_ERROR,"can not find source config");return u.clientRequest={command:"SetSourceUserId",uid:m.uid+""},u;case Er.SetDestChannel:if(h=n&&n.getDestChannelMediaInfo(),!h)throw new ie(B.UNEXPECTED_ERROR,"can not find dest config");return h.forEach(g=>{r.push(g.channelName),o.push(g.uid+""),l.push(g.token||this.joinInfo.appId)}),u.clientRequest={command:"SetDestChannel",channelName:r,uid:o,token:l},u;case Er.StartPacketTransfer:return u.clientRequest={command:"StartPacketTransfer"},u;case Er.Reconnect:return u.clientRequest={command:"Reconnect"},u;case Er.StopPacketTransfer:return u.clientRequest={command:"StopPacketTransfer"},u;case Er.UpdateDestChannel:if(h=n&&n.getDestChannelMediaInfo(),!h)throw new ie(B.UNEXPECTED_ERROR,"can not find dest config");return h.forEach(g=>{r.push(g.channelName),o.push(g.uid+""),l.push(g.token||this.joinInfo.appId)}),u.clientRequest={command:"UpdateDestChannel",channelName:r,uid:o,token:l},u;case Er.SetVideoProfile:u.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return u}}const Oee={name:"ChannelMediaRelay",create:function(e){return new Iee(e.joinInfo,e.clientId,e.websocketRetryConfig||Kn,e.httpRetryConfig||Kn,e.resolution)}};function B3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Yy(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?B3(Object(n),!0).forEach(function(r){U(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B3(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Nee extends En{constructor(t,n,r,o){super(),U(this,"spec",void 0),U(this,"token",void 0),U(this,"websocket",void 0),U(this,"pingpongTimer",void 0),U(this,"reconnectMode","retry"),U(this,"serviceMode",void 0),U(this,"reqId",0),U(this,"commandReqId",0),U(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),U(this,"handleWebSocketMessage",l=>{if(!l.data)return;const u=JSON.parse(l.data);u.requestId?this.emit("@".concat(u.requestId,"-").concat(u.sid),u):(xe.workerEvent(this.spec.sid,{actionType:"status",serverCode:u.code,workerType:this.serviceMode===Gl.TRANSCODE?1:2}),this.emit($u.PUBLISH_STREAM_STATUS,u))}),this.spec=n,this.token=t,this.serviceMode=o,this.websocket=new yy("live-streaming",r),this.websocket.on(it.CONNECTED,this.handleWebSocketOpen),this.websocket.on(it.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(it.REQUEST_NEW_URLS,(l,u)=>{Mi(this,$u.REQUEST_NEW_ADDRESS).then(l).catch(u)}),this.websocket.on(it.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,r,o){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const l=this.commandReqId,u=this.reqId;if(!u||!this.websocket)throw new ie(B.UNEXPECTED_ERROR);const h=Yy({command:t,sdkVersion:mo==="4.23.2"?"0.0.1":mo,seq:u,requestId:u,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new ie(B.WS_DISCONNECT);const m=()=>new we((R,b)=>{this.websocket.once(it.CLOSED,()=>b(new ie(B.WS_ABORT))),this.websocket.once(it.CONNECTED,R)});this.websocket.state!=="connected"&&await m(),h.clientRequest&&(h.clientRequest.workerToken=this.token);const g=new we((R,b)=>{const x=()=>{b(new ie(B.WS_ABORT))};this.websocket.once(it.RECONNECTING,x),this.websocket.once(it.CLOSED,x),this.once("@".concat(u,"-").concat(this.spec.sid),P=>{R(P)})});o&&xe.workerEvent(this.spec.sid,Yy(Yy({},o),{},{requestId:l,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const E=Date.now();this.websocket.sendMessage(h);let S=null;try{S=await g}catch(R){if(this.websocket.state==="closed")throw R;return await m(),await this.request(t,n,r)}return o&&xe.workerEvent(this.spec.sid,Yy(Yy({},o),{},{requestId:l,actionType:"response",payload:JSON.stringify(S.serverResponse),serverCode:S.code,success:S.code===200,responseTime:Date.now()-E})),S.code!==200&&this.handleResponseError(S),S}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=mo==="4.23.2"?"0.0.1":mo;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Qn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void A.warning("live stream response already exists stream");case Qn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Qn.LIVE_STREAM_RESPONSE_BAD_STREAM:case Qn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new ie(B.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Qn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new ie(B.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Qn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new ie(B.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Qn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new ie(B.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit($u.WARNING,n,t.serverResponse.url)}case Qn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new ie(B.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit($u.WARNING,n,t.serverResponse.url)}case Qn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new ie(B.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Qn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new ie(B.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Qn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new ie(B.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit($u.WARNING,n,t.serverResponse.url)}case Qn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new ie(B.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Qn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new ie(B.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Qn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Qn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new ie(B.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Qn.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new ie(B.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new ie(B.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Qn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Qn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Qn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Qn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new ie(B.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(jR)},6e3)}}function j3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function es(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?j3(Object(n),!0).forEach(function(r){U(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j3(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Pee extends En{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Kn,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Kn;super(),U(this,"onLiveStreamWarning",void 0),U(this,"onLiveStreamError",void 0),U(this,"spec",void 0),U(this,"retryTimeout",1e4),U(this,"connection",void 0),U(this,"httpRetryConfig",void 0),U(this,"wsRetryConfig",void 0),U(this,"streamingTasks",new Map),U(this,"isStartingStreamingTask",!1),U(this,"taskMutex",new Gi("live-streaming")),U(this,"cancelToken",Pr.CancelToken.source()),U(this,"transcodingConfig",void 0),U(this,"uapResponse",void 0),U(this,"lastTaskId",1),U(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=r,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=es(es({},_Q),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(A.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(u=>es(es(es({},gQ),u),{},{zOrder:u.zOrder?u.zOrder+1:1}))),function(u){Sn(u.width)||jt(u.width,"config.width",0,1e4),Sn(u.height)||jt(u.height,"config.height",0,1e4),Sn(u.videoBitrate)||jt(u.videoBitrate,"config.videoBitrate",1,1e6),Sn(u.videoFrameRate)||jt(u.videoFrameRate,"config.videoFrameRate"),Sn(u.lowLatency)||Vl(u.lowLatency,"config.lowLatency"),Sn(u.audioSampleRate)||ei(u.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Sn(u.audioBitrate)||jt(u.audioBitrate,"config.audioBitrate",1,128),Sn(u.audioChannels)||ei(u.audioChannels,"config.audioChannels",[1,2,3,4,5]),Sn(u.videoGop)||jt(u.videoGop,"config.videoGop"),Sn(u.videoCodecProfile)||ei(u.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Sn(u.userCount)||jt(u.userCount,"config.userCount",0,17),Sn(u.backgroundColor)||jt(u.backgroundColor,"config.backgroundColor",0,16777215),Sn(u.userConfigExtraInfo)||vi(u.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),u.transcodingUsers&&!Sn(u.transcodingUsers)&&(Fl(u.transcodingUsers,"config.transcodingUsers"),u.transcodingUsers.forEach((h,m)=>{dw(h.uid),Sn(h.x)||jt(h.x,"transcodingUser[".concat(m,"].x"),0,1e4),Sn(h.y)||jt(h.y,"transcodingUser[".concat(m,"].y"),0,1e4),Sn(h.width)||jt(h.width,"transcodingUser[".concat(m,"].width"),0,1e4),Sn(h.height)||jt(h.height,"transcodingUser[".concat(m,"].height"),0,1e4),Sn(h.zOrder)||jt(h.zOrder-1,"transcodingUser[".concat(m,"].zOrder"),0,100),Sn(h.alpha)||jt(h.alpha,"transcodingUser[".concat(m,"].alpha"),0,1,!1)})),Sn(u.watermark)||SO(u.watermark,"watermark"),Sn(u.backgroundImage)||SO(u.backgroundImage,"backgroundImage"),u.images&&!Sn(u.images)&&(Fl(u.images,"config.images"),u.images.forEach((h,m)=>{SO(h,"images[".concat(m,"]"))}))}(n);const r=[];n.images&&r.push(...n.images.map(u=>es(es(es({},vO),u),{},{zOrder:255}))),n.backgroundImage&&(r.push(es(es(es({},vO),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(r.push(es(es(es({},vO),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=r,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(u=>es({},u)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const o=(n.userConfigs||[]).map(u=>typeof u.uid=="number"?we.resolve(u.uid):lB(u.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await we.all(o)).forEach((u,h)=>{n.userConfigs&&n.userConfigs[h]&&(n.userConfigs[h].uid=u)}),this.transcodingConfig=n,this.connection)try{var l;const u=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Gs(l=this.streamingTasks).call(l)).map(h=>h.taskId).join("#")});A.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(u.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(u){if(!u.data||!u.data.retry)throw u;u.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(h=>{A.warning("[".concat(this.spec.clientId,"] live streaming receive error"),u.toString(),"try to republish",h.url),this.startLiveStreamingTask(h.url,h.mode,u).then(()=>{A.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(h.url," success"))}).catch(m=>{A.error("[".concat(this.spec.clientId,"] live streaming republish failed"),h.url,m.toString()),this.onLiveStreamError&&this.onLiveStreamError(h.url,m)})})}}async startLiveStreamingTask(t,n,r){if(!this.transcodingConfig&&n===Gl.TRANSCODE)throw new ie(B.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const o={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};A.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const l=await this.taskMutex.lock();if(!this.connection&&r)return void l();if(this.streamingTasks.get(t)&&!r)return l(),new ie(B.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(h){throw l(),h}switch(n){case Gl.TRANSCODE:o.transcodingConfig=es({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(o.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const u=this.lastTaskId++;try{const h=new we((g,E)=>{Si(this.retryTimeout).then(()=>{if(r)return E(r);const S=this.statusError.get(t);return S?(this.statusError.delete(t),E(S)):void 0})}),m=await we.race([this.connection.request("request",{clientRequest:o},!0,{url:t,command:"PublishStream",workerType:n===Gl.TRANSCODE?1:2,requestByUser:!r,tid:u.toString()}),h]);this.isStartingStreamingTask=!1,A.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(m.code)),this.streamingTasks.set(t,{clientRequest:o,mode:n,url:t,taskId:u}),l()}catch(h){if(l(),this.isStartingStreamingTask=!1,!h.data||!h.data.retry||r)throw h;return h.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,h)):await this.startLiveStreamingTask(t,n,h)}}stopLiveStreamingTask(t){return new we((n,r)=>{const o=this.streamingTasks.get(t);if(!o||!this.connection)return new ie(B.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const l=o.mode;o.abortTask=()=>{A.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:o.url}},!1,{url:t,command:"UnPublishStream",workerType:l===Gl.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(u=>{A.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(u.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(r)})}resetAllTask(){var t;const n=Array.from(Gs(t=this.streamingTasks).call(t));this.terminate();for(const r of n)this.startLiveStreamingTask(r.url,r.mode).catch(o=>{this.onLiveStreamError&&this.onLiveStreamError(r.url,o)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Pr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new ie(B.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await Mi(this,TO.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new Nee(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on($u.WARNING,(r,o)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(o,r)),this.connection.on($u.PUBLISH_STREAM_STATUS,r=>this.handlePublishStreamServer(r)),this.connection.on($u.REQUEST_NEW_ADDRESS,(r,o)=>{if(!this.connection)return o(new ie(B.UNEXPECTED_ERROR,"can not get new live streaming address list"));Mi(this,TO.REQUEST_WORKER_MANAGER_LIST,t).then(l=>{this.uapResponse=l,r(l.addressList)}).catch(o)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",r=this.streamingTasks.get(n),o=t.reason;switch(t.code){case Qn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Qn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Qn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Qn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const u=new ie(B.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(r)return A.error(u.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,u);if(!this.isStartingStreamingTask)return;this.statusError.set(n,u)}case Qn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const u=new ie(B.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,o);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,u)}case Qn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Qn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var l;if(!this.connection)return;this.connection.tryNextAddress();const u=Array.from(Gs(l=this.streamingTasks).call(l));for(const h of u)h.abortTask?h.abortTask():(A.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",h.url),this.startLiveStreamingTask(h.url,h.mode,new ie(B.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{A.debug("[".concat(this.spec.clientId,"] republish live stream success"),h.url)}).catch(m=>{A.error(m.toString()),this.onLiveStreamError&&this.onLiveStreamError(h.url,m)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const Dee={name:"LiveStreaming",create:function(e){return new Pee(e.joinInfo,e.websocketRetryConfig||Kn,e.httpRetryConfig||Kn)}};function kee(e){let t=z3();return function(n,r){let o=n.appId;o!==void 0&&(Ut(r,10),Mc(r,o));let l=n.cid;l!==void 0&&(Ut(r,16),Ut(r,l));let u=n.cname;u!==void 0&&(Ut(r,26),Mc(r,u));let h=n.deviceId;h!==void 0&&(Ut(r,34),Mc(r,h));let m=n.elapse;m!==void 0&&(Ut(r,40),dd(r,m));let g=n.fileSize;g!==void 0&&(Ut(r,48),dd(r,Sg(g)));let E=n.height;E!==void 0&&(Ut(r,56),dd(r,Sg(E)));let S=n.jpg;S!==void 0&&(Ut(r,66),Ut(r,S.length),function(Ur,le){let Se=Tg(Ur,le.length);Ur.bytes.set(le,Se)}(r,S));let R=n.networkType;R!==void 0&&(Ut(r,72),dd(r,Sg(R)));let b=n.osType;b!==void 0&&(Ut(r,80),dd(r,Sg(b)));let x=n.requestId;x!==void 0&&(Ut(r,90),Mc(r,x));let P=n.sdkVersion;P!==void 0&&(Ut(r,98),Mc(r,P));let k=n.sequence;k!==void 0&&(Ut(r,104),dd(r,Sg(k)));let V=n.sid;V!==void 0&&(Ut(r,114),Mc(r,V));let F=n.timestamp;F!==void 0&&(Ut(r,120),dd(r,F));let K=n.uid;K!==void 0&&(Ut(r,128),Ut(r,K));let $=n.vid;$!==void 0&&(Ut(r,136),Ut(r,$));let Z=n.width;Z!==void 0&&(Ut(r,144),dd(r,Sg(Z)));let J=n.service;J!==void 0&&(Ut(r,152),Ut(r,J));let re=n.callbackData;re!==void 0&&(Ut(r,162),Mc(r,re));let pe=n.jpgEncryption;pe!==void 0&&(Ut(r,168),Ut(r,pe));let Ce=n.requestType;Ce!==void 0&&(Ut(r,176),Ut(r,Ce));let Ie=n.scorePorn;Ie!==void 0&&(Ut(r,185),wN(r,Ie));let _t=n.scoreSexy;_t!==void 0&&(Ut(r,193),wN(r,_t));let Et=n.scoreNeutral;Et!==void 0&&(Ut(r,201),wN(r,Et));let Qt=n.scene;Qt!==void 0&&(Ut(r,208),Ut(r,Qt));let kn=n.ossFilePrefix;kn!==void 0&&(Ut(r,218),Mc(r,kn));let An=n.serviceVendor;if(An!==void 0)for(let Ur of An){Ut(r,226);let le=z3();Mee(Ur,le),Ut(r,le.limit),Bee(r,le),Fee(le)}}(e,t),function(n){let r=n.bytes,o=n.limit;return r.length===o?r:r.subarray(0,o)}(t)}function Lee(e){return function(n){let r={};e:for(;!H3(n);){let o=Uc(n);switch(o>>>3){case 0:break e;case 1:r.code=Uc(n);break;case 2:r.msg=K3(n,Uc(n));break;case 3:{let l=Uee(n);r.data=xee(n),n.limit=l;break}default:G3(n,7&o)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function xee(e){let t={};e:for(;!H3(e);){let n=Uc(e);switch(n>>>3){case 0:break e;case 1:t.requestId=K3(e,Uc(e));break;case 2:t.requestType=Uc(e)>>>0;break;case 3:t.scorePorn=RN(e);break;case 4:t.scoreSexy=RN(e);break;case 5:t.scoreNeutral=RN(e);break;case 6:t.requestScene=Uc(e)>>>0;break;case 7:t.scene=Uc(e)>>>0;break;default:G3(e,7&n)}}return t}function Mee(e,t){let n=e.service;n!==void 0&&(Ut(t,8),Ut(t,n));let r=e.vendor;r!==void 0&&(Ut(t,16),Ut(t,r));let o=e.token;o!==void 0&&(Ut(t,26),Mc(t,o));let l=e.callbackUrl;l!==void 0&&(Ut(t,34),Mc(t,l))}function Uee(e){let t=Uc(e),n=e.limit;return e.limit=e.offset+t,n}function G3(e,t){switch(t){case 0:for(;128&q3(e););break;case 2:SN(e,Uc(e));break;case 5:SN(e,4);break;case 1:SN(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let Vee=new Float32Array(1);new Uint8Array(Vee.buffer);let vN=new Float64Array(1),ts=new Uint8Array(vN.buffer);function Sg(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let W3=[];function z3(){const e=W3.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function Fee(e){W3.push(e)}function SN(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function H3(e){return e.offset>=e.limit}function Tg(e,t){let n=e.bytes,r=e.offset,o=e.limit,l=r+t;if(l>n.length){let u=new Uint8Array(2*l);u.set(n),e.bytes=u}return e.offset=l,l>o&&(e.limit=l),r}function TN(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function K3(e,t){let n=TN(e,t),r=String.fromCharCode,o=e.bytes,l="",u="";for(let h=0;h<t;h++){let m,g,E,S,R=o[h+n];(128&R)==0?u+=r(R):(224&R)==192?h+1>=t?u+=l:(m=o[h+n+1],(192&m)!=128?u+=l:(S=(31&R)<<6|63&m,S<128?u+=l:(u+=r(S),h++))):(240&R)==224?h+2>=t?u+=l:(m=o[h+n+1],g=o[h+n+2],(49344&(m|g<<8))!=32896?u+=l:(S=(15&R)<<12|(63&m)<<6|63&g,S<2048||S>=55296&&S<=57343?u+=l:(u+=r(S),h+=2))):(248&R)==240?h+3>=t?u+=l:(m=o[h+n+1],g=o[h+n+2],E=o[h+n+3],(12632256&(m|g<<8|E<<16))!=8421504?u+=l:(S=(7&R)<<18|(63&m)<<12|(63&g)<<6|63&E,S<65536||S>1114111?u+=l:(S-=65536,u+=r(55296+(S>>10),56320+(1023&S)),h+=3))):u+=l}return u}function Mc(e,t){let n=t.length,r=0;for(let u=0;u<n;u++){let h=t.charCodeAt(u);h>=55296&&h<=56319&&u+1<n&&(h=(h<<10)+t.charCodeAt(++u)-56613888),r+=h<128?1:h<2048?2:h<65536?3:4}Ut(e,r);let o=Tg(e,r),l=e.bytes;for(let u=0;u<n;u++){let h=t.charCodeAt(u);h>=55296&&h<=56319&&u+1<n&&(h=(h<<10)+t.charCodeAt(++u)-56613888),h<128?l[o++]=h:(h<2048?l[o++]=h>>6&31|192:(h<65536?l[o++]=h>>12&15|224:(l[o++]=h>>18&7|240,l[o++]=h>>12&63|128),l[o++]=h>>6&63|128),l[o++]=63&h|128)}}function Bee(e,t){let n=Tg(e,t.limit),r=e.bytes,o=t.bytes;for(let l=0,u=t.limit;l<u;l++)r[l+n]=o[l]}function q3(e){return e.bytes[TN(e,1)]}function Y3(e,t){let n=Tg(e,1);e.bytes[n]=t}function RN(e){let t=TN(e,8),n=e.bytes;return ts[0]=n[t++],ts[1]=n[t++],ts[2]=n[t++],ts[3]=n[t++],ts[4]=n[t++],ts[5]=n[t++],ts[6]=n[t++],ts[7]=n[t++],vN[0]}function wN(e,t){let n=Tg(e,8),r=e.bytes;vN[0]=t,r[n++]=ts[0],r[n++]=ts[1],r[n++]=ts[2],r[n++]=ts[3],r[n++]=ts[4],r[n++]=ts[5],r[n++]=ts[6],r[n++]=ts[7]}function Uc(e){let t,n=0,r=0;do t=q3(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function Ut(e,t){for(t>>>=0;t>=128;)Y3(e,127&t|128),t>>>=7;Y3(e,t)}function dd(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,o=t.high>>>24,l=o===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:o<128?9:10,u=Tg(e,l),h=e.bytes;switch(l){case 10:h[u+9]=o>>>7&1;case 9:h[u+8]=l!==9?128|o:127&o;case 8:h[u+7]=l!==8?r>>>21|128:r>>>21&127;case 7:h[u+6]=l!==7?r>>>14|128:r>>>14&127;case 6:h[u+5]=l!==6?r>>>7|128:r>>>7&127;case 5:h[u+4]=l!==5?128|r:127&r;case 4:h[u+3]=l!==4?n>>>21|128:n>>>21&127;case 3:h[u+2]=l!==3?n>>>14|128:n>>>14&127;case 2:h[u+1]=l!==2?n>>>7|128:n>>>7&127;case 1:h[u]=l!==1?128|n:127&n}}function X3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}const jee=new Map([["moderation",1],["supervise",2]]);class Gee extends En{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(mi.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=ms(n=t.map(r=>jee.get(r)||0)).call(n,(r,o)=>r+o),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),U(this,"name","AgoraRTCVideoContentInspect"),U(this,"_connectionState",Ko.CONNECTING),U(this,"_innerConnectionState",void 0),U(this,"sequence",0),U(this,"inspectStartTime",void 0),U(this,"workerManagerConnection",void 0),U(this,"workerConnection",void 0),U(this,"workerMessageLengthLimit",void 0),U(this,"inspectIntervalMinimum",void 0),U(this,"qualityRatio",void 0),U(this,"_connectInfo",void 0),U(this,"_cancelTokenSource",Pr.CancelToken.source()),U(this,"_retryConfig",void 0),U(this,"wmSequence",0),U(this,"inspectInterval",void 0),U(this,"inspectTimer",null),U(this,"ossFilePrefix",void 0),U(this,"extraInfo",void 0),U(this,"_inspectType",void 0),U(this,"_inspectMode",void 0),U(this,"_quality",1),U(this,"qualityTimer",null),U(this,"_inspectId",void 0),U(this,"_needWorkUrlOnly",!1),U(this,"inspectImage",()=>{if(this.connectionState!==Ko.CONNECTED)throw new ie(B.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Ko.CONNECTED?this.requestToInspectImage():A.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Jt(5,"inspect-"),this.workerMessageLengthLimit=G("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=G("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=G("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new yy("worker-manager-"+this._inspectId,Kn),this.on(mi.STATE_CHANGE,(n,r)=>{this._innerConnectionState=n,A.debug("[".concat(this._inspectId,"] Inspect operation :").concat(qo[n]," ").concat(r||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new yy("worker-"+this._inspectId,Kn),this.handleWorkerEvents()}async init(t,n){this.emit(mi.STATE_CHANGE,qo.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new we((o,l)=>{this.on(mi.CONNECTION_STATE_CHANGE,(u,h)=>{h===Ko.CONNECTED&&o()}),this.requestAP(t,r,n).then(u=>{this.connectWorkerManager(u)}).catch(u=>{l(u)})})}async requestAP(t,n,r){const o=G("WEBCS_DOMAIN").map(h=>"https://".concat(h,"/api/v1")),l=await function(h,m,g,E){let{appId:S,areaCode:R,cname:b,sid:x,token:P,uid:k}=m;dg++;const V="image_moderation_api",F={service_name:V,json_body:JSON.stringify({appId:S,areaCode:R,cname:b,command:"allocateEdge",requestId:dg,seq:dg,sid:x,token:P,ts:Date.now(),uid:k+""})};let K,$,Z=h[0];return Na(async()=>{K=Date.now();const J=await xa(Z,{data:F,cancelToken:g,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if($=Date.now()-K,J.code!==0){const Ie=new ie(B.UNEXPECTED_RESPONSE,"image inspect ap error, code"+J.code,{retry:!0,responseTime:$});throw A.error(Ie.toString()),Ie}const re=JSON.parse(J.json_body);if(re.code!==200){const Ie=new ie(B.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(re.code,", reason: ").concat(re.reason),{code:re.code,responseTime:$});throw A.error(Ie.toString()),Ie}if(!re.servers||!Array.isArray(re.servers)||re.servers.length===0){const Ie=new ie(B.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:re.code,responseTime:$});throw A.error(Ie.toString()),Ie}const pe=G("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Ce=G("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:re.servers.map(Ie=>{let{address:_t,wss:Et}=Ie;if(_t&&Et)return"wss://".concat(_t.replace(/\./g,"-"),".").concat(pe,":").concat(Ce||Et)}).filter(Ie=>!!Ie),workerToken:re.workerToken,vid:re.vid,responseTime:$}},(J,re)=>(xe.apworkerEvent(x,{success:!0,sc:200,serviceName:V,responseDetail:JSON.stringify(J.addressList),firstSuccess:re===0,responseTime:$,serverIp:h[re%h.length]}),!1),(J,re)=>(xe.apworkerEvent(x,{success:!1,sc:J.data&&J.data.code||200,serviceName:V,responseTime:$,serverIp:h[re%h.length]}),!!(J.code!==B.OPERATION_ABORTED&&J.code!==B.UNEXPECTED_RESPONSE||J.data&&J.data.retry)&&(Z=h[(re+1)%h.length],!0)),E)}(o,t,n,r);this.emit(mi.STATE_CHANGE,qo.AP_CONNECTED);const{addressList:u}=l;return this.wmSequence++,u}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(mi.STATE_CHANGE,qo.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(it.CONNECTED,async()=>{this.emit(mi.STATE_CHANGE,qo.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(it.CLOSED,()=>{this._innerConnectionState<qo.GET_WORKER_MANAGER_RESPONSE&&A.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(it.FAILED,()=>{this._innerConnectionState<qo.GET_WORKER_MANAGER_RESPONSE&&A.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(it.RECONNECTING,()=>{this._innerConnectionState<qo.GET_WORKER_MANAGER_RESPONSE&&A.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(it.ON_MESSAGE,async t=>{this.emit(mi.STATE_CHANGE,qo.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const r=JSON.parse(t.data);if(r.code!==200)throw A.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new ie(B.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&n))throw A.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new ie(B.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{const o=G("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,l=n.replace(/:\d+\/?$/,":".concat(o));this.emit(mi.STATE_CHANGE,qo.CONNECT_WORKER,l),this._needWorkUrlOnly?this.emit(mi.REQUEST_NEW_WORKER_URL,l):await this.connectWorker(l)}}),this.workerManagerConnection.on(it.WILL_RECONNECT,(t,n,r)=>{r(t)}),this.workerManagerConnection.on(it.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(it.CONNECTED,async()=>{this.emit(mi.STATE_CHANGE,qo.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Ko.CONNECTED}),this.workerConnection.on(it.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const r=Lee(new Uint8Array(t.data));if(G("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&A.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),r.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(mi.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var n;const o={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},l=ms(n=Object.keys(o)).call(n,(h,m)=>o[h]>o[m]?h:m,"porn"),u=Object.keys(o).find(h=>h===l);this.emit(mi.INSPECT_RESULT,u)}else this.emit(mi.INSPECT_RESULT,void 0,new ie(B.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit(mi.INSPECT_RESULT,void 0,new ie(B.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else A.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(mi.INSPECT_RESULT,void 0,new ie(B.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(it.CLOSED,()=>{this.connectionState=Ko.CLOSED}),this.workerConnection.on(it.FAILED,()=>{this.connectionState=Ko.CLOSED}),this.workerConnection.on(it.RECONNECTING,()=>{this.connectionState=this.connectionState===Ko.CONNECTED?Ko.RECONNECTING:Ko.CONNECTING}),this.workerConnection.on(it.WILL_RECONNECT,(t,n,r)=>{t==="recover"&&r(t),r("tryNext")}),this.workerConnection.on(it.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(mi.REQUEST_NEW_WORKER_URL,r=>{t([r])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r=>{this.connectWorkerManager(r,!0)}).catch(r=>{n(r)})})}async requestToInspectImage(){this.sequence++;const t=zs(this,mi.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(mi.INSPECT_RESULT,void 0,new ie(B.INVALID_OPERATION,"Only the track being played can be inspected"));const r=await this.generateRequestData(t,n);this.workerConnection.sendMessage(r,!0,!0)}else this.emit(mi.INSPECT_RESULT,void 0,new ie(B.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:r,cname:o,cid:l,vid:u,sid:h,uid:m}=n;const g=Date.now(),E=await t.getCurrentFrameImage("image/jpeg",this.quality),S=await NU(E,r,o),R=this.sequence+"-"+l+"-"+m+"-"+g+"-"+Jt(12,""),b={appId:r,cid:l,cname:o,deviceId:"",elapse:(x=Number(g-this.inspectStartTime),{low:x|=0,high:x>>31,unsigned:x>=0}),fileSize:S.byteLength,jpgEncryption:2,height:E.height,width:E.width,jpg:S,networkType:6,osType:7,requestId:R,sdkVersion:"4.23.2",sequence:this.sequence,sid:h,timestamp:ij(g),uid:m,vid:u,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var x;this.extraInfo===void 0&&delete b.callbackData,this.ossFilePrefix===void 0&&delete b.ossFilePrefix;const P=kee(b);if(P.byteLength<this.workerMessageLengthLimit){if(G("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const k=function(V){for(var F=1;F<arguments.length;F++){var K=arguments[F]!=null?arguments[F]:{};F%2?X3(Object(K),!0).forEach(function($){U(V,$,K[$])}):Object.getOwnPropertyDescriptors?Object.defineProperties(V,Object.getOwnPropertyDescriptors(K)):X3(Object(K)).forEach(function($){Object.defineProperty(V,$,Object.getOwnPropertyDescriptor(K,$))})}return V}({},b);delete k.jpg,A.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(k))}return P}{const k=this.quality*this.qualityRatio;return this.quality=k,await this.generateRequestData(t,{appId:r,cname:o,cid:l,vid:u,sid:h,uid:m})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Pr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Ko.CLOSED,this.emit(mi.STATE_CHANGE,qo.CLOSED)}}const Wee={name:"ContentInspect",create:function(e){let{config:t}=e;return function(n){if(!n)throw new ie(B.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new ie(B.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const r=[...new Set(n.inspectType)];r.forEach(o=>{var l;if(!Te(l=["supervise","moderation"]).call(l,o))throw new ie(B.INVALID_PARAMS,"".concat(o," is not a valid inspect type."))}),n.inspectType=r}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new ie(B.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new Gee(t)}};var J3=p(Rr.Object.getOwnPropertySymbols),zee=xt,Hee=k_.indexOf,Kee=dl,CN=tn([].indexOf),$3=!!CN&&1/CN([1],1,-0)<0;zee({target:"Array",proto:!0,forced:$3||!Kee("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return $3?CN(this,e,t)||0:Hee(this,e,t)}});var qee=fs("Array").indexOf,Yee=j,Xee=qee,bN=Array.prototype,Jee=function(e){var t=e.indexOf;return e===bN||Yee(bN,e)&&t===bN.indexOf?Xee:t},Q3=p(Jee);function $ee(e,t){if(e==null)return{};var n,r,o=function(u,h){if(u==null)return{};var m,g,E={},S=EF(u);for(g=0;g<S.length;g++)m=S[g],Q3(h).call(h,m)>=0||(E[m]=u[m]);return E}(e,t);if(J3){var l=J3(e);for(r=0;r<l.length;r++)n=l[r],Q3(t).call(t,n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}let Z3=class{get localCapabilities(){return Rn(this._localCapabilities)}get rtpCapabilities(){return Rn(this._rtpCapabilities)}get candidates(){return Rn(this._candidates)}get iceParameters(){return Rn(this._iceParameters)}get dtlsParameters(){return Rn(this._dtlsParameters)}constructor(e){U(this,"sessionDesc",void 0),U(this,"_localCapabilities",void 0),U(this,"_rtpCapabilities",void 0),U(this,"_candidates",void 0),U(this,"_iceParameters",void 0),U(this,"_dtlsParameters",void 0),U(this,"setup",void 0),U(this,"currentMidIndex",void 0),U(this,"cname","o/i14u9pJrxRKAsu"),U(this,"firefoxSsrcMidMap",new Map),e=Rn(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:o,localCapabilities:l,direction:u,setup:h,videoCodec:m,audioCodec:g}=e;let E;this.setup=h,E=u===_r.RECEIVE_ONLY?Qr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Qr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=o,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=l;const S=u===_r.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,R=u===_r.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,b=u===_r.RECEIVE_ONLY?o.send.videoCodecs:Ty(Pe.VIDEO,S,R,m),x=u===_r.RECEIVE_ONLY?o.send.audioCodecs:Ty(Pe.AUDIO,S,R,g);for(const P of E.mediaDescriptions)P.attributes.iceUfrag=t.iceUfrag,P.attributes.icePwd=t.icePwd,P.attributes.fingerprints=n.fingerprints,P.attributes.candidates=r,P.attributes.setup=this.setup,P.media.mediaType==="application"&&(P.attributes.sctpPort="5000"),P.media.mediaType==="video"&&(P.media.fmts=b.map(k=>k.payloadType.toString(10)),P.attributes.payloads=b,P.attributes.extmaps=S.videoExtensions),P.media.mediaType==="audio"&&(P.media.fmts=x.map(k=>k.payloadType.toString(10)),P.attributes.payloads=x,P.attributes.extmaps=S.audioExtensions,ug(P));this.sessionDesc=E,this.currentMidIndex=E.mediaDescriptions.length-1}toString(){return Ju(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,r,o){n=n.replace(/ /g,"-");const{ssrcs:l,ssrcGroups:u}=ep(t,this.cname,G("SYNC_GROUP")?n:void 0),h=this.findPreloadMediaDesc(l);if(h){if(vn()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,h.attributes.mid),o&&(o.twcc||o.remb)){const m=this.sessionDesc.mediaDescriptions.indexOf(h);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(h,o),{mid:h.attributes.mid,needExchangeSDP:!0}}return{mid:h.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(e,l,r);let g;return m===-1?(g=this.createOrRecycleSendMedia(e,l,u,"sendonly",r,o),this.updateBundleMids()):(g=Rn(this.sessionDesc.mediaDescriptions[m]),g.attributes.direction="sendonly",g.attributes.ssrcs=l,g.attributes.ssrcGroups=u,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(g,o)),vn()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,g.attributes.mid),{needExchangeSDP:!0,mid:g.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){const r=[];return e.forEach(o=>{const l=o._mediaStreamTrack.kind,u=this.findAvailableRecvMediaIndex(l);let h,m=!1;u===-1?(m=!0,h=this.createOrRecycleRecvMedia(o,[],"recvonly",t,n),this.updateBundleMids()):(h=Rn(this.sessionDesc.mediaDescriptions[u]),h.attributes.direction="recvonly"),r.push({mid:h.attributes.mid,needCreateTransceiver:m})}),r}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:r,port:o,type:l,relatedAddress:u,relatedPort:h,priority:m}=new RTCIceCandidate(e),g={foundation:t??"",componentId:"1",transport:n??"",priority:m?m+"":"",connectionAddress:r??"",port:o?o+"":"",type:l?l+"":"",relAddr:u??"",relPort:h?h+"":"",extension:{}};this.candidates.some(E=>E.priority===g.priority&&E.connectionAddress===g.connectionAddress&&E.port===g.port)||(this._candidates.push(g),this.sessionDesc.mediaDescriptions.forEach(E=>{E.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,r,o){const l=e._mediaStreamTrack.kind,u=this.rtpCapabilities.recv,h=Ty(l,u,this.localCapabilities.send,l===Pe.AUDIO?o:r),m=l===Pe.VIDEO?u.videoExtensions:u.audioExtensions,g="".concat(++this.currentMidIndex);let E={media:{mediaType:l,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};E=this.mungRecvMediaDsec(E,e);const S=this.findFirstClosedMedia(l);if(S){const R=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[R]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>Te(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>Te(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const o=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(vn()){if(o){const l=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(l||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!l||l!==r.attributes.mid)}return!1}return o&&r.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{const n=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&n})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=Rn(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,r,o,l){const u=this.rtpCapabilities.send,h=e===Pe.VIDEO?u.videoCodecs:u.audioCodecs,m=e===Pe.VIDEO?u.videoExtensions:u.audioExtensions;vn()&&(o="".concat(++this.currentMidIndex));let g={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:o}};g=this.mungSendMediaDesc(g,l);const E=this.findFirstClosedMedia(e);if(E){const S=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[S]=g}else this.sessionDesc.mediaDescriptions.push(g);return g}mungRecvMediaDsec(e,t,n){const r=Rn(e);return AO(r),lg(r,t),IO(r,t),WF(r),Ew(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=Rn(e);return Ew(n,t,this.localCapabilities.recv),ug(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(n!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=r}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>vn()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}};const Qee=["sdp"];var nn;function e4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function hd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?e4(Object(n),!0).forEach(function(r){U(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):e4(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let t4=(nn=class bg extends wF{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,r){super(t,n),U(this,"direction",void 0),U(this,"name",void 0),U(this,"store",void 0),U(this,"spec",void 0),U(this,"peerConnection",void 0),U(this,"initialOffer",void 0),U(this,"transport",void 0),U(this,"statsFilter",void 0),U(this,"localCandidateCount",0),U(this,"_isInRestartIce",!1),U(this,"mutex",void 0),U(this,"onLocalCandidate",void 0),U(this,"remoteSDP",void 0),U(this,"pendingCandidates",[]),U(this,"localCapabilities",void 0),U(this,"isReady",!1),U(this,"restartCnt",0),U(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new Gi("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(bg.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=r??_r.SEND_ONLY,this.name=this.direction===_r.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=jI(this.peerConnection,G("STATS_UPDATE_INTERVAL"),void 0,vn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const n=await HF();if(this.localCapabilities=yw(n),t){const{sdp:r}=t,o=$ee(t,Qee),l=function(){const E={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},S=Sy(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),R={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},x={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Yo(S,E,"videoExtensions",R,b,x),Yo(S,E,"videoCodecs",R,b,x),Yo(S,E,"audioExtensions",R,b,x),Yo(S,E,"audioCodecs",R,b,x),G("RAISE_H264_BASELINE_PRIORITY")){const P=x.videoCodecs.findIndex(k=>k.rtpMap&&k.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&k.fmtp&&k.fmtp.parameters["profile-level-id"]==="42001f");if(P!==-1){const k=x.videoCodecs.findIndex(V=>V.rtpMap&&V.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(k<P){A.debug("raising H264 baseline profile priority");const V=x.videoCodecs[P];x.videoCodecs.splice(P,1),x.videoCodecs.splice(k,0,V)}k!==-1&&G("FILTER_SEND_H264_BASELINE")&&(R.videoCodecs=R.videoCodecs.filter(V=>!(V.rtpMap&&V.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&V.fmtp&&V.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:R,recv:b,sendrecv:x}}({},{},r);this.remoteSDP=new Z3({remoteIceParameters:o.iceParameters,remoteDtlsParameters:o.dtlsParameters,candidates:[],remoteRTPCapabilities:l,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const u=await this.peerConnection.createAnswer();if(!u.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const h=td(u.sdp);await this.peerConnection.setLocalDescription(u);const m=await KF({},{},u.sdp);this.localCapabilities=yw(m);const g=this.peerConnection.getTransceivers()[0];return g!=null&&g.receiver&&g.receiver.transport&&this.tryBindTransportEvents(g.receiver.transport),hd(hd({},h),{},{sdp:u.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const o=td(r.sdp);return this.initialOffer=r,hd(hd({},o),{},{sdp:r.sdp})}}catch(n){throw new oe(B.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:r,dtlsParameters:o}=t,l=await KF({},{},n);this.remoteSDP=new Z3({remoteIceParameters:r,remoteDtlsParameters:o,candidates:[],remoteRTPCapabilities:l,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const u=this.peerConnection.getTransceivers()[0];u!=null&&u.sender&&u.sender.transport&&this.tryBindTransportEvents(u.sender.transport)}catch(n){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new oe(B.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(t,n,r){var o=this;return fo(function*(){const l=yield St(o.mutex.lock("From P2PConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=[],h=o.remoteSDP.receive(t,n,r);t.forEach((k,V)=>{if(h[V].needCreateTransceiver){const F=o.peerConnection.addTransceiver(k._mediaStreamTrack,{direction:"sendonly"});u.push(F),k._updateRtpTransceiver(F)}else{const F=o.peerConnection.getTransceivers().find(K=>K.mid===h[V].mid);if(!F)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(h[V].mid));u.push(F),k._updateRtpTransceiver(F)}}),vn()&&G("SIMULCAST")===!0&&(yield St(o.applySimulcastForFirefox(u,t)));const m=h.map(k=>k.mid),g=yield St(o.peerConnection.createOffer()),E=o.mungSendOfferSDP(g.sdp,t,m),S=Qr(E),R=m.map(k=>{const V=S.mediaDescriptions.find(F=>F.attributes.mid===k);if(!V)throw new Error("Cannot extract ssrc from mediaDescription.");return BF(V,G("USE_PUB_RTX"))}),b=u.map((k,V)=>{const F=m[V];return{localSSRC:R[V],id:F}});yield St(o.peerConnection.setLocalDescription({type:"offer",sdp:E}));try{yield b}catch(k){const V=o.remoteSDP.toString();throw yield St(o.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield St(o.peerConnection.setRemoteDescription({type:"answer",sdp:V})),yield St(o.stopSending(m,!0)),k}yield St(o.applySimulcastEncodings(u,t)),yield St(o.applySendEncodings(u,t));const x=o.remoteSDP.toString(),P=o.logSDPExchange(E,"offer","local","send");return P==null||P(x),yield St(o.setRemoteDescription({type:"answer",sdp:x})),u.map((k,V)=>{const F=m[V];return{localSSRC:R[V],id:F}})}catch(u){throw u instanceof oe?u:new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{l()}})()}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const o=this.peerConnection.getTransceivers().filter(m=>t.indexOf(m.mid)!==-1);if(o.length!==t.length)throw new Error("Transceivers' length (".concat(o.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));o.map(m=>{var g;m.direction="inactive",(g=m.stop)===null||g===void 0||g.call(m)});const l=await this.peerConnection.createOffer(),u=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);const h=this.remoteSDP.toString();u==null||u(h),await this.setRemoteDescription({type:"answer",sdp:h})}catch(o){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}finally{r&&r()}}async receive(t,n,r,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:u}=this.remoteSDP.send(t,n,r,o);if(u){const m=this.remoteSDP.toString(),g=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const E=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(E.sdp,l,t);g==null||g(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),A.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else A.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const h=this.peerConnection.getTransceivers().find(m=>m.mid===l);if(!h||h.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,mid:h.mid,transceiver:h}}catch(l){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async mockReceive(t,n,r,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:l,needExchangeSDP:u}=this.remoteSDP.send(t,n,r,o);if(u){const h=this.remoteSDP.toString(),m=this.logSDPExchange(h,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:h});const g=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(g.sdp,l,t);m==null||m(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),A.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else A.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(l){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();r==null||r(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===Kh.Auto&&(this.store.p2pTransport=Kh.SdRtn,bt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(bg.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,bt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(bg.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:r}=td(n.sdp);return this.store.descriptionStart(),this.direction===_r.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),r}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===_r.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:r}=td(n.sdp);return await this.peerConnection.setLocalDescription(n),r}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const l=this.remoteSDP.toString(),u=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),u==null||u(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new oe(B.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter(o=>o.mid===t);r.length===1&&(this.isVP8Simulcast(n)?vn()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find(o=>o.mid===n);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:r,remote:o}=n.getSelectedCandidatePair();return{local:hd(hd({},Rc),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:hd(hd({},Rc),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;Te(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var n;t.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else A.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const o={iceServers:[]};var l;return t.iceServers?o.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(cy(t.turnServer.servers)?o.iceServers=t.turnServer.servers:(o.iceServers&&o.iceServers.push(...bg.turnServerConfigToIceServers(t.turnServer.servers,n,r)),G("USE_TURN_SERVER_OF_GATEWAY")&&o.iceServers&&t.turnServer.serversFromGateway&&o.iceServers.push(...bg.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,r)),Te(l=[Kh.Relay,Kh.SdRtn]).call(l,n)&&(o.iceTransportPolicy="relay"),G("FORCE_TURN_TCP")?o.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(u=>{u.forceturn&&(o.iceTransportPolicy="relay")}))),G("ENABLE_ENCODED_TRANSFORM")&&bt().supportWebRTCEncodedTransform&&(o.encodedInsertableStreams=!0),A.debug("P2PConnection p2pTransport is ".concat(n)),o}static turnServerConfigToIceServers(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const o=[],l=t.filter(h=>h.tcpport);A.debug("P2PConnection turnServers is ".concat(l,", current index is ").concat(r));const u=l.length>r?l[r]:l[0];switch(n){case Kh.SdRtn:const h=t.filter(g=>{var E;return Te(E=g.username).call(E,"glb:")&&g.turnServerURL==g.turnServerURL}),m=h.length>r?h[r]:h[0];m&&(o.push({username:m.username,credential:m.password,credentialType:"password",urls:"turn:".concat(Zu(m.turnServerURL),":").concat(m.tcpport,"?transport=udp")}),o.push({username:m.username,credential:m.password,credentialType:"password",urls:"turns:".concat(Zu(m.turnServerURL),":").concat(m.tcpport,"?transport=tcp")}));break;case Kh.Relay:u&&(o.push({username:u.username,credential:u.password,credentialType:"password",urls:"turn:".concat(u.turnServerURL,":").concat(u.tcpport,"?transport=udp")}),o.push({username:u.username,credential:u.password,credentialType:"password",urls:"turns:".concat(Zu(u.turnServerURL),":").concat(u.tcpport,"?transport=tcp")}));break;default:u&&(o.push({username:u.username,credential:u.password,credentialType:"password",urls:"turn:".concat(u.turnServerURL,":").concat(u.tcpport,"?transport=udp")}),o.push({username:u.username,credential:u.password,credentialType:"password",urls:"turns:".concat(Zu(u.turnServerURL),":").concat(u.tcpport,"?transport=tcp")}),o.push({username:u.username,credential:u.password,credentialType:"password",urls:"stun:".concat(u.turnServerURL,":").concat(u.tcpport)}))}return o}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var r;t!=null&&t.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,t.state))},t.onerror=r=>{var o;(o=this.onDTLSTransportError)===null||o===void 0||o.call(this,"error"in r?r.error:r)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const r=t==null?void 0:t.iceTransport.state;var o;r&&((o=this.onICETransportStateChange)===null||o===void 0||o.call(this,r))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:r,remote:o}=n.getSelectedCandidatePair();A.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol}),", remote ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var r;if(n||(n=this.peerConnection.getSenders().find(E=>E.track===t._mediaStreamTrack)),!n)return A.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return A.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!bt().supportSetRtpSenderParameters)return A.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const o={},l={};switch(t._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;default:o.degradationPreference="balanced"}if(t._encoderConfig){var u;const{bitrateMax:E,frameRate:S,scaleResolutionDownBy:R}=t._encoderConfig;E&&(l.maxBitrate=1e3*E),Te(u=t._hints).call(u,$t.LOW_STREAM)&&(S&&(l.maxFramerate=Rs(S)),R&&R>=1&&(l.scaleResolutionDownBy=R))}if(G("DSCP_TYPE")&&Ul()){var h;const E=G("DSCP_TYPE");Te(h=["very-low","low","medium","high"]).call(h,E)&&(l.networkPriority=E)}const m=n.getParameters(),g=(r=m.encodings)===null||r===void 0?void 0:r[0];vn()&&!g&&(o.encodings=[l]),g&&Object.assign(g,l),Object.assign(m,o),A.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await n.setParameters(m)}async applySendEncodings(t,n){try{if(!bt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const o=t[r],l=n[r];l instanceof an&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,o.sender)}}catch{A.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,r){const o=Qr(t);return n.forEach((l,u)=>{const h=r[u],m=o.mediaDescriptions.find(g=>g.attributes.mid===h);m&&(lg(m,l),zF(m,l,this.store.codec))}),Ju(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let m=0;m<t.length;m++){var r,o,l,u,h;const g=t[m],E=n[m];if(E instanceof an&&!Te(r=E._hints).call(r,$t.LOW_STREAM)&&(o=E._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((l=E._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(u=E._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=E._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1&&this.store.codec==="vp8"){const S={},R={high:1e3*(E._encoderConfig.bitrateMax-50),medium:5e4};S.encodings=[{rid:"m",active:!0,maxBitrate:R.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:R.high}];const b=g.sender.getParameters();await g.sender.setParameters(Object.assign(b,S))}}}async applySimulcastEncodings(t,n){if(!vn()&&t.length===n.length)for(let r=0;r<t.length;r++){const o=n[r];if(o instanceof an&&this.isVP8Simulcast(o)){const l=t[r],u={},h={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};u.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:h.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:h.medium,scaleResolutionDownBy:4}];const m=l.sender.getParameters();await l.sender.setParameters(Object.assign(m,u))}}}isVP8Simulcast(t){var n,r,o,l,u;return!!(t instanceof an&&G("SIMULCAST")&&this.store.codec==="vp8"&&!Te(n=t._hints).call(n,$t.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((o=t._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=t._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1)}logSDPExchange(t,n,r,o){if(G("SDP_LOGGING"))return A.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(o,`
`),t),n==="offer"?l=>{this.logSDPExchange(l,"answer",r==="local"?"remote":"local",o)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(u=>u.mid&&t.indexOf(u.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(u=>{u.direction="inactive"});const r=await this.peerConnection.createOffer(),o=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const l=this.remoteSDP.toString();o==null||o(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(u=>u.mid&&t.indexOf(u.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async u=>{u.direction="sendonly"});const r=await this.peerConnection.createOffer(),o=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);const l=this.remoteSDP.toString();o==null||o(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(n){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(t,n){var r,o;if(n=(r=n)!==null&&r!==void 0?r:(o=this.currentRemoteDescription)===null||o===void 0?void 0:o.sdp){var l;const u=(l=Qr(n).mediaDescriptions.find(h=>h.attributes.mid===t))===null||l===void 0?void 0:l.attributes.ssrcs;return u==null?void 0:u[0].ssrcId}}async setRemoteDescription(t){var n;await this.peerConnection.setRemoteDescription(t),Te(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,n,r){const o=Qr(t),l=o.mediaDescriptions.find(u=>u.attributes.mid===n);return l&&r===Pe.AUDIO&&l.media.mediaType==="audio"&&ug(l),Ju(o)}},ke(nn.prototype,"establish",[Zo],Object.getOwnPropertyDescriptor(nn.prototype,"establish"),nn.prototype),ke(nn.prototype,"connect",[Zo],Object.getOwnPropertyDescriptor(nn.prototype,"connect"),nn.prototype),ke(nn.prototype,"receive",[Zo],Object.getOwnPropertyDescriptor(nn.prototype,"receive"),nn.prototype),ke(nn.prototype,"mockReceive",[Zo],Object.getOwnPropertyDescriptor(nn.prototype,"mockReceive"),nn.prototype),ke(nn.prototype,"stopReceiving",[Zo],Object.getOwnPropertyDescriptor(nn.prototype,"stopReceiving"),nn.prototype),ke(nn.prototype,"restartICE",[Zo],Object.getOwnPropertyDescriptor(nn.prototype,"restartICE"),nn.prototype),ke(nn.prototype,"close",[Zo],Object.getOwnPropertyDescriptor(nn.prototype,"close"),nn.prototype),ke(nn.prototype,"updateEncoderConfig",[Zo],Object.getOwnPropertyDescriptor(nn.prototype,"updateEncoderConfig"),nn.prototype),ke(nn.prototype,"updateSendParameters",[Zo],Object.getOwnPropertyDescriptor(nn.prototype,"updateSendParameters"),nn.prototype),ke(nn.prototype,"replaceTrack",[Zo],Object.getOwnPropertyDescriptor(nn.prototype,"replaceTrack"),nn.prototype),ke(nn.prototype,"muteLocal",[Zo],Object.getOwnPropertyDescriptor(nn.prototype,"muteLocal"),nn.prototype),ke(nn.prototype,"unmuteLocal",[Zo],Object.getOwnPropertyDescriptor(nn.prototype,"unmuteLocal"),nn.prototype),nn);function Zo(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,l=await o.lock("From P2PConnection.".concat(t));try{for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return await r.apply(this,h)}finally{l()}},n}let Ua=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var n4,i4,r4,s4,o4,a4,c4,l4,u4,d4,h4,mn;function p4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function tC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?p4(Object(n),!0).forEach(function(r){U(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p4(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Zee=(n4=Va(Ua.SEND_ONLY),i4=Va(Ua.SEND_ONLY),r4=Va(),s4=Va(Ua.RECEIVE_ONLY),o4=Va(Ua.RECEIVE_ONLY),a4=Va(Ua.RECEIVE_ONLY),c4=Va(Ua.RECEIVE_ONLY),l4=Va(Ua.RECEIVE_ONLY),u4=Va(Ua.RECEIVE_ONLY),d4=Va(),h4=Va(Ua.RECEIVE_ONLY),mn=class extends En{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(je.StateChange,t,this._state)}constructor(e,t){super(),U(this,"isPlanB",!1),U(this,"store",void 0),U(this,"statsUploader",void 0),U(this,"sendConnection",void 0),U(this,"recvConnection",void 0),U(this,"localTrackMap",new Map),U(this,"remoteUserMap",new Map),U(this,"localDataChannels",[]),U(this,"pendingLocalTracks",[]),U(this,"pendingRemoteTracks",[]),U(this,"statsCollector",void 0),U(this,"dtlsFailedCount",0),U(this,"sendMutex",void 0),U(this,"recvMutex",void 0),U(this,"_state",Lt.Disconnected),U(this,"_restartStates",["disconnected","failed"]),U(this,"reconnectInterval",void 0),U(this,"uploadUnplinkStarted",!1),U(this,"uploadDownlinkStarted",!1),U(this,"uplinkStateUploadInterval",void 0),U(this,"downlinkStatsUploadInterval",void 0),U(this,"handleMuteLocalTrack",async(n,r,o)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Lt.Connected)return void o(new oe(B.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const m=this.filterTobeMutedTracks(n);if(m.length===0)return void r();const g=m.find(b=>b[0]==="videoLowTrack");g&&g[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(m.map(b=>{let[,{id:x}]=b;return x}));let E=!1;var u,h;n.trackMediaType==="video"?E=!((u=this.localTrackMap.get(he.LocalAudioTrack))===null||u===void 0||!u.track._muted):E=((h=this.localTrackMap.get(he.LocalVideoTrack))===null||h===void 0?void 0:h.id)===void 0;const S=this.createMuteMessage(m);await Xt(this,je.RequestMuteLocal,S);const R=n.trackMediaType==="video"?Qu.MUTE_LOCAL_VIDEO:Qu.MUTE_LOCAL_AUDIO;await Xt(this,je.RequestP2PMuteLocal,{action:R,message:S,isMuteAll:E}),r()}catch(m){o(m)}finally{l()}}),U(this,"handleUnmuteLocalTrack",async(n,r,o)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Lt.Connected)return void o(new oe(B.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const u=this.filterTobeUnmutedTracks(n);if(u.length===0)return void r();await this.sendConnection.unmuteLocal(u.map(g=>{let[,{id:E}]=g;return E}));const h=this.createUnmuteMessage(u),m=n.trackMediaType==="video"?Qu.UNMUTE_LOCAL_VIDEO:Qu.UNMUTE_LOCAL_AUDIO;await Xt(this,je.RequestP2PMuteLocal,{action:m,message:h}),r()}catch(u){o(u)}finally{l()}}),U(this,"handleUpdateVideoEncoder",async(n,r,o,l)=>{let u;typeof l=="boolean"&&l||(u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const m=this.localTrackMap.get(he.LocalVideoTrack);if(!this.sendConnection||!m||m.track!==n||this.state!==Lt.Connected)return void r();const{id:g,track:E}=m;g&&(await this.sendConnection.updateSendParameters(g,E),await this.sendConnection.updateEncoderConfig(g,E),this.emit(je.UpdateVideoEncoder,E)),r()}catch(m){o(m)}finally{var h;(h=u)===null||h===void 0||h()}}),U(this,"handleUpdateVideoSendParameters",async(n,r,o)=>{const l=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const u=this.localTrackMap.get(he.LocalVideoTrack);if(!this.sendConnection||!u||u.track!==n||this.state!==Lt.Connected)return void r();const{id:h,track:m}=u;h&&await this.sendConnection.updateSendParameters(h,m),r()}catch(u){o(u)}finally{l()}}),U(this,"handleReplaceTrack",async(n,r,o,l)=>{let u;A.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof l=="boolean"&&l||(u=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var h;const g=Array.from(this.localTrackMap.entries()).find(E=>{let[,{track:S}]=E;return n===S});if(!this.sendConnection||!g||g[1].id===void 0||this.state!==Lt.Connected)return void r();if(await((h=this.sendConnection)===null||h===void 0?void 0:h.replaceTrack(n,g[1].id)),g[0]===he.LocalVideoTrack&&bt().supportDualStreamEncoding){const E=this.localTrackMap.get(he.LocalVideoLowTrack);if(E){const S=n._mediaStreamTrack.clone();E.track._originMediaStreamTrack.stop(),E.track._mediaStreamTrack=S,E.track._originMediaStreamTrack=S,await new we((R,b)=>{this.handleReplaceTrack(E.track,R,b,!0)})}}r()}catch(g){o(g)}finally{var m;(m=u)===null||m===void 0||m()}}),U(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),U(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),U(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),U(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new PB(e),this.bindStatsUploaderEvents(),this.sendMutex=new Gi("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Gi("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},G("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new oe(B.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new oe(B.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(A.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new t4(e,this.store,_r.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const r=await this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=Lt.New,this.sendConnection&&(A.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new t4(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const r=await this.sendConnection.establish();return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new oe(B.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Lt.Connected}async addRemoteCandidate(e,t){if(t===_r.RECEIVE_ONLY){if(!this.sendConnection)throw new oe(B.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new oe(B.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var r=this;return fo(function*(){const o=yield St(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==Lt.Connected){r.throwIfTrackTypeNotMatch(e);const g=e.filter(E=>r.pendingLocalTracks.indexOf(E)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(g))}r.store.pubId=r.store.pubId+1,Hi.markPublishStart(r.store.clientId,r.store.pubId);const l=r.filterTobePublishedTracks(e,t,n);if(l.length===0)return void(yield St(r.tryToUnmuteAudio(e)));l.forEach(g=>{let{track:E,type:S}=g;const R=Date.now();r.store.publish(E.getTrackId(),S===he.LocalAudioTrack?"audio":"video",R)}),r.bindLocalTrackEvents(l);const u=yield St(r.sendConnection.send(l.map(g=>{let{track:E}=g;return E}),r.store.codec,r.store.audioCodec)),h=(yield St(u.next())).value,m=r.createGatewayPublishMessage(l,h);try{yield m}catch(g){throw u.throw(g),(g==null?void 0:g.code)===B.WS_ABORT&&l.forEach(E=>{let{track:S}=E;r.pendingLocalTracks.indexOf(S)===-1&&r.pendingLocalTracks.push(S)}),r.unbindLocalTrackEvents(l),g}yield St(u.next()),l.forEach(g=>{let{type:E}=g;r.statsCollector.addLocalStats(E)}),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(l,h),l.forEach(g=>{let{track:E,type:S}=g;const R=Date.now();r.store.publish(E.getTrackId(),S===he.LocalAudioTrack?"audio":"video",void 0,R)}),r.startUploadUplinkState()}finally{o()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Lt.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(o=>!Te(e).call(e,o)));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(o=>o[0]==="videoLowTrack");n&&n[1].track.close();const r=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(o=>{let[,{id:l}]=o;return l})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(o=>{let[l,{track:u}]=o;return{type:l,track:u}})),t.forEach(o=>{let[l]=o;this.statsCollector.removeLocalStats(l)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Lt.Connected)return n&&n[1].track.close(),r;e.forEach(o=>{const l=this.pendingLocalTracks.indexOf(o);l!==-1&&this.pendingLocalTracks.splice(l,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],n=[];Array.from(this.localTrackMap.entries()).forEach(r=>{let[o,{track:l,ssrcs:u}]=r;const h={stream_type:zQ(l,o),ssrcs:u};l._muted||!l._enabled?t.push(h):n.push(h)}),t.length>0&&t.forEach(r=>{Xt(this,je.RequestMuteLocal,[r])}),n.length>0&&n.forEach(r=>{Xt(this,je.RequestUnmuteLocal,[r])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return fo(function*(){throw new oe(B.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(A.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Mi(this,je.RequestRePublish,this.pendingLocalTracks),this.emit(je.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new oe(B.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,r){var o;if(!this.recvConnection)throw new oe(B.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((o=this.remoteUserMap.get(e))!==null&&o!==void 0&&o.has(t))return;const{track:l,mid:u,transceiver:h}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),r);t===Pe.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(l):(e._audioTrack=new tg(l,e.uid,e._uintid,this.store),A.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),h&&e._audioTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(l):(e._videoTrack=new eg(l,e.uid,e._uintid,this.store),A.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),h&&e._videoTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._videoTrack));const m=this.remoteUserMap.get(e);m?m.set(t,u):this.remoteUserMap.set(e,new Map([[t,u]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const g=this.pendingRemoteTracks.findIndex(E=>{let{user:S,kind:R}=E;return S.uid===e.uid&&t===R});g!==-1&&(this.pendingRemoteTracks.splice(g,1),this.emit(je.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,r){if(!this.recvConnection)throw new oe(B.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),r)}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter(l=>{let{user:u,kind:h}=l;return t!==void 0?u.uid===e.uid&&t===h:u.uid===e.uid});if(r.forEach(l=>{const u=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(u,1)}),this.recvConnection||n||r.forEach(l=>{let{kind:u}=l;var h;if(u===Pe.AUDIO)(h=e._audioTrack)===null||h===void 0||h._destroy(),e._audioTrack=void 0;else if(u===Pe.VIDEO){var m;(m=e._videoTrack)===null||m===void 0||m._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const o=this.filterTobeUnSubscribedTracks(e,t);o.length!==0&&(await this.recvConnection.stopReceiving(o.map(l=>{let[,{id:u}]=l;return u})),this.withdrawRemoteTracks(o),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),o.forEach(l=>{let[u,{kind:h}]=l;var m,g;if(h===Pe.VIDEO&&u._videoSSRC&&((m=this.recvConnection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===Pe.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),n||((g=u._videoTrack)===null||g===void 0||g._destroy(),u._videoTrack=void 0);else if(h===Pe.AUDIO){var E;this.unbindRemoteTrackEvents(u._audioTrack),!n&&((E=u._audioTrack)===null||E===void 0||E._destroy(),u._audioTrack=void 0)}}),o.forEach(l=>{let[,{kind:u}]=l;Xt(this,je.RequestP2PMuteRemote,u)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,n]=t;[Pe.VIDEO,Pe.AUDIO].forEach(r=>{n.has(r)?Xt(this,je.RequestP2PUnmuteRemote,r):Xt(this,je.RequestP2PMuteRemote,r)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new oe(B.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new oe(B.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new oe(B.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new oe(B.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void A.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void A.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===Pe.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void A.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||A.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(he.LocalAudioTrack);if((t==null?void 0:t.track)instanceof $n){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[o]=r;return o!==he.LocalAudioTrack}).filter(r=>{let[o]=r;return!(e&&o===he.LocalVideoLowTrack)}).map(r=>{let[,{track:o}]=r;return o}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(e&&r===he.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}reportPublishEvent(e,t,n,r,o){if(e){const u=this.localTrackMap.get(he.LocalAudioTrack),h=r?this.localTrackMap.get(he.LocalVideoLowTrack):this.localTrackMap.get(he.LocalVideoTrack);xe.publish(this.store.sessionId,{eventElapse:Hi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:u==null?void 0:u.track.getTrackLabel(),videoName:h==null?void 0:h.track.getTrackLabel(),screenshare:(h==null?void 0:h.track._hints.indexOf($t.SCREEN_TRACK))!==-1,audio:!!u,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}else{var l;n||(n=[]);const u=n.find(m=>m instanceof bn),h=r?(l=this.localTrackMap.get(he.LocalVideoTrack))===null||l===void 0?void 0:l.track:n.find(m=>m instanceof an);xe.publish(this.store.sessionId,{eventElapse:Hi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:u==null?void 0:u.getTrackLabel(),videoName:h==null?void 0:h.getTrackLabel(),screenshare:(h==null?void 0:h._hints.indexOf($t.SCREEN_TRACK))!==-1,audio:!!u,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}}reportSubscribeEvent(e,t,n,r){const o=r===Pe.VIDEO?n._videoSSRC:n._audioSSRC;o&&xe.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Pe.VIDEO,audio:r===Pe.AUDIO,peerid:n.uid,subscribeRequestid:r===Pe.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Hi.measureFromSubscribeStart(this.store.clientId,o)})}reset(){A.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Gi("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Gi("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(he.LocalAudioTrack);if((e==null?void 0:e.track)instanceof $n){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Lt.Disconnected}getStats(e){var t,n;return e?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(he.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(he.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof an||t&&t.track instanceof bn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(Ks(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(he.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=KE(e).call(e,(n,r)=>n.level-r.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(A.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Lt.Reconnecting,G("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case he.LocalVideoTrack:Te(t=r._hints).call(t,$t.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case he.LocalAudioTrack:r instanceof $n?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case he.LocalVideoLowTrack:}}),this.emit(je.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Ks(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(je.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),A.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:o}=n;if((e instanceof id?e.uid:e)===r.uid&&t===o)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,r;if(e===_r.SEND_ONLY){if(!this.sendConnection)throw new oe(B.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new oe(B.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){const o=await r.restartICE(t);return r.isInRestartIce=!1,o}{const o=await r.restartICE();if(o){const l=await Mi(this,je.RequestP2PRestartICE,{direction:_r.RECEIVE_ONLY,iceParameter:o});await r.restartICE(l),r.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(he.LocalVideoTrack),n=this.localTrackMap.get(he.LocalAudioTrack),r=e.videoSend.find(b=>{var x;return b.ssrc===(t==null||(x=t.ssrcs)===null||x===void 0?void 0:x[0].ssrcId)}),o=e.audioSend.find(b=>{var x;return b.ssrc===(n==null||(x=n.ssrcs)===null||x===void 0?void 0:x[0].ssrcId)});if(!r||!o)return 1;const l=zs(this,je.NeedSignalRTT),u=r?r.rttMs:void 0,h=o?o.rttMs:void 0,m=u&&h?(u+h)/2:u||h,g=(m&&l?(m+l)/2:m||l)||0,E=100*e.sendPacketLossRate*.7/50+.3*g/1500,S=E<.17?1:E<.36?2:E<.59?3:E<.1?4:5,R=t==null?void 0:t.track;if(R&&R._encoderConfig&&R._hints.indexOf($t.SCREEN_TRACK)===-1){const b=R._encoderConfig.bitrateMax,x=e.bitrate.actualEncoded;if(b&&x){const P=(1e3*b-x)/(1e3*b);return mF[P<.15?0:P<.3?1:P<.45?2:P<.6?3:4][S]}}return S}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const o=r._audioSSRC,l=r._videoSSRC,u=e.audioRecv.find(x=>x.ssrc===o),h=e.videoRecv.find(x=>x.ssrc===l);if(!u&&!h)return void(t+=1);const m=zs(this,je.NeedSignalRTT),g=e.rtt,E=(g&&m?(g+m)/2:g||m)||0,S=u?u.jitterMs:void 0,R=e.recvPacketLossRate;let b=.7*R*100/50+.3*E/1500;S&&(b=.6*R*100/50+.2*E/1500+.2*S/400),t+=b<.1?1:b<.17?2:b<.36?3:b<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new we((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const r=[],o=bt(),l=this.getAllTracks();e=jm(e=e.filter(m=>l.indexOf(m)===-1));let u=!1,h=!1;for(const m of e){if(m instanceof an&&(this.localTrackMap.has(he.LocalVideoTrack)||u?new oe(B.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:m,type:he.LocalVideoTrack}),u=!0),t)){const g=this.getLowVideoTrack(m,n);r.push({track:g,type:he.LocalVideoLowTrack})}if(m instanceof bn){const g=this.localTrackMap.get(he.LocalAudioTrack);if(g){if(!(g.track instanceof $n))throw new oe(B.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new oe(B.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");g.track.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0)}else if(h){const E=r.find(S=>{let{type:R}=S;return R===he.LocalAudioTrack});if(!(E.track instanceof $n))throw new oe(B.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new oe(B.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(m)}else{if(!o.webAudioMediaStreamDest||m instanceof $n||m._bypassWebAudio)r.push({track:m,type:he.LocalAudioTrack});else{const E=new $n;E.addAudioTrack(m),r.push({track:E,type:he.LocalAudioTrack})}h=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=jm(e=e.filter(r=>n.indexOf(r)!==-1));for(const r of e){if(r instanceof bn){const o=this.localTrackMap.get(he.LocalAudioTrack);if(!o)continue;o.track instanceof $n?(o.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),o.track.trackList.length===0&&(t.push([he.LocalAudioTrack,o]),o.track.close())):t.push([he.LocalAudioTrack,o])}if(r instanceof an){const o=this.localTrackMap.get(he.LocalVideoTrack);if(!o)continue;t.push([he.LocalVideoTrack,o]);const l=this.localTrackMap.get(he.LocalVideoLowTrack);l&&t.push([he.LocalVideoLowTrack,l])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:r}=t;switch(r){case he.LocalVideoTrack:n.addListener(De.GET_STATS,this.handleGetLocalVideoStats),n.addListener(De.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(De.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(De.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(De.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(De.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(De.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(De.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case he.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case he.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof $n?e.trackList.forEach(n=>{n.addListener(De.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(De.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(De.GET_STATS,this.handleGetLocalAudioStats),n.addListener(De.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(De.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(De.GET_STATS,this.handleGetLocalAudioStats),e.addListener(De.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(De.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(De.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(De.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(De.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:r}]=t;return{track:r,type:n}})),e.forEach(t=>{let{track:n,type:r}=t;switch(r){case he.LocalVideoTrack:n.off(De.GET_STATS,this.handleGetLocalVideoStats),n.off(De.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(De.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(De.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(De.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(De.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(De.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(De.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case he.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case he.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof $n?e.trackList.forEach(t=>{t.off(De.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(De.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(De.GET_STATS,this.handleGetLocalAudioStats),t.off(De.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(De.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(De.GET_STATS,this.handleGetLocalAudioStats),e.off(De.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(De.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(De.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(De.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(De.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof eg&&t.addListener(De.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof tg&&t.addListener(De.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(De.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(Pe.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Pe.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,r)=>{var o;let l,{track:u,type:h}=n;switch(h){case he.LocalAudioTrack:l=Mt.Audio;break;case he.LocalVideoTrack:l=Te(o=u._hints).call(o,$t.SCREEN_TRACK)?Mt.Screen:Mt.High;break;case he.LocalVideoLowTrack:l=Mt.Low}return{kind:h===he.LocalAudioTrack?Pe.AUDIO:Pe.VIDEO,stream_type:l,mid:t[r].id,ssrcs:t[r].localSSRC,isMuted:u.muted||!u.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let r,[o,{track:l,ssrcs:u,id:h}]=t;switch(o){case he.LocalVideoTrack:r=Te(n=l._hints).call(n,$t.SCREEN_TRACK)?Mt.Screen:Mt.High;break;case he.LocalAudioTrack:r=Mt.Audio;break;case he.LocalVideoLowTrack:r=Mt.Low}return{stream_type:r,ssrcs:u,mid:h}})}assignLocalTracks(e,t){e.forEach((n,r)=>{let{track:o,type:l}=n;this.localTrackMap.set(l,{track:o,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(je.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),Te(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Si(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),xe.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Tn.TRACER}).onSuccess(),this.emit(je.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const r=Array.from(Ks(n=this.remoteUserMap).call(n)).find(l=>l._audioSSRC===t);var o;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(o=r.audioTrack)===null||o===void 0||o.emit(Xm.FIRST_FRAME_DECODED),xe.firstRemoteFrame(this.store.sessionId,ai.FIRST_AUDIO_DECODE,pn.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Hi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const r=Array.from(Ks(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===t);r&&xe.firstRemoteFrame(this.store.sessionId,ai.FIRST_AUDIO_RECEIVED,pn.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Hi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoReceived=t=>{var n;const r=Array.from(Ks(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===t);r&&xe.firstRemoteFrame(this.store.sessionId,ai.FIRST_VIDEO_RECEIVED,pn.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Hi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const r=t.candidateType==="relay",o=n.candidateType==="relay";n.candidateType!=="unknown"&&r===o||this.emit(je.ConnectionTypeChange,r),A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(ed(n))," -> ").concat(JSON.stringify(ed(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{A.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(ed(n))," -> ").concat(JSON.stringify(ed(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(je.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===_r.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,A.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===_r.SEND_ONLY?this.restartICE(e):Mi(this,je.RequestP2PRestartICE,{direction:_r.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(he.LocalAudioTrack);if(e instanceof bn&&(n==null?void 0:n.track)instanceof $n)return n.track.isActive||t.push([he.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:l}]=o;return e===l});if(r&&(t.push(r),r[0]===he.LocalVideoTrack)){const o=this.localTrackMap.get(he.LocalVideoLowTrack);o&&t.push([he.LocalVideoLowTrack,o])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(he.LocalAudioTrack);if(e instanceof bn&&(n==null?void 0:n.track)instanceof $n)return n.track.isActive&&t.push([he.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:l}]=o;return e===l});if(r)if(r[0]===he.LocalVideoTrack){t.push(r);const o=this.localTrackMap.get(he.LocalVideoLowTrack);o&&t.push([he.LocalVideoLowTrack,o])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var n;let r,[o,{track:l,ssrcs:u,id:h}]=t;switch(o){case he.LocalAudioTrack:r=Mt.Audio;break;case he.LocalVideoTrack:r=Te(n=l._hints).call(n,$t.SCREEN_TRACK)?Mt.Screen:Mt.High;break;case he.LocalVideoLowTrack:r=Mt.Low}return{stream_type:r,ssrcs:u,mid:h}})}createUnmuteMessage(e){return e.map(t=>{var n;let r,[o,{track:l,ssrcs:u,id:h}]=t;switch(o){case he.LocalAudioTrack:r=Mt.Audio;break;case he.LocalVideoTrack:r=Te(n=l._hints).call(n,$t.SCREEN_TRACK)?Mt.Screen:Mt.High;break;case he.LocalVideoLowTrack:r=Mt.Low}return{stream_type:r,ssrcs:u,mid:h}})}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const o=r.get(t);if(!o)return n;n.push([e,{kind:t,id:o}])}else Array.from(r.entries()).forEach(o=>{let[l,u]=o;n.push([e,{kind:l,id:u}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[r,{kind:o,id:l}]=n;switch(o){case Pe.VIDEO:return void(r._videoSSRC&&t.push({stream_type:Pe.VIDEO,ssrcId:r._videoSSRC}));case Pe.AUDIO:return void(r._audioSSRC&&t.push({stream_type:Pe.AUDIO,ssrcId:r._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:r}]=t;const o=this.remoteUserMap.get(n);o&&(o.delete(r),Array.from(o.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(he.LocalVideoTrack),n=this.localTrackMap.get(he.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new we((r,o)=>{this.handleUpdateVideoEncoder(t.track,r,o,!0)})),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new we((r,o)=>{this.handleUpdateVideoEncoder(n.track,r,o,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof bn){const n=this.filterTobeUnmutedTracks(e[t]);if(n.length===0)continue;const r=this.createUnmuteMessage(n);return void await Xt(this,je.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(je.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(je.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Si(xI(this.dtlsFailedCount,Kn)),this.emit(je.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(he.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof an)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof an).length>1)throw new oe(B.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof bn).length>1&&(e.some(t=>t instanceof bn&&t._bypassWebAudio)||!bt().webAudioMediaStreamDest))throw new oe(B.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof an&&this.pendingLocalTracks.some(n=>n instanceof an))throw new oe(B.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof bn&&this.pendingLocalTracks.some(n=>n instanceof bn)&&(!bt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof bn&&n._bypassWebAudio)))throw new oe(B.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&bt().supportDualStreamEncoding,r=tC(tC({},{width:160,height:120,framerate:15,bitrate:50}),t);let o;o=n?e._mediaStreamTrack.clone():zO(e,r);const l=Jt(8,"track-low-"),u=new an(o,tC(tC({},n&&{scaleResolutionDownBy:bO(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,l);return u.on(qh.TRANSCEIVER_UPDATED,h=>{e._updateRtpTransceiver(h,qm.LOW_STREAM)}),u._hints.push($t.LOW_STREAM),e.addListener(De.NEED_CLOSE,()=>{u.close()}),u}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,r){var o;const l=Array.from(Ks(o=this.remoteUserMap).call(o)).find(u=>u._videoSSRC===e);if(l){r||this.store.subscribe(l.uid,"video",void 0,void 0,void 0,void 0,Date.now());const u=this.store.keyMetrics,h=u.subscribe.find(m=>m.userId===l.uid&&m.type==="video");xe.firstRemoteVideoDecode(this.store.sessionId,ai.FIRST_VIDEO_DECODE,pn.FIRST_VIDEO_DECODE,{peer:l._uintid,videowidth:t,videoheight:n,subscribeElapse:Hi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:u.requestAPEnd||0,apStart:u.requestAPStart||0,joinGwEnd:u.joinGatewayEnd||0,joinGwStart:u.joinGatewayStart||0,pcEnd:u.peerConnectionEnd||0,pcStart:u.peerConnectionStart||0,subscriberEnd:(h==null?void 0:h.subscribeEnd)||0,subscriberStart:(h==null?void 0:h.subscribeStart)||0,videoAddNotify:(h==null?void 0:h.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const o=r.get(t);if(!o)return!1;const l=await this.recvConnection.getRemoteSSRC(o);return l!==void 0&&l!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new oe(B.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new oe(B.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new oe(B.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new oe(B.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new oe(B.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new oe(B.NOT_SUPPORTED)}async preConnect(e){throw new oe(B.NOT_SUPPORTED)}getEstablishParams(){throw new oe(B.NOT_SUPPORTED)}async reSubscribe(e){throw new oe(B.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new oe(B.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===he.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,qm.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},ke(mn.prototype,"p2pConnect",[n4],Object.getOwnPropertyDescriptor(mn.prototype,"p2pConnect"),mn.prototype),ke(mn.prototype,"unpublish",[i4],Object.getOwnPropertyDescriptor(mn.prototype,"unpublish"),mn.prototype),ke(mn.prototype,"unpublishLowStream",[r4],Object.getOwnPropertyDescriptor(mn.prototype,"unpublishLowStream"),mn.prototype),ke(mn.prototype,"subscribe",[s4],Object.getOwnPropertyDescriptor(mn.prototype,"subscribe"),mn.prototype),ke(mn.prototype,"mockSubscribe",[o4],Object.getOwnPropertyDescriptor(mn.prototype,"mockSubscribe"),mn.prototype),ke(mn.prototype,"unsubscribe",[a4],Object.getOwnPropertyDescriptor(mn.prototype,"unsubscribe"),mn.prototype),ke(mn.prototype,"muteRemote",[c4],Object.getOwnPropertyDescriptor(mn.prototype,"muteRemote"),mn.prototype),ke(mn.prototype,"unmuteRemote",[l4],Object.getOwnPropertyDescriptor(mn.prototype,"unmuteRemote"),mn.prototype),ke(mn.prototype,"hasRemoteMediaWithLock",[u4],Object.getOwnPropertyDescriptor(mn.prototype,"hasRemoteMediaWithLock"),mn.prototype),ke(mn.prototype,"disconnectForReconnect",[d4],Object.getOwnPropertyDescriptor(mn.prototype,"disconnectForReconnect"),mn.prototype),ke(mn.prototype,"remoteMediaSsrcChanged",[h4],Object.getOwnPropertyDescriptor(mn.prototype,"remoteMediaSsrcChanged"),mn.prototype),mn);function Va(e){return function(t,n,r){const o=t[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];switch(e){case Ua.SEND_ONLY:{const m=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await o.apply(this,u)}finally{m()}}case Ua.RECEIVE_ONLY:{const m=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await o.apply(this,u)}finally{m()}}default:{const m=await this.sendMutex.lock("From P2PChannel2.".concat(n)),g=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await o.apply(this,u)}finally{m(),g()}}}},r}}class fp extends En{constructor(t,n){super(),U(this,"signal",void 0),U(this,"token",void 0),U(this,"tokenTimeout",void 0),U(this,"tokenInterval",void 0),U(this,"_sequence",0),U(this,"userMap",new Map),U(this,"encoder",new TextEncoder),this.signal=t,this.token=n;const r=()=>{this.signal.connectionState===Zt.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(r,1e3):this.tokenInterval=window.setTimeout(r,3*G("P2P_TOKEN_INTERVAL"))};r()}async send(t,n,r,o,l){var u,h,m;if(this.userMap.size===0)return;const g=Array.from(Gs(u=this.userMap).call(u))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),o=(h=o)!==null&&h!==void 0?h:Jt(6,""),l=(m=l)!==null&&m!==void 0?m:this._sequence++;const E={_id:o,_type:t,_seq:l,_message:n,token:"".concat(this.token,"_").concat(g)};G("SHOW_P2P_LOG")&&A.debug("send message",E,"noNeedResponse : ".concat(r)),this.splitMessage(JSON.stringify(E)).forEach(R=>{this.signal.request(Ye.DATA_STREAM,{payload:Xu(this.encoder.encode(R))})});const S=new we((R,b)=>{const x=window.setTimeout(()=>{this.off("res-@".concat(o,"_ack"),P),this.off("res-@".concat(o),V),this.off(og.ABORT,k),A.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(o)),this.userMap.size===0?b(new oe(B.INVALID_REMOTE_USER)):b(new oe(B.TIMEOUT))},G("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),P=()=>{x&&window.clearTimeout(x),this.off(og.ABORT,k),r&&R()},k=()=>{x&&window.clearTimeout(x),this.off("res-@".concat(o,"_ack"),P),this.off("res-@".concat(o),V),b(new oe(B.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(o)))};this.once(og.ABORT,k),this.once("res-@".concat(o,"_ack"),P);const V=(K,$)=>{F=!0,x&&window.clearTimeout(x),this.off("res-@".concat(o,"_ack"),P),this.off(og.ABORT,k),K==="success"?R($):b(new oe(B.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(o)))};let F=!1;r||(this.once("res-@".concat(o),V),Si(G("SIGNAL_REQUEST_TIMEOUT")).then(()=>{F||A.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(o,", ").concat(E))}))});try{return await S}catch(R){if(R.code===B.TIMEOUT)return await this.send(t,n,r,o,l);throw R}}onMessage(t){var n;const{_uid:r}=t;let o,l=this.userMap.get(r);if(l)o=l.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Dn.CHECK)return;const{token:g}=t;o=new Map,l={uid:r,isStart:!0,token:g,splitMessageMap:o,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r,l),this.signal.emit(mt.ON_USER_ONLINE,{uid:r}),this.handleUserOnline()}if("id"in t&&"total"in t){var u;const{id:g,total:E}=t,S=(u=o.get(g))!==null&&u!==void 0?u:[];if(S.push(t),o.has(g)||o.set(g,S),S.length!==E)return;{const R=KE(S).call(S,(b,x)=>b.index-x.index).map(b=>b.payload).join("");o.delete(g),(t=JSON.parse(R))._uid=r}}const{_type:h,token:m}=t;if(Te(n=[Dn.ACK,Dn.CHECK]).call(n,h))return h===Dn.CHECK&&this.handleCheckToken(l,m),void this.receiveMessage(t);m==="".concat(l.token,"_").concat(this.token)?this.handleReceivedMessage(t):A.debug('Receive unexpected message", '.concat(m,", cur_token: ").concat(l.token,"_").concat(this.token),t)}check(){const t={_id:Jt(6,""),token:this.token,_type:Dn.CHECK};G("SHOW_P2P_LOG")&&A.debug("send message",t),this.signal.request(Ye.DATA_STREAM,{payload:Xu(this.encoder.encode(JSON.stringify(t)))})}ack(t){const n={_id:t,_type:Dn.ACK,token:this.token};G("SHOW_P2P_LOG")&&A.debug("send message",n),this.signal.request(Ye.DATA_STREAM,{payload:Xu(this.encoder.encode(JSON.stringify(n)))})}response(t,n,r){this.send(Dn.RESPONSE,JSON.stringify({success:!r,message:n}),!0,t)}handleReceivedMessage(t){const n=()=>{this.userMap.forEach(g=>{const{receivedMessagesMap:E,nextExpectedSequenceNumber:S}=g;for(;E.has(S);){const R=E.get(S);E.delete(S),this.receiveMessage(R),g.nextExpectedSequenceNumber++}})};if(!t)return void n();const{_uid:r,_seq:o}=t,l=this.userMap.get(r),{receivedMessagesMap:u,isStart:h,nextExpectedSequenceNumber:m}=l;if(o<m)return this.ack(t._id),void A.debug("[external-signal] receive old message, seq: ".concat(o,", ").concat(t._message));u.set(o,t),h&&o===m&&(this.receiveMessage(t),u.delete(m),l.nextExpectedSequenceNumber++,n())}receiveMessage(t){const{_id:n,_type:r,_message:o,_uid:l}=t;if(G("SHOW_P2P_LOG")&&A.debug("receive message",t),n){let u;switch(t._type!==Dn.ACK&&(o&&(u=JSON.parse(o)),this.ack(t._id)),t._type){case Dn.CANDIDATE:case Dn.CONTROL:this.signal.emit(r,u,l);break;case Dn.PUBLISH:case Dn.UNPUBLISH:case Dn.RESTART_ICE:case Dn.CALL:u.uid=l,Mi(this.signal,r,u).then(h=>{this.response(t._id,h)}).catch(()=>{this.response(t._id,void 0,!0)});break;case Dn.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case Dn.RESPONSE:{const{success:h,message:m}=u;this.emit("res-@".concat(n),h?"success":"failed",m);break}}}}splitMessage(t){if(t.length<fp.MAX_MESSAGE_SIZE)return[t];const n=[],{remoteToken:r}=JSON.parse(t),o=Jt(6,"");let l=0,u=800;const h=Math.ceil(t.length/u);for(;t.length>0;){l++;const m={id:o,index:l,total:h,payload:t.slice(0,u),token:"".concat(this.token,"_").concat(r)};JSON.stringify(m).length>fp.MAX_MESSAGE_SIZE?u-=50:(n.push(m),t=t.slice(u))}return n.map(m=>JSON.stringify(m))}handleCheckToken(t,n){return t.token!==n?(A.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{A.debug("token timeout, ".concat(n)),this.reset(t.uid)},G("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await Mi(this.signal,Dn.CALL,void 0),n=await this.send(Dn.CALL,t);this.signal.emit(Je.P2P_CONNECTION,n,!0)}async reset(t,n){const r=this.userMap.get(t);r&&(this.emit(og.ABORT),this.signal.emit(mt.ON_USER_OFFLINE,{uid:r.uid,reason:EQ.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(A.debug("change local token from ".concat(n," to ").concat(n)),this.token=Jt(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(og.ABORT)}}U(fp,"MAX_SIZE",1),U(fp,"MAX_MESSAGE_SIZE",1024);class ete extends En{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Zt.CONNECTED?this.emit(Je.WS_CONNECTED):t===Zt.RECONNECTING?this.emit(Je.WS_RECONNECTING,this._websocketReconnectReason):t===Zt.CLOSED&&this.emit(Je.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),U(this,"_disconnectedReason",void 0),U(this,"_websocketReconnectReason",void 0),U(this,"_connectionState",Zt.CLOSED),U(this,"reconnectToken",void 0),U(this,"p2pToken",void 0),U(this,"websocket",void 0),U(this,"openConnectionTime",void 0),U(this,"clientId",void 0),U(this,"lastMsgTime",Date.now()),U(this,"uploadCache",[]),U(this,"uploadCacheInterval",void 0),U(this,"rttRolling",new W2(5)),U(this,"pingpongTimer",void 0),U(this,"pingpongTimeoutCount",0),U(this,"joinResponse",void 0),U(this,"multiIpOption",void 0),U(this,"initError",void 0),U(this,"spec",void 0),U(this,"store",void 0),U(this,"_external_signal",void 0),U(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(Je.ON_BINARY_DATA,r.data);const o=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){const l="res-@".concat(o._id);this.emit(l,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")){switch(o._type){case mt.ON_DATA_STREAM:return void this.handleDataStream(o._message);case mt.MUTE_AUDIO:case mt.MUTE_VIDEO:case mt.ON_P2P_LOST:case mt.ON_USER_ONLINE:return;case mt.ON_USER_OFFLINE:const{uid:l}=o._message;return A.debug("[".concat(this.clientId,"] user-offline uid: ").concat(l)),void this._external_signal.reset(l)}if(this.emit(o._type,o._message),o._type===mt.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===mt.ON_USER_BANNED)switch(o._message.error_code){case 14:this.close(kt.UID_BANNED);break;case 15:this.close(kt.IP_BANNED);break;case 16:this.close(kt.CHANNEL_BANNED)}if(o._type===mt.ON_USER_LICENSE_BANNED)switch(o._message.error_code){case We.ERR_LICENSE_MISSING:this.close(kt.LICENSE_MISSING);break;case We.ERR_LICENSE_EXPIRED:this.close(kt.LICENSE_EXPIRED);break;case We.ERR_LICENSE_MINUTES_EXCEEDED:this.close(kt.LICENSE_MINUTES_EXCEEDED);break;case We.ERR_LICENSE_PERIOD_INVALID:this.close(kt.LICENSE_PERIOD_INVALID);break;case We.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(kt.LICENSE_MULTIPLE_SDK_SERVICE);break;case We.ERR_LICENSE_ILLEGAL:this.close(kt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new wO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,G("JOIN_GATEWAY_USE_DUAL_DOMAIN"),G("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Zt.CONNECTED&&this.reconnect("retry",xi.OFFLINE)}),this.p2pToken=Jt(6,""),this._external_signal=new fp(this,this.p2pToken)}async request(t,n,r,o){const l=Jt(6,""),u={_id:l,_type:t,_message:n},h=this.websocket.connectionID,m=()=>new we((x,P)=>{if(this.connectionState===Zt.CONNECTED)return x();const k=()=>{this.off(Je.WS_CLOSED,V),x()},V=()=>{this.off(Je.WS_CONNECTED,k),P(new oe(B.WS_ABORT))};this.once(Je.WS_CONNECTED,k),this.once(Je.WS_CLOSED,V)});if(this.connectionState!==Zt.CONNECTING&&this.connectionState!==Zt.RECONNECTING||t===Ye.JOIN||t===Ye.REJOIN||await m(),this.websocket.sendMessage(u,!0),o)return;const g=new we((x,P)=>{let k=!1;const V=(K,$)=>{k=!0,x({isSuccess:K==="success",message:$||{}}),this.off(Je.WS_CLOSED,F),this.off(Je.WS_RECONNECTING,F),this.emit(Je.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(l),V);const F=()=>{P(new oe(B.WS_ABORT,"type: ".concat(t))),this.off(Je.WS_CLOSED,F),this.off(Je.WS_RECONNECTING,F),this.off("res-@".concat(l),V)};this.once(Je.WS_CLOSED,F),this.once(Je.WS_RECONNECTING,F),Si(G("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==h||k||(A.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Je.REQUEST_TIMEOUT,t,n))})});let E=null;try{E=await g}catch(x){if(this.connectionState===Zt.CLOSED||t===Ye.LEAVE)throw new oe(B.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?x.throw():t===Ye.JOIN||t===Ye.REJOIN?null:(await m(),await this.request(t,n))}if(E.isSuccess)return E.message;const S=Number(E.message.error_code||E.message.code),R=Ey(S),b=new oe(B.UNEXPECTED_RESPONSE,"".concat(R.desc,": ").concat(E.message.error_str),{code:S,data:E.message,desc:R.desc});return R.action==="success"?E.message:(A.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(S,", message: ").concat(R.desc,", action: ").concat(R.action)),S===We.ERR_TOO_MANY_BROADCASTERS?((t===Ye.JOIN||t===Ye.REJOIN)&&(this.initError=b,this.close()),b.throw()):R.action==="failed"?b.throw():R.action==="quit"?(this.initError=b,this.close(),b.throw()):(S===We.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=E.message.option,A.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",xi.MULTI_IP)):this.reconnect(R.action,xi.SERVER_ERROR),t===Ye.JOIN||t===Ye.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new we(r=>{const o=l=>{(!n||n(l))&&(this.off(t,o),r(l))};this.on(t,o)})}uploadWRTCStats(t){if(!this.store.sessionId)return void A.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(gy.WRTC_STATS,n)}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const l=G("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Zt.CONNECTED)return;const u=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(u._type,u._message)},G("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}async sendExtensionMessage(t,n,r){return await this._external_signal.send(t,n,r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new we((n,r)=>{this.once(Je.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Je.WS_CLOSED,()=>r(this.initError||new oe(B.WS_ABORT))),this.connectionState=Zt.CONNECTING,this.websocket.init(t).catch(r)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||kt.LEAVE,this.connectionState=Zt.CLOSED,A.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Jt(6,""),this._external_signal.clear(),this._external_signal=new fp(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Je.ABORT_P2P_EXECUTION);const t=await Mi(this,Je.REQUEST_JOIN_INFO),n=await this.request(Ye.JOIN,t);if(!n)return this.emit(Je.REPORT_JOIN_GATEWAY,B.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Je.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Zt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleDataStream(t){try{var n;const r=zh(t.payload),o=new TextDecoder().decode(r),l=JSON.parse(o);"total"in l&&"id"in l||Te(n=Object.values(Dn)).call(n,l._type)?(l._uid=t.uid,this._external_signal.onMessage(l)):this.emit(mt.ON_DATA_STREAM,t)}catch{this.emit(mt.ON_DATA_STREAM,t)}}handleNotification(t){A.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Ey(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(kt.UID_BANNED),void this.close()):void this.reconnect(n.action,xi.SERVER_ERROR);A.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=G("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(A.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>G("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",xi.TIMEOUT):this.request(Ye.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),G("REPORT_STATS")&&this.send(Ye.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWebsocketEvents(){this.websocket.on(it.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Je.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(it.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(it.CLOSED,()=>{this.connectionState=Zt.CLOSED}),this.websocket.on(it.FAILED,()=>{this._disconnectedReason=kt.NETWORK_ERROR,this.connectionState=Zt.CLOSED}),this.websocket.on(it.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Zt.CONNECTED?this.connectionState=Zt.RECONNECTING:this.connectionState=Zt.CONNECTING}),this.websocket.on(it.WILL_RECONNECT,(t,n,r)=>{t!=="retry"?(A.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):A.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r(t)}),this.websocket.on(it.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(Je.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof oe&&t.code===B.UNEXPECTED_RESPONSE&&t.data.code===We.ERR_NO_AUTHORIZED)return A.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",xi.SERVER_ERROR);A.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",xi.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(it.REQUEST_NEW_URLS,(t,n)=>{Mi(this,Je.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(it.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(mt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const tte={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new Zee(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new ete(n,t)}};function f4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function m4(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?f4(Object(n),!0).forEach(function(r){U(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f4(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class nte{constructor(t){U(this,"sessionDesc",void 0),U(this,"localCapabilities",void 0),U(this,"rtpCapabilities",void 0),U(this,"candidates",void 0),U(this,"_originCandidates",void 0),U(this,"iceParameters",void 0),U(this,"dtlsParameters",void 0),U(this,"setup",void 0),U(this,"currentMidIndex",void 0),U(this,"cname",void 0),t=Rn(t);const{iceParameters:n,dtlsParameters:r,candidates:o,rtpCapabilities:l,setup:u,localCapabilities:h,sdkCodec:m,cname:g}=t,E=Qr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=l,this.candidates=o,this._originCandidates=Rn(o),this.iceParameters=n,this.dtlsParameters=r,this.setup=u,this.localCapabilities=h,this.cname=g;for(let S=0;S<E.mediaDescriptions.length;S++){const R=E.mediaDescriptions[S];if(R.attributes.iceUfrag=n.iceUfrag,R.attributes.icePwd=n.icePwd,R.attributes.fingerprints=r.fingerprints,R.attributes.candidates=o,R.attributes.setup=u,R.media.mediaType==="video"){R.media.fmts=l.videoCodecs.map(x=>x.payloadType.toString(10));let b=l.videoCodecs.filter(x=>{var P,k;return(P=x.rtpMap)===null||P===void 0?void 0:Te(k=P.encodingName.toLowerCase()).call(k,m)});b.length===0&&(b=l.videoCodecs),R.attributes.payloads=b,R.attributes.extmaps=l.videoExtensions}R.media.mediaType==="audio"&&(R.media.fmts=l.audioCodecs.map(b=>b.payloadType.toString(10)),R.attributes.payloads=l.audioCodecs,R.attributes.extmaps=l.audioExtensions),E.mediaDescriptions[S]=this.mungMediaDesc(R)}this.sessionDesc=E,this.currentMidIndex=E.mediaDescriptions.length-1}toString(){return Ju(this.sessionDesc)}send(t,n,r){const{ssrcs:o,ssrcGroups:l}=ep(n,this.cname),u=this.sessionDesc.mediaDescriptions.find(g=>t===Pe.VIDEO?g.media.mediaType==="video":g.media.mediaType==="audio"),h=o[0].attributes.label,m=o[0].attributes.mslabel;return u.attributes.ssrcs=u.attributes.ssrcs.concat(o),u.attributes.ssrcGroups=u.attributes.ssrcGroups.concat(l),{id:h,mslabel:m}}batchSend(t){return t.map(n=>{let{kind:r,ssrcMsg:o}=n;return this.send(r,o,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(n=>{const r=[],o=[],l=[];n.attributes.ssrcs.forEach(u=>{Te(t).call(t,u.attributes.label||"")?l.push(u):r.push(u)}),n.attributes.ssrcGroups.forEach(u=>{var h;Te(h=l.map(m=>m.ssrcId)).call(h,u.ssrcIds[0])||o.push(u)}),n.attributes.ssrcs=r,n.attributes.ssrcGroups=o})}mute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,r){t.forEach((o,l)=>{const u=o._mediaStreamTrack,h=this.sessionDesc.mediaDescriptions.findIndex(g=>g.attributes.mid===u.kind),m=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[h],o);this.sessionDesc.mediaDescriptions[h]=m})}stopReceiving(t){}updateCandidates(t){const n=this._originCandidates.filter(o=>o.transport==="udp"),r=[];if(n.forEach(o=>{r.push(m4(m4({},o),{},{foundation:"tcpcandidate",priority:Number(o.priority)-1+"",transport:"tcp",port:Number(o.port)+90+""}))}),n.length!==0){switch(t){case zi.TCP_RELAY:this.candidates=r;break;case zi.UDP_TCP_RELAY:case zi.RELAY:this.candidates=[...n,...r];break;default:this.candidates=n}for(const o of this.sessionDesc.mediaDescriptions)o.attributes.candidates=this.candidates}}restartICE(t){t=Rn(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let r=0;r<t;r++)n.push((this.currentMidIndex+r+1).toString(10));return n}mungRecvMediaDsec(t,n){const r=Rn(t);return lg(r,n),IO(r,n),r}updateRecvMedia(t,n){const r=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===t);if(r!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],n);this.sessionDesc.mediaDescriptions[r]=o}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,r){const o=this.sessionDesc.mediaDescriptions.find(u=>t===Pe.VIDEO?u.attributes.mid==="video":u.attributes.mid==="audio");if(o){const u=o.attributes.ssrcs.find(h=>h.attributes.label===n);var l;u&&(u.attributes.label=r,(l=u.attributes.msid)===null||l===void 0||l.replace(n,r))}}mungMediaDesc(t){const n=Rn(t);return AO(n),function(r){const o=r.attributes.extmaps.find(l=>_w(l.extensionName));o&&r.attributes.extmaps.splice(r.attributes.extmaps.indexOf(o),1),r.attributes.payloads.forEach(l=>{const u=l.rtcpFeedbacks.findIndex(h=>h.type==="transport-cc");u!==-1&&l.rtcpFeedbacks.splice(u,1)})}(n),n}getSSRC(t){for(const n of this.sessionDesc.mediaDescriptions)for(const r of n.attributes.ssrcs)if(r.attributes.label===t)return[r]}}var Kt;function g4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function nC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?g4(Object(n),!0).forEach(function(r){U(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g4(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let ite=(Kt=class av extends CF{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return Te(n=Object.keys(KR)).call(n,t)}))]}constructor(t,n){super(t,n),U(this,"store",void 0),U(this,"peerConnection",void 0),U(this,"remoteSDP",void 0),U(this,"initialOffer",void 0),U(this,"statsFilter",void 0),U(this,"useRTX",!1),U(this,"localCapabilities",void 0),U(this,"localCandidateCount",0),U(this,"allCandidatesReceived",!1),U(this,"establishPromise",void 0),U(this,"mutex",void 0),this.store=n,this.mutex=new Gi("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(av.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=jI(this.peerConnection,G("STATS_UPDATE_INTERVAL"),void 0,vn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=td(t.sdp),r=Sy(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:G("FILTER_VIDEO_FEC"),filterAudioFec:G("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=r,this.initialOffer=t,nC(nC({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:t.sdp})}catch(t){throw new oe(B.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new nte(nC(nC({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(t,n){throw new oe(B.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,n){var r=this;return fo(function*(){const o=yield St(r.mutex.lock());try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const l=t.map(R=>r.peerConnection.addTrack(R._mediaStreamTrack)),u=yield St(r.peerConnection.createOffer()),h=Qr(u.sdp),m=t.map(R=>{const b=R._mediaStreamTrack,x=h.mediaDescriptions.find(P=>P.attributes.mid===b.kind);if(!x)throw new Error("Cannot extract ssrc from mediaDescription.");return function(P,k,V){const F=P.attributes.ssrcs.filter($=>$.attributes.label===k),K=P.attributes.ssrcGroups;if(F.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(K&&F.length>1){const $=K.find(Z=>Z.ssrcIds.indexOf(F[0].ssrcId)!==-1);return $?[{ssrcId:$.ssrcIds[0],rtx:V?$.ssrcIds[1]:void 0}]:[{ssrcId:F[0].ssrcId}]}return[{ssrcId:F[0].ssrcId}]}(x,b.id,r.useRTX)});let g;try{g=yield m}catch(R){throw l.forEach(b=>{Li()&&b.replaceTrack(null),r.peerConnection.removeTrack(b)}),R}const E=r.mungSendOfferSDP(u.sdp,t);r.remoteSDP.receive(t,n,g);const S=r.remoteSDP.toString();return yield St(r.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield St(r.applySendEncodings(l,t)),yield St(r.peerConnection.setRemoteDescription({type:"answer",sdp:S})),t.map((R,b)=>{const x=R._mediaStreamTrack.id;return{localSSRC:m[b],id:x}})}catch(l){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{o()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(l=>{var u;return t.indexOf(((u=l.track)===null||u===void 0?void 0:u.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(l=>{Li()&&l.replaceTrack(null),this.peerConnection.removeTrack(l)});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(t);const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,r,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:l,mslabel:u}=this.remoteSDP.send(t,n,o),h=new we((E,S)=>{const R=setTimeout(()=>{S(new Error("Cannot receive track, id: ".concat(l)))},1e4),b=x=>{const P=Tt();if((P.name==="Safari"&&Number(P.version)===11||fr())&&x.track.id!==l&&x.streams[0].id===u){var k;const V=x.streams[0].getTracks()[0];return(k=this.remoteSDP)===null||k===void 0||k.updateTrackLabel(t,l,x.track.id),this.peerConnection.removeEventListener("track",b),clearTimeout(R),void E(V)}if(x.track.id===l)return this.peerConnection.removeEventListener("track",b),clearTimeout(R),void E(x.track)};this.peerConnection.addEventListener("track",b)}),m=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:m});const g=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(g),{track:await h,id:l}}catch(l){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r)}catch(n){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(r=>{var o;return t.indexOf(((o=r.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(r=>{if(Li()&&r.track)r.track.enabled=!1;else{const o=r.getParameters();o.encodings.forEach(l=>l.active=!1),r.setParameters(o)}})}catch(n){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(l=>{var u;return t.indexOf(((u=l.track)===null||u===void 0?void 0:u.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async l=>{if(Li()&&l.track)l.track.enabled=!0;else{const u=l.getParameters();u.encodings.forEach(h=>h.active=!0),await l.setParameters(u)}});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r);const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return fo(function*(){const r=yield St(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const o=bt().supportPCSetConfiguration;if(t===zi.RELAY&&!o)return;if(o){const g=n.peerConnection.getConfiguration(),E=t===zi.RELAY?"relay":"all";g.iceTransportPolicy!==E&&(A.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(g.iceTransportPolicy,"] to [").concat(E,"]")),g.iceTransportPolicy=E,n.peerConnection.setConfiguration(g))}t!==zi.RELAY&&n.remoteSDP.updateCandidates(t);const l=yield St(n.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const u=td(l.sdp),{remoteIceParameters:h}=yield u.iceParameters;n.remoteSDP.restartICE(h);const m=n.remoteSDP.toString();yield St(n.peerConnection.setLocalDescription(l)),yield St(n.peerConnection.setRemoteDescription({type:"answer",sdp:m}))}catch(o){A.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),o)}finally{r()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(r.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const l=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new oe(B.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getSenders().filter(o=>{var l;return((l=o.track)===null||l===void 0?void 0:l.id)===t});r.length===1&&await this.applySendEncodings(r,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getSenders().find(o=>{var l;return((l=o.track)===null||l===void 0?void 0:l.id)===n});r&&await r.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,n){throw new oe(B.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new oe(B.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,A.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,A.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},G("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(cy(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...av.turnServerConfigToIceServers(t.turnServer.servers)),G("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...av.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(t,n){var r;if(n||(n=this.peerConnection.getSenders().find(g=>{var E;return((E=g.track)===null||E===void 0?void 0:E.id)===t._mediaStreamTrack.id})),!n)return A.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!bt().supportSetRtpSenderParameters)return A.warn("Browser not support set rtp-sender parameters");const o={},l={};if(t instanceof an)switch(t._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;default:o.degradationPreference="balanced"}if(G("DSCP_TYPE")&&Ul()){var u;const g=G("DSCP_TYPE");Te(u=["very-low","low","medium","high"]).call(u,g)&&(l.networkPriority=g)}const h=n.getParameters(),m=(r=h.encodings)===null||r===void 0?void 0:r[0];m&&Object.assign(m,l),Object.assign(h,o),A.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await n.setParameters(h)}async applySendEncodings(t,n){try{if(!bt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const o=t[r],l=n[r];o&&l&&await this.updateRtpSenderEncodings(l,o)}}catch{A.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const r=Qr(t);return n.forEach((o,l)=>{const u=o._mediaStreamTrack,h=r.mediaDescriptions.find(m=>m.attributes.mid===u.kind);h&&lg(h,o)}),Ju(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map((l,u)=>{let{id:h,mslabel:m}=l;const{kind:g}=t[u];return new we((E,S)=>{const R=setTimeout(()=>{S(new Error("Cannot receive track, id: ".concat(h)))},1e4),b=x=>{const P=Tt();if(P.name==="Safari"&&Number(P.version)===11&&x.track.id!==h&&x.streams[0].id===m){var k;const V=x.streams[0].getTracks()[0];return(k=this.remoteSDP)===null||k===void 0||k.updateTrackLabel(g,h,x.track.id),this.peerConnection.removeEventListener("track",b),clearTimeout(R),void E({track:V,id:h})}if(x.track.id===h)return this.peerConnection.removeEventListener("track",b),clearTimeout(R),void E({track:x.track,id:h})};this.peerConnection.addEventListener("track",b)})}),r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const o=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(o),await we.all(n)}catch(n){throw new oe(B.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(bt().supportPCSetConfiguration){const n=av.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},ke(Kt.prototype,"connect",[To],Object.getOwnPropertyDescriptor(Kt.prototype,"connect"),Kt.prototype),ke(Kt.prototype,"stopSending",[To],Object.getOwnPropertyDescriptor(Kt.prototype,"stopSending"),Kt.prototype),ke(Kt.prototype,"receive",[To],Object.getOwnPropertyDescriptor(Kt.prototype,"receive"),Kt.prototype),ke(Kt.prototype,"stopReceiving",[To],Object.getOwnPropertyDescriptor(Kt.prototype,"stopReceiving"),Kt.prototype),ke(Kt.prototype,"muteRemote",[To],Object.getOwnPropertyDescriptor(Kt.prototype,"muteRemote"),Kt.prototype),ke(Kt.prototype,"unmuteRemote",[To],Object.getOwnPropertyDescriptor(Kt.prototype,"unmuteRemote"),Kt.prototype),ke(Kt.prototype,"muteLocal",[To],Object.getOwnPropertyDescriptor(Kt.prototype,"muteLocal"),Kt.prototype),ke(Kt.prototype,"unmuteLocal",[To],Object.getOwnPropertyDescriptor(Kt.prototype,"unmuteLocal"),Kt.prototype),ke(Kt.prototype,"close",[To],Object.getOwnPropertyDescriptor(Kt.prototype,"close"),Kt.prototype),ke(Kt.prototype,"updateEncoderConfig",[To],Object.getOwnPropertyDescriptor(Kt.prototype,"updateEncoderConfig"),Kt.prototype),ke(Kt.prototype,"updateSendParameters",[To],Object.getOwnPropertyDescriptor(Kt.prototype,"updateSendParameters"),Kt.prototype),ke(Kt.prototype,"replaceTrack",[To],Object.getOwnPropertyDescriptor(Kt.prototype,"replaceTrack"),Kt.prototype),ke(Kt.prototype,"getRemoteSSRC",[To],Object.getOwnPropertyDescriptor(Kt.prototype,"getRemoteSSRC"),Kt.prototype),Kt);function To(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,l=await o.lock("Locking from P2PConnection.".concat(t));try{for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return await r.apply(this,h)}finally{l()}},n}const rte={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new ite(n,t)}},ste={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!bt().supportWebRTCEncodedTransform)return void A.warning("browser not support audio encoded transform");if(tw.has(e)||!e.track)return;const n={track:e.track};if(Ml()){if(!e.createEncodedStreams)return void A.warning("browser not support createEncodedStreams() API");let o=null;try{o=e.createEncodedStreams()}catch(u){return void A.error("create audio-encoded-streams error",u&&u.message)}const l=new TransformStream({transform(u,h){n.controller||(n.controller=h),e.track&&e.track.id!==n.track.id&&(A.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const m=t.metadata&&t.metadata();m?function(g,E){const{chunk:S,controller:R}=E,b=G("ENABLE_AUDIO_PTS_METADATA")?jl.AUDIO_64_BIT_PTS:jl.METADATA;S.data=function(x,P,k){const V=k.byteLength,F=V+dO+lF,K=lO+uO+F,$=new ArrayBuffer(x.byteLength+K),Z=new DataView($);Z.setUint8(0,cF),Z.setUint16(1,F),Z.setUint8(3,P),Z.setUint16(4,V);for(let re=0;re<V;re++)Z.setUint8(6+re,k[re]);const J=new Uint8Array(Z.buffer);return J.set(new Uint8Array(x),K),J.buffer}(S.data,b,g),R.enqueue(S)}(m,{chunk:u,controller:h}):h.enqueue(u)}});o.readable.pipeThrough(l).pipeTo(o.writable)}else if(Li()){if(typeof RTCRtpScriptTransform>"u")return void A.warning("browser not support RTCRtpScriptTransform");const o=ew(),l=new MessageChannel;await new we(h=>o.onmessage=m=>{m.data==="registered"&&h(void 0)});const u=new RTCRtpScriptTransform(o,{name:"audio-metadata-tx",port:l.port2},[l.port2]);e.transform=u,await new we(h=>o.onmessage=m=>{m.data==="started"&&h(void 0)}),l.port1.onmessage=h=>{var m;if(h.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==n.track.id)A.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r);else if(h.data.getMetadata){const g=t.metadata&&t.metadata();g&&l.port1.postMessage({metadata:g})}},n.worker=o}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const o=tw.get(e);if(o){tw.delete(e);try{var l,u;(l=o.controller)===null||l===void 0||l.terminate(),(u=o.worker)===null||u===void 0||u.terminate()}catch(h){A.warning(h&&h.message)}}}tw.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!bt().supportWebRTCEncodedTransform)return void A.warning("browser not support audio encoded transform");if(aw.has(e))return;const n={track:e.track,onMetadata:t.onMetadata};if(Ml()){if(!e.createEncodedStreams)return void A.warning("browser not support createEncodedStreams() API");RI(Ot.CHROME,87,116)||(t.enableTopn=!1);let o=null;try{o=e.createEncodedStreams()}catch(u){return void A.error("create audio-encoded-streams error",u&&u.message)}const l=new TransformStream({transform(u,h){n.controller||(n.controller=h),e.track&&e.track.id!==n.track.id&&(A.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)),t.enableTopn?function(m,g,E){var S;const R=uF(new DataView(g.data));if(!R)return E.enqueue(g);const b=m.track.id;F$.set(b,m.track);const x=(S=R.tlv.find($=>$.tag===jl.AUDIO_LEVEL))===null||S===void 0?void 0:S.value;let P=0;typeof x=="number"&&(P=127-x);const k=Math.round(Math.pow(10,P/60)-1),{selected:V,speaker:F}=function($,Z){let J=ng.get($);if(J||(J=function(re){const pe=new hF;return ng.set(re,pe),Da||(Da=new U$(G("TOPN_SILENCE_THRESHOLD")||500),Da.on("ActiveSpeakerChanged",Ce=>{Ce!=null&&(rw=Ce)})),Da.addSpeakers([pe]),pe}($)),ng.size<=pF)return{selected:!0,speaker:J};if(!Da)throw new Error("no active speaker detector");return Da.levelChanged(J.id,Z),$h=Da.loudest.map(re=>re.id),rw&&!Te($h).call($h,rw)&&$h.length>=pF&&$h.pop(),{selected:Te($h).call($h,J.id)||J.id===rw,speaker:J}}(m,k),K=function($,Z,J){const re=ka.get($)||new V$($,Z);return re.score=J,ka.set($,re),function(pe){if(sw.set(pe,!0),!ow)return void(ow=Date.now());const Ce=Date.now();Ce-ow>1e3&&(sw.get(pe)?sw.set(pe,!1):(fF(pe),sw.delete(pe)),ow=Ce)}($),re}(b,m.track,F.energyScore);K.addSample(V),K.active&&(g.data=R.frame.buffer,E.enqueue(g))}(e,u,h):t.enableMetadata?function(m,g,E){const S=uF(new DataView(m.data));if(!S)return g.enqueue(m);const R=S.tlv.find(b=>b.tag===jl.METADATA||b.tag===jl.AUDIO_64_BIT_PTS);R&&E&&R.value instanceof Uint8Array&&E(R.value),m.data=S.frame.buffer,g.enqueue(m)}(u,h,t.onMetadata):h.enqueue(u)}});o.readable.pipeThrough(l).pipeTo(o.writable)}else if(Li()){if(typeof RTCRtpScriptTransform>"u")return void A.warning("browser not support RTCRtpScriptTransform");const o=ew(),l=new MessageChannel;await new we(h=>o.onmessage=m=>{m.data==="registered"&&h(void 0)});const u=new RTCRtpScriptTransform(o,{name:"audio-metadata-rx",port:l.port2},[l.port2]);e.transform=u,await new we(h=>o.onmessage=m=>{m.data==="started"&&h(void 0)}),l.port1.onmessage=h=>{var m;h.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==n.track.id?(A.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):h.data.metadata&&n.onMetadata&&n.onMetadata(h.data.metadata)},n.worker=o}function r(){e.track.removeEventListener("ended",r),function(o){const l=aw.get(o);if(l){(function(m){const g=ng.get(m);g&&(ng.delete(m),Da&&(Da.removeSpeakers([g]),ng.size===0&&(Da.destroy(),Da=null)))})(o),fF(o.track.id),aw.delete(o);try{var u,h;(u=l.controller)===null||u===void 0||u.terminate(),(h=l.worker)===null||h===void 0||h.terminate()}catch(m){A.warning(m&&m.message)}}}(e)}aw.set(e,n),e.track.addEventListener("ended",r)},interceptLocalVideoFrame:async function(e,t){if(!bt().supportWebRTCEncodedTransform)return void A.warning("browser not support video encoded transform");if(cw.has(e)||!e.track)return;const n={track:e.track};if(Ml()){if(!e.createEncodedStreams)return void A.warning("browser not support createEncodedStreams() API");let o=null;try{o=e.createEncodedStreams()}catch(h){return void A.error("create video-encoded-streams error",h&&h.message)}const l=[];t.on("sei-to-send",h=>{l.push(h)});const u=new TransformStream({transform(h,m){n.controller||(n.controller=m),e.track&&e.track.id!==n.track.id&&(A.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const g=l.shift();g&&(h.data=function(E,S){const R=function(F){const K=F.length;let $=[],Z=0;for(;Z<K;)Z+2<K&&F[Z]===0&&F[Z+1]===0&&(F[Z+2]===0||F[Z+2]===1||F[Z+2]===2||F[Z+2]===3)?($.push(F[Z],F[Z+1],3,F[Z+2]),Z+=3):($.push(F[Z]),Z++);return new Uint8Array($)}(S),b=R.length,x=Math.floor(b/255),P=b%255,k=new Uint8Array(6+x+1+b+E.byteLength);k[0]=0,k[1]=0,k[2]=0,k[3]=1,k[4]=6,k[5]=101;let V=0;for(;V<x;)k[6+V]=255,V++;return k[6+V]=P,V++,k.set(R,6+V),k.set(new Uint8Array(E),6+V+b),k.buffer}(h.data,g)),m.enqueue(h)}});o.readable.pipeThrough(u).pipeTo(o.writable)}else{if(!Li())return;{if(typeof RTCRtpScriptTransform>"u")return void A.warning("browser not support RTCRtpScriptTransform");const o=ew(),l=new MessageChannel;await new we(h=>o.onmessage=m=>{m.data==="registered"&&h(void 0)});const u=new RTCRtpScriptTransform(o,{name:"sei-tx",port:l.port2},[l.port2]);e.transform=u,await new we(h=>o.onmessage=m=>{m.data==="started"&&h(void 0)}),t.on("sei-to-send",h=>{l.port1.postMessage({sei:h})}),l.port1.onmessage=h=>{var m;h.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==n.track.id&&(A.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r))},n.worker=o}}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const o=cw.get(e);if(o){cw.delete(e);try{var l,u;(l=o.controller)===null||l===void 0||l.terminate(),(u=o.worker)===null||u===void 0||u.terminate()}catch(h){A.warning(h&&h.message)}}}cw.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!bt().supportWebRTCEncodedTransform)return void A.warning("browser not support video encoded transform");if(!e.track)return;if(my.has(e)){const o=my.get(e);return void(o&&(o.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(Ml()){if(!e.createEncodedStreams)return void A.warning("browser not support createEncodedStreams() API");let o=null;try{o=e.createEncodedStreams()}catch(u){return void A.error("create video-encoded-streams error",u&&u.message)}const l=new TransformStream({transform(u,h){n.controller||(n.controller=h),e.track&&e.track.id!==n.track.id&&(A.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const m=function(g){const E=new DataView(g.data);let S=0;for(;S+4<g.data.byteLength;){if(E.getUint8(S+0)===0&&E.getUint8(S+1)===0&&E.getUint8(S+2)===0&&E.getUint8(S+3)===1&&E.getUint8(S+4)===6){let R=S+6,b=0,x=0;for(;(x=E.getUint8(R++))===255;)b+=255;b+=x;const P=B$(g.data,R,b);return new Uint8Array(P)}S++}return null}(u);m&&n.onSei&&n.onSei(m),h.enqueue(u)}});o.readable.pipeThrough(l).pipeTo(o.writable)}else if(Li()){if(typeof RTCRtpScriptTransform>"u")return void A.warning("browser not support RTCRtpScriptTransform");const o=ew(),l=new MessageChannel;await new we(h=>o.onmessage=m=>{m.data==="registered"&&h(void 0)});const u=new RTCRtpScriptTransform(o,{name:"sei-rx",port:l.port2},[l.port2]);e.transform=u,await new we(h=>o.onmessage=m=>{m.data==="started"&&h(void 0)}),l.port1.onmessage=h=>{var m;h.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==n.track.id?(A.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):h.data.sei&&n.onSei&&n.onSei(h.data.sei)},n.worker=o}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}(function(o){const l=my.get(o);if(l){my.delete(o);try{var u,h;(u=l.controller)===null||u===void 0||u.terminate(),(h=l.worker)===null||h===void 0||h.terminate()}catch(m){A.warning(m&&m.message)}}})(e)}my.set(e,n),e.track.addEventListener("ended",r)}},ote={name:"InterceptFrame",create:()=>ste};GI(),Vt("PROCESS_ID","process-".concat(Jt(8,""),"-").concat(Jt(4,""),"-").concat(Jt(4,""),"-").concat(Jt(4,""),"-").concat(Jt(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void A.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();A.debug("Loading global parameters from cache",t),Object.keys(t).forEach(r=>{if(Object.prototype.hasOwnProperty.call(on,r)){const{value:o,expires:l}=t[r];if(l&&l<=n)return;Pa[r]=o,on[r]=o}})}catch(t){A.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(Pa.AREAS)&&Pa.AREAS.length>0&&kO(Pa.AREAS,!0);const _4=(e,t,n)=>{A.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),Vt(e,t,n)};nd(Oee,!1),nd(Dee,!1),nd(dZ,!1),nd(Wee,!1),nd(bee,!1),nd(tte,!1),nd(rte,!1),nd(ote,!1);const qn=function(e){const t=new En,n=e,r={getListeners:t.getListeners.bind(t),on:(o,l)=>(function(u,h){u===Ac.SECURITY_POLICY_VIOLATION&&$j(h,!0)}(o,l),t.on.bind(t)(o,l)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return Jj(Jj({},n),r)}({__TRACK_LIST__:Km,VERSION:mo,BUILD:HI,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:_4,getParameter:G,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(r){let o;return bt().supportUnifiedPlan?(r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"}),o=(await r.createOffer()).sdp):o=(await r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,o}(t);if(!n)return e;t.close(),t=null,e=function(r){const o={video:[],audio:[]};return r.match(/ VP8/i)&&o.video.push("VP8"),r.match(/ VP9/i)&&o.video.push("VP9"),r.match(/ AV1/i)&&o.video.push("AV1"),r.match(/ H264/i)&&o.video.push("H264"),r.match(/ H265/i)&&o.video.push("H265"),r.match(/ opus/i)&&o.audio.push("OPUS"),r.match(/ PCMU/i)&&o.audio.push("PCMU"),r.match(/ PCMA/i)&&o.audio.push("PCMA"),r.match(/ G722/i)&&o.audio.push("G722"),o}(n)}catch(t){throw new ie(B.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=xe.reportApiInvoke(null,{name:Hn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Tn.TRACER});let t=!1;try{const l=window.RTCPeerConnection,u=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,h=window.WebSocket;t=!!(l&&u&&h),t&&AI()&&E2(75)&&new l().close()}catch(l){return A.error("check system requirement failed: ",l),!1}let n=!1;const r=Tt();r.name===Ot.CHROME&&Number(r.version)>=58&&(Oa.engine.name!=="WebKit"||function(){const l=Tt();if(UR()){if(l.os===oi.MAC_OS)return!0;if(l.os===oi.IOS){const u=Oa.os.version&&Oa.os.version.split(".");if(u&&Number(u[0])===14&&u[1]&&Number(u[1])>=3||u&&Number(u[0])>14)return!0}}return!1}())&&(n=!0),(r.name===Ot.FIREFOX&&Number(r.version)>=56||r.name===Ot.OPERA&&Number(r.version)>=45||r.name===Ot.SAFARI&&Number(r.version)>=11||r.name==="WebKit"&&(fr()||Go())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||w2()||Tt().name===Ot.QQ)&&(n=!0),A.debug("checkSystemRequirements, api:",t,"browser",n);const o=t&&n;return e.onSuccess(o),o},getDevices:function(e){return $s.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return $s.getRecordingDevices(e)},getCameras:function(e){return $s.getCamerasDevices(e)},getElectronScreenSources:EU,getPlaybackDevices:function(e){return $s.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=Jt(5,"client-"),r=xe.reportApiInvoke(null,{id:n,name:Hn.CREATE_CLIENT,options:[t],tag:Tn.TRACER});try{(function(o){ei(o.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),ei(o.mode,"config.mode",["rtc","live","p2p"]),o.audioCodec!==void 0&&ei(o.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),o.proxyServer!==void 0&&vi(o.proxyServer,"config.proxyServer",1,1e4),o.turnServer!==void 0&&D2(o.turnServer),o.httpRetryConfig!==void 0&&P2(o.httpRetryConfig),o.websocketRetryConfig!==void 0&&P2(o.websocketRetryConfig)})(t)}catch(o){throw r.onError(o),o}return(v2(16,0)||S2(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",A.debug("browser not support vp9, force use vp8")),Vt("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),r.onSuccess(),new hZ(Jo(Jo({forceWaitGatewayResponse:!0},t),{},{role:Te(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=G("CAMERA_CAPTURE_CONFIG"),n=Jt(8,"track-cam-"),r=xe.reportApiInvoke(null,{id:n,tag:Tn.TRACER,name:Hn.CREATE_CAM_VIDEO_TRACK,options:[fn({},e),t]});t&&(e.encoderConfig=t);const o=QR(e);let l=null;A.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{l=(await Js({video:o},n)).getVideoTracks()[0]||null}catch(h){throw r.onError(h),h}if(!l){const h=new oe(B.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(h),h.throw(A)}e.optimizationMode&&cO(n,l,e,wc(e.encoderConfig));const u=new aO(l,e,o,e.scalabiltyMode?YR(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return r.onSuccess(u.getTrackId()),A.info("create camera video success, trackId:",n),u},createCustomVideoTrack:function(e){const t=Jt(8,"track-cus-"),n=xe.reportApiInvoke(null,{id:t,tag:Tn.TRACER,name:Hn.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),r=new an(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?YR(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[$t.CUSTOM_TRACK]);return n.onSuccess(r.getTrackId()),A.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof t=="object"?function(R){return IU(R)}(t):void 0;n&&(t="auto");const r=Jt(8,"track-scr-v-"),o=xe.reportApiInvoke(null,{id:r,tag:Tn.TRACER,name:Hn.CREATE_SCREEN_VIDEO_TRACK,options:[fn({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const l=function(R){const b={};R.screenSourceType&&(b.mediaSource=R.screenSourceType),R.extensionId&&Ml()&&(b.extensionId=R.extensionId);const{displaySurface:x,selfBrowserSurface:P,surfaceSwitching:k,systemAudio:V,preferCurrentTab:F}=R;(ry(107)||wI(107)||CI(93))&&(x&&(ei(x,"displaySurface",["browser","window","monitor"]),b.displaySurface=x),P?(ei(P,"selfBrowserSurface",["exclude","include"]),b.selfBrowserSurface=P):b.selfBrowserSurface="include",k&&(ei(k,"surfaceSwitching",["exclude","include"]),b.surfaceSwitching=k)),(ry(105)||wI(105)||CI(91))&&V&&(ei(V,"systemAudio",["exclude","include"]),b.systemAudio=V),(ry(94)||wI(94)||CI(80))&&F&&(b.preferCurrentTab=!0),R.electronScreenSourceId&&(b.sourceId=R.electronScreenSourceId);const K=R.encoderConfig?JI(R.encoderConfig):null;return b.mandatory={chromeMediaSource:"desktop",maxWidth:K?K.width:void 0,maxHeight:K?K.height:void 0},K&&(K.frameRate&&(typeof K.frameRate=="number"?(b.mandatory.maxFrameRate=K.frameRate,b.mandatory.minFrameRate=K.frameRate):(b.mandatory.maxFrameRate=K.frameRate.max||K.frameRate.ideal||K.frameRate.exact||void 0,b.mandatory.minFrameRate=K.frameRate.min||K.frameRate.ideal||K.frameRate.exact||void 0),b.frameRate=K.frameRate),K.width&&(b.width=K.width),K.height&&(b.height=K.height)),b}(e);let u=null,h=null;const m=bt();if(!m.supportShareAudio&&t==="enable"){const R=new oe(B.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return o.onError(R),R.throw(A)}A.info("start create screen video track with config",e,"withAudio",t,"trackId",r);const g=m.supportShareAudio&&t!=="disable";try{const R=await Js({screen:l,screenAudio:g?n||!0:void 0},r);u=R.getVideoTracks()[0]||null,h=R.getAudioTracks()[0]||null}catch(R){throw o.onError(R),R}if(!u){const R=new oe(B.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(R),R.throw(A)}if(!h&&t==="enable"){u&&u.stop();const R=new oe(B.SHARE_AUDIO_NOT_ALLOWED);return o.onError(R),R.throw(A)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(cO(r,u,e,e.encoderConfig&&JI(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const E=new an(u,e.encoderConfig?JI(e.encoderConfig):{},e.scalabiltyMode?YR(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[$t.SCREEN_TRACK]);if(!h)return o.onSuccess(E.getTrackId()),A.info("create screen video track success","video:",E.getTrackId()),E;const S=new bn(h,void 0,Jt(8,"track-scr-a-"),!1);return o.onSuccess([E.getTrackId(),S.getTrackId()]),A.info("create screen video track success","video:",E.getTrackId(),"audio:",S.getTrackId()),[E,S]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=G("CAMERA_CAPTURE_CONFIG"),r=Jt(8,"track-mic-"),o=Jt(8,"track-cam-"),l=xe.reportApiInvoke(null,{id:"".concat(r,"-").concat(o),tag:Tn.TRACER,name:Hn.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const u=QR(t),h=OU(e);let m=null,g=null;A.info("start create camera video track(".concat(o,") and microphone audio track(").concat(r,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const R=await Js({audio:h,video:u},"".concat(r,"-").concat(o));m=R.getAudioTracks()[0],g=R.getVideoTracks()[0]}catch(R){throw l.onError(R),R}if(!m||!g){const R=new oe(B.UNEXPECTED_ERROR,"can not find tracks in media stream");return l.onError(R),R.throw(A)}t.optimizationMode&&cO(o,g,t,wc(t.encoderConfig));const E=new ZR(m,e,h,r),S=new aO(g,t,u,t.scalabiltyMode?YR(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,o);return l.onSuccess([E.getTrackId(),S.getTrackId()]),A.info("create camera video track(".concat(o,") and microphone audio track(").concat(r,") success")),[E,S]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Jt(8,"track-mic-"),n=xe.reportApiInvoke(null,{id:t,tag:Tn.TRACER,name:Hn.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=OU(e);let o=null;A.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{o=(await Js({audio:r},t)).getAudioTracks()[0]||null}catch(u){throw n.onError(u),u}if(!o){const u=new oe(B.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(u),u.throw(A)}const l=new ZR(o,e,r,t);return n.onSuccess(l.getTrackId()),A.info("create microphone audio track success, trackId:",t),l},createCustomAudioTrack:function(e){const t=Jt(8,"track-cus-"),n=xe.reportApiInvoke(null,{id:t,tag:Tn.TRACER,name:Hn.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new bn(e.mediaStreamTrack,e.encoderConfig?XR(e.encoderConfig):{},t,!1);return A.info("create custom audio track success with config",e,"trackId",r.getTrackId()),n.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:r}=e;let{source:o}=e;const l={source:o instanceof AudioBuffer?"AudioBuffer":o instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":o,cacheOnlineFile:n,encoderConfig:r},u=Jt(8,"track-buf-"),h=xe.reportApiInvoke(null,{id:u,tag:Tn.TRACER,name:Hn.CREATE_BUFFER_AUDIO_TRACK,options:[l]});if(G("DISABLE_WEBAUDIO"))throw new oe(B.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");A.info("start create buffer source audio track with config",JSON.stringify(l),"trackId",u);const m=o;if(!(o instanceof AudioBuffer))try{o=await async function(S,R){let b=null;if(typeof S=="string"){const P=mV.get(S);if(P)return A.debug("use cached audio resource: ",S),P;try{b=(await Na(()=>Pr.get(S,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(k){throw new oe(B.FETCH_AUDIO_FILE_FAILED,k.toString())}}else b=await new we((k,V)=>{const F=new FileReader;F.onload=K=>{K.target?k(K.target.result):V(new oe(B.READ_LOCAL_AUDIO_FILE_ERROR))},F.onerror=()=>{V(new oe(B.READ_LOCAL_AUDIO_FILE_ERROR))},F.readAsArrayBuffer(S)});const x=await function(P){const k=Qm();return new we((V,F)=>{k.decodeAudioData(P,K=>{V(K)},K=>{F(new oe(B.DECODE_AUDIO_FILE_FAILED,K.toString()))})})}(b);return typeof S=="string"&&R&&mV.set(S,x),x}(o,n)}catch(S){return h.onError(S),S.throw(A)}const g=new D$(o),E=new P$(m,g,r?XR(r):{},u);return A.info("create buffer source audio track success, trackId:",u),h.onSuccess(E.getTrackId()),E},setAppType:function(e){if(A.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw A.debug("Invalid appType"),new ie(B.INVALID_PARAMS,"invalid app type",e);Vt("APP_TYPE",Math.floor(e))},setLogLevel:function(e){A.setLogLevel(e)},enableLogUpload:function(){G("USE_NEW_LOG")?Vt("UPLOAD_LOG",!0):A.enableLogUpload()},disableLogUpload:function(){G("USE_NEW_LOG")?Vt("UPLOAD_LOG",!1):A.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new mB},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=xe.reportApiInvoke(null,{tag:Tn.TRACER,name:Hn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof bn||e instanceof tg)){const m=new ie(B.INVALID_TRACK,"the parameter is not a audio track");return n.onError(m),m.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof bn?e.getTrackLabel():"remote_track",o=e.getVolumeLevel();let l=o,u=o;const h=Date.now();return new we(m=>{const g=setInterval(()=>{const E=e.getVolumeLevel();l=E>l?E:l,u=E<u?E:u;const S=l-u>1e-4,R=Date.now()-h;if(S||R>t){clearInterval(g);const b=S,x={duration:R,deviceLabel:r,maxVolumeLevel:l,result:b};A.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(x))),n.onSuccess(x),m(b)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=xe.reportApiInvoke(null,{tag:Tn.TRACER,name:Hn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof an||e instanceof eg)){const S=new ie(B.INVALID_TRACK,"the parameter is not a video track");return n.onError(S),S.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof an?e.getTrackLabel():"remote_track",o=e.getMediaStreamTrack(!0),l=document.createElement("video");l.style.width="1px",l.style.height="1px",l.setAttribute("muted",""),l.muted=!0,l.setAttribute("playsinline",""),l.controls=!1,(Li()||UR())&&(l.style.opacity="0.01",l.style.position="fixed",l.style.left="0",l.style.top="0",document.body.appendChild(l)),l.srcObject=new MediaStream([o]),l.play();const u=document.createElement("canvas");u.width=160,u.height=120;let h=0,m=0;try{const S=Date.now();h=await function(R,b,x,P){let k,V=0,F=null;return new we((K,$)=>{function Z(){V>P&&k&&(k(),K(V));const J=x.getContext("2d");if(!J){const Ce=new ie(B.UNEXPECTED_ERROR,"can not get canvas 2d context.");return A.error(Ce.toString()),void $(Ce)}J.drawImage(R,0,0,160,120);const re=J.getImageData(0,0,x.width,x.height),pe=Math.floor(re.data.length/3);if(F){for(let Ce=0;Ce<pe;Ce+=3)if(re.data[Ce]!==F[Ce])return V+=1,void(F=re.data);F=re.data}else F=re.data}setTimeout(()=>{k&&(k(),K(V))},b),k=tO(()=>{Z()},30)})}(l,t,u,4),m=Date.now()-S}catch(S){throw n.onError(S),S}$Q===Ot.SAFARI&&(l.pause(),l.remove()),l.srcObject=null;const g=h>4,E={duration:m,changedPicNum:h,deviceLabel:r,result:g};return A.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(E))),n.onSuccess(E),g},setArea:kO,audioElementPlayCenter:Dr,resumeAudioContext:function(){Dr.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){fZ.processExternalMediaAEC(e)},registerExtensions:function(e){const t=G("PLUGIN_INFO")||[];e.forEach(n=>{"name"in n&&!Te(t).call(t,n.name)&&t.push(n.name);const r=n;r.__registered__=!0,r.logger.hookLog=A.extLog,r.reporter.hookApiInvoke=xe.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach(o=>{r.parameters[o]=G(o)})}),_4("PLUGIN_INFO",t)},ChannelMediaRelayError:rg,ChannelMediaRelayEvent:Wl,ChannelMediaRelayState:Zr,RemoteStreamFallbackType:w$,RemoteStreamType:R$,ConnectionDisconnectedReason:kt,AudienceLatencyLevelType:e$,AREAS:Nt,preload:async function(e,t,n,r){return GB(e,t,n,r)}});return Object.defineProperties(qn,{onAudioAutoplayFailed:{get:()=>Qs.onAudioAutoplayFailed,set:e=>{Qs.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Qs.onAutoplayFailed,set:e=>{Qs.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>qn._onSecurityPolicyViolation,set(e){qn._onSecurityPolicyViolation=e,$j(e)}},__CLIENT_LIST__:{get:()=>G("SHOW_GLOBAL_CLIENT_LIST")?Qh:[]}}),$s.on(Yh.CAMERA_DEVICE_CHANGED,e=>{A.info("camera device changed",JSON.stringify(e)),qn.onCameraChanged&&qn.onCameraChanged(e),qn.safeEmit(Ac.CAMERA_CHANGED,e)}),$s.on(Yh.RECORDING_DEVICE_CHANGED,e=>{A.info("microphone device changed",JSON.stringify(e)),qn.onMicrophoneChanged&&qn.onMicrophoneChanged(e),qn.safeEmit(Ac.MICROPHONE_CHANGED,e)}),$s.on(Yh.PLAYOUT_DEVICE_CHANGED,e=>{A.debug("playout device changed",JSON.stringify(e)),qn.onPlaybackDeviceChanged&&qn.onPlaybackDeviceChanged(e),qn.safeEmit(Ac.PLAYBACK_DEVICE_CHANGED,e)}),Dr.onAutoplayFailed=()=>{A.info("detect audio element autoplay failed"),Qs.onAudioAutoplayFailed&&Qs.onAudioAutoplayFailed()},Ft.on("autoplay-failed",()=>{A.info("detect webaudio autoplay failed"),Qs.onAudioAutoplayFailed&&Qs.onAudioAutoplayFailed(),qn.safeEmit(Ac.AUTOPLAY_FAILED)}),Ft.on(Ri.STATE_CHANGE,(e,t)=>{A.info("audio context state changed: ".concat(t," => ").concat(e)),qn.onAudioContextStateChanged&&qn.onAudioContextStateChanged(e,t),qn.safeEmit(Ac.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),Un.on(Bm.NETWORK_STATE_CHANGE,(e,t)=>{A.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=qn),qn})}(VC)),VC.exports}var Pye=Nye();const FG=BG(Pye),Rp=lv("http://localhost:5001"),Dye="665f7a8ddf874c68a762eeb828338b90",kye=()=>{const[s,i]=_e.useState("idle"),[a,c]=_e.useState(null),p=_e.useRef(null),_=_e.useRef(null),y=_e.useRef(null),T=async(L,j,Y)=>{try{const X=FG.createClient({mode:"rtc",codec:"vp8"});p.current=X,await X.join(Dye,L,j,Y);const ee=await FG.createMicrophoneAudioTrack();_.current=ee,await X.publish(ee),X.on("user-published",async(Q,se)=>{await X.subscribe(Q,se),se==="audio"&&(y.current=Q.audioTrack,Q.audioTrack.play(),i("connected"))}),X.on("user-left",()=>{i("partnerLeft"),C()})}catch(X){console.error("Error joining channel:",X),i("error")}},C=()=>{p.current&&p.current.leave(),_.current&&_.current.close(),y.current&&y.current.stop(),p.current=null,_.current=null,y.current=null,Rp.emit("leaveCall")},I=()=>{C(),Rp.emit("endCall",{partnerId:a}),i("idle"),c(null)},D=()=>{i("searching"),Rp.emit("randomCall")};return _e.useEffect(()=>(Rp.on("callMatched",({channelName:L,token:j,uid:Y,partnerId:X})=>{c(X),T(L,j,Y)}),Rp.on("callEnded",({initiator:L})=>{i(L?"idle":"partnerLeft"),C()}),()=>{C(),Rp.off("callMatched"),Rp.off("callEnded")}),[]),H.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-indigo-500 via-purple-600 to-pink-500 flex flex-col items-center justify-center p-6 text-white",children:[H.jsx("h2",{className:"text-4xl font-extrabold mb-10 drop-shadow-xl text-center",children:" Random Voice Chat"}),s==="idle"&&H.jsxs("button",{onClick:D,className:"px-8 py-4 bg-green-500 text-xl font-semibold rounded-full shadow-lg hover:bg-green-600 transition-all duration-200",children:[H.jsx(foe,{className:"inline-block mr-2"})," Start Random Call"]}),s==="searching"&&H.jsxs("div",{className:"flex flex-col items-center bg-white/10 backdrop-blur-lg p-6 rounded-2xl shadow-xl max-w-md w-full",children:[H.jsx(moe,{className:"animate-spin text-3xl mb-4"}),H.jsx("p",{className:"text-lg",children:"Looking for someone to chat with..."}),H.jsx("button",{onClick:C,className:"mt-6 px-6 py-2 bg-red-500 rounded-full font-semibold hover:bg-red-600 transition",children:"Cancel"})]}),s==="connected"&&H.jsxs("div",{className:"flex flex-col items-center bg-white/10 backdrop-blur-lg p-6 rounded-2xl shadow-xl max-w-md w-full",children:[H.jsx("p",{className:"mb-4 text-xl",children:"You're now connected "}),H.jsx("div",{className:"w-20 h-20 bg-green-500 rounded-full flex items-center justify-center text-3xl shadow-lg mb-4",children:H.jsx(hoe,{})}),H.jsxs("button",{onClick:I,className:"px-6 py-2 bg-red-500 rounded-full font-semibold hover:bg-red-600 transition",children:[H.jsx(poe,{className:"inline-block mr-2"})," End Call"]})]}),s==="partnerLeft"&&H.jsxs("div",{className:"text-center bg-white/10 backdrop-blur-lg p-6 rounded-2xl shadow-xl max-w-md w-full",children:[H.jsx("p",{className:"mb-4 text-red-300 font-bold",children:"Your partner has left the call "}),H.jsx("button",{onClick:()=>{i("idle"),c(null)},className:"px-6 py-2 bg-blue-600 rounded-full font-semibold hover:bg-blue-700 transition",children:"Try Again"})]})]})},Lye=()=>{const{authUser:s,checkAuth:i,isCheckingAuth:a}=$c(),{theme:c}=XW();return _e.useEffect(()=>{i()},[i]),a&&!s?H.jsx("div",{className:"flex items-center justify-center h-screen",children:H.jsx(Fse,{className:"size-10 animate-spin"})}):H.jsxs("div",{"data-theme":c,children:[H.jsx(jse,{}),H.jsxs(ane,{children:[H.jsx(Zl,{path:"/",element:H.jsx(bye,{})}),H.jsx(Zl,{path:"/list",element:H.jsx(Iye,{})}),H.jsx(Zl,{path:"/call",element:H.jsx(kye,{})}),H.jsx(Zl,{path:"/home",element:s?H.jsx(Yse,{}):H.jsx(oC,{to:"/login"})}),H.jsx(Zl,{path:"/signup",element:s?H.jsx(oC,{to:"/"}):H.jsx(Xse,{})}),H.jsx(Zl,{path:"/login",element:s?H.jsx(oC,{to:"/"}):H.jsx(Jse,{})}),H.jsx(Zl,{path:"/settings",element:H.jsx(Zse,{})}),H.jsx(Zl,{path:"/profile",element:s?H.jsx(eoe,{}):H.jsx(oC,{to:"/login"})})]}),H.jsx(Fre,{})]})};gte.createRoot(document.getElementById("root")).render(H.jsx(_e.StrictMode,{children:H.jsx(fne,{children:H.jsx(Lye,{})})}));
